<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>java笔记</title>
      <link href="/2024/12/21/blog-open-source-javanote/"/>
      <url>/2024/12/21/blog-open-source-javanote/</url>
      
        <content type="html"><![CDATA[<iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="100%" height="86" src="//music.163.com/outchain/player?type=2&amp;id=1973133244&amp;auto=1&amp;height=66"></iframe><h2 id="java笔记"><a href="#java笔记" class="headerlink" title="java笔记"></a>java笔记</h2><h3 id="说说进程和线程的区别？"><a href="#说说进程和线程的区别？" class="headerlink" title="说说进程和线程的区别？"></a>说说进程和线程的区别？</h3><p>进程是程序的一次执行，是系统进行资源分配和调度的独立单位，他的作用是是程序能够并发执行提高资源利用率和吞吐率。</p><p>由于进程是资源分配和调度的基本单位，因为进程的创建、销毁、切换产生大量的时间和空间的开销，进程的数量不能太多，而线程是比进程更小的能独立运行的基本单位，他是进程的一个实体，可以减少程序并发执行时的时间和空间开销，使得操作系统具有更好的并发性。</p><p>线程基本不拥有系统资源，只有一些运行时必不可少的资源，比如程序计数器、寄存器和栈，进程则占有堆、栈。</p><p>操作系统的线程状态：新建、就绪、运行、阻塞、终止</p><p>java的线程状态：新建、运行、阻塞、等待、超时等待、终止</p><h3 id="1、重载和重写的区别"><a href="#1、重载和重写的区别" class="headerlink" title="1、重载和重写的区别"></a>1、重载和重写的区别</h3><p><strong>重载：</strong> 发生在同一个类中，方法名必须相同，参数类型不同、个数不同、顺序不同，方法返回值和访问修饰符可以不同。</p><p><strong>重写：</strong> 发生在父子类中，方法名、参数列表必须相同，返回值范围小于等于父类，抛出的异常范围小于等于父类，访问修饰符范围大于等于父类；如果父类方法访问修饰符为 private 则子类就不能重写该方法。</p><h3 id="2、static-关键字是干什么用的？谈谈你的理解"><a href="#2、static-关键字是干什么用的？谈谈你的理解" class="headerlink" title="2、static 关键字是干什么用的？谈谈你的理解"></a>2、static 关键字是干什么用的？谈谈你的理解</h3><p>static 是 Java 中非常重要的关键字，static 表示的概念是 <code>静态的</code>，在 Java 中，static 主要用来</p><ul><li>修饰变量，static 修饰的变量称为<code>静态变量</code>、也称为<code>类变量</code>，类变量属于类所有，对于不同的类来说，static 变量只有一份，static 修饰的变量位于方法区中；static 修饰的变量能够直接通过 类名.变量名 来进行访问，不用通过实例化类再进行使用。</li><li>修饰方法，static 修饰的方法被称为<code>静态方法</code>，静态方法能够直接通过 类名.方法名来使用，在静态方法内部不能使用非静态属性和方法</li><li>static 可以修饰代码块，主要分为两种，一种直接定义在类中，使用 <code>static{}</code>，这种被称为<code>静态代码块</code>，一种是在类中定义<code>静态内部类</code>，使用 <code>static class xxx</code> 来进行定义。</li><li>static 可以用于静态导包，通过使用 <code>import static xxx</code>  来实现，这种方式一般不推荐使用</li><li>static 可以和单例模式一起使用，通过双重检查锁来实现线程安全的单例模式。</li></ul><h3 id="final-关键字是干什么用的？谈谈你的理解"><a href="#final-关键字是干什么用的？谈谈你的理解" class="headerlink" title="final 关键字是干什么用的？谈谈你的理解"></a>final 关键字是干什么用的？谈谈你的理解</h3><p>final 是 Java 中的关键字，它表示的意思是 <code>不可变的</code>，在 Java 中，final 主要用来</p><ul><li>修饰类，final 修饰的类不能被继承，不能被继承的意思就是不能使用 <code>extends</code> 来继承被 final 修饰的类。</li><li>修饰变量，final 修饰的变量不能被改写，不能被改写的意思有两种，对于基本数据类型来说，final 修饰的变量，其值不能被改变，final 修饰的对象，对象的引用不能被改变，但是对象内部的属性可以被修改。final 修饰的变量在某种程度上起到了<code>不可变</code>的效果，所以，可以用来保护只读数据，尤其是在并发编程中，因为明确的不能再为 final 变量进行赋值，有利于减少额外的同步开销。</li><li>修饰方法，final 修饰的方法不能被重写。</li></ul><h3 id="2、StringBuild和StringBuffer还有String"><a href="#2、StringBuild和StringBuffer还有String" class="headerlink" title="2、StringBuild和StringBuffer还有String"></a>2、StringBuild和StringBuffer还有String</h3><p>他们的无参构造器的初始容量都为16，有参的为参数长度加上16。</p><p>StringBuffer 对方法加了同步锁或者对调用的方法加了同步锁，所以是线程安全的。StringBuilder 并没有对方法进行加同步锁，所以是非线程安全的。每次 String 类型进行改变的时候，都会生成一个新的 String 对象，然后将指针指向新的 String 对象。StringBuffer 每次都会对 StringBuffer 对象本身进行操作，而不是生成新的对象并改变对象引用。</p><p><strong>对于三者使用的总结：</strong></p><ol><li><p>操作少量的数据 ： String</p></li><li><p>单线程操作字符串缓冲区下操作大量数据 ：StringBuilder</p></li><li><p>多线程操作字符串缓冲区下操作大量数据 ：StringBuffer</p></li><li><p>String的equals源码</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original=".%5Cimages%5CString%E7%9A%84equals%E6%BA%90%E7%A0%81.png" alt="image-20210816170633107"></p></li></ol><h3 id="3、接口和抽象类的区别是什么"><a href="#3、接口和抽象类的区别是什么" class="headerlink" title="3、接口和抽象类的区别是什么"></a>3、接口和抽象类的区别是什么</h3><ol><li><p>接口的方法默认是 public，所有方法在接口中不能有实现(Java 8 开始接口方法可以有默认实现），抽象类可以有非抽象的方法</p></li><li><p>接口中的实例变量默认是 final 类型的，而抽象类中则不一定</p></li><li><p>一个类可以实现多个接口，但最多只能实现一个抽象类</p></li><li><p>一个类实现接口的话要实现接口的所有方法，而抽象类不一定</p></li><li><p>接口不能用 new 实例化，但可以声明，但是必须引用一个实现该接口的对象 从设计层面来说，抽象是对类的抽象，是一种模板设计，接口是行为的抽象，是一种行为的规范。</p></li></ol><h3 id="6、ArrayList实现了RandomAccess接口（关于随机访问）、Cloneable接口、Serializable（关于序列化和反序列化）、继承了AbstractList抽象类"><a href="#6、ArrayList实现了RandomAccess接口（关于随机访问）、Cloneable接口、Serializable（关于序列化和反序列化）、继承了AbstractList抽象类" class="headerlink" title="6、ArrayList实现了RandomAccess接口（关于随机访问）、Cloneable接口、Serializable（关于序列化和反序列化）、继承了AbstractList抽象类"></a>6、ArrayList实现了RandomAccess接口（关于随机访问）、Cloneable接口、Serializable（关于序列化和反序列化）、继承了AbstractList抽象类</h3><p>ArrayList的无参构造器为一个空数组</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> DEFAULTCAPACITY_EMPTY_ELEMENTDATA <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original=".%5Cimages%5CArrayList%E6%97%A0%E5%8F%82%E6%9E%84%E9%80%A0.png" alt="image-20210918115237209"></p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original=".%5Cimages%5CArrayList%E6%9C%89%E5%8F%82%E6%9E%84%E9%80%A0.png" alt="image-20210921181330903"></p><p>此时整个数组里面是没有数据的，但是容量是initialCapacity的，如果执行add(int index, E element)和set(int index, E element)方法时会报错数组越界。<br>ArrayList的默认初始化容量为10，jdk1.7的时候初始化默认为10，但是jdk1.8之后，默认为空，只有第一次添加数据的时候会判断当前是否有容量，否则初始化容量为10</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original=".%5Cimages%5CArrayList%E6%B7%BB%E5%8A%A0%E5%85%83%E7%B4%A0%E6%97%B6%E7%9A%84%E6%A3%80%E6%9F%A5.png" alt="image-20210921195820657"></p><p>ArrayList的add过程</p><ol><li><p><strong>初始容量</strong>：当创建一个 ArrayList 对象时，如果没有指定初始容量大小，则其初始容量为 10。</p></li><li><p><strong>添加元素</strong>：当向 ArrayList 中添加元素时，ArrayList 会先检查当前元素个数是否达到了数组的长度，如果达到了就需要进行扩容。</p></li><li><p><strong>计算新容量</strong>：扩容时，ArrayList 会计算新的容量大小。先获取当前容器的长度，扩大到之前容器的1.5倍，然后回去检查容器是否合适，如果当前容器小了，容器大小直接为当前的值，当前容器容量超过数组最大容量，newCapacity = (minCapacity &gt; MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE来扩容</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original=".%5Cimages%5CArrayList%E6%89%A9%E5%AE%B9.png" alt="image-20210921201257542"></p></li><li><p><strong>创建新数组</strong>：ArrayList 将创建一个新的数组，其长度为新容量大小。</p></li><li><p><strong>数据复制</strong>：ArrayList 将原来数组中的元素复制到新数组中。</p></li><li><p><strong>更新引用</strong>：ArrayList 更新内部引用，使其指向新的数组。</p></li><li><p><strong>添加新元素</strong>：最后，ArrayList 将新的元素添加到新数组中。</p></li></ol><p>ArrayList的移除方法是先检查当前index是否合法，将当前index+1以及后面的元素进行复制后，往前移动一个下标覆盖之前的数据，然后设置将数组最后一个元素设置为null，并且size-1</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original=".%5Cimages%5CArrayList%E7%9A%84remove%E6%96%B9%E6%B3%95.png" alt="image-20210921232405261"></p><p>ArrayList的添加方法：先去检查index的合法性，检查容器是否需要初始化和扩容等，然后将index位置以及之后的数据移动到index+1的位置上，留出index的位置，将元素放到index的位置上</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original=".%5Cimages%5CArrayList%E7%9A%84add%E6%96%B9%E6%B3%95.png" alt="image-20210921233458372"></p><p>关于Arrays.asList()方法是生成的一个内部的java.util.Arrays.ArrayList，不是java.util.ArrayList，这个要注意，它不具备添加和删除的方法。</p><h3 id="为什么不是线程安全的，具体来说是哪里不安全？（源码层面，没答上来）"><a href="#为什么不是线程安全的，具体来说是哪里不安全？（源码层面，没答上来）" class="headerlink" title="为什么不是线程安全的，具体来说是哪里不安全？（源码层面，没答上来）"></a>为什么不是线程安全的，具体来说是哪里不安全？（源码层面，没答上来）</h3><p>在高并发添加数据下，ArrayList会暴露三个问题;</p><ul><li>部分值为null（我们并没有add null进去）</li><li>索引越界异常</li><li>size与我们add的数量不符</li></ul><p>下面我们来分析三种情况都是如何产生的：</p><ul><li>部分值为null：当线程1走到了扩容那里发现当前size是9，而数组容量是10，所以不用扩容，这时候cpu让出执行权，线程2也进来了，发现size是9，而数组容量是10，所以不用扩容，这时候线程1继续执行，将数组下标索引为9的位置set值了，还没有来得及执行size++，这时候线程2也来执行了，又把数组下标索引为9的位置set了一遍，这时候两个先后进行size++，导致下标索引10的地方就为null了。</li><li>索引越界异常：线程1走到扩容那里发现当前size是9，数组容量是10不用扩容，cpu让出执行权，线程2也发现不用扩容，这时候数组的容量就是10，而线程1 set完之后size++，这时候线程2再进来size就是10，数组的大小只有10，而你要设置下标索引为10的就会越界（数组的下标索引从0开始）；</li><li>size与我们add的数量不符：这个基本上每次都会发生，这个理解起来也很简单，因为size++本身就不是原子操作，可以分为三步：获取size的值，将size的值加1，将新的size值覆盖掉原来的，线程1和线程2拿到一样的size值加完了同时覆盖，就会导致一次没有加上，所以肯定不会与我们add的数量保持一致的；</li></ul><h3 id="7、HashMap（继承AbstractMap抽象类，实现了Map-Cloneable-Serializable）"><a href="#7、HashMap（继承AbstractMap抽象类，实现了Map-Cloneable-Serializable）" class="headerlink" title="7、HashMap（继承AbstractMap抽象类，实现了Map, Cloneable, Serializable）"></a>7、HashMap（继承AbstractMap抽象类，实现了Map, Cloneable, Serializable）</h3><p>初始化的时候会根据传入的数值计算一个比传入值大的第一个2次幂的值,然后将这个值作为HashMap的容量</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original=".%5Cimages%5CHashMap%E5%88%9D%E5%A7%8B%E5%8C%96.png" alt="image-20211216163926866"></p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original=".%5Cimages%5C%E8%AE%A1%E7%AE%97%E6%AF%94%E4%BC%A0%E5%85%A5%E5%80%BC%E5%A4%A7%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA2%E6%AC%A1%E5%B9%82%E7%9A%84%E5%80%BC.png" alt="image-20211216164232417"></p><p>默认容量为16<br><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original=".%5Cimages%5CHashMap%E9%BB%98%E8%AE%A4%E5%AE%B9%E9%87%8F.png" alt="image-20211104160909551"><br>负载因子为0.75<br>负载因子是0.75的时候，空间利用率比较高，而且避免了相当多的Hash冲突，使得底层的链表或者是红黑树的高度比较低，提升了空间效率。<br>扩容条件</p><blockquote><p>当前数据存储量达到总容量乘以负载因子时，就会发生扩容</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original=".%5Cimages%5CHashMap%E6%89%A9%E5%AE%B9.png" alt=""></p><p>HashMap的Put方法：1.8之前是头插法，1.8之后使用尾插法</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> V <span class="token function">put</span><span class="token punctuation">(</span>K key<span class="token punctuation">,</span> V value<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">final</span> V <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> K key<span class="token punctuation">,</span> V value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">,</span>               <span class="token keyword">boolean</span> evict<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Node<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> Node<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> p<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> i<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//第一次put元素时，table数组为空，先调用resize生成一个指定容量的数组</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> null <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>        n <span class="token operator">=</span> <span class="token punctuation">(</span>tab <span class="token operator">=</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//hash值和n-1的与运算结果为桶的位置，如果该位置空就直接放置一个Node</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> tab<span class="token punctuation">[</span>i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> null<span class="token punctuation">)</span>        tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//如果计算出的bucket不空，即发生哈希冲突，就要进一步判断</span>    <span class="token keyword">else</span> <span class="token punctuation">{</span>        Node<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> e<span class="token punctuation">;</span> K k<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//判断当前Node的key与要put的key是否相等,如果相等，直接覆盖</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> p<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            e <span class="token operator">=</span> p<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//判断当前Node是否是红黑树的节点</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>            e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>TreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span><span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> tab<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//以上都不是，说明要new一个Node，加入到链表中</span>        <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>             <span class="token comment" spellcheck="true">//在链表尾部插入新节点，注意jdk1.8是在链表尾部插入新节点</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    p<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment" spellcheck="true">// 如果当前链表中的元素大于树化的阈值，进行链表转树的操作</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">>=</span> TREEIFY_THRESHOLD <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// -1 for 1st</span>                        <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment" spellcheck="true">//在链表中继续判断是否已经存在完全相同的key</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>                    <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                p <span class="token operator">=</span> e<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//走到这里，说明本次put是更新一个已存在的键值对的value</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// existing mapping for key</span>            V oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent <span class="token operator">||</span> oldValue <span class="token operator">==</span> null<span class="token punctuation">)</span>                e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//在hashMap中，afterNodeAccess方法体为空，交给子类去实现</span>            <span class="token function">afterNodeAccess</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token operator">++</span>modCount<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//如果当前size超过临界值，就扩容。注意是先插入节点再扩容</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>size <span class="token operator">></span> threshold<span class="token punctuation">)</span>        <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//在hashMap中，afterNodeInsertion方法体为空，交给子类去实现</span>    <span class="token function">afterNodeInsertion</span><span class="token punctuation">(</span>evict<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> null<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>HashMap的hash计算方法:将hashCode无符号右移16位后，让高16位和低16位进行异或运算，减少hash碰撞，实现均匀分布。</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original=".%5Cimages%5CHashMap%E7%9A%84hash%E8%AE%A1%E7%AE%97%E6%96%B9%E6%B3%95.png" alt="image-20211216143455714"></p><h3 id="说说你对红黑树的见解？"><a href="#说说你对红黑树的见解？" class="headerlink" title="说说你对红黑树的见解？"></a>说说你对红黑树的见解？</h3><p>每个节点非红即黑<br>根节点总是黑色的<br>如果节点是红色的，则它的子节点必须是黑色的（反之不一定）<br>每个叶子节点都是黑色的空节点（NIL节点）<br>从根节点到叶节点或空子节点的每条路径，必须包含相同数目的黑色节点（即相同的黑色高度）</p><h3 id="8、HashMap-和-HashTable-有什么区别？"><a href="#8、HashMap-和-HashTable-有什么区别？" class="headerlink" title="8、HashMap 和 HashTable 有什么区别？"></a>8、HashMap 和 HashTable 有什么区别？</h3><ol><li><p>HashMap 是线程不安全的，HashTable 是线程安全的；HashTable里面所有方法使用Synchronized的修饰，导致HashTable的效率比不上HashMap</p></li><li><p>HashMap最多只允许一条记录的键为null，允许多条记录的值为null，而 HashTable不允许；concurrentHashMap也不允许key和value为null。</p></li><li><p>HashMap 默认初始化数组的大小为16，HashTable 为 11，前者扩容时，扩大两倍，后者扩大两倍+1；</p></li><li><p>HashMap 需要重新计算 hash 值，而 HashTable 直接使用对象的 hashCode</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original=".%5Cimages%5CHashTable%E6%89%A9%E5%AE%B9.png" alt="image-20211104195532344"></p></li><li><p>实现方式不同：HashTable继承Dictionary类，HashMap继承的是AbstractMap类</p></li><li><p>迭代器不同：HashMap中的迭代器是Iterator（快速失败机制）的,，而HashTable的是Enumerator（安全失败）</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original=".%5Cimages%5CEnumerator.png" alt="image-20220504225614199"></p><ol><li>HashMap在1.8后有引入红黑树，但是HashTable没有</li></ol><h3 id="HashMap1-7和1-8的区别"><a href="#HashMap1-7和1-8的区别" class="headerlink" title="HashMap1.7和1.8的区别"></a>HashMap1.7和1.8的区别</h3><p>底层结构：<br>hashmap1.7底层结构是entry数组+链表，</p><pre><code>    hashmap1.8底层结构是node数组+链表+红黑树</code></pre><p>扩容策略：7上8下(7前8后)<br>1.8会保持原链表的顺序并且在元素插入后检测是否需要扩容，扩容后，不会把所有元素重新计算一遍位置；</p><pre><code>    1.7会颠倒链表的顺序并且在元素插入前检测是否需要扩容，扩容后，把所有元素重新计算一遍位置，为了降低hash冲突；</code></pre><ul><li>在JDK1.7的时候是直接用hash值和需要扩容的二进制数进行&amp;（这里就是为什么扩容的时候为啥一定必须是2的多少次幂的原因所在，因为如果只有2的n次幂的情况时最后一位二进制数才一定是1，这样能最大程度减少hash碰撞）（hash值 &amp; length-1）</li><li>而在JDK1.8的时候直接用了JDK1.7的时候计算的规律，也就是扩容前的原始位置+扩容的大小值=JDK1.8的计算方式，而不再是JDK1.7的那种异或的方法。但是这种方式就相当于只需要判断Hash值的新增参与运算的位是0还是1就直接迅速计算出了扩容后的储存方式。</li></ul><h3 id="9、关于Iterator和Enumeration"><a href="#9、关于Iterator和Enumeration" class="headerlink" title="9、关于Iterator和Enumeration"></a>9、关于Iterator和Enumeration</h3><p>两者都是迭代器接口，都是关于比遍历集合的</p><p>Iterator包含hasNext()、next()、remov()、forEachRemaining()四个方法，支持对集合的遍历以及删除，支持fail-fast</p><p>enumeration包含hasMoreElements()、nextElement()，只支持对集合的变量，不支持对集合进行删除操作。</p><h3 id="10-快速失败-fail-fast-和安全失败-fail-safe-的区别是什么？"><a href="#10-快速失败-fail-fast-和安全失败-fail-safe-的区别是什么？" class="headerlink" title="10. 快速失败(fail-fast)和安全失败(fail-safe)的区别是什么？"></a>10. 快速失败(fail-fast)和安全失败(fail-safe)的区别是什么？</h3><p>快速失败</p><p>在用迭代器遍历一个集合对象时，如果遍历过程中对集合对象的内容进行了修改（增加、删除、修改），则会抛出Concurrent Modification Exception。安全失败</p><p>采用安全失败机制的集合容器，在遍历时不是直接在集合内容上访问的，而是先复制原有集合内容，在拷贝的集合上进行遍历。</p><p>其实，在java.util.concurrent 并发包的集合，如 ConcurrentHashMap, CopyOnWriteArrayList等，默认为都是安全失败的。</p><h3 id="11、Java创建对象的方式"><a href="#11、Java创建对象的方式" class="headerlink" title="11、Java创建对象的方式"></a>11、Java创建对象的方式</h3><ol><li>通过new的方式</li><li>通过反射</li><li>通过clone机制</li><li>通过反序列化</li></ol><h3 id="12、Java中的异常体系"><a href="#12、Java中的异常体系" class="headerlink" title="12、Java中的异常体系"></a>12、Java中的异常体系</h3><p>Java中的所有异常都来自顶级父类Throwable。Throwable下有两个子类Exception和Error。</p><ol><li><p>Error是程序无法处理的错误，一旦出现这个错误，则程序将被迫停止运行。</p></li><li><p>Exception不会导致程序停止，又分为两个部分Unchecked Exception（非受检异常）和CheckedException（受检异常）。</p></li><li><p>Checked Exception（受检异常）：这种异常在编译时就可以被检测出来，必须要在代码中进行处理或者声明抛出，否则编译不通过。这类异常主要是由程序的外部环境引起的，例如文件不存在、网络连接失败等。常见的Checked Exception包括IOException、SQLException等。</p></li><li><p>Unchecked Exception（非受检异常）：这种异常通常是由程序内部错误引起的包括RuntimeException以及其子类，例如NullPointerException、ArrayIndexOutOfBoundsException、IllegalArgumentException等。这类异常不需要在代码中声明抛出，也可以不进行处理，但是如果不进行处理，程序会崩溃。</p></li></ol><h3 id="13-Collections-sort和Arrays-sort的实现原理"><a href="#13-Collections-sort和Arrays-sort的实现原理" class="headerlink" title="13. Collections.sort和Arrays.sort的实现原理"></a>13. Collections.sort和Arrays.sort的实现原理</h3><p>Collection.sort是对list进行排序，Arrays.sort是对数组进行排序。因此，Collections.sort方法底层就是调用的Array.sort方法</p><p>Arrays的sort方法，如下：</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzHTXzzpaoia3tmfmZWFoOAsp1rg4wXnvsZvkCCJGjpkRZU9z1RzJHibjZhp5Yfw1Fm0CXoxqguibsFicw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>如果比较器为null，进入sort（a）方法。如下：<img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzHTXzzpaoia3tmfmZWFoOAspffM7oicRm5rFBaRqCoB64ToOePMtHdIGl7CRYSYRS8lUNm7FH4hbmdg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>因此，Arrays的sort方法底层就是：</p><ul><li>legacyMergeSort(a)，归并排序，</li><li>ComparableTimSort.sort()：即Timsort排序。</li></ul><p>Timesort排序</p><p>Timsort排序是结合了合并排序（merge.sort）和插入排序（insertion sort）而得出的排序方法；</p><p>1.当数组长度小于某个值，采用的是二分插入排序算法，如下：</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzHTXzzpaoia3tmfmZWFoOAsptK91pJpGSh65XdOLpDGUJUolVPzr0iaicS0XW1hPmUFJZetbw8ic0qZbA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><ol><li>找到各个run，并入栈。</li></ol><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzHTXzzpaoia3tmfmZWFoOAsprlFCf9Dia8fvxmBibLm2BNyBRmm9V9ia2l6YAkiabNwqeiaLEsGZJqAxHIg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><ol><li>按规则合并run。</li></ol><h3 id="14-TreeMap底层？"><a href="#14-TreeMap底层？" class="headerlink" title="14. TreeMap底层？"></a>14. TreeMap底层？</h3><ul><li>TreeMap实现了SotredMap接口，它是有序的集合。</li><li>TreeMap底层数据结构是一个红黑树，每个key-value都作为一个红黑树的节点。</li><li>如果在调用TreeMap的构造函数时没有指定比较器，则根据key执行自然排序。</li></ul><h3 id="15-Iterator-和-ListIterator-有什么区别？"><a href="#15-Iterator-和-ListIterator-有什么区别？" class="headerlink" title="15. Iterator 和 ListIterator 有什么区别？"></a>15. Iterator 和 ListIterator 有什么区别？</h3><ul><li>ListIterator 比 Iterator有更多的方法。</li><li>ListIterator只能用于遍历List及其子类，Iterator可用来遍历所有集合，</li><li>ListIterator遍历可以是逆向的，因为有previous()和hasPrevious()方法，而Iterator不可以。</li><li>ListIterator有add()方法，可以向List添加对象，而Iterator却不能。</li><li>ListIterator可以定位当前的索引位置，因为有nextIndex()和previousIndex()方法，而Iterator不可以。</li><li>ListIterator可以实现对象的修改，set()方法可以实现。Iterator仅能遍历，不能修改哦。</li></ul><h3 id="16-怎么确保一个集合不能被修改？"><a href="#16-怎么确保一个集合不能被修改？" class="headerlink" title="16. 怎么确保一个集合不能被修改？"></a>16. 怎么确保一个集合不能被修改？</h3><ul><li>unmodifiableMap</li><li>unmodifiableList</li><li>unmodifiableSet</li></ul><h3 id="17-Java中类的比较和排序方法"><a href="#17-Java中类的比较和排序方法" class="headerlink" title="17.Java中类的比较和排序方法"></a>17.Java中类的比较和排序方法</h3><p>使用Comparable接口  Comparable接口定义了compareTo方法，用于对象之间的比较</p><p>使用Comparator接口 Comparator可以用于比较没有实现Comparable的类的对象，Comparator的compare方法用来告诉代码应该怎么去比较两个实例，然后根据比较结果进行排序</p><h3 id="18-多线程创建的方式"><a href="#18-多线程创建的方式" class="headerlink" title="18. 多线程创建的方式"></a>18. 多线程创建的方式</h3><ol><li><p>继承Thread类创建线程</p></li><li><p>实现Runnable接口创建线程</p></li><li><p>实现Callable接口通过FutureTask包装器来创建Thread线程</p></li><li><p>使用ExecutorService、Callable、Future实现有返回结果的线程</p></li></ol><h3 id="23-什么是Java优先级队列-Priority-Queue-？"><a href="#23-什么是Java优先级队列-Priority-Queue-？" class="headerlink" title="23. 什么是Java优先级队列(Priority Queue)？"></a>23. 什么是Java优先级队列(Priority Queue)？</h3><p>优先队列PriorityQueue是Queue接口的实现，可以对其中元素进行排序</p><ul><li>优先队列中元素默认排列顺序是升序排列</li><li>但对于自己定义的类来说，需要自己定义比较器</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PriorityQueue</span><span class="token operator">&lt;</span>E<span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token operator">&lt;</span>E<span class="token operator">></span>    <span class="token keyword">implements</span> <span class="token class-name">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable</span> <span class="token punctuation">{</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">private</span> <span class="token keyword">final</span> Comparator<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> E<span class="token operator">></span> comparator<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>方法：</p><pre><code>peek()//返回队首元素poll()//返回队首元素，队首元素出队列add()//添加元素size()//返回队列元素个数isEmpty()//判断队列是否为空，为空返回true,不空返回false</code></pre><p>特点：</p><ul><li>1.基于优先级堆</li><li>2.不允许null值</li><li>3.线程不安全</li><li>4.出入队时间复杂度O(log(n))</li><li>5.调用remove()返回堆内最小值</li></ul><h3 id="24-JAVA8的ConcurrentHashMap为什么放弃了分段锁，有什么问题吗，如果你来设计，你如何设计。"><a href="#24-JAVA8的ConcurrentHashMap为什么放弃了分段锁，有什么问题吗，如果你来设计，你如何设计。" class="headerlink" title="24. JAVA8的ConcurrentHashMap为什么放弃了分段锁，有什么问题吗，如果你来设计，你如何设计。"></a>24. JAVA8的ConcurrentHashMap为什么放弃了分段锁，有什么问题吗，如果你来设计，你如何设计。</h3><p>jdk8 放弃了分段锁而是用了Node锁，减低锁的粒度，提高性能，并使用CAS操作来确保Node的一些操作的原子性，取代了锁。</p><h3 id="25-阻塞队列的实现，ArrayBlockingQueue的底层实现？"><a href="#25-阻塞队列的实现，ArrayBlockingQueue的底层实现？" class="headerlink" title="25. 阻塞队列的实现，ArrayBlockingQueue的底层实现？"></a>25. 阻塞队列的实现，ArrayBlockingQueue的底层实现？</h3><p>ArrayBlockingQueue是数组实现的线程安全的有界的阻塞队列，继承自AbstractBlockingQueue,间接的实现了Queue接口和Collection接口。底层以数组的形式保存数据(实际上可看作一个循环数组)。常用的操作包括 add ,offer,put，remove,poll,take,peek。</p><h3 id="29-ConcurrenHashMap-原理？1-8-中为什么要用红黑树？"><a href="#29-ConcurrenHashMap-原理？1-8-中为什么要用红黑树？" class="headerlink" title="29. ConcurrenHashMap 原理？1.8 中为什么要用红黑树？"></a>29. ConcurrenHashMap 原理？1.8 中为什么要用红黑树？</h3><p>聊到ConcurrenHashMap，需要跟面试官聊到安全性，分段锁segment，为什么放弃了分段锁，与及选择CAS，其实就是都是从效率和安全性触发，嘻嘻~</p><pre><code>java8不是用红黑树来管理hashmap,而是在hash值相同的情况下(且重复数量大于8),用红黑树来管理数据。红黑树相当于排序数据。可以自动的使用二分法进行定位。性能较高。</code></pre><h3 id="35-说一下HashSet的实现原理？"><a href="#35-说一下HashSet的实现原理？" class="headerlink" title="35. 说一下HashSet的实现原理？"></a>35. 说一下HashSet的实现原理？</h3><ul><li>不能保证元素的排列顺序，顺序有可能发生变化。</li><li>元素可以为null</li><li>hashset保证元素不重复~ （这个面试官很可能会问什么原理，这个跟HashMap有关的哦）</li><li>HashSet，需要谈谈它俩hashcode()和equles()哦~</li><li>实际是基于HashMap实现的，HashSet 底层使用HashMap来保存所有元素的看看它的add方法吧~</li></ul><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span>E e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> PRESENT<span class="token punctuation">)</span><span class="token operator">==</span>null<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="39-讲讲红黑树的特点？"><a href="#39-讲讲红黑树的特点？" class="headerlink" title="39. 讲讲红黑树的特点？"></a>39. 讲讲红黑树的特点？</h3><ul><li>每个节点或者是黑色，或者是红色。</li><li>根节点是黑色。</li><li>每个叶子节点（NIL）是黑色。[注意：这里叶子节点，是指为空(NIL或NULL)的叶子节点！]</li><li>如果一个节点是红色的，则它的子节点必须是黑色的。</li><li>从一个节点到该节点的子孙节点的所有路径上包含相同数目的黑节点。</li></ul><h3 id="41-谈谈线程池阻塞队列吧"><a href="#41-谈谈线程池阻塞队列吧" class="headerlink" title="41.谈谈线程池阻塞队列吧~"></a>41.谈谈线程池阻塞队列吧~</h3><ul><li>ArrayBlockingQueue</li><li>LinkedBlockingQueue</li><li>DelayQueue</li><li>PriorityBlockingQueue</li><li>SynchronousQueue</li></ul><p><strong>ArrayBlockingQueue：</strong> （有界队列）是一个用数组实现的有界阻塞队列，按FIFO排序量。</p><p><strong>LinkedBlockingQueue：</strong> （可设置容量队列）基于链表结构的阻塞队列，按FIFO排序任务，容量可以选择进行设置，不设置的话，将是一个无边界的阻塞队列，最大长度为Integer.MAX_VALUE，吞吐量通常要高于ArrayBlockingQuene；newFixedThreadPool线程池使用了这个队列</p><p><strong>DelayQueue：</strong>（延迟队列）是一个任务定时周期的延迟执行的队列。根据指定的执行时间从小到大排序，否则根据插入到队列的先后排序。newScheduledThreadPool线程池使用了这个队列。</p><p><strong>PriorityBlockingQueue：</strong>（优先级队列）是具有优先级的无界阻塞队列；</p><p><strong>SynchronousQueue：</strong>（同步队列）一个不存储元素的阻塞队列，每个插入操作必须等到另一个线程调用移除操作，否则插入操作一直处于阻塞状态，吞吐量通常要高于LinkedBlockingQuene，newCachedThreadPool线程池使用了这个队列。针对面试题：线程池都有哪几种工作队列？</p><p>我觉得，回答以上几种ArrayBlockingQueue，LinkedBlockingQueue，SynchronousQueue等，说出它们的特点，并结合使用到对应队列的常用线程池(如newFixedThreadPool线程池使用LinkedBlockingQueue)，进行展开阐述， 就可以啦。</p><h3 id="Class类的getDeclaredFields-方法与getFields-的区别"><a href="#Class类的getDeclaredFields-方法与getFields-的区别" class="headerlink" title="Class类的getDeclaredFields()方法与getFields()的区别?"></a>Class类的getDeclaredFields()方法与getFields()的区别?</h3><p>getDeclaredFields():可以获取所有本类自己声明的方法,不能获取继承的方法<br>getFields():只能获取所有public声明的方法,包括继承的方法</p><h3 id="静态代码、非静态代码、构造方法的执行顺序"><a href="#静态代码、非静态代码、构造方法的执行顺序" class="headerlink" title="静态代码、非静态代码、构造方法的执行顺序"></a>静态代码、非静态代码、构造方法的执行顺序</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloA</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//构造方法</span>        <span class="token keyword">public</span> <span class="token function">HelloA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello A!父类构造方法"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//非静态代码块</span>        <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"i'm A class.父类非静态代码块"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//静态代码块</span>        <span class="token keyword">static</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"static A 父类静态代码块"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloB</span> <span class="token keyword">extends</span> <span class="token class-name">HelloA</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//构造方法</span>        <span class="token keyword">public</span> <span class="token function">HelloB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello B! 构造方法"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//非静态代码块</span>        <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"i'm B class.非静态代码块"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//静态代码块</span>        <span class="token keyword">static</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"static B 静态代码块"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---start---"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">new</span> <span class="token class-name">HelloB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---end---"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面是执行一次new HelloB方法，执行结果是：<br>static A 父类静态代码块<br>static B 静态代码块<br>—start—<br>i’m A class.父类非静态代码块<br>HelloA!父类构造方法<br>i’m B class.非静态代码块<br>HelloB! 构造方法<br>—end—</p><p>面试时new HelloB方法使执行两次的，执行两次的话，结果为：<br>static A 父类静态代码块<br>static B 静态代码块<br>—start—<br>i’m A class.父类非静态代码块<br>HelloA!父类构造方法<br>i’m B class.非静态代码块<br>HelloB! 构造方法<br>i’m A class.父类非静态代码块<br>HelloA!父类构造方法<br>i’m B class.非静态代码块<br>HelloB! 构造方法</p><h3 id="transient的作用"><a href="#transient的作用" class="headerlink" title="transient的作用"></a>transient的作用</h3><p>阻止实例中那些用此关键字修饰的的变量序列化； 当对象被反序列化时，被 transient 修饰的变量值不会被持久化和恢复。 <code>transient 只能修饰变量，不能修饰类和方法。</code></p><h3 id="java的深拷贝和浅拷贝"><a href="#java的深拷贝和浅拷贝" class="headerlink" title="java的深拷贝和浅拷贝"></a>java的深拷贝和浅拷贝</h3><h4 id="浅拷贝定义"><a href="#浅拷贝定义" class="headerlink" title="浅拷贝定义"></a>浅拷贝定义</h4><p>被复制对象的所有变量都含有与原来的对象相同的值，而所有的对其他对象的引用仍然指向原来的对象。即对象的浅拷贝会对“主”对象进行拷贝，但不会复制主对象里面的对象。”里面的对象“会在原来的对象和它的副本之间共享。</p><h4 id="深拷贝"><a href="#深拷贝" class="headerlink" title="深拷贝"></a>深拷贝</h4><p>深拷贝是一个整个独立的对象拷贝，深拷贝会拷贝所有的属性,并拷贝属性指向的动态分配的内存。当对象和它所引用的对象一起拷贝时即发生深拷贝。深拷贝相比于浅拷贝速度较慢并且花销较大。</p><p><a href="https://blog.csdn.net/riemann_/article/details/87217229?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164792327616780366542167%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=164792327616780366542167&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~top_positive~default-1-87217229.nonecase&amp;utm_term=java%E6%B7%B1%E6%8B%B7%E8%B4%9D%E5%92%8C%E6%B5%85%E6%8B%B7%E8%B4%9D&amp;spm=1018.2226.3001.4450" target="_blank" rel="noopener">参考链接</a></p><h4 id="实现深拷贝的两种方法"><a href="#实现深拷贝的两种方法" class="headerlink" title="实现深拷贝的两种方法"></a>实现深拷贝的两种方法</h4><ul><li><p>clone() 方法麻烦一些，需要将所有涉及到的类实现声明式接口 Cloneable，并覆盖Object类中的clone()方法，并设置作用域为public（这是为了其他类可以使用到该clone方法）。</p></li><li><p>序列化的方法简单，需要将所有涉及到的类实现接口Serializable</p></li></ul><h3 id="jdbc中主要使用桥接模式"><a href="#jdbc中主要使用桥接模式" class="headerlink" title="jdbc中主要使用桥接模式"></a>jdbc中主要使用桥接模式</h3><h3 id="关于物理分页还是内存分页"><a href="#关于物理分页还是内存分页" class="headerlink" title="关于物理分页还是内存分页"></a>关于物理分页还是内存分页</h3><ul><li>物理分页指sql中拼接好分页条件，分页的功能由sql提供。</li><li>内存分页表示程序一次性把数据库的数据全部取出来，然后由程序进行分页获取分页数据。</li></ul><h3 id="toString-、String-valueOf-、-String-强转区别"><a href="#toString-、String-valueOf-、-String-强转区别" class="headerlink" title="toString()、String.valueOf()、(String)强转区别"></a>toString()、String.valueOf()、(String)强转区别</h3><h3 id="1、toString-，可能会抛空指针异常"><a href="#1、toString-，可能会抛空指针异常" class="headerlink" title="1、toString()，可能会抛空指针异常"></a>1、toString()，可能会抛空指针异常</h3><p>在这种使用方法中，因为java.lang.Object类里已有public方法.toString()，所以java对象都可以调用此方法。但在使用时要注意，必须保证object不是null值，否则将抛出NullPointerException异常。采用这种方法时，通常派生类会覆盖Object里的toString()方法。</p><h3 id="2、String-valueOf-，推荐使用，返回字符串“null”"><a href="#2、String-valueOf-，推荐使用，返回字符串“null”" class="headerlink" title="2、String.valueOf()，推荐使用，返回字符串“null”"></a>2、String.valueOf()，推荐使用，返回字符串“null”</h3><p>String.valueOf()方法是小编推荐使用的，因为它不会出现空指针异常，而且是静态的方法，直接通过String调用即可，只是有一点需要注意，就是上面提到的，如果为null，String.valueOf()返回结果是字符串“null”。而不是null。</p><h3 id="3、-String-强转，不推荐使用"><a href="#3、-String-强转，不推荐使用" class="headerlink" title="3、(String)强转，不推荐使用"></a>3、(String)强转，不推荐使用</h3><p>（String）是标准的类型转换，将Object类型转为String类型，使用(String)强转时，最好使用instanceof做一个类型检查，以判断是否可以进行强转，否则容易抛出ClassCastException异常。需要注意的是编写的时候，编译器并不会提示有语法错误，所以这个方法要谨慎的使用。</p><h3 id="Integer的范围为-128-127"><a href="#Integer的范围为-128-127" class="headerlink" title="Integer的范围为[-128,127]"></a>Integer的范围为[-128,127]</h3><h3 id="Java是值传递"><a href="#Java是值传递" class="headerlink" title="Java是值传递"></a>Java是值传递</h3><p>参考链接<a href="https://blog.csdn.net/pcwl1206/article/details/86550268?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_title~default-5.pc_relevant_default&amp;spm=1001.2101.3001.4242.4&amp;utm_relevant_index=8" target="_blank" rel="noopener">https://blog.csdn.net/pcwl1206/article/details/86550268?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_title~default-5.pc_relevant_default&amp;spm=1001.2101.3001.4242.4&amp;utm_relevant_index=8</a></p><p>比如经过Hash函数计算后， <code>7</code>和 <code>8</code>会有相同的Hash值，对此Java的HashMap对象采用的是<strong>“链地址法”</strong>的解决方案。效果如下图所示</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/xq9PqibkVAzriaxY3UB0Kcg50owNgoMtHmwTKNiaVhsJJkwibrbzCfV9rJ43Sv8kjRelMRs49QqQ0AhhxDUEDoH45A/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>具体的做法是，为所有Hash值是 <code>i</code>的对象建立一个同义词链表。假设我们在放入 <code>8</code>的时候，发现 <code>4</code>号位置已经被占，那么就会新建一个链表结点放入 <code>8</code>。同样，如果我们要找 <code>8</code>，那么发现 <code>4</code>号索引里不是 <code>8</code>，那会沿着链表依次查找。</p><p>虽然我们还是无法彻底避免Hash值冲突的问题，但是Hash函数设计合理，仍能保证同义词链表的长度被控制在一个合理的范围里。</p><h3 id="Object类所有方法详解"><a href="#Object类所有方法详解" class="headerlink" title="Object类所有方法详解"></a>Object类所有方法详解</h3><p><code>Object</code>中含有： <code>registerNatives()、getClass()、hashCode()、equals()、clone()、toString()、notify()、notifyAll()、wait(long)、wait(long,int)、wait()、finalize()</code> 共<strong>十二个方法</strong>。这个顺序是按照 <code>Object</code>类中定义方法的顺序列举的，下面我也会按照这个顺序依次进行讲解。</p><ul><li><strong>registerNatives()</strong></li></ul><p><strong>从名字上理解，这个方法是注册 native方法</strong>（本地方法，由 <code>JVM</code>实现，底层是 <code>C/C++</code>实现的）<strong>向谁注册呢？当然是向 JVM</strong>，当有程序调用到 <code>native</code>方法时， <code>JVM</code>才好去找到这些底层的方法进行调用。</p><p><code>Object</code>中的 <code>native</code>方法，并使用 <code>registerNatives()</code>向 <code>JVM</code>进行注册。（这属于 <code>JNI</code>的范畴，有兴趣的可自行查阅。）</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/xq9PqibkVAzp1opdyycWF8FqUsnz1pdR07HZn67GzuK8MwwAyF5VBXbmOKfqRfQX1TtiaryNQCSpFgWVdvjibpewA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><blockquote><p>为什么要使用静态方法，还要放到静态块中呢？</p></blockquote><p>我们知道了在类初始化的时候，会依次从父类到本类的类变量及类初始化块中的类变量及方法按照定义顺序放到 <code>&lt; clinit&gt;</code>方法中，这样可以保证父类的类变量及方法的初始化一定先于子类。所以当子类调用相应 <code>native</code>方法，比如计算 <code>hashCode</code>时，一定可以保证能够调用到 <code>JVM</code>的 <code>native</code>方法。</p><ul><li><strong>getClass()</strong></li></ul><pre><code>public final native Class getClass();</code></pre><p>这是一个 <code>public</code>的方法，我们可以直接通过对象调用。</p><p>类加载的第一阶段类的加载就是将 <code>.class</code>文件加载到内存，并生成一个 <code>java.lang.Class</code>对象的过程。 <code>getClass()</code>方法就是获取这个对象，这是当前类的对象在运行时类的所有信息的集合。这个方法是反射三种方式之一。</p><ul><li><strong>hashCode()</strong></li></ul><pre><code>public native int hashCode(); </code></pre><p>这是一个 <code>public</code>的方法，所以子类可以重写它。这个方法返回当前对象的 <code>hashCode</code>值，这个值是一个整数范围内的 <code>（-2^31~2^31-1）</code>数字。</p><p>对于 <code>hashCode</code>有以下几点约束:</p><ol><li>在 Java应用程序执行期间，在对同一对象多次调用 <code>hashCode</code> 方法时，必须一致地返回相同的整数，前提是将对象进行 <code>equals</code> 比较时所用的信息没有被修改；</li><li>如果两个对象 <code>x.equals(y)</code> 方法返回 <code>true</code>，则 <code>x</code>、 <code>y</code>这两个对象的 <code>hashCode</code>必须相等。</li><li>如果两个对象 <code>x.equals(y)</code> 方法返回 <code>false</code>，则 <code>x</code>、 <code>y</code>这两个对象的 <code>hashCode</code>可以相等也可以不等。但是，为不相等的对象生成不同整数结果可以提高哈希表的性能。</li><li>默认的 <code>hashCode</code>是将内存地址转换为的 <code>hash</code>值，重写过后就是自定义的计算方式；也可以通过 <code>System.identityHashCode(Object)</code>来返回原本的 <code>hashCode</code>。</li></ol><pre><code>public class HashCodeTest {        private int age;        private String name;        @Override        public int hashCode() {                Object[] a = Stream.of(age, name).toArray();                int result = 1;                for (Object element : a) {                        result = 31 * result + (element == null ? 0 : element.hashCode());                }                return result;        }}</code></pre><p>推荐使用 <code>Objects.hash(Object…values)</code>方法。相信看源码的时候，都看到计算 <code>hashCode</code>都使用了 <code>31</code>作为基础乘数，为什么使用 <code>31</code>呢？我比较赞同与理解 <code>result*31=(result&lt;&lt;5)-result</code>。 <code>JVM</code>底层可以自动做优化为位运算，效率很高；还有因为 <code>31</code>计算的 <code>hashCode</code>冲突较少，利于 <code>hash</code>桶位的分布。</p><ul><li><strong>equals()</strong></li></ul><pre><code>public boolean equals(Object obj);</code></pre><p>用于比较当前对象与目标对象是否相等，默认是比较引用是否指向同一对象。为 <code>public</code>方法，子类可重写。</p><pre><code>public class Object{    public boolean equals(Object obj) {        return (this == obj);    }}</code></pre><blockquote><p>为什么需要重写 <code>equals</code>方法？</p></blockquote><p><strong>因为如果不重写equals方法，当将自定义对象放到 map或者 set中时</strong>；如果这时两个对象的 <code>hashCode</code>相同，就会调用 <code>equals</code>方法进行比较，这个时候会调用 <code>Object</code>中默认的 <code>equals</code>方法，而默认的 <code>equals</code>方法只是比较了两个对象的引用是否指向了同一个对象，显然大多数时候都不会指向，这样就会将重复对象存入 <code>map</code>或者 <code>set</code>中。这就<strong>破坏了 map与 set不能存储重复对象的特性，会造成内存溢出</strong>。</p><p><strong>重写 equals方法的几条约定：</strong></p><ol><li><strong>自反性</strong>：即 <code>x.equals(x)</code>返回 <code>true</code>， <code>x</code>不为 <code>null</code>；</li><li><strong>对称性</strong>：即 <code>x.equals(y)</code>与 <code>y.equals(x）</code>的结果相同， <code>x</code>与 <code>y</code>不为 <code>null</code>；</li><li><strong>传递性</strong>：即 <code>x.equals(y)</code>结果为 <code>true</code>, <code>y.equals(z)</code>结果为 <code>true</code>，则 <code>x.equals(z)</code>结果也必须为 <code>true</code>；</li><li><strong>一致性</strong>：即 <code>x.equals(y)</code>返回 <code>true</code>或 <code>false</code>，在未更改 <code>equals</code>方法使用的参数条件下，多次调用返回的结果也必须一致。 <code>x</code>与 <code>y</code>不为 <code>null</code>。</li><li>如果 <code>x</code>不为 <code>null</code>, <code>x.equals(null)</code>返回 <code>false</code>。</li></ol><ul><li><strong>clone()</strong></li></ul><pre><code>protected native Object clone() throws CloneNotSupportedException;</code></pre><p>此方法返回当前对象的一个副本。</p><p>这是一个 <code>protected</code>方法，提供给子类重写。但需要实现 <code>Cloneable</code>接口，这是一个标记接口，如果没有实现，当调用 <code>object.clone()</code>方法，会抛出 <code>CloneNotSupportedException</code>。</p><pre><code>public class CloneTest implements Cloneable {        private int age;        private String name;        //省略get、set、构造函数等        @Override        protected CloneTest clone() throws CloneNotSupportedException {                return (CloneTest) super.clone();        }        public static void main(String[] args) throws CloneNotSupportedException {                CloneTest cloneTest = new CloneTest(23, "XX");                CloneTest clone = cloneTest.clone();                System.out.println(clone == cloneTest);                System.out.println(cloneTest.getAge()==clone.getAge());                System.out.println(cloneTest.getName()==clone.getName());        }}//输出结果//false//true//true</code></pre><p>从输出我们看见， <code>clone</code>的对象是一个新的对象；但原对象与 <code>clone</code>对象的 <code>String</code>类型的 <code>name</code>却是同一个引用，这表明， <code>super.clone</code>方法对成员变量如果是引用类型，进行是浅拷贝。</p><blockquote><p>那如果我们要进行深拷贝怎么办呢？</p><p><strong>答案是</strong>：如果成员变量是引用类型，想实现深拷贝，则成员变量也要实现 <code>Cloneable</code>接口，重写 <code>clone</code>方法。</p></blockquote><ul><li><strong>toString()</strong></li></ul><pre><code>public String toString()；</code></pre><p>这是一个 <code>public</code>方法，子类可重写，建议所有子类都重写 <code>toString</code>方法，默认的 <code>toString</code>方法，只是将当前类的全限定性类名 <code>+@+</code>十六进制的 <code>hashCode</code>值。</p><p><strong>我们思考一下为什么需要toString方法？</strong></p><p>可以这么理解：返回当前对象的字符串表示，可以将其打印方便查看对象的信息，方便记录日志信息提供调试。我们可以选择需要表示的重要信息重写到 <code>toString</code>方法中。</p><ul><li><strong>wait()/ wait(long)/ wait(long,int)</strong></li></ul><p>这三个方法是用来线程间通信用的，作用是阻塞当前线程，等待其他线程调用 <code>notify()/notifyAll()</code>方法将其唤醒。这些方法都是 <code>publicfinal</code>的，不可被重写。</p><p><strong>注意：</strong></p><ol><li>此方法只能在当前线程获取到对象的锁监视器之后才能调用，否则会抛出 <code>IllegalMonitorStateException</code>异常。</li><li>调用 <code>wait</code>方法，线程会将锁监视器进行释放；而 <code>Thread.sleep，Thread.yield()</code>并不会释放锁。</li><li><code>wait</code>方法会一直阻塞，直到其他线程调用当前对象的 <code>notify()/notifyAll()</code>方法将其唤醒；而 <code>wait(long)</code>是等待给定超时时间内（单位毫秒），如果还没有调用 <code>notify()/nofiyAll()</code>会自动唤醒； <code>wait(long,int)</code>如果第二个参数大于 <code>0</code>并且小于 <code>999999</code>，则第一个参数 <code>+1</code>作为超时时间；</li></ol><ul><li><strong>notify()/notifyAll()</strong></li></ul><p>前面说了，如果当前线程获得了当前对象锁，调用 <code>wait</code>方法，将锁释放并阻塞；这时另一个线程获取到了此对象锁，并调用此对象的 <code>notify()/notifyAll()</code>方法将之前的线程唤醒。这些方法都是 <code>public final</code>的，不可被重写。</p><ol><li><code>public final native void notify();</code> 随机唤醒之前在当前对象上调用 <code>wait</code>方法的一个线程</li><li><code>public final native void notifyAll()</code>; 唤醒所有之前在当前对象上调用 <code>wait</code>方法的线程</li></ol><p><strong>注意</strong>：调用 <code>notify()</code>后，阻塞线程被唤醒，可以参与锁的竞争，但可能调用 <code>notify()</code>方法的线程还要继续做其他事，锁并未释放，所以我们看到的结果是，无论 <code>notify()</code>是在方法一开始调用，还是最后调用，阻塞线程都要等待当前线程结束才能开始。</p><blockquote><p>为什么 <code>wait()/notify()</code>方法要放到 <code>Object</code>中呢？ 因为每个对象都可以成为锁监视器对象，所以放到 <code>Object</code>中，可以直接使用。</p></blockquote><ul><li><strong>finalize()</strong></li></ul><pre><code>protected void finalize() throws Throwable ;</code></pre><p>此方法是在垃圾回收之前，JVM会调用此方法来清理资源。此方法可能会将对象重新置为可达状态，导致JVM无法进行垃圾回收。</p><p>我们知道java相对于C++很大的优势是程序员不用手动管理内存，内存由jvm管理；如果我们的引用对象在堆中没有引用指向他们时，当内存不足时，JVM会自动将这些对象进行回收释放内存，这就是我们常说的垃圾回收。但垃圾回收没有讲述的这么简单。</p><p><strong>finalize()方法具有如下4个特点：</strong></p><ol><li>永远不要主动调用某个对象的 <code>finalize()</code>方法，该方法由垃圾回收机制自己调用；</li><li><code>finalize()</code>何时被调用，是否被调用具有不确定性；</li><li>当 <code>JVM</code>执行可恢复对象的 <code>finalize()</code>可能会将此对象重新变为可达状态；</li><li>当 <code>JVM</code>执行 <code>finalize()</code>方法时出现异常，垃圾回收机制不会报告异常，程序继续执行。</li></ol><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中23种设计模式</title>
      <link href="/2024/04/16/blog-open-source-design-patterns/"/>
      <url>/2024/04/16/blog-open-source-design-patterns/</url>
      
        <content type="html"><![CDATA[<iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="100%" height="86" src="//music.163.com/outchain/player?type=2&amp;id=64634&amp;auto=0&amp;height=66"></iframe><h1 id="Java中23种设计模式"><a href="#Java中23种设计模式" class="headerlink" title="Java中23种设计模式"></a>Java中23种设计模式</h1><p>Java中23种设计模式，包括简单介绍，适用场景以及优缺点等</p><h3 id="一、创建型模式"><a href="#一、创建型模式" class="headerlink" title="一、创建型模式"></a>一、创建型模式</h3><h4 id="1-单例模式（Singleton-Pattern）"><a href="#1-单例模式（Singleton-Pattern）" class="headerlink" title="1.单例模式（Singleton Pattern）"></a>1.单例模式（Singleton Pattern）</h4><p>单例模式（Singleton Pattern）是 Java 中最简单的设计模式之一。这种模式涉及到一个单一的类，该类负责创建自己的对象，同时确保只有单个对象被创建。这个类提供了一种访问其唯一的对象的方式，可以直接访问，不需要实例化该类的对象。</p><p>1.1 饿汉式</p><p>特点:类加载时就初始化,线程安全</p><pre class="line-numbers language-csharp"><code class="language-csharp">        <span class="token comment" spellcheck="true">// 构造方法私有化</span>    <span class="token keyword">private</span> <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 饿汉式创建单例对象</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> Singleton singleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> Singleton <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> singleton<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1.2 懒汉式</p><p>特点:第一次调用才初始化，避免内存浪费。</p><pre class="line-numbers language-aspectj"><code class="language-aspectj">    /*     * 懒汉式创建单例模式 由于懒汉式是非线程安全， 所以加上线程锁保证线程安全     */    private static Singleton singleton;    public static synchronized Singleton getInstance() {        if (singleton == null) {            singleton = new Singleton();        }        return singleton;    }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1.3 双重检验锁(double check lock)(DCL)</p><p>特点:安全且在多线程情况下能保持高性能</p><pre class="line-numbers language-csharp"><code class="language-csharp">    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> Singleton singleton<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token function">Singleton</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> Singleton <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">synchronized</span> <span class="token punctuation">(</span>Singleton<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    singleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> singleton<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1.4 静态内部类</p><p>特点:效果类似DCL,只适用于静态域</p><pre class="line-numbers language-java"><code class="language-java">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SingletonHolder</span> <span class="token punctuation">{</span>        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Singleton INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token function">Singleton</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Singleton <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> SingletonHolder<span class="token punctuation">.</span>INSTANCE<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1.5 枚举</p><p>特点:自动支持序列化机制，绝对防止多次实例化</p><pre class="line-numbers language-angelscript"><code class="language-angelscript">public enum Singleton {    INSTANCE;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>1.6 破坏单例的几种方式与解决方法</p><p>1.6.1 反序列化</p><pre class="line-numbers language-abnf"><code class="language-abnf">            Singleton singleton = Singleton.getInstance();            ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream("D:/test.txt"));            oos.writeObject(singleton);            oos.flush();            oos.close();            ObjectInputStream ois = new ObjectInputStream(new FileInputStream("D:/test.txt"));            Singleton singleton1 = (Singleton)ois.readObject();            ois.close();            System.out.println(singleton);//com.ruoyi.base.mapper.Singleton@50134894            System.out.println(singleton1);//com.ruoyi.base.mapper.Singleton@5ccd43c2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到反序列化后，两个对象的地址不一样了，那么这就是违背了单例模式的原则了，解决方法只需要在单例类里加上一个readResolve()方法即可，原因就是在反序列化的过程中，会检测readResolve()方法是否存在，如果存在的话就会反射调用readResolve()这个方法。</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token keyword">private</span> Object <span class="token function">readResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> singleton<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token comment" spellcheck="true">//com.ruoyi.base.mapper.Singleton@50134894</span><span class="token comment" spellcheck="true">//com.ruoyi.base.mapper.Singleton@50134894</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1.6.2 反射</p><pre class="line-numbers language-delphi"><code class="language-delphi">            Singleton singleton = Singleton.getInstance();            Class<Singleton> singletonClass = Singleton.class;            Constructor<Singleton> constructor = singletonClass.getDeclaredConstructor();            constructor.setAccessible(true);            Singleton singleton1 = constructor.newInstance();            System.out.println(singleton);//com.ruoyi.base.mapper.Singleton@32a1bec0            System.out.println(singleton1);//com.ruoyi.base.mapper.Singleton@22927a81<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同样可以看到，两个对象的地址不一样，这同样是违背了单例模式的原则，解决办法为使用一个布尔类型的标记变量标记一下即可，代码如下：</p><pre class="line-numbers language-aspectj"><code class="language-aspectj">private static boolean singletonFlag = false;    private Singleton() {        if (singleton != null || singletonFlag) {            throw new RuntimeException("试图用反射破坏异常");        }        singletonFlag = true;    }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但是这种方法假如使用了反编译，获得了这个标记变量，同样可以破坏单例，代码如下：</p><pre class="line-numbers language-kotlin"><code class="language-kotlin">            Class<span class="token operator">&lt;</span>Singleton<span class="token operator">></span> singletonClass <span class="token operator">=</span> Singleton<span class="token punctuation">.</span>class<span class="token punctuation">;</span>            Constructor<span class="token operator">&lt;</span>Singleton<span class="token operator">></span> <span class="token keyword">constructor</span> <span class="token operator">=</span> singletonClass<span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">constructor</span><span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            Singleton singleton <span class="token operator">=</span> <span class="token keyword">constructor</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>singleton<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// com.ruoyi.base.mapper.Singleton@32a1bec0</span>            Field singletonFlag <span class="token operator">=</span> singletonClass<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"singletonFlag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            singletonFlag<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            singletonFlag<span class="token punctuation">.</span><span class="token function">setBoolean</span><span class="token punctuation">(</span>singleton<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            Singleton singleton1 <span class="token operator">=</span> <span class="token keyword">constructor</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>singleton1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// com.ruoyi.base.mapper.Singleton@5e8c92f4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果想使单例不被破坏，那么应该使用枚举的方式去实现单例模式，枚举是不可以被反射破坏单例的。</p><p>1.7 容器式单例</p><p>当程序中的单例对象非常多的时候，则可以使用容器对所有单例对象进行管理，如下：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ContainerSingleton</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token function">ContainerSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> singletonMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> Object <span class="token function">getInstance</span><span class="token punctuation">(</span>Class <span class="token class-name">clazz</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        String className <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 当容器中不存在目标对象时则先生成对象再返回该对象</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>singletonMap<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            Object instance <span class="token operator">=</span> Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            singletonMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> instance<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> instance<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 否则就直接返回容器里的对象</span>        <span class="token keyword">return</span> singletonMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        SafetyDangerLibrary instance1 <span class="token operator">=</span> <span class="token punctuation">(</span>SafetyDangerLibrary<span class="token punctuation">)</span>ContainerSingleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>SafetyDangerLibrary<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        SafetyDangerLibrary instance2 <span class="token operator">=</span> <span class="token punctuation">(</span>SafetyDangerLibrary<span class="token punctuation">)</span>ContainerSingleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>SafetyDangerLibrary<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance1 <span class="token operator">==</span> instance2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// true</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1.8 ThreadLocal单例</p><p>不保证整个应用全局唯一，但保证线程内部全局唯一，以空间换时间，且线程安全。</p><pre class="line-numbers language-livescript"><code class="language-livescript"><span class="token identifier">public</span> <span class="token keyword">class</span> <span class="token identifier">ThreadLocalSingleton</span> <span class="token punctuation">{</span>    <span class="token identifier">private</span> <span class="token identifier">ThreadLocalSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token identifier">private</span> <span class="token identifier">static</span> <span class="token identifier">final</span> <span class="token identifier">ThreadLocal</span><span class="token operator">&lt;</span><span class="token identifier">ThreadLocalSingleton</span><span class="token operator">></span> <span class="token identifier">threadLocalInstance</span> <span class="token operator">=</span> <span class="token identifier">ThreadLocal</span><span class="token punctuation">.</span><span class="token identifier">withInitial</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">new</span> <span class="token identifier">ThreadLocalSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token identifier">public</span> <span class="token identifier">static</span> <span class="token identifier">ThreadLocalSingleton</span> <span class="token identifier">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token identifier">threadLocalInstance</span><span class="token punctuation">.</span><span class="token identifier">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token identifier">public</span> <span class="token identifier">static</span> <span class="token keyword">void</span> <span class="token identifier">main</span><span class="token punctuation">(</span><span class="token identifier">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token identifier">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">new</span> <span class="token identifier">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">{</span>            <span class="token identifier">System</span><span class="token punctuation">.</span><span class="token identifier">out</span><span class="token punctuation">.</span><span class="token identifier">println</span><span class="token punctuation">(</span><span class="token identifier">Thread</span><span class="token punctuation">.</span><span class="token identifier">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token identifier">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token interpolated-string"><span class="token string">"-----"</span></span> <span class="token operator">+</span> <span class="token identifier">ThreadLocalSingleton</span><span class="token punctuation">.</span><span class="token identifier">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token identifier">System</span><span class="token punctuation">.</span><span class="token identifier">out</span><span class="token punctuation">.</span><span class="token identifier">println</span><span class="token punctuation">(</span><span class="token identifier">Thread</span><span class="token punctuation">.</span><span class="token identifier">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token identifier">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token interpolated-string"><span class="token string">"-----"</span></span> <span class="token operator">+</span> <span class="token identifier">ThreadLocalSingleton</span><span class="token punctuation">.</span><span class="token identifier">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token identifier">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token identifier">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">{</span>            <span class="token identifier">System</span><span class="token punctuation">.</span><span class="token identifier">out</span><span class="token punctuation">.</span><span class="token identifier">println</span><span class="token punctuation">(</span><span class="token identifier">Thread</span><span class="token punctuation">.</span><span class="token identifier">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token identifier">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token interpolated-string"><span class="token string">"-----"</span></span> <span class="token operator">+</span> <span class="token identifier">ThreadLocalSingleton</span><span class="token punctuation">.</span><span class="token identifier">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token identifier">System</span><span class="token punctuation">.</span><span class="token identifier">out</span><span class="token punctuation">.</span><span class="token identifier">println</span><span class="token punctuation">(</span><span class="token identifier">Thread</span><span class="token punctuation">.</span><span class="token identifier">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token identifier">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token interpolated-string"><span class="token string">"-----"</span></span> <span class="token operator">+</span> <span class="token identifier">ThreadLocalSingleton</span><span class="token punctuation">.</span><span class="token identifier">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token identifier">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token regex">//        Thread-0-----com.ruoyi.library.domain.vo.ThreadLocalSingleton@53ac93b3//</span>        <span class="token identifier">Thread</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token identifier">com</span><span class="token punctuation">.</span><span class="token identifier">ruoyi</span><span class="token punctuation">.</span><span class="token identifier">library</span><span class="token punctuation">.</span><span class="token identifier">domain</span><span class="token punctuation">.</span><span class="token identifier">vo</span><span class="token punctuation">.</span><span class="token identifier">ThreadLocalSingleton</span><span class="token operator">@</span><span class="token number">7fe11afc</span><span class="token regex">//        Thread-0-----com.ruoyi.library.domain.vo.ThreadLocalSingleton@53ac93b3//</span>        <span class="token identifier">Thread</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token identifier">com</span><span class="token punctuation">.</span><span class="token identifier">ruoyi</span><span class="token punctuation">.</span><span class="token identifier">library</span><span class="token punctuation">.</span><span class="token identifier">domain</span><span class="token punctuation">.</span><span class="token identifier">vo</span><span class="token punctuation">.</span><span class="token identifier">ThreadLocalSingleton</span><span class="token operator">@</span><span class="token number">7fe11afc</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到上面线程0和1他们的对象是不一样的，但是线程内部，他们的对象是一样的，这就是线程内部保证唯一。</p><p>1.9 总结</p><p>适用场景：</p><ul><li>需要确保在任何情况下绝对只需要一个实例。如：ServletContext，ServletConfig，ApplicationContext，DBPool，ThreadPool等。</li></ul><p>优点：</p><ul><li>在内存中只有一个实例，减少了内存开销。</li><li>可以避免对资源的多重占用。</li><li>设置全局访问点，严格控制访问。</li></ul><p>缺点：</p><ul><li>没有接口，扩展困难。</li><li>如果要扩展单例对象，只有修改代码，没有其它途径。</li></ul><h4 id="2-工厂方法模式（Factory-Method）"><a href="#2-工厂方法模式（Factory-Method）" class="headerlink" title="2.工厂方法模式（Factory Method）"></a>2.工厂方法模式（Factory Method）</h4><p>2.1 简单工厂模式</p><p>简单工厂模式不是23种设计模式之一，他可以理解为工厂模式的一种简单的特殊实现。</p><p>2.1.1 基础版</p><pre class="line-numbers language-lasso"><code class="language-lasso">// 工厂类public class CoffeeFactory {    public Coffee create(String type) {        if ("americano".equals(type)) {            return new Americano();        }        if ("mocha".equals(type)) {            return new Mocha();        }        if ("cappuccino".equals(type)) {            return new Cappuccino();        }        return null;    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-angelscript"><code class="language-angelscript">// 产品基类public interface Coffee {}// 产品具体类，实现产品基类接口public class Cappuccino implements Coffee {}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>基础版是最基本的简单工厂的写法，传一个参数过来，判断是什么类型的产品，就返回对应的产品类型。但是这里有一个问题，就是参数是字符串的形式，这就很容易会写错，比如少写一个字母，或者小写写成了大写，就会无法得到自己想要的产品类了，同时如果新加了产品，还得在工厂类的创建方法中继续加if，于是就有了升级版的写法。</p><p>2.1.2 升级版</p><pre class="line-numbers language-aspectj"><code class="language-aspectj">    // 使用反射创建对象    // 加一个static变为静态工厂    public static Coffee create(Class<? extends Coffee> clazz) throws Exception {        if (clazz != null) {            return clazz.newInstance();        }        return null;    }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>升级版就很好的解决基础版的问题，在创建的时候在传参的时候不仅会有代码提示，保证不会写错，同时在新增产品的时候只需要新增产品类即可，也不需要再在工厂类的方法里面新增代码了。</p><p>2.1.3 总结</p><p>适用场景：</p><ul><li>工厂类负责创建的对象较少。</li><li>客户端只需要传入工厂类的参数，对于如何创建的对象的逻辑不需要关心。</li></ul><p>优点：</p><ul><li>只需要传入一个正确的参数，就可以获取你所需要的对象，无须知道创建的细节。</li></ul><p>缺点：</p><ul><li>工厂类的职责相对过重，增加新的产品类型的时需要修改工厂类的判断逻辑，违背了开闭原则。</li><li>不易于扩展过于复杂的产品结构。</li></ul><p>2.2 工厂方法模式</p><p>工厂方法模式是指定义一个创建对象的接口，让实现这个接口的类来决定实例化哪个类，工厂方法让类的实例化推迟到子类中进行。</p><p>工厂方法模式主要有以下几种角色：</p><ul><li>抽象工厂（Abstract Factory）：提供了创建产品的接口，调用者通过它访问具体工厂的工厂方法来创建产品。</li><li>具体工厂（ConcreteFactory）：主要是实现抽象工厂中的抽象方法，完成具体产品的创建。</li><li>抽象产品（Product）：定义了产品的规范，描述了产品的主要特性和功能。</li><li>具体产品（ConcreteProduct）：实现了抽象产品角色所定义的接口，由具体工厂来创建，它和具体工厂之间一一对应。</li></ul><p>2.2.1 代码实现</p><pre class="line-numbers language-haxe"><code class="language-haxe"><span class="token comment" spellcheck="true">// 抽象工厂</span><span class="token keyword">public</span> <span class="token keyword">interface</span> CoffeeFactory <span class="token punctuation">{</span>    Coffee <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 具体工厂</span><span class="token keyword">public</span> <span class="token keyword">class</span> CappuccinoFactory <span class="token keyword">implements</span> CoffeeFactory <span class="token punctuation">{</span>    <span class="token metadata symbol">@Override</span>    <span class="token keyword">public</span> Coffee <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token function">Cappuccino</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 抽象产品</span><span class="token keyword">public</span> <span class="token keyword">interface</span> Coffee <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 具体产品</span><span class="token keyword">public</span> <span class="token keyword">class</span> Cappuccino <span class="token keyword">implements</span> Coffee <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2.2.2 总结</p><p>适用场景：</p><ul><li>创建对象需要大量的重复代码。</li><li>客户端（应用层）不依赖于产品类实例如何被创建和实现等细节。</li><li>一个类通过其子类来指定创建哪个对象。</li></ul><p>优点：</p><ul><li>用户只需要关系所需产品对应的工厂，无须关心创建细节。</li><li>加入新产品符合开闭原则，提高了系统的可扩展性。</li></ul><p>缺点：</p><ul><li>类的数量容易过多，增加了代码结构的复杂度。</li><li>增加了系统的抽象性和理解难度。</li></ul><h4 id="3-抽象工厂模式（Abstract-Factory）"><a href="#3-抽象工厂模式（Abstract-Factory）" class="headerlink" title="3.抽象工厂模式（Abstract Factory）"></a>3.抽象工厂模式（Abstract Factory）</h4><p>抽象工厂模式是指提供一个创建一系列相关或相互依赖对象的接口，无须指定他们具体的类。</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/img_convert/2f4f488dc07071fef17142abf9a95d81.webp?x-oss-process=image/format,png" alt="img"></p><p> 工厂方法模式中考虑的是一类产品的生产，如电脑厂只生产电脑，电话厂只生产电话，这种工厂只生产同种类的产品，同种类产品称为同等级产品，也就是说，工厂方法模式只考虑生产同等级的产品，但是现实生活中许多工厂都是综合型工厂，能生产多等级（种类）的产品，如上面说的电脑和电话，本质上他们都属于电器，那么他们就能在电器厂里生产出来，而抽象工厂模式就将考虑多等级产品的生产，将同一个具体工厂所生产的位于不同等级的一组产品称为一个产品族，如上图所示纵轴是产品等级，也就是同一类产品；横轴是产品族，也就是同一品牌的产品，同一品牌的产品产自同一个工厂。</p><p>抽象工厂模式的主要角色如下：</p><ul><li>抽象工厂（Abstract Factory）：提供了创建产品的接口，它包含多个创建产品的方法，可以创建多个不同等级的产品。</li><li>具体工厂（Concrete Factory）：主要是实现抽象工厂中的多个抽象方法，完成具体产品的创建。</li><li>抽象产品（Product）：定义了产品的规范，描述了产品的主要特性和功能，抽象工厂模式有多个抽象产品。</li><li>具体产品（ConcreteProduct）：实现了抽象产品角色所定义的接口，由具体工厂来创建，它同具体工厂之间是多对一的关系。</li></ul><p>3.1 代码实现</p><pre class="line-numbers language-haxe"><code class="language-haxe"><span class="token comment" spellcheck="true">// 咖啡店 抽象工厂</span><span class="token keyword">public</span> <span class="token keyword">interface</span> CoffeeShopFactory <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 咖啡类</span>    Coffee <span class="token function">createCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 甜点类</span>    Dessert <span class="token function">createDessert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 美式风格工厂</span><span class="token keyword">public</span> <span class="token keyword">class</span> AmericanFactory <span class="token keyword">implements</span> CoffeeShopFactory <span class="token punctuation">{</span>    <span class="token metadata symbol">@Override</span>    <span class="token keyword">public</span> Coffee <span class="token function">createCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token function">Americano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token metadata symbol">@Override</span>    <span class="token keyword">public</span> Dessert <span class="token function">createDessert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token function">Cheesecake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 意式风格工厂</span><span class="token keyword">public</span> <span class="token keyword">class</span> ItalyFactory <span class="token keyword">implements</span> CoffeeShopFactory <span class="token punctuation">{</span>    <span class="token metadata symbol">@Override</span>    <span class="token keyword">public</span> Coffee <span class="token function">createCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token function">Cappuccino</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token metadata symbol">@Override</span>    <span class="token keyword">public</span> Dessert <span class="token function">createDessert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token function">Tiramisu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/img_convert/48211b9a6bce25aee12971f8d18b2fcf.webp?x-oss-process=image/format,png" alt="img">类图</p><p>3.2 总结</p><p>产品族：一系列相关的产品，整合到一起有关联性</p><p>产品等级：同一个继承体系</p><p>适用场景：</p><ul><li>客户端（应用层）不依赖于产品类实例如何被创建和实现等细节。</li><li>强调一系列相关的产品对象（属于同一产品族）一起使用创建对象需要大量重复的代码。</li><li>提供一个产品类的库，所有的产品以同样的接口出现，从而使客户端不依赖于具体实现。</li></ul><p>优点：</p><ul><li>当一个产品族中的多个对象被设计成一起工作时，它能保证客户端始终只使用同一个产品族中的对象。</li></ul><p>缺点：</p><ul><li>当产品族中需要增加一个新的产品时，所有的工厂类都需要进行修改。</li></ul><h4 id="4-原型模式（Prototype）"><a href="#4-原型模式（Prototype）" class="headerlink" title="4.原型模式（Prototype）"></a>4.原型模式（Prototype）</h4><p>原型模式是指原型实例指定创建对象的种类，并且通过拷贝这些原型创建新的对象。调用者不需要知道任何创建细节，不调用构造函数。</p><p>原型模式包含如下角色：</p><ul><li>抽象原型类：规定了具体原型对象必须实现的的 clone() 方法。</li><li>具体原型类：实现抽象原型类的 clone() 方法，它是可被复制的对象。</li><li>访问类：使用具体原型类中的 clone() 方法来复制新的对象。</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">private</span> String sex<span class="token punctuation">;</span>    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> Object <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> CloneNotSupportedException <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception<span class="token punctuation">{</span>        Student stu1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Student stu2 <span class="token operator">=</span> <span class="token punctuation">(</span>Student<span class="token punctuation">)</span>stu1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        stu2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stu1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Student(name=张三, sex=男, age=18)</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stu2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Student(name=李四, sex=男, age=18)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到，把一个学生复制过来，只是改了姓名而已，其他属性完全一样没有改变，需要注意的是，一定要在被拷贝的对象上实现Cloneable接口，否则会抛出CloneNotSupportedException异常。</p><p>4.1 浅克隆</p><p>创建一个新对象，新对象的属性和原来对象完全相同，对于非基本类型属性，仍指向原有属性所指向的对象的内存地址。</p><pre class="line-numbers language-haxe"><code class="language-haxe"><span class="token metadata symbol">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> Clazz <span class="token keyword">implements</span> Cloneable <span class="token punctuation">{</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">private</span> Student student<span class="token punctuation">;</span>    <span class="token metadata symbol">@Override</span>    protected Object <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> throws CloneNotSupportedException <span class="token punctuation">{</span>        <span class="token keyword">return</span> super<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token metadata symbol">@Data</span><span class="token metadata symbol">@AllArgsConstructor</span><span class="token metadata symbol">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> Student <span class="token keyword">implements</span> Serializable <span class="token punctuation">{</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">private</span> String sex<span class="token punctuation">;</span>    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span><span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> void <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> throws Exception<span class="token punctuation">{</span>        Clazz clazz1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Clazz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        clazz1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"高三一班"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Student stu1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        clazz1<span class="token punctuation">.</span><span class="token function">setStudent</span><span class="token punctuation">(</span>stu1<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>clazz1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Clazz(name=高三一班, student=Student(name=张三, sex=男, age=18))</span>        Clazz clazz2 <span class="token operator">=</span> <span class="token punctuation">(</span>Clazz<span class="token punctuation">)</span>clazz1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Student stu2 <span class="token operator">=</span> clazz2<span class="token punctuation">.</span><span class="token function">getStudent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        stu2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>clazz1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Clazz(name=高三一班, student=Student(name=李四, sex=男, age=18))</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>clazz2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Clazz(name=高三一班, student=Student(name=李四, sex=男, age=18))</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到，当修改了stu2的姓名时，stu1的姓名同样也被修改了，这说明stu1和stu2是同一个对象，这就是浅克隆的特点，对具体原型类中的引用类型的属性进行引用的复制。同时，这也可能是浅克隆所带来的弊端，因为结合该例子的原意，显然是想在班级中新增一名叫李四的学生，而非让所有的学生都改名叫李四，于是我们这里就要使用深克隆。</p><p>4.2 深克隆</p><p>创建一个新对象，属性中引用的其他对象也会被克隆，不再指向原有对象地址。</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Clazz</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> Serializable <span class="token punctuation">{</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">private</span> Student student<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> Object <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> CloneNotSupportedException <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">protected</span> Object <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> ClassNotFoundException <span class="token punctuation">{</span>        ByteArrayOutputStream bos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ObjectOutputStream oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>bos<span class="token punctuation">)</span><span class="token punctuation">;</span>        oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ByteArrayInputStream bis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>bos<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ObjectInputStream ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>bis<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception<span class="token punctuation">{</span>        Clazz clazz1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Clazz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        clazz1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"高三一班"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Student stu1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        clazz1<span class="token punctuation">.</span><span class="token function">setStudent</span><span class="token punctuation">(</span>stu1<span class="token punctuation">)</span><span class="token punctuation">;</span>        Clazz clazz3 <span class="token operator">=</span> <span class="token punctuation">(</span>Clazz<span class="token punctuation">)</span>clazz1<span class="token punctuation">.</span><span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Student stu3 <span class="token operator">=</span> clazz3<span class="token punctuation">.</span><span class="token function">getStudent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        stu3<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"王五"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>clazz1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Clazz(name=高三一班, student=Student(name=张三, sex=男, age=18))</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>clazz3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Clazz(name=高三一班, student=Student(name=王五, sex=男, age=18))</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到，当修改了stu3的姓名时，stu1的姓名并没有被修改了，这说明stu3和stu1已经是不同的对象了，说明Clazz中的Student也被克隆了，不再指向原有对象地址，这就是深克隆。这里需要注意的是，Clazz类和Student类都需要实现Serializable接口，否则会抛出NotSerializableException异常。</p><p>4.3 克隆破坏单例与解决办法</p><p>PS：上面例子有的代码，这里便不重复写了，可以在上面的代码基础上添加以下代码</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// Clazz类</span><span class="token keyword">private</span> <span class="token keyword">static</span> Clazz clazz <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Clazz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token function">Clazz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> Clazz <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> clazz<span class="token punctuation">;</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception<span class="token punctuation">{</span>        Clazz clazz1 <span class="token operator">=</span> Clazz<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Clazz clazz2 <span class="token operator">=</span> <span class="token punctuation">(</span>Clazz<span class="token punctuation">)</span>clazz1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>clazz1 <span class="token operator">==</span> clazz2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// false</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到clazz1和clazz2并不相等，也就是说他们并不是同一个对象，也就是单例被破坏了。</p><p>解决办法也很简单，首先第一个就是不实现Cloneable接口即可，但是不实现Cloneable接口进行clone则会抛出CloneNotSupportedException异常。第二个方法就是重写clone()方法即可，如下：</p><pre class="line-numbers language-aspectj"><code class="language-aspectj">    @Override    protected Object clone() throws CloneNotSupportedException {        return clazz;    }    // 测试输出    System.out.println(clazz1 == clazz2) // true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到，上面clazz1和clazz2是相等的，即单例没有被破坏。</p><p>另外我们知道，单例就是只有一个实例对象，如果重写了clone(）方法保证单例的话，那么通过克隆出来的对象则不可以重新修改里面的属性，因为修改以后就会连同克隆对象一起被修改，所以是需要单例还是克隆，在实际应用中需要好好衡量。</p><p>4.4 总结</p><p>适用场景：</p><ul><li>类初始化消耗资源较多。</li><li>new产生的一个对象需要非常繁琐的过程（数据准备、访问权限等）。</li><li>构造函数比较复杂。</li><li>循环体中生产大量对象时。</li></ul><p>优点：</p><ul><li>性能优良，Java自带的原型模式是基于内存二进制流的拷贝，比直接new一个对象性能上提升了许多。</li><li>可以使用深克隆方式保存对象的状态，使用原型模式将对象复制一份并将其状态保存起来，简化了创建的过程。</li></ul><p>缺点：</p><ul><li>必须配备克隆（或者可拷贝）方法。</li><li>当对已有类进行改造的时候，需要修改代码，违反了开闭原则。</li><li>深克隆、浅克隆需要运用得当。</li></ul><h4 id="5-建造者模式（Builder）"><a href="#5-建造者模式（Builder）" class="headerlink" title="5.建造者模式（Builder）"></a>5.建造者模式（Builder）</h4><p>建造者模式是将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。用户只需指定需要建造的类型就可以获得对象，建造过程及细节不需要了解。</p><p>建造者（Builder）模式包含如下角色：</p><ul><li>抽象建造者类（Builder）：这个接口规定要实现复杂对象的那些部分的创建，并不涉及具体的部件对象的创建。</li><li>具体建造者类（ConcreteBuilder）：实现 Builder 接口，完成复杂产品的各个部件的具体创建方法。在构造过程完成后，提供产品的实例。</li><li>产品类（Product）：要创建的复杂对象。</li><li>指挥者类（Director）：调用具体建造者来创建复杂对象的各个部分，在指导者中不涉及具体产品的信息，只负责保证对象各部分完整创建或按某种顺序创建。</li></ul><p>5.1 常规写法</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">//产品类 电脑</span>@Data<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String motherboard<span class="token punctuation">;</span>    <span class="token keyword">private</span> String cpu<span class="token punctuation">;</span>    <span class="token keyword">private</span> String memory<span class="token punctuation">;</span>    <span class="token keyword">private</span> String disk<span class="token punctuation">;</span>    <span class="token keyword">private</span> String gpu<span class="token punctuation">;</span>    <span class="token keyword">private</span> String power<span class="token punctuation">;</span>    <span class="token keyword">private</span> String heatSink<span class="token punctuation">;</span>    <span class="token keyword">private</span> String chassis<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 抽象 builder类（接口） 组装电脑</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ComputerBuilder</span> <span class="token punctuation">{</span>     Computer computer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">buildMotherboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">buildCpu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">buildMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">buildDisk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">buildGpu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">buildHeatSink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">buildPower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">buildChassis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Computer <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 具体 builder类 华硕ROG全家桶电脑（手动狗头）</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsusComputerBuilder</span> <span class="token keyword">implements</span> <span class="token class-name">ComputerBuilder</span> <span class="token punctuation">{</span>    @Override     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildMotherboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setMotherboard</span><span class="token punctuation">(</span><span class="token string">"Extreme主板"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildCpu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setCpu</span><span class="token punctuation">(</span><span class="token string">"Inter 12900KS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setMemory</span><span class="token punctuation">(</span><span class="token string">"芝奇幻峰戟 16G*2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildDisk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setDisk</span><span class="token punctuation">(</span><span class="token string">"三星980Pro 2T"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildGpu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setGpu</span><span class="token punctuation">(</span><span class="token string">"华硕3090Ti 水猛禽"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildHeatSink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setHeatSink</span><span class="token punctuation">(</span><span class="token string">"龙神二代一体式水冷"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildPower</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setPower</span><span class="token punctuation">(</span><span class="token string">"雷神二代1200W"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildChassis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setChassis</span><span class="token punctuation">(</span><span class="token string">"太阳神机箱"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> Computer <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> computer<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 指挥者类 指挥该组装什么电脑</span>@AllArgsConstructor<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ComputerDirector</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> ComputerBuilder computerBuilder<span class="token punctuation">;</span>    <span class="token keyword">public</span> Computer <span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        computerBuilder<span class="token punctuation">.</span><span class="token function">buildMotherboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        computerBuilder<span class="token punctuation">.</span><span class="token function">buildCpu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        computerBuilder<span class="token punctuation">.</span><span class="token function">buildMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        computerBuilder<span class="token punctuation">.</span><span class="token function">buildDisk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        computerBuilder<span class="token punctuation">.</span><span class="token function">buildGpu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        computerBuilder<span class="token punctuation">.</span><span class="token function">buildHeatSink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        computerBuilder<span class="token punctuation">.</span><span class="token function">buildPower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        computerBuilder<span class="token punctuation">.</span><span class="token function">buildChassis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> computerBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>   <span class="token comment" spellcheck="true">// 测试</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ComputerDirector computerDirector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComputerDirector</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AsusComputerBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// Computer(motherboard=Extreme主板, cpu=Inter 12900KS, memory=芝奇幻峰戟 16G*2, disk=三星980Pro 2T, gpu=华硕3090Ti 水猛禽, power=雷神二代1200W, heatSink=龙神二代一体式水冷, chassis=太阳神机箱)</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>computerDirector<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面示例是建造者模式的常规用法，指挥者类ComputerDirector在建造者模式中具有很重要的作用，它用于指导具体构建者如何构建产品，控制调用先后次序，并向调用者返回完整的产品类，但是有些情况下需要简化系统结构，可以把指挥者类和抽象建造者进行结合，于是就有了下面的简化写法。</p><p>5.2 简化写法</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">// 把指挥者类和抽象建造者合在一起的简化建造者类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleComputerBuilder</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Computer computer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildMotherBoard</span><span class="token punctuation">(</span>String motherBoard<span class="token punctuation">)</span><span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setMotherboard</span><span class="token punctuation">(</span>motherBoard<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildCpu</span><span class="token punctuation">(</span>String cpu<span class="token punctuation">)</span><span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setCpu</span><span class="token punctuation">(</span>cpu<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildMemory</span><span class="token punctuation">(</span>String memory<span class="token punctuation">)</span><span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setMemory</span><span class="token punctuation">(</span>memory<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildDisk</span><span class="token punctuation">(</span>String disk<span class="token punctuation">)</span><span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setDisk</span><span class="token punctuation">(</span>disk<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildGpu</span><span class="token punctuation">(</span>String gpu<span class="token punctuation">)</span><span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setGpu</span><span class="token punctuation">(</span>gpu<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildPower</span><span class="token punctuation">(</span>String power<span class="token punctuation">)</span><span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setPower</span><span class="token punctuation">(</span>power<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildHeatSink</span><span class="token punctuation">(</span>String heatSink<span class="token punctuation">)</span><span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setHeatSink</span><span class="token punctuation">(</span>heatSink<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildChassis</span><span class="token punctuation">(</span>String chassis<span class="token punctuation">)</span><span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setChassis</span><span class="token punctuation">(</span>chassis<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Computer <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> computer<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SimpleComputerBuilder simpleComputerBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleComputerBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        simpleComputerBuilder<span class="token punctuation">.</span><span class="token function">buildMotherBoard</span><span class="token punctuation">(</span><span class="token string">"Extreme主板"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        simpleComputerBuilder<span class="token punctuation">.</span><span class="token function">buildCpu</span><span class="token punctuation">(</span><span class="token string">"Inter 12900K"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        simpleComputerBuilder<span class="token punctuation">.</span><span class="token function">buildMemory</span><span class="token punctuation">(</span><span class="token string">"芝奇幻峰戟 16G*2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        simpleComputerBuilder<span class="token punctuation">.</span><span class="token function">buildDisk</span><span class="token punctuation">(</span><span class="token string">"三星980Pro 2T"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        simpleComputerBuilder<span class="token punctuation">.</span><span class="token function">buildGpu</span><span class="token punctuation">(</span><span class="token string">"华硕3090Ti 水猛禽"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        simpleComputerBuilder<span class="token punctuation">.</span><span class="token function">buildPower</span><span class="token punctuation">(</span><span class="token string">"雷神二代1200W"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        simpleComputerBuilder<span class="token punctuation">.</span><span class="token function">buildHeatSink</span><span class="token punctuation">(</span><span class="token string">"龙神二代一体式水冷"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        simpleComputerBuilder<span class="token punctuation">.</span><span class="token function">buildChassis</span><span class="token punctuation">(</span><span class="token string">"太阳神机箱"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// Computer(motherboard=Extreme主板, cpu=Inter 12900K, memory=芝奇幻峰戟 16G*2, disk=三星980Pro 2T, gpu=华硕3090Ti 水猛禽, power=雷神二代1200W, heatSink=龙神二代一体式水冷, chassis=太阳神机箱)</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>simpleComputerBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到，对比常规写法，这样写确实简化了系统结构，但同时也加重了建造者类的职责，也不是太符合单一职责原则，如果construct() 过于复杂，建议还是封装到 Director 中。</p><p>5.3 链式写法</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">// 链式写法建造者类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleComputerBuilder</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Computer computer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> SimpleComputerBuilder <span class="token function">buildMotherBoard</span><span class="token punctuation">(</span>String motherBoard<span class="token punctuation">)</span><span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setMotherboard</span><span class="token punctuation">(</span>motherBoard<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> SimpleComputerBuilder <span class="token function">buildCpu</span><span class="token punctuation">(</span>String cpu<span class="token punctuation">)</span><span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setCpu</span><span class="token punctuation">(</span>cpu<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> SimpleComputerBuilder <span class="token function">buildMemory</span><span class="token punctuation">(</span>String memory<span class="token punctuation">)</span><span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setMemory</span><span class="token punctuation">(</span>memory<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> SimpleComputerBuilder <span class="token function">buildDisk</span><span class="token punctuation">(</span>String disk<span class="token punctuation">)</span><span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setDisk</span><span class="token punctuation">(</span>disk<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> SimpleComputerBuilder <span class="token function">buildGpu</span><span class="token punctuation">(</span>String gpu<span class="token punctuation">)</span><span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setGpu</span><span class="token punctuation">(</span>gpu<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> SimpleComputerBuilder <span class="token function">buildPower</span><span class="token punctuation">(</span>String power<span class="token punctuation">)</span><span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setPower</span><span class="token punctuation">(</span>power<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> SimpleComputerBuilder <span class="token function">buildHeatSink</span><span class="token punctuation">(</span>String heatSink<span class="token punctuation">)</span><span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setHeatSink</span><span class="token punctuation">(</span>heatSink<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> SimpleComputerBuilder <span class="token function">buildChassis</span><span class="token punctuation">(</span>String chassis<span class="token punctuation">)</span><span class="token punctuation">{</span>        computer<span class="token punctuation">.</span><span class="token function">setChassis</span><span class="token punctuation">(</span>chassis<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Computer <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> computer<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Computer asusComputer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleComputerBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buildMotherBoard</span><span class="token punctuation">(</span><span class="token string">"Extreme主板"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">buildCpu</span><span class="token punctuation">(</span><span class="token string">"Inter 12900K"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">buildMemory</span><span class="token punctuation">(</span><span class="token string">"芝奇幻峰戟 16G*2"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">buildDisk</span><span class="token punctuation">(</span><span class="token string">"三星980Pro 2T"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">buildGpu</span><span class="token punctuation">(</span><span class="token string">"华硕3090Ti 水猛禽"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">buildPower</span><span class="token punctuation">(</span><span class="token string">"雷神二代1200W"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">buildHeatSink</span><span class="token punctuation">(</span><span class="token string">"龙神二代一体式水冷"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">buildChassis</span><span class="token punctuation">(</span><span class="token string">"太阳神机箱"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>asusComputer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到，其实链式写法与普通写法的区别并不大，只是在建造者类组装部件的时候，同时将建造者类返回即可，使用链式写法使用起来更方便，某种程度上也可以提高开发效率。从软件设计上，对程序员的要求比较高。比较常见的mybatis-plus中的条件构造器就是使用的这种链式写法。</p><p>5.4 总结</p><p>适用场景：</p><ul><li>适用于创建对象需要很多步骤，但是步骤顺序不一定固定。</li><li>如果一个对象有非常复杂的内部结构（属性），把复杂对象的创建和使用进行分离。</li></ul><p>优点：</p><ul><li>封装性好，创建和使用分离。</li><li>扩展性好，建造类之间独立、一定程度上解耦。</li></ul><p>缺点：</p><ul><li>产生多余的Builder对象。</li><li>产品内部发生变化，建造者都要修改，成本较大。</li></ul><p>与工厂模式的区别：</p><ul><li>建造者模式更注重方法的调用顺序，工厂模式更注重创建对象。</li><li>创建对象的力度不同，建造者模式创建复杂的对象，由各种复杂的部件组成，工厂模式创建出来的都一样。</li><li>关注点不同，工厂模式只需要把对象创建出来就可以了，而建造者模式中不仅要创建出这个对象，还要知道这个对象由哪些部件组成。</li><li>建造者模式根据建造过程中的顺序不一样，最终的对象部件组成也不一样。</li></ul><p>与抽象工厂模式的区别：</p><ul><li>抽象工厂模式实现对产品族的创建，一个产品族是这样的一系列产品：具有不同分类维度的产品组合，采用抽象工厂模式则是不需要关心构建过程，只关心什么产品由什么工厂生产即可。</li><li>建造者模式则是要求按照指定的蓝图建造产品，它的主要目的是通过组装零配件而产生一个新产品。</li><li>建造者模式所有函数加到一起才能生成一个对象，抽象工厂一个函数生成一个对象</li></ul><h3 id="二、结构型模式"><a href="#二、结构型模式" class="headerlink" title="二、结构型模式"></a>二、<strong>结构型模式</strong></h3><h4 id="1-代理模式（Proxy-Pattern）"><a href="#1-代理模式（Proxy-Pattern）" class="headerlink" title="1.代理模式（Proxy Pattern）"></a>1.代理模式（Proxy Pattern）</h4><p>代理模式是指为其他对象提供一种代理，以控制对这个对象的访问。代理对象在访问对象和目标对象之间起到中介作用。</p><p>Java中的代理按照代理类生成时机不同又分为静态代理和动态代理。静态代理代理类在编译期就生成，而动态代理代理类则是在Java运行时动态生成。动态代理又有JDK代理和CGLib代理两种。</p><p>代理（Proxy）模式分为三种角色：</p><ul><li>抽象角色（Subject）： 通过接口或抽象类声明真实角色和代理对象实现的业务方法。</li><li>真实角色（Real Subject）： 实现了抽象角色中的具体业务，是代理对象所代表的真实对象，是最终要引用的对象。</li><li>代理角色（Proxy） ： 提供了与真实角色相同的接口，其内部含有对真实角色的引用，它可以访问、控制或扩展真实角色的功能。</li></ul><p>1.1 静态代理</p><p>静态代理就是指我们在给一个类扩展功能的时候，我们需要去书写一个静态的类，相当于在之前的类上套了一层，这样我们就可以在不改变之前的类的前提下去对原有功能进行扩展，静态代理需要代理对象和目标对象实现一样的接口。</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">// 火车站接口，有卖票功能</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TrainStation</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">sellTickets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 广州火车站卖票</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GuangzhouTrainStation</span> <span class="token keyword">implements</span> <span class="token class-name">TrainStation</span> <span class="token punctuation">{</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sellTickets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"广州火车站卖票啦"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 代售点卖票（代理类）</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyPoint</span> <span class="token keyword">implements</span> <span class="token class-name">TrainStation</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 目标对象（代理火车站售票）</span>    <span class="token keyword">private</span> TrainStation station <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GuangzhouTrainStation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sellTickets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"代售加收5%手续费"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        station<span class="token punctuation">.</span><span class="token function">sellTickets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ProxyPoint proxyPoint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 代售加收5%手续费</span>        <span class="token comment" spellcheck="true">// 广州火车站卖票啦</span>        proxyPoint<span class="token punctuation">.</span><span class="token function">sellTickets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ProxyPoint proxyPoint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 代售加收5%手续费</span>        <span class="token comment" spellcheck="true">// 火车站卖票啦</span>        proxyPoint<span class="token punctuation">.</span><span class="token function">sellTickets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以从上面代码看到，我们访问的是ProxyPoint对象，也就是说ProxyPoint是作为访问对象和目标对象的中介的，同时也对sellTickets方法进行了增强（代理点收取加收5%手续费）。</p><p>静态代理的优点是实现简单，容易理解，只要确保目标对象和代理对象实现共同的接口或继承相同的父类就可以在不修改目标对象的前提下进行扩展。</p><p>而缺点也比较明显，那就是代理类和目标类必须有共同接口(父类)，并且需要为每一个目标类维护一个代理类，当需要代理的类很多时会创建出大量代理类。一旦接口或父类的方法有变动，目标对象和代理对象都需要作出调整。</p><p>1.2 动态代理</p><p>代理类在代码运行时创建的代理称之为动态代理。动态代理中代理类并不是预先在Java代码中定义好的，而是运行时由JVM动态生成，并且可以代理多个目标对象。</p><p>1.2.1 jdk动态代理</p><p>JDK动态代理是Java JDK自带的一个动态代理实现， 位于java.lang.reflect包下。</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">// 火车站接口，有卖票功能</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TrainStation</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">sellTickets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 广州火车站卖票</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GuangzhouTrainStation</span> <span class="token keyword">implements</span> <span class="token class-name">TrainStation</span> <span class="token punctuation">{</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sellTickets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"广州火车站卖票啦"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 深圳火车站卖票</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShenzhenTrainStation</span> <span class="token keyword">implements</span> <span class="token class-name">TrainStation</span> <span class="token punctuation">{</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sellTickets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"深圳火车站卖票啦"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 代售点卖票（代理类）</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyPoint</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> TrainStation trainStation<span class="token punctuation">;</span>    <span class="token keyword">public</span> TrainStation <span class="token function">getProxyObject</span><span class="token punctuation">(</span>TrainStation trainStation<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>trainStation <span class="token operator">=</span> trainStation<span class="token punctuation">;</span>        Class<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">TrainStation</span><span class="token operator">></span> clazz <span class="token operator">=</span> trainStation<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>TrainStation<span class="token punctuation">)</span> Proxy<span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>clazz<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> clazz<span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> Object <span class="token function">invoke</span><span class="token punctuation">(</span>Object proxy<span class="token punctuation">,</span> Method method<span class="token punctuation">,</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> throws Throwable <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"代售火车票收取5%手续费"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>trainStation<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ProxyPoint proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        TrainStation guangzhouTrainStation <span class="token operator">=</span> proxy<span class="token punctuation">.</span><span class="token function">getProxyObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GuangzhouTrainStation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 代售火车票收取5%手续费</span>        <span class="token comment" spellcheck="true">// 广州火车站卖票啦</span>        guangzhouTrainStation<span class="token punctuation">.</span><span class="token function">sellTickets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        TrainStation shenzhenTrainStation <span class="token operator">=</span> proxy<span class="token punctuation">.</span><span class="token function">getProxyObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ShenzhenTrainStation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 代售火车票收取5%手续费</span>        <span class="token comment" spellcheck="true">// 深圳火车站卖票啦</span>        shenzhenTrainStation<span class="token punctuation">.</span><span class="token function">sellTickets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>优点：</p><ul><li>使用简单、维护成本低。</li><li>Java原生支持，不需要任何依赖。</li><li>解决了静态代理存在的多数问题。</li></ul><p>缺点：</p><ul><li>由于使用反射，性能会比较差。</li><li>只支持接口实现，不支持继承， 不满足所有业务场景。</li></ul><p>1.2.2 CGLIB动态代理</p><p>CGLIB是一个强大的、高性能的代码生成库。它可以在运行期扩展Java类和接口，其被广泛应用于AOP框架中（Spring、dynaop）中， 用以提供方法拦截。CGLIB比JDK动态代理更强的地方在于它不仅可以接管Java接口， 还可以接管普通类的方法。</p><pre class="line-numbers language-dust"><code class="language-dust">        <!-- 先引入cglib包 -->        <dependency>            <groupId>cglib</groupId>            <artifactId>cglib</artifactId>            <version>${cglib-version}</version>        </dependency><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">// 代售点卖票（代理类）</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyPoint</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> TrainStation <span class="token function">getProxyObject</span><span class="token punctuation">(</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">TrainStation</span><span class="token operator">></span> trainStation<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//创建Enhancer对象，类似于JDK动态代理的Proxy类，下一步就是设置几个参数</span>        Enhancer enhancer <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//设置父类的字节码对象</span>        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span>trainStation<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//设置回调函数</span>        enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//创建代理对象并返回</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>TrainStation<span class="token punctuation">)</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> Object <span class="token function">intercept</span><span class="token punctuation">(</span>Object o<span class="token punctuation">,</span> Method method<span class="token punctuation">,</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> objects<span class="token punctuation">,</span> MethodProxy methodProxy<span class="token punctuation">)</span> throws Throwable <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"代售火车票收取5%手续费"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> methodProxy<span class="token punctuation">.</span><span class="token function">invokeSuper</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> objects<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ProxyPoint proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        TrainStation guangzhouTrainStation <span class="token operator">=</span> proxy<span class="token punctuation">.</span><span class="token function">getProxyObject</span><span class="token punctuation">(</span>GuangzhouTrainStation<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 代售火车票收取5%手续费</span>        <span class="token comment" spellcheck="true">// 广州火车站卖票啦</span>        guangzhouTrainStation<span class="token punctuation">.</span><span class="token function">sellTickets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        TrainStation shenzhenTrainStation <span class="token operator">=</span> proxy<span class="token punctuation">.</span><span class="token function">getProxyObject</span><span class="token punctuation">(</span>ShenzhenTrainStation<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 代售火车票收取5%手续费</span>        <span class="token comment" spellcheck="true">// 深圳火车站卖票啦</span>        shenzhenTrainStation<span class="token punctuation">.</span><span class="token function">sellTickets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1.3 总结</p><p>应用场景：</p><ul><li>保护目标对象。</li><li>增强目标对象。</li></ul><p>优点：</p><ul><li>代理模式能将代理对象与真实被调用的目标对象分离。</li><li>一定程度上降低了系统的耦合程度，易于扩展。</li><li>代理可以起到保护目标对象的作用。</li><li>增强目标对象的职责。</li></ul><p>缺点：</p><ul><li>代理模式会造成系统设计中类的数目增加。</li><li>在客户端和目标对象之间增加了一个代理对象，请求处理速度变慢。</li><li>增加了系统的复杂度。</li></ul><p>两种动态代理的对比：</p><ul><li>JDK动态代理的特点：<ul><li>需要实现InvocationHandler接口， 并重写invoke方法。</li><li>被代理类需要实现接口， 它不支持继承。</li><li>JDK 动态代理类不需要事先定义好， 而是在运行期间动态生成。</li><li>JDK 动态代理不需要实现和被代理类一样的接口， 所以可以绑定多个被代理类。</li><li>主要实现原理为反射， 它通过反射在运行期间动态生成代理类， 并且通过反射调用被代理类的实际业务方法。</li></ul></li><li>cglib的特点：<ul><li>cglib动态代理中使用的是FastClass机制。</li><li>cglib生成字节码的底层原理是使用ASM字节码框架。</li><li>cglib动态代理需创建3份字节码，所以在第一次使用时会比较耗性能，但是后续使用较JDK动态代理方式更高效，适合单例bean场景。</li><li>cglib由于是采用动态创建子类的方法，对于final方法，无法进行代理。</li></ul></li></ul><h4 id="2-适配器模式（Adapter-Class-Object）"><a href="#2-适配器模式（Adapter-Class-Object）" class="headerlink" title="2.适配器模式（Adapter Class/Object）"></a>2.适配器模式（Adapter Class/Object）</h4><p>适配器模式，它的功能是将一个类的接口变成客户端所期望的另一种接口，从而使原本因接口不匹配而导致无法在一起工作的两个类能够一起工作。适配器模式分为类适配器模式和对象适配器模式，前者类之间的耦合度比后者高，且要求程序员了解现有组件库中的相关组件的内部结构，所以应用相对较少些。</p><p>适配器模式（Adapter）包含以下主要角色：</p><ul><li>目标（Target）接口：当前系统业务所期待的接口，它可以是抽象类或接口。</li><li>适配者（Adaptee）类：它是被访问和适配的现存组件库中的组件接口。</li><li>适配器（Adapter）类：它是一个转换器，通过继承或引用适配者的对象，把适配者接口转换成目标接口，让客户按目标接口的格式访问适配者。</li></ul><p>2.1 类适配器</p><p>类适配器是通过定义一个适配器类来实现当前系统的业务接口，同时又继承现有组件库中已经存在的组件来实现的，类图如下：</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/725d67526afd4d5498f0ef79cd8e31cf.webp" alt="img">类图</p><pre class="line-numbers language-csharp"><code class="language-csharp"><span class="token comment" spellcheck="true">// 适配者 220V电压</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AC220</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"输出220V交流电"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">220</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 目标 5V</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DC5</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">output5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 适配器类（电源适配器）</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PowerAdapter</span> extends <span class="token class-name">AC220</span> implements <span class="token class-name">DC5</span> <span class="token punctuation">{</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">output5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> output220 <span class="token operator">=</span> super<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> output5 <span class="token operator">=</span> output220 <span class="token operator">/</span> <span class="token number">44</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>output220 <span class="token operator">+</span> <span class="token string">"V适配转换成"</span> <span class="token operator">+</span> output5 <span class="token operator">+</span> <span class="token string">"V"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> output5<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        PowerAdapter powerAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PowerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 输出220V交流电</span>        powerAdapter<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 输出220V交流电</span>        <span class="token comment" spellcheck="true">// 220V适配转换成5V</span>        powerAdapter<span class="token punctuation">.</span><span class="token function">output5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过上面代码例子可以看出，类适配器有一个很明显的缺点，就是违背了合成复用原则。结合上面的例子，假如我不是220V的电压了，是380V电压呢？那就要多建一个380V电压的适配器了。同理，由于Java是单继承的原因，如果不断的新增适配者，那么就要无限的新增适配器，于是就有了对象适配器。</p><p>2.2 对象适配器</p><p>对象适配器的实现方式是通过现有组件库中已经实现的组件引入适配器类中，该类同时实现当前系统的业务接口。</p><pre class="line-numbers language-csharp"><code class="language-csharp"><span class="token comment" spellcheck="true">// 电源接口</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Power</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 适配者 220V电压</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AC220</span> implements <span class="token class-name">Power</span> <span class="token punctuation">{</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"输出220V交流电"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">220</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 目标 5V</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DC5</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">output5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>@AllArgsConstructor<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PowerAdapter</span> implements <span class="token class-name">DC5</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 适配者</span>    <span class="token keyword">private</span> Power power<span class="token punctuation">;</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">output5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> output220 <span class="token operator">=</span> power<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> output5 <span class="token operator">=</span> output220 <span class="token operator">/</span> <span class="token number">44</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>output220 <span class="token operator">+</span> <span class="token string">"V适配转换成"</span> <span class="token operator">+</span> output5 <span class="token operator">+</span> <span class="token string">"V"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> output5<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        DC5 powerAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PowerAdapter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AC220</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 输出220V交流电</span>        <span class="token comment" spellcheck="true">// 220V适配转换成5V</span>        powerAdapter<span class="token punctuation">.</span><span class="token function">output5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到，上面代码中，只实现了目标接口，并没有继承适配者，而是将适配者类实现适配者接口，在适配器中引入适配者接口，当我们需要使用不同的适配者通过适配器进行转换时，就无需再新建适配器类了，如上面例子，假如我需要380V的电源转换成5V的，那么客户端只需要调用适配器时传入380V电源的类即可，就无需再新建一个380V电源的适配器了（PS：上述逻辑代码中output220 / 44请忽略，可以根据实际情况编写实际的通用逻辑代码）。</p><p>2.3 接口适配器</p><p>接口适配器主要是解决类臃肿的问题，我们可以把所有相近的适配模式的方法都放到同一个接口里面，去实现所有方法，当客户端需要哪个方法直接调用哪个方法即可。如上面例子所示，我们只是转换成了5V电压，那假如我要转换成12V，24V，30V…呢？那按照上面的写法就需要新建12V，24V，30V…的接口，这样就会导致类过于多了。那么我们就可以把5V，12V，24V，30V…这些转换方法，通通都写到一个接口里去，这样当我们需要转换哪种就直接调用哪种即可。</p><pre class="line-numbers language-csharp"><code class="language-csharp"><span class="token comment" spellcheck="true">// 这里例子 输出不同直流电接口</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DC</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> <span class="token function">output5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">output12</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">output24</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">output30</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 适配器类（电源适配器）</span>@AllArgsConstructor<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PowerAdapter</span> implements <span class="token class-name">DC</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Power power<span class="token punctuation">;</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">output5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 具体实现逻辑</span>        <span class="token keyword">return</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">output12</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 具体实现逻辑</span>        <span class="token keyword">return</span> <span class="token number">12</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">output24</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 具体实现逻辑</span>        <span class="token keyword">return</span> <span class="token number">24</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">output30</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 具体实现逻辑</span>        <span class="token keyword">return</span> <span class="token number">30</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2.4 总结</p><p>适用场景：</p><ul><li>已经存在的类，它的方法和需求不匹配（方法结构相同或相似）的情况。</li><li>使用第三方提供的组件，但组件接口定义和自己要求的接口定义不同。</li></ul><p>优点：</p><ul><li>能提高类的透明性和复用，现有的类复用但不需要改变。</li><li>目标类和适配器类解耦，提高程序的扩展性。</li><li>在很多业务场景中符合开闭原则。</li></ul><p>缺点：</p><ul><li>适配器编写过程需要全面考虑，可能会增加系统的复杂性。</li><li>增加代码阅读难度，降级代码可读性，过多使用适配器会使系统代码变得凌乱。</li></ul><h4 id="3-装饰模式（Decorator-Pattern）"><a href="#3-装饰模式（Decorator-Pattern）" class="headerlink" title="3.装饰模式（Decorator Pattern）"></a>3.装饰模式（Decorator Pattern）</h4><p>装饰模式，是指在不改变原有对象的基础上，将功能附加到对象上，提供了比继承更有弹性的替代方案（扩展原有对象的功能）</p><p>装饰（Decorator）模式中的角色：</p><ul><li>抽象构件（Component）角色 ：定义一个抽象接口以规范准备接收附加责任的对象。</li><li>具体构件（Concrete Component）角色 ：实现抽象构件，通过装饰角色为其添加一些职责。</li><li>抽象装饰（Decorator）角色 ： 继承或实现抽象构件，并包含具体构件的实例，可以通过其子类扩展具体构件的功能。</li><li>具体装饰（ConcreteDecorator）角色 ：实现抽象装饰的相关方法，并给具体构件对象添加附加的责任。</li></ul><p>3.1 继承方式</p><p>举一个简单的例子，假如现在有一碟炒饭，每个人的口味不一样，有些人喜欢加鸡蛋，有些人喜欢加鸡蛋火腿，有些人喜欢加鸡蛋火腿胡萝卜等，那么就会发现，如果采用继承的方式去实现这个例子，那么没加一个配料，都需要创建新的配料类去继承上一个旧的配料类，那么久而久之，就会产生很多类了，而且还不利于扩展，代码如下：</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">// 炒饭类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FriedRice</span> <span class="token punctuation">{</span>    String <span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"炒饭"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    Integer <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 炒饭加鸡蛋类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FriedRiceAddEgg</span> <span class="token keyword">extends</span> <span class="token class-name">FriedRice</span><span class="token punctuation">{</span>    String <span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"+鸡蛋"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    Integer <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 炒饭加鸡蛋加火腿类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FriedRiceAddEggAndHam</span> <span class="token keyword">extends</span> <span class="token class-name">FriedRiceAddEgg</span> <span class="token punctuation">{</span>    String <span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"+火腿"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    Integer <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试方法</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        FriedRice friedRice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FriedRice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>friedRice<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> friedRice<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"元"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 炒饭5元</span>        FriedRice friedRiceAddEgg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FriedRiceAddEgg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>friedRiceAddEgg<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> friedRiceAddEgg<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"元"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 炒饭+鸡蛋7元</span>        FriedRice friedRiceAddEggAndHam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FriedRiceAddEggAndHam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>friedRiceAddEggAndHam<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> friedRiceAddEggAndHam<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"元"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 炒饭+鸡蛋+火腿10元</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以从上面看到，如果我们只需要炒饭加火腿，那么我们还需要创建一个FriedRiceAddHam类去继承FriedRice类，所以继承的方式扩展性非常不好，且需要定义非常多的子类，下面就可以用装饰器模式去改进它。</p><p>3.2 装饰器模式方式</p><pre class="line-numbers language-scala"><code class="language-scala"><span class="token comment" spellcheck="true">// 炒饭类</span>public <span class="token keyword">class</span> FriedRice <span class="token punctuation">{</span>    <span class="token builtin">String</span> getDesc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"炒饭"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    Integer getPrice<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 配料表</span>public <span class="token keyword">abstract</span> <span class="token keyword">class</span> Ingredients <span class="token keyword">extends</span> FriedRice<span class="token punctuation">{</span>    <span class="token keyword">private</span> FriedRice friedRice<span class="token punctuation">;</span>    public Ingredients<span class="token punctuation">(</span>FriedRice friedRice<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>friedRice <span class="token operator">=</span> friedRice<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token builtin">String</span> getDesc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>friedRice<span class="token punctuation">.</span>getDesc<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    Integer getPrice<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>friedRice<span class="token punctuation">.</span>getPrice<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 鸡蛋配料</span>public <span class="token keyword">class</span> Egg <span class="token keyword">extends</span> Ingredients <span class="token punctuation">{</span>    public Egg<span class="token punctuation">(</span>FriedRice friedRice<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>friedRice<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token builtin">String</span> getDesc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span>getDesc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"+鸡蛋"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    Integer getPrice<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span>getPrice<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 火腿配料</span>public <span class="token keyword">class</span> Ham <span class="token keyword">extends</span> Ingredients <span class="token punctuation">{</span>    public Ham<span class="token punctuation">(</span>FriedRice friedRice<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>friedRice<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token builtin">String</span> getDesc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span>getDesc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"+火腿"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    Integer getPrice<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span>getPrice<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试方法</span>    public static void main<span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        FriedRice friedRice <span class="token operator">=</span> <span class="token keyword">new</span> FriedRice<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println<span class="token punctuation">(</span>friedRice<span class="token punctuation">.</span>getDesc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> friedRice<span class="token punctuation">.</span>getPrice<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"元"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 炒饭5元</span>        friedRice <span class="token operator">=</span> <span class="token keyword">new</span> Egg<span class="token punctuation">(</span>friedRice<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println<span class="token punctuation">(</span>friedRice<span class="token punctuation">.</span>getDesc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> friedRice<span class="token punctuation">.</span>getPrice<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"元"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 炒饭+鸡蛋7元</span>        friedRice <span class="token operator">=</span> <span class="token keyword">new</span> Egg<span class="token punctuation">(</span>friedRice<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println<span class="token punctuation">(</span>friedRice<span class="token punctuation">.</span>getDesc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> friedRice<span class="token punctuation">.</span>getPrice<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"元"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 炒饭+鸡蛋+鸡蛋9元</span>        friedRice <span class="token operator">=</span> <span class="token keyword">new</span> Ham<span class="token punctuation">(</span>friedRice<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println<span class="token punctuation">(</span>friedRice<span class="token punctuation">.</span>getDesc<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> friedRice<span class="token punctuation">.</span>getPrice<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"元"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 炒饭+鸡蛋+鸡蛋+火腿12元</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到，使用装饰器模式的方法实现，与普通的继承方法实现，最大的区别就是一种配料只有一个类，而且在加配料的时候，也可以直接想加多少就加多少，不需要说一个鸡蛋一个类，两个鸡蛋也要创建一个类，这样可以带来比继承更加灵活的扩展功能，使用也更加方便。</p><p>3.3 总结</p><p>装饰器模式与代理模式对比：</p><ul><li>装饰器模式就是一种特殊的代理模式。</li><li>装饰器模式强调自身的功能扩展，用自己说了算的透明扩展，可动态定制的扩展；代理模式强调代理过程的控制。</li><li>获取目标对象构建的地方不同，装饰者是从外界传递进来的，可以通过构造方法传递；静态代理是在代理类内部创建，以此来隐藏目标对象。</li></ul><p>适用场景：</p><ul><li>用于扩展一个类的功能或者给一个类添加附加职责。</li><li>动态的给一个对象添加功能，这些功能同样也可以再动态的撤销。</li></ul><p>优点：</p><ul><li>装饰器是继承的有力补充，比继承灵活，不改变原有对象的情况下动态地给一个对象扩展功能，即插即用。</li><li>通过使用不同装饰类以及这些装饰类的排列组合，可实现不同效果。</li><li>装饰器完全遵守开闭原则。</li></ul><p>缺点：</p><ul><li>会出现更多的代码，更多的类，增加程序的复杂性。</li><li>动态装饰时，多层装饰会更复杂。</li></ul><h4 id="4-桥接模式（Bridge-Pattern）"><a href="#4-桥接模式（Bridge-Pattern）" class="headerlink" title="4.桥接模式（Bridge Pattern）"></a>4.桥接模式（Bridge Pattern）</h4><p>桥接模式也称为桥梁模式、接口模式或者柄体（Handle and Body）模式，是将抽象部分与他的具体实现部分分离，使它们都可以独立地变化，通过组合的方式建立两个类之间的联系，而不是继承。</p><p>桥接（Bridge）模式包含以下主要角色：</p><ul><li>抽象化（Abstraction）角色 ：定义抽象类，并包含一个对实现化对象的引用。</li><li>扩展抽象化（Refined Abstraction）角色 ：是抽象化角色的子类，实现父类中的业务方法，并通过组合关系调用实现化角色中的业务方法。</li><li>实现化（Implementor）角色 ：定义实现化角色的接口，供扩展抽象化角色调用。</li><li>具体实现化（Concrete Implementor）角色 ：给出实现化角色接口的具体实现。</li></ul><p>4.1 代码实现</p><p>下面以一个多系统多视频格式文件播放为例子：</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">// 视频接口</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Video</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span>String fileName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// MP4格式类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Mp4</span> <span class="token keyword">implements</span> <span class="token class-name">Video</span><span class="token punctuation">{</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span>String fileName<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"MP4视频文件："</span><span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// RMVB格式类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Rmvb</span> <span class="token keyword">implements</span> <span class="token class-name">Video</span><span class="token punctuation">{</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span>String fileName<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"rmvb文件："</span> <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 操作系统抽象类</span>@AllArgsConstructor<span class="token keyword">public</span> abstract <span class="token keyword">class</span> <span class="token class-name">OperatingSystem</span> <span class="token punctuation">{</span>    Video video<span class="token punctuation">;</span>    <span class="token keyword">public</span> abstract <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span>String fileName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// iOS系统</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Ios</span> <span class="token keyword">extends</span> <span class="token class-name">OperatingSystem</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">Ios</span><span class="token punctuation">(</span>Video video<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>video<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span>String fileName<span class="token punctuation">)</span> <span class="token punctuation">{</span>        video<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// windows系统</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Windows</span> <span class="token keyword">extends</span> <span class="token class-name">OperatingSystem</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">Windows</span><span class="token punctuation">(</span>Video video<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>video<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span>String fileName<span class="token punctuation">)</span> <span class="token punctuation">{</span>        video<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/e494a87e39f944a283deb560cc41a100.webp" alt="img">类关系图</p><p>可以通过类图看到，视频类和操作系统类之间通过OperatingSystem类桥接关联起来。</p><p>4.2 总结</p><p>适用场景：</p><ul><li>在抽象和具体实现之间需要增加更多的灵活性的场景。</li><li>一个类存在两个（或多个）独立变化的维度，而这两个（或多个）维度都需要独立进行扩展。</li><li>不希望使用继承，或因为多层继承导致系统类的个数剧增。</li></ul><p>优点：</p><ul><li>分离抽象部分及其具体实现部分。</li><li>提高了系统的扩展性。</li><li>符合开闭原型。</li><li>符合合成复用原则。</li></ul><p>缺点：</p><ul><li>增加了系统的理解与设计难度。</li><li>需要正确地识别系统中两个独立变化的维度。</li></ul><h4 id="5-外观模式（Facade）"><a href="#5-外观模式（Facade）" class="headerlink" title="5.外观模式（Facade）"></a>5.外观模式（Facade）</h4><p>外观模式又称门面模式，提供了一个统一的接口，用来访问子系统中的一群接口。</p><p>特征：门面模式定义了一个高层接口，让子系统更容易使用。</p><p>外观（Facade）模式包含以下主要角色：</p><ul><li>外观（Facade）角色：为多个子系统对外提供一个共同的接口。</li><li>子系统（Sub System）角色：实现系统的部分功能，客户可以通过外观角色访问它。</li></ul><p>5.1 代码实现</p><p>下面以一个智能音箱实现起床睡觉一键操作电器的场景，通过代码模拟一下这个场景：</p><pre class="line-numbers language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Light</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"开灯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"关灯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Tv</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"开电视"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"关电视"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Fan</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"开风扇"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"关风扇"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmartSpeaker</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Light light<span class="token punctuation">;</span>    <span class="token keyword">private</span> Tv tv<span class="token punctuation">;</span>    <span class="token keyword">private</span> Fan fan<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">SmartSpeaker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        light <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Light</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        tv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        fan <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">say</span><span class="token punctuation">(</span>String order<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"起床"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">getUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"睡觉"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"我还听不懂你说的啥！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"起床"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        light<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        tv<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        fan<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"睡觉"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        light<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        tv<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        fan<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SmartSpeaker smartSpeaker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SmartSpeaker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//睡觉</span>        <span class="token comment" spellcheck="true">//关灯</span>        <span class="token comment" spellcheck="true">//关电视</span>        <span class="token comment" spellcheck="true">//开风扇</span>        smartSpeaker<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">"我要睡觉了!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//起床</span>        <span class="token comment" spellcheck="true">//开灯</span>        <span class="token comment" spellcheck="true">//开电视</span>        <span class="token comment" spellcheck="true">//关风扇</span>        smartSpeaker<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">"我起床了!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//我还听不懂你说的啥！</span>        smartSpeaker<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">"Emmm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>5.2 总结</p><p>适用场景：</p><ul><li>对分层结构系统构建时，使用外观模式定义子系统中每层的入口点可以简化子系统之间的依赖关系。</li><li>当一个复杂系统的子系统很多时，外观模式可以为系统设计一个简单的接口供外界访问。</li><li>当客户端与多个子系统之间存在很大的联系时，引入外观模式可将它们分离，从而提高子系统的独立性和可移植性。</li></ul><p>优点：</p><ul><li>简化了调用过程，无需深入了解子系统，以防给子系统带来风险。</li><li>减少系统依赖、松散耦合。</li><li>更好地划分访问层次，提高了安全性。</li><li>遵循迪米特法则，即最少知道原则。</li></ul><p>缺点：</p><ul><li>当增加子系统和扩展子系统行为时，可能容易带来未知风险。</li><li>不符合开闭原则。</li><li>某些情况下可能违背单一职责原则。</li></ul><h4 id="6-组合模式（Composite-Pattern）"><a href="#6-组合模式（Composite-Pattern）" class="headerlink" title="6.组合模式（Composite Pattern）"></a>6.组合模式（Composite Pattern）</h4><p>组合模式也称为整体-部分（Part-Whole）模式，它的宗旨是通过将单个对象（叶子结点）和组合对象（树枝节点）用相同的接口进行表示。</p><p>作用：使客户端对单个对象和组合对象保持一致的方式处理。</p><ul><li>组合模式主要包含三种角色：<br>抽象根节点（Component）：定义系统各层次对象的共有方法和属性，可以预先定义一些默认行为和属性。</li><li>树枝节点（Composite）：定义树枝节点的行为，存储子节点，组合树枝节点和叶子节点形成一个树形结构。</li><li>叶子节点（Leaf）：叶子节点对象，其下再无分支，是系统层次遍历的最小单位。</li></ul><p>6.1 代码实现</p><p>下面以一个添加菜单的例子通过代码实现：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 菜单组件</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">MenuComponent</span> <span class="token punctuation">{</span>    String name<span class="token punctuation">;</span>    Integer level<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>MenuComponent menuComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token string">"不支持添加操作!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span>MenuComponent menuComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token string">"不支持删除操作!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> MenuComponent <span class="token function">getChild</span><span class="token punctuation">(</span>Integer i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token string">"不支持获取子菜单操作!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token string">"不支持获取名字操作!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token string">"不支持打印操作!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 菜单类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Menu</span> <span class="token keyword">extends</span> <span class="token class-name">MenuComponent</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>MenuComponent<span class="token operator">></span> menuComponentList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Menu</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span><span class="token keyword">int</span> level<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>level <span class="token operator">=</span> level<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>MenuComponent menuComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>        menuComponentList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>menuComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span>MenuComponent menuComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>        menuComponentList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>menuComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> MenuComponent <span class="token function">getChild</span><span class="token punctuation">(</span>Integer i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> menuComponentList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> level<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"--"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>MenuComponent menuComponent <span class="token operator">:</span> menuComponentList<span class="token punctuation">)</span> <span class="token punctuation">{</span>            menuComponent<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 子菜单类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MenuItem</span> <span class="token keyword">extends</span> <span class="token class-name">MenuComponent</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">MenuItem</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span><span class="token keyword">int</span> level<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>level <span class="token operator">=</span> level<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> level<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"--"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试方法</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//创建一级菜单</span>        MenuComponent component <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Menu</span><span class="token punctuation">(</span><span class="token string">"系统管理"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        MenuComponent menu1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Menu</span><span class="token punctuation">(</span><span class="token string">"用户管理"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        menu1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token string">"新增用户"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        menu1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token string">"修改用户"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        menu1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token string">"删除用户"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        MenuComponent menu2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Menu</span><span class="token punctuation">(</span><span class="token string">"角色管理"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        menu2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token string">"新增角色"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        menu2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token string">"修改角色"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        menu2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token string">"删除角色"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        menu2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token string">"绑定用户"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//将二级菜单添加到一级菜单中</span>        component<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>menu1<span class="token punctuation">)</span><span class="token punctuation">;</span>        component<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>menu2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//打印菜单名称(如果有子菜单一块打印)</span>        component<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 测试结果</span>系统管理<span class="token operator">--</span>用户管理<span class="token operator">--</span><span class="token operator">--</span>新增用户<span class="token operator">--</span><span class="token operator">--</span>修改用户<span class="token operator">--</span><span class="token operator">--</span>删除用户<span class="token operator">--</span>角色管理<span class="token operator">--</span><span class="token operator">--</span>新增角色<span class="token operator">--</span><span class="token operator">--</span>修改角色<span class="token operator">--</span><span class="token operator">--</span>删除角色<span class="token operator">--</span><span class="token operator">--</span>绑定用户<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>6.2 总结</p><p>适用场景：</p><ul><li>希望客户端可以忽略组合对象与单个对象的差异时。</li><li>对象层次具备整体和部分，呈树形结构（如树形菜单，操作系统目录结构，公司组织架构等）。</li></ul><p>优点：</p><ul><li>清楚地定义分层次的复杂对象，表示对象的全部或部分层次。</li><li>让客户端忽略了层次的差异，方便对整个层次结构进行控制。</li><li>简化客户端代码。</li><li>符合开闭原则。</li></ul><p>缺点：</p><ul><li>限制类型时会较为复杂。</li><li>使设计变得更加抽象。</li></ul><p>分类：</p><ul><li>透明组合模式<ul><li>透明组合模式中，抽象根节点角色中声明了所有用于管理成员对象的方法，比如在示例中MenuComponent声明了add() 、 remove() 、getChild()方法，这样做的好处是确保所有的构件类都有相同的接口。透明组合模式也是组合模式的标准形式。</li><li>透明组合模式的缺点是不够安全，因为叶子对象和容器对象在本质上是有区别的，叶子对象不可能有下一个层次的对象，即不可能包含成员对象，因此为其提供 add()、remove() 等方法是没有意义的，这在编译阶段不会出错，但在运行阶段如果调用这些方法可能会出错（如果没有提供相应的错误处理代码）</li></ul></li><li>安全组合模式<ul><li>在安全组合模式中，在抽象构件角色中没有声明任何用于管理成员对象的方法，而是在树枝节点Menu类中声明并实现这些方法。安全组合模式的缺点是不够透明，因为叶子构件和容器构件具有不同的方法，且容器构件中那些用于管理成员对象的方法没有在抽象构件类中定义，因此客户端不能完全针对抽象编程，必须有区别地对待叶子构件和容器构件。</li></ul></li></ul><h4 id="7-享元模式（Flyweight-Pattern）"><a href="#7-享元模式（Flyweight-Pattern）" class="headerlink" title="7.享元模式（Flyweight Pattern）"></a>7.享元模式（Flyweight Pattern）</h4><p>享元模式又称为轻量级模式，是对象池的一种实现，类似于线程池，线程池可以避免不停的创建和销毁多个对象，消耗性能。提供了减少对象数量从而改善应用所需的对象结构的方式。宗旨：共享细粒度对象，将多个对同一对象的访问集中起来。</p><p>享元（Flyweight ）模式中存在以下两种状态：</p><ul><li>内部状态，即不会随着环境的改变而改变的可共享部分。</li><li>外部状态，指随环境改变而改变的不可以共享的部分。享元模式的实现要领就是区分应用中的这两种状态，并将外部状态外部化。</li></ul><p>享元模式的主要有以下角色：</p><ul><li>抽象享元角色（Flyweight）：通常是一个接口或抽象类，在抽象享元类中声明了具体享元类公共的方法，这些方法可以向外界提供享元对象的内部数据（内部状态），同时也可以通过这些方法来设置外部数据（外部状态）。</li><li>具体享元（Concrete Flyweight）角色 ：它实现了抽象享元类，称为享元对象；在具体享元类中为内部状态提供了存储空间。通常我们可以结合单例模式来设计具体享元类，为每一个具体享元类提供唯一的享元对象。</li><li>非享元（Unsharable Flyweight)角色 ：并不是所有的抽象享元类的子类都需要被共享，不能被共享的子类可设计为非共享具体享元类；当需要一个非共享具体享元类的对象时可以直接通过实例化创建。</li><li>享元工厂（Flyweight Factory）角色 ：负责创建和管理享元角色。当客户对象请求一个享元对象时，享元工厂检査系统中是否存在符合要求的享元对象，如果存在则提供给客户；如果不存在的话，则创建一个新的享元对象。</li></ul><p>7.1 代码实现</p><p>下面通过查询火车票的例子来用代码进行模拟实现：</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">// 抽象接口</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ITicket</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span>String seat<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TrainTicket</span> <span class="token keyword">implements</span> <span class="token class-name">ITicket</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String <span class="token keyword">from</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> String to<span class="token punctuation">;</span>    <span class="token keyword">private</span> Integer price<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">TrainTicket</span><span class="token punctuation">(</span>String <span class="token keyword">from</span><span class="token punctuation">,</span> String to<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">from</span> <span class="token operator">=</span> <span class="token keyword">from</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>to <span class="token operator">=</span> to<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span>String seat<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">from</span> <span class="token operator">+</span> <span class="token string">"->"</span> <span class="token operator">+</span> to <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> seat <span class="token operator">+</span> <span class="token string">"价格:"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 工厂类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TicketFactory</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> ITicket<span class="token operator">></span> pool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> ITicket <span class="token function">getTicket</span><span class="token punctuation">(</span>String <span class="token keyword">from</span><span class="token punctuation">,</span> String to<span class="token punctuation">)</span> <span class="token punctuation">{</span>        String key <span class="token operator">=</span> <span class="token keyword">from</span> <span class="token operator">+</span> <span class="token string">"->"</span> <span class="token operator">+</span> to<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>pool<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"使用缓存获取火车票:"</span> <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> pool<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"使用数据库获取火车票:"</span> <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>        ITicket ticket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrainTicket</span><span class="token punctuation">(</span><span class="token keyword">from</span><span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span>        pool<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> ticket<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> ticket<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ITicket ticket <span class="token operator">=</span> <span class="token function">getTicket</span><span class="token punctuation">(</span><span class="token string">"北京"</span><span class="token punctuation">,</span> <span class="token string">"上海"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//使用数据库获取火车票:北京->上海</span>        <span class="token comment" spellcheck="true">//北京->上海:二等座价格:20</span>        ticket<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token string">"二等座"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ITicket ticket1 <span class="token operator">=</span> <span class="token function">getTicket</span><span class="token punctuation">(</span><span class="token string">"北京"</span><span class="token punctuation">,</span> <span class="token string">"上海"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//使用缓存获取火车票:北京->上海</span>        <span class="token comment" spellcheck="true">//北京->上海:商务座价格:69</span>        ticket1<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token string">"商务座"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ITicket ticket2 <span class="token operator">=</span> <span class="token function">getTicket</span><span class="token punctuation">(</span><span class="token string">"上海"</span><span class="token punctuation">,</span> <span class="token string">"北京"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//使用数据库获取火车票:上海->北京</span>        <span class="token comment" spellcheck="true">//上海->北京:一等座价格:406</span>        ticket2<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token string">"一等座"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ticket <span class="token operator">==</span> ticket1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//true</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ticket <span class="token operator">==</span> ticket2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//false</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到ticket和ticket2是使用<a href="https://link.csdn.net/?target=https%3A%2F%2Fgitcode.com%2FSequoiaDB%2FSequoiaDB%2Foverview%3Flogin%3Dfrom_csdn" target="_blank" rel="noopener">数据库</a>查询的，而ticket1是使用缓存查询的，同时ticket == ticket1返回的是true，ticket == ticket2返回的是false，证明ticket和ticket1是共享的对象。</p><p>7.2 总结</p><p>适用场景：</p><ul><li>一个系统有大量相同或者相似的对象，造成内存的大量耗费。</li><li>对象的大部分状态都可以外部化，可以将这些外部状态传入对象中。</li><li>在使用享元模式时需要维护一个存储享元对象的享元池，而这需要耗费一定的系统资源，因此，应当在需要多次重复使用享元对象时才值得使用享元模式。</li></ul><p>优点：</p><ul><li>减少对象的创建，降低内存中对象的数量，降低系统的内存，提高效率。</li><li>减少内存之外的其他资源占用。</li></ul><p>缺点：</p><ul><li>关注内、外部状态。</li><li>关注线程安全问题。</li><li>使系统、程序的逻辑复杂化。</li></ul><h3 id="三、行为型模式"><a href="#三、行为型模式" class="headerlink" title="三、行为型模式"></a>三、<strong>行为型模式</strong></h3><h4 id="1-模板方法模式（Template-method-pattern）"><a href="#1-模板方法模式（Template-method-pattern）" class="headerlink" title="1.模板方法模式（Template method pattern）"></a>1.模板方法模式（Template method pattern）</h4><p>模板方法模式通常又叫模板模式，是指定义一个算法的骨架，并允许之类为其中的一个或者多个步骤提供实现。模板方法模式使得子类可以在不改变算法结构的情况下，重新定义算法的某些步骤。</p><p>模板方法（Template Method）模式包含以下主要角色：</p><ul><li>抽象类（Abstract Class）：负责给出一个算法的轮廓和骨架。它由一个模板方法和若干个基本方法构成。<ul><li>模板方法：定义了算法的骨架，按某种顺序调用其包含的基本方法。</li><li>基本方法：是实现算法各个步骤的方法，是模板方法的组成部分。基本方法又可以分为三种：<ul><li>抽象方法(Abstract Method) ：一个抽象方法由抽象类声明、由其具体子类实现。</li><li>具体方法(Concrete Method) ：一个具体方法由一个抽象类或具体类声明并实现，其子类可以进行覆盖也可以直接继承。</li><li>钩子方法(Hook Method) ：在抽象类中已经实现，包括用于判断的逻辑方法和需要子类重写的空方法两种。一般钩子方法是用于判断的逻辑方法，这类方法名一般为isXxx，返回值类型为boolean类型。</li></ul></li></ul></li><li>具体子类（Concrete Class）：实现抽象类中所定义的抽象方法和钩子方法，它们是一个顶级逻辑的组成步骤。</li></ul><p>1.1 代码实现</p><p>下面以一个简单的请假流程来通过代码来实现：</p><pre class="line-numbers language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">DayOffProcess</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 请假模板</span>    <span class="token keyword">public</span> final <span class="token keyword">void</span> <span class="token function">dayOffProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 领取申请表</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pickUpForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 填写申请信息</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">writeInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 签名</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">signUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 提交到不同部门审批</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">summit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 行政部备案</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">filing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">filing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"行政部备案"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">summit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">signUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"填写申请信息"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pickUpForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"领取申请表"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZhangSan</span> extends <span class="token class-name">DayOffProcess</span> <span class="token punctuation">{</span>    @Override    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">summit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"张三签名"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">signUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"提交到技术部审批"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Lisi</span> extends <span class="token class-name">DayOffProcess</span> <span class="token punctuation">{</span>    @Override    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">summit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"李四签名"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">signUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"提交到市场部审批"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试方法</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        DayOffProcess zhangsan <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZhangSan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//领取申请表</span>        <span class="token comment" spellcheck="true">//填写申请信息</span>        <span class="token comment" spellcheck="true">//提交到技术部审批</span>        <span class="token comment" spellcheck="true">//张三签名</span>        <span class="token comment" spellcheck="true">//行政部备案</span>        zhangsan<span class="token punctuation">.</span><span class="token function">dayOffProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        DayOffProcess lisi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Lisi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//领取申请表</span>        <span class="token comment" spellcheck="true">//填写申请信息</span>        <span class="token comment" spellcheck="true">//提交到市场部审批</span>        <span class="token comment" spellcheck="true">//李四签名</span>        <span class="token comment" spellcheck="true">//行政部备案</span>        lisi<span class="token punctuation">.</span><span class="token function">dayOffProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1.2 总结</p><p>适用场景：</p><ul><li>一次性实现一个算法不变的部分，并将可变的行为留给子类来实现。</li><li>各子类中公共的行为被提取出来并集中到一个公共的父类中，从而避免代码重复。</li></ul><p>优点：</p><ul><li>利用模板方法将相同处理逻辑的代码放到抽象父类中，可以提高代码的复用性。</li><li>将不同的代码不同的子类中，通过对子类的扩展增加新的行为，提高代码的扩展性。</li><li>把不变的行为写在父类上，去除子类的重复代码，提供了一个很好的代码复用平台，符合开闭原则。</li></ul><p>缺点：</p><ul><li>类数目的增加，每一个抽象类都需要一个子类来实现，这样导致类的个数增加。</li><li>类数量的增加，间接地增加了系统实现的复杂度。</li><li>继承关系自身缺点，如果父类添加新的抽象方法，所有子类都要改一遍。</li></ul><h4 id="2-策略模式（Strategy-Pattern）"><a href="#2-策略模式（Strategy-Pattern）" class="headerlink" title="2.策略模式（Strategy Pattern）"></a>2.策略模式（Strategy Pattern）</h4><p>策略模式又叫政策模式（Policy Pattern），它是将定义的算法家族分别封装起来，让它们之间可以互相替换，从而让算法的变化不会影响到使用算法的用户。可以避免多重分支的if……else和switch语句。</p><p>策略模式的主要角色如下：</p><ul><li>抽象策略（Strategy）类：这是一个抽象角色，通常由一个接口或抽象类实现。此角色给出所有的具体策略类所需的接口。</li><li>具体策略（Concrete Strategy）类：实现了抽象策略定义的接口，提供具体的算法实现或行为。</li><li>环境（Context）类：持有一个策略类的引用，最终给客户端调用。</li></ul><p>2.1 普通案例（会员卡打折）</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">// 会员卡接口</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">VipCard</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">discount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoldCard</span> <span class="token keyword">implements</span> <span class="token class-name">VipCard</span> <span class="token punctuation">{</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">discount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"金卡打7折"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SilverCard</span> <span class="token keyword">implements</span> <span class="token class-name">VipCard</span> <span class="token punctuation">{</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">discount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"银卡打8折"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CopperCard</span> <span class="token keyword">implements</span> <span class="token class-name">VipCard</span> <span class="token punctuation">{</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">discount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"铜卡打9折"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Normal</span> <span class="token keyword">implements</span> <span class="token class-name">VipCard</span> <span class="token punctuation">{</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">discount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"普通会员没有折扣"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 会员卡容器类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VipCardFactory</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> VipCard<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">{</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"gold"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">GoldCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"silver"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SilverCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"copper"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CopperCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> VipCard <span class="token function">getVIPCard</span><span class="token punctuation">(</span>String level<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> map<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Normal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试方法</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//金卡打7折</span>        VipCardFactory<span class="token punctuation">.</span><span class="token function">getVIPCard</span><span class="token punctuation">(</span><span class="token string">"gold"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">discount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//银卡打8折</span>        VipCardFactory<span class="token punctuation">.</span><span class="token function">getVIPCard</span><span class="token punctuation">(</span><span class="token string">"silver"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">discount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//普通会员没有折扣</span>        VipCardFactory<span class="token punctuation">.</span><span class="token function">getVIPCard</span><span class="token punctuation">(</span><span class="token string">"other"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">discount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>用一个容器（Map）装起来，可以通过传进来的参数直接获取对应的策略，避免了if…else。</p><p>2.2 支付方式案例</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">// 支付方式抽象类</span><span class="token keyword">public</span> abstract <span class="token keyword">class</span> <span class="token class-name">Payment</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> String <span class="token function">pay</span><span class="token punctuation">(</span>String uid<span class="token punctuation">,</span> double money<span class="token punctuation">)</span> <span class="token punctuation">{</span>        double balance <span class="token operator">=</span> <span class="token function">queryBalance</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>balance <span class="token operator">&lt;</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token string">"支付失败!余额不足!欠"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>money <span class="token operator">-</span> balance<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"元!"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token string">"支付成功!支付金额:"</span> <span class="token operator">+</span> money <span class="token operator">+</span> <span class="token string">"余额剩余:"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>balance <span class="token operator">-</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">protected</span> abstract String <span class="token function">getPaymentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> abstract double <span class="token function">queryBalance</span><span class="token punctuation">(</span>String uid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 现金支付 默认方式</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cash</span> <span class="token keyword">extends</span> <span class="token class-name">Payment</span><span class="token punctuation">{</span>    @Override    <span class="token keyword">protected</span> String <span class="token function">getPaymentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"现金支付"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">protected</span> double <span class="token function">queryBalance</span><span class="token punctuation">(</span>String uid<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token number">1000</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 支付宝类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliPay</span> <span class="token keyword">extends</span> <span class="token class-name">Payment</span> <span class="token punctuation">{</span>    @Override    <span class="token keyword">protected</span> String <span class="token function">getPaymentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"支付宝"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">protected</span> double <span class="token function">queryBalance</span><span class="token punctuation">(</span>String uid<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token number">500</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 微信支付类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeChatPay</span> <span class="token keyword">extends</span> <span class="token class-name">Payment</span> <span class="token punctuation">{</span>    @Override    <span class="token keyword">protected</span> String <span class="token function">getPaymentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"微信支付"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">protected</span> double <span class="token function">queryBalance</span><span class="token punctuation">(</span>String uid<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token number">300</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 支付方式容器策略类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentStrategy</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Payment<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">{</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"WeChat"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">WeChatPay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"Ali"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AliPay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> Payment <span class="token function">getPayment</span><span class="token punctuation">(</span>String payment<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>payment<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">Cash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> map<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>payment<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 订单交易类</span>@AllArgsConstructor<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String uid<span class="token punctuation">;</span>    <span class="token keyword">private</span> double amount<span class="token punctuation">;</span>    <span class="token keyword">public</span> String <span class="token function">pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">pay</span><span class="token punctuation">(</span><span class="token string">"cash"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">pay</span><span class="token punctuation">(</span>String key<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Payment payment <span class="token operator">=</span> PaymentStrategy<span class="token punctuation">.</span><span class="token function">getPayment</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"欢迎使用"</span> <span class="token operator">+</span> payment<span class="token punctuation">.</span><span class="token function">getPaymentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"本次交易金额:"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>amount <span class="token operator">+</span> <span class="token string">",开始扣款..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> payment<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>uid<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试方法</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Order order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token string">"20221014001"</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//欢迎使用微信支付</span>        <span class="token comment" spellcheck="true">//本次交易金额:500.0,开始扣款...</span>        <span class="token comment" spellcheck="true">//支付失败!余额不足!欠200.0元!</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token string">"WeChat"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//欢迎使用支付宝</span>        <span class="token comment" spellcheck="true">//本次交易金额:500.0,开始扣款...</span>        <span class="token comment" spellcheck="true">//支付成功!支付金额:500.0余额剩余:0.0</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token string">"Ali"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//欢迎使用现金支付</span>        <span class="token comment" spellcheck="true">//本次交易金额:500.0,开始扣款...</span>        <span class="token comment" spellcheck="true">//支付成功!支付金额:500.0余额剩余:500.0</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2.3 总结</p><p>适用场景：</p><ul><li>系统中有很多类，而它们的区别仅仅在于它们的行为不同。</li><li>系统需要动态地在几种算法中选择一种。</li><li>需要屏蔽算法规则。</li></ul><p>优点：</p><ul><li>符合开闭原则。</li><li>避免使用多重条件语句。</li><li>可以提高算法的保密性和安全性。</li><li>易于扩展。</li></ul><p>缺点：</p><ul><li>客户端必须知道所有的策略，并且自行决定使用哪一个策略类。</li><li>代码中会产生非常多的策略类，增加维护难度。</li></ul><h4 id="3-命令模式（Command-Pattern）"><a href="#3-命令模式（Command-Pattern）" class="headerlink" title="3.命令模式（Command Pattern）"></a>3.命令模式（Command Pattern）</h4><p>命令模式是对命令的封装，每一个命令都是一个操作：请求的一方发出请求要求执行一个操作；接收的一方收到请求，并执行操作。命令模式解耦了请求方和接收方，请求方只需请求执行命令，不用关心命令是怎样被接收，怎样被操作以及是否被执行等。本质：解耦命令的请求与处理。</p><p>命令模式包含以下主要角色：</p><ul><li>抽象命令类（Command）角色： 定义命令的接口，声明执行的方法。</li><li>具体命令（Concrete Command）角色：具体的命令，实现命令接口；通常会持有接收者，并调用接收者的功能来完成命令要执行的操作。</li><li>实现者/接收者（Receiver）角色： 接收者，真正执行命令的对象。任何类都可能成为一个接收者，只要它能够实现命令要求实现的相应功能。</li><li>调用者/请求者（Invoker）角色： 要求命令对象执行请求，通常会持有命令对象，可以持有很多的命令对象。这个是客户端真正触发命令并要求命令执行相应操作的地方，也就是说相当于使用命令对象的入口。</li></ul><p>3.1 代码实现</p><p>下面以一个播放器的例子来进行代码实现：</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">// 播放器类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Player</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"正常播放"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"暂停播放"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"停止播放"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 命令接口</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IAction</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">excuse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 播放命令类</span>@AllArgsConstructor<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PlayAction</span> <span class="token keyword">implements</span> <span class="token class-name">IAction</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Player player<span class="token punctuation">;</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">excuse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 暂停命令类</span>@AllArgsConstructor<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PauseAction</span> <span class="token keyword">implements</span> <span class="token class-name">IAction</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Player player<span class="token punctuation">;</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">excuse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 停止命令类</span>@AllArgsConstructor<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StopAction</span> <span class="token keyword">implements</span> <span class="token class-name">IAction</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> Player player<span class="token punctuation">;</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">excuse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 控制器</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">excuse</span><span class="token punctuation">(</span>IAction action<span class="token punctuation">)</span> <span class="token punctuation">{</span>        action<span class="token punctuation">.</span><span class="token function">excuse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>   <span class="token comment" spellcheck="true">// 测试方法</span>   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 正常播放</span>        <span class="token keyword">new</span> <span class="token class-name">Controller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">excuse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PlayAction</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 暂停播放</span>        <span class="token keyword">new</span> <span class="token class-name">Controller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">excuse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PauseAction</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 停止播放</span>        <span class="token keyword">new</span> <span class="token class-name">Controller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">excuse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StopAction</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3.2 总结</p><p>适用场景：</p><ul><li>现实语义中具备“命令”的操作（如命令菜单，shell命令…）。</li><li>请求调用者和请求接收者需要解耦，使得调用者和接收者不直接交互。</li><li>需要抽象出等待执行的行为，比如撤销操作和恢复操作等。</li><li>需要支持命令宏（即命令组合操作）。</li></ul><p>优点：</p><ul><li>通过引入中间件（抽象接口），解耦了命令的请求与实现。</li><li>扩展性良好，可以很容易地增加新命令。</li><li>支持组合命令，支持命令队列。</li><li>可以在现有的命令的基础上，增加额外功能。</li></ul><p>缺点：</p><ul><li>具体命令类可能过多。</li><li>增加 了程序的复杂度，理解更加困难。</li></ul><h4 id="4-职责链模式（chain-of-responsibility-pattern）"><a href="#4-职责链模式（chain-of-responsibility-pattern）" class="headerlink" title="4.职责链模式（chain of responsibility pattern）"></a>4.职责链模式（chain of responsibility pattern）</h4><p>职责链模式是将链中每一个节点看作是一个对象，每个节点处理的请求均不同，且内部自动维护一个下一节点对象。当一个请求从链式的首端发出时，会沿着链的路径依次传递给每一个节点对象，直至有对象处理这个请求为止。</p><p>职责链模式主要包含以下角色：</p><ul><li>抽象处理者（Handler）角色：定义一个处理请求的接口，包含抽象处理方法和一个后继连接。</li><li>具体处理者（Concrete Handler）角色：实现抽象处理者的处理方法，判断能否处理本次请求，如果可以处理请求则处理，否则将该请求转给它的后继者。</li><li>客户类（Client）角色：创建处理链，并向链头的具体处理者对象提交请求，它不关心处理细节和请求的传递过程。</li></ul><p>4.1 代码实现</p><p>下面以一个简单的登录校验流程来通过代码进行实现：</p><pre class="line-numbers language-scala"><code class="language-scala"><span class="token comment" spellcheck="true">// 用户实体类</span><span class="token annotation punctuation">@Data</span>public <span class="token keyword">class</span> User <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token builtin">String</span> username<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token builtin">String</span> password<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token builtin">String</span> role<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// handler抽象类</span>public <span class="token keyword">abstract</span> <span class="token keyword">class</span> Handler <span class="token punctuation">{</span>    <span class="token keyword">protected</span> Handler next<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 返回handler方便链式操作</span>    public void next<span class="token punctuation">(</span>Handler next<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 流程开始的方法</span>    public <span class="token keyword">abstract</span> void doHandler<span class="token punctuation">(</span>User user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 校验用户名或者密码是否为空</span>public <span class="token keyword">class</span> ValidateHandler <span class="token keyword">extends</span> Handler <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    public void doHandler<span class="token punctuation">(</span>User user<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span>isBlank<span class="token punctuation">(</span>user<span class="token punctuation">.</span>getUsername<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> StringUtils<span class="token punctuation">.</span>isBlank<span class="token punctuation">(</span>user<span class="token punctuation">.</span>getPassword<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println<span class="token punctuation">(</span><span class="token string">"用户名或者密码为空!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println<span class="token punctuation">(</span><span class="token string">"校验通过"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        next<span class="token punctuation">.</span>doHandler<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 登录校验，校验用户名是否匹配密码</span>public <span class="token keyword">class</span> LoginHandler <span class="token keyword">extends</span> Handler <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    public void doHandler<span class="token punctuation">(</span>User user<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">"pyy52hz"</span><span class="token punctuation">.</span>equals<span class="token punctuation">(</span>user<span class="token punctuation">.</span>getUsername<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token string">"123456"</span><span class="token punctuation">.</span>equals<span class="token punctuation">(</span>user<span class="token punctuation">.</span>getPassword<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println<span class="token punctuation">(</span><span class="token string">"用户名或者密码不正确!请检查!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        user<span class="token punctuation">.</span>setRole<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println<span class="token punctuation">(</span><span class="token string">"登陆成功!角色为管理员!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        next<span class="token punctuation">.</span>doHandler<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 权限校验</span>public <span class="token keyword">class</span> AuthHandler <span class="token keyword">extends</span> Handler <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    public void doHandler<span class="token punctuation">(</span>User user<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">"admin"</span><span class="token punctuation">.</span>equals<span class="token punctuation">(</span>user<span class="token punctuation">.</span>getRole<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println<span class="token punctuation">(</span><span class="token string">"无权限操作!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println<span class="token punctuation">(</span><span class="token string">"角色为管理员,可以进行下一步操作!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 登录流程</span>public <span class="token keyword">class</span> LoginService <span class="token punctuation">{</span>    public void login<span class="token punctuation">(</span>User user<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Handler validateHandler <span class="token operator">=</span> <span class="token keyword">new</span> ValidateHandler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Handler loginHandler <span class="token operator">=</span> <span class="token keyword">new</span> LoginHandler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Handler authHandler <span class="token operator">=</span> <span class="token keyword">new</span> AuthHandler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        validateHandler<span class="token punctuation">.</span>next<span class="token punctuation">(</span>loginHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>        loginHandler<span class="token punctuation">.</span>next<span class="token punctuation">(</span>authHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>        validateHandler<span class="token punctuation">.</span>doHandler<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试方法</span>    public static void main<span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>      User user <span class="token operator">=</span> <span class="token keyword">new</span> User<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//校验通过</span>      <span class="token comment" spellcheck="true">//用户名或者密码不正确!请检查!</span>      user<span class="token punctuation">.</span>setUsername<span class="token punctuation">(</span><span class="token string">"pyy52hz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      user<span class="token punctuation">.</span>setPassword<span class="token punctuation">(</span><span class="token string">"1234567"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      LoginService loginService <span class="token operator">=</span> <span class="token keyword">new</span> LoginService<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      loginService<span class="token punctuation">.</span>login<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//校验通过</span>      <span class="token comment" spellcheck="true">//登陆成功!角色为管理员!</span>      <span class="token comment" spellcheck="true">//角色为管理员,可以进行下一步操作!</span>      user<span class="token punctuation">.</span>setUsername<span class="token punctuation">(</span><span class="token string">"pyy52hz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      user<span class="token punctuation">.</span>setPassword<span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      loginService<span class="token punctuation">.</span>login<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>4.3 结合建造者模式</p><p>与基础版本区别主要是Handler类中新增一个Builder的内部类，以及流程类里改用链式写法，具体如下：</p><pre class="line-numbers language-kotlin"><code class="language-kotlin"><span class="token comment" spellcheck="true">// handler抽象类</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> Handler<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> Handler next<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 返回handler方便链式操作</span>    <span class="token keyword">public</span> Handler <span class="token function">next</span><span class="token punctuation">(</span>Handler next<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>        <span class="token keyword">return</span> next<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 流程开始的方法</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> void <span class="token function">doHandler</span><span class="token punctuation">(</span>User user<span class="token punctuation">)</span><span class="token punctuation">;</span>    static <span class="token keyword">class</span> Builder<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">private</span> Handler<span class="token operator">&lt;</span>T<span class="token operator">></span> head<span class="token punctuation">;</span>        <span class="token keyword">private</span> Handler<span class="token operator">&lt;</span>T<span class="token operator">></span> tail<span class="token punctuation">;</span>        <span class="token keyword">public</span> Builder<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">addHandler</span><span class="token punctuation">(</span>Handler<span class="token operator">&lt;</span>T<span class="token operator">></span> handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>head <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>head <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tail <span class="token operator">=</span> handler<span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>tail<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>tail <span class="token operator">=</span> handler<span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> Handler<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>head<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> LoginService <span class="token punctuation">{</span>    <span class="token keyword">public</span> void <span class="token function">login</span><span class="token punctuation">(</span>User user<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Handler<span class="token punctuation">.</span>Builder builder <span class="token operator">=</span> new Handler<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        builder<span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span>new <span class="token function">ValidateHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span>new <span class="token function">LoginHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span>new <span class="token function">AuthHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doHandler</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>4.4 总结</p><p>适用场景：</p><ul><li>多个对象可以处理同一请求，但具体由哪个对象处理则在运行时动态决定。</li><li>在不明确指定接收者的情况下，向多个对象中的一个提交一个请求。</li><li>可动态指定一组对象处理请求。</li></ul><p>优点：</p><ul><li>将请求与处理解耦。</li><li>请求处理者（节点对象）只需关注自己感兴趣的请求进行处理即可，对于不感兴趣的请求，直接转发给下一级节点对象。</li><li>具备链式传递处理请求功能，请求发送者无需知晓链路结构，只需等待请求处理结果。</li><li>链路结构灵活，可以通过改变链路结构动态地新增或删减责任。</li><li>易于扩展新的请求处理类（节点），符合开闭原则。</li></ul><p>缺点：</p><ul><li>责任链太长或者处理时间过长，会影响整体性能。</li><li>如果节点对象存在循环引用时，会造成死循环，导致系统崩溃。</li></ul><h4 id="5-状态模式（State-Pattern）"><a href="#5-状态模式（State-Pattern）" class="headerlink" title="5.状态模式（State Pattern）"></a>5.状态模式（State Pattern）</h4><p>状态模式也称为状态机模式（State Machine Pattern），是允许对象在内部状态发生改变时改变它的行为，对象看起来好像修改了它的类。</p><p>状态模式包含以下主要角色：</p><ul><li>环境（Context）角色：也称为上下文，它定义了客户程序需要的接口，维护一个当前状态，并将与状态相关的操作委托给当前状态对象来处理。</li><li>抽象状态（State）角色：定义一个接口，用以封装环境对象中的特定状态所对应的行为。</li><li>具体状态（Concrete State）角色：实现抽象状态所对应的行为。</li></ul><p>5.1 代码实现</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">// 电梯状态</span><span class="token keyword">public</span> abstract <span class="token keyword">class</span> <span class="token class-name">LiftState</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> Context context<span class="token punctuation">;</span>    <span class="token keyword">public</span> abstract <span class="token keyword">void</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> abstract <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> abstract <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> abstract <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 开门状态</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OpenState</span> <span class="token keyword">extends</span> <span class="token class-name">LiftState</span> <span class="token punctuation">{</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"电梯门打开了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>CLOSE_STATE<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 关门状态</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CloseState</span> <span class="token keyword">extends</span> <span class="token class-name">LiftState</span> <span class="token punctuation">{</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>OPEN_STATE<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"电梯门关闭了!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>RUN_STATE<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>STOP_STATE<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 运行状态</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunState</span> <span class="token keyword">extends</span> <span class="token class-name">LiftState</span> <span class="token punctuation">{</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"电梯正在运行..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>STOP_STATE<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 停止状态</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StopState</span> <span class="token keyword">extends</span> <span class="token class-name">LiftState</span> <span class="token punctuation">{</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>OPEN_STATE<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>CLOSE_STATE<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>RUN_STATE<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"电梯停止了!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 上下文</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Context</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> LiftState liftState<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> final LiftState OPEN_STATE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OpenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> final LiftState CLOSE_STATE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CloseState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> final LiftState RUN_STATE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RunState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> final LiftState STOP_STATE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StopState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLiftState</span><span class="token punctuation">(</span>LiftState liftState<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState <span class="token operator">=</span> liftState<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState<span class="token punctuation">.</span><span class="token function">setContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>      Context context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CloseState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//电梯门打开了</span>      <span class="token comment" spellcheck="true">//电梯门关闭了!</span>      <span class="token comment" spellcheck="true">//电梯正在运行...</span>      <span class="token comment" spellcheck="true">//电梯停止了!</span>      context<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      context<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      context<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      context<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>5.2 spring的状态机</p><p>// Todo</p><p>5.3 总结</p><p>适用场景：</p><ul><li>行为随状态改变而改变的场景。</li><li>一个操作中含有庞大的多分支结构，并且这些分支取决于对象的状态。</li></ul><p>优点：</p><ul><li>结构清晰：将状态独立为类，消除了冗余的if…else或switch…case语句，使代码更加简洁，提高系统可维护性。</li><li>将状态转换显示化：通常的对象内部都是使用数值类型来定义状态，状态的切换是通过赋值进行表现，不够直观；而使用状态类，在切换状态时，是以不同的类进行表示，转换目的更加明确。</li><li>状态类职责明确且具备扩展性。</li></ul><p>缺点：</p><ul><li>类膨胀：如果一个事物具备很多状态，则会造成状态类太多。</li><li>状态模式的结构与实现都较为复杂，如果使用不当将导致程序结构和代码的混乱。</li><li>状态模式对开闭原则的支持并不太好，对于可以切换状态的状态模式，增加新的状态类需要修改那些负责状态转换的源代码，否则无法切换到新增状态，而且修改某个状态类的行为也需修改对应类的源代码。</li></ul><h4 id="6-观察者模式（Observer-Mode）"><a href="#6-观察者模式（Observer-Mode）" class="headerlink" title="6.观察者模式（Observer Mode）"></a>6.观察者模式（Observer Mode）</h4><p>观察者模式，又叫发布-订阅（Publish/Subscribe）模式，模型-视图（Model/View）模式，源-监听器（Source/Listener）模式或从属者（Dependents）模式。定义一种一对多的依赖关系，一个主题对象可被多个观察者同时监听，使得每当主题对象状态变化时，所有依赖于它的对象都会得到通知并被自动更新。</p><p>6.1 代码实现</p><p>通过一个微信用户（观察者）订阅公众号（被观察者）接收公众号推送消息的例子来进行简单的代码实现：</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">// 抽象观察者接口</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 微信用户类 具体的观察者</span>@AllArgsConstructor<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeixinUser</span> <span class="token keyword">implements</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">"接收到了消息(观察到了):"</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 被观察者接口</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Observable</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 新增用户(新增观察者)</span>    <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>Observer observer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 移除用户,或者说用户取消订阅(移除观察者)</span>    <span class="token keyword">void</span> <span class="token function">del</span><span class="token punctuation">(</span>Observer observer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 发布 推送消息</span>    <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 具体的被观察者(公众号)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Subject</span> <span class="token keyword">implements</span> <span class="token class-name">Observable</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 观察者列表(订阅用户)</span>    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>Observer<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>Observer observer<span class="token punctuation">)</span> <span class="token punctuation">{</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">del</span><span class="token punctuation">(</span>Observer observer<span class="token punctuation">)</span> <span class="token punctuation">{</span>        list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 给每一个观察者(订阅者)推送消息</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span> <span class="token punctuation">{</span>        list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>observer <span class="token operator">-</span><span class="token operator">></span> observer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>      Observable o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      WeixinUser user1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeixinUser</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      WeixinUser user2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeixinUser</span><span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      WeixinUser user3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeixinUser</span><span class="token punctuation">(</span><span class="token string">"王五"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      o<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user1<span class="token punctuation">)</span><span class="token punctuation">;</span>      o<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user2<span class="token punctuation">)</span><span class="token punctuation">;</span>      o<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user3<span class="token punctuation">)</span><span class="token punctuation">;</span>      o<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token string">"薛之谦演唱会要来到广州啦!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// 运行结果</span>      <span class="token comment" spellcheck="true">// 张三接收到了消息(观察到了):薛之谦演唱会要来到广州啦!</span>      <span class="token comment" spellcheck="true">// 李四接收到了消息(观察到了):薛之谦演唱会要来到广州啦!</span>      <span class="token comment" spellcheck="true">// 王五接收到了消息(观察到了):薛之谦演唱会要来到广州啦!</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>6.2 JDK实现</p><p>在 Java 中，通过java.util.Observable类和 java.util.Observer接口定义了观察者模式，只要实现它们的子类就可以编写观察者模式实例。</p><p>6.2.1 Observable类</p><p>Observable类是抽象目标类（被观察者），它有一个Vector集合成员变量，用于保存所有要通知的观察者对象，下面是它最重要的 3 个方法：<br>void addObserver(Observer o) 方法：用于将新的观察者对象添加到集合中。<br>void notifyObservers(Object arg) 方法：调用集合中的所有观察者对象的update方法，通知它们数据发生改变。通常越晚加入集合的观察者越先得到通知。<br>void setChange() 方法：用来设置一个boolean类型的内部标志，注明目标对象发生了变化。当它为true时，notifyObservers() 才会通知观察者。</p><p>6.2.2 Observer 接口</p><p>Observer 接口是抽象观察者，它监视目标对象的变化，当目标对象发生变化时，观察者得到通知，并调用 update 方法，进行相应的工作。</p><p>6.2.3 代码实现</p><p>下面还是通过微信用户订阅公众号的例子进行代码实现，方便对比他们之间的区别：</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">// 具体的被观察者(公众号)</span>@Data@AllArgsConstructor<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Subject</span> <span class="token keyword">extends</span> <span class="token class-name">Observable</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 公众号的名字</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 公众号发布消息</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notifyMessage</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"公众号发布消息:"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"请关注用户留意接收!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">notifyObservers</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>@AllArgsConstructor<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeixinUser</span> <span class="token keyword">implements</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * @param o 被观察者     * @param arg 被观察者带过来的参数，此例子中是公众号发布的消息     */</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span>Observable o<span class="token punctuation">,</span> Object arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">"关注了公众号(被观察者):"</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Subject<span class="token punctuation">)</span>o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">",接收到消息:"</span> <span class="token operator">+</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>        WeixinUser user1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeixinUser</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        WeixinUser user2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeixinUser</span><span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        WeixinUser user3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeixinUser</span><span class="token punctuation">(</span><span class="token string">"王五"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Subject subject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token string">"演唱会消息发布"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        subject<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span>user1<span class="token punctuation">)</span><span class="token punctuation">;</span>        subject<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span>user2<span class="token punctuation">)</span><span class="token punctuation">;</span>        subject<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span>user3<span class="token punctuation">)</span><span class="token punctuation">;</span>        subject<span class="token punctuation">.</span><span class="token function">notifyMessage</span><span class="token punctuation">(</span><span class="token string">"薛之谦演唱会要来到广州啦!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 返回结果</span>        <span class="token comment" spellcheck="true">// 演唱会消息发布公众号发布消息:薛之谦演唱会要来到广州啦!请关注用户留意接收!</span>        <span class="token comment" spellcheck="true">// 王五关注了公众号(被观察者):演唱会消息发布,接收到消息:薛之谦演唱会要来到广州啦!</span>        <span class="token comment" spellcheck="true">// 李四关注了公众号(被观察者):演唱会消息发布,接收到消息:薛之谦演唱会要来到广州啦!</span>        <span class="token comment" spellcheck="true">// 张三关注了公众号(被观察者):演唱会消息发布,接收到消息:薛之谦演唱会要来到广州啦!</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>6.3 Google的Guava实现</p><table><thead><tr><th><strong>EventBus 术语</strong></th><th><strong>解释</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td>事件（消息）</td><td>可以向事件总线（EventBus）发布的对象</td><td>通常是一个类，不同的消息事件用不同的类来代替，消息内容就是类里面的属性</td></tr><tr><td>订阅</td><td>向事件总线注册监听者，以接受事件的行为</td><td>EventBus.register(Object)，参数就是监听者</td></tr><tr><td>监听者</td><td>提供一个处理方法，希望接受和处理事件的对象</td><td>通常也是一个类，里面有消息的处理方法</td></tr><tr><td>处理方法</td><td>监听者提供的公共方法，事件总线使用该方法向监听者发送事件；该方法应使用 Subscribe 注解</td><td>监听者里面添加一个 Subscribe 注解的方法，就可以认为是消息的处理方法</td></tr><tr><td>发布消息</td><td>通过事件总线向所有匹配的监听者提供事件</td><td>EventBus.post(Object)</td></tr></tbody></table><pre class="line-numbers language-typescript"><code class="language-typescript">@AllArgsConstructor<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeixinUser</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    @Subscribe    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getMessage</span><span class="token punctuation">(</span>Object arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"接收到消息:"</span> <span class="token operator">+</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 消息总线</span>        EventBus eventBus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        eventBus<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WeixinUser</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        eventBus<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WeixinUser</span><span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        eventBus<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"薛之谦演唱会要来到广州啦!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 返回结果</span>        <span class="token comment" spellcheck="true">// 张三接收到消息:薛之谦演唱会要来到广州啦!</span>        <span class="token comment" spellcheck="true">// 李四接收到消息:薛之谦演唱会要来到广州啦!</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>6.4 总结</p><p>适用场景：</p><ul><li>当一个抽象模型包含两个方面内容，其中一个方面依赖于另一个方面。</li><li>其他一个或多个对象的变化依赖于另一个对象的变化。</li><li>实现类似广播机制的功能，无需知道具体收听者，只需分发广播，系统中感兴趣的对象会自动接收该广播。</li></ul><p>多层级嵌套使用，形成一种链式触发机制，使得事件具备跨域（跨越两种观察者类型）通知。</p><p>优点：</p><ul><li>观察者和被观察者是松耦合（抽象耦合）的，符合依赖倒置原则。</li><li>分离了表示层（观察者）和数据逻辑层（被观察者），并且建立了一套触发机制，使得数据的变化可以相应到多个表示层上。</li><li>实现了一对多的通讯机制，支持事件注册机制，支持兴趣分发机制，当被观察者触发事件时，只有感兴趣的观察者可以接收到通知。</li></ul><p>缺点：</p><ul><li>如果观察者数量过多，则事件通知会耗时较长。</li><li>事件通知呈线性关系，如果其中一个观察者处理事件卡壳，会影响后续的观察者接收该事件。</li><li>如果观察者和被观察者之间存在循环依赖，则可能造成两者之间的循环调用，导致系统崩溃。</li></ul><h4 id="7-中介者模式（mediator-pattern）"><a href="#7-中介者模式（mediator-pattern）" class="headerlink" title="7.中介者模式（mediator pattern）"></a>7.中介者模式（mediator pattern）</h4><p>中介者模式又称为调解者模式或调停者模式。用一个中介对象封装一系列的对象交互，中介者使各对象不需要显示地相互作用，从而使其耦合松散，而且可以独立地改变它们之间的交互。</p><p>核心：通过中介者解耦系统各层次对象的直接耦合，层次对象的对外依赖通信统统交由中介者转发。</p><p>中介者模式包含以下主要角色：</p><ul><li>抽象中介者（Mediator）角色：它是中介者的接口，提供了同事对象注册与转发同事对象信息的抽象方法。</li><li>具体中介者（ConcreteMediator）角色：实现中介者接口，定义一个 List 来管理同事对象，协调各个同事角色之间的交互关系，因此它依赖于同事角色。</li><li>抽象同事类（Colleague）角色：定义同事类的接口，保存中介者对象，提供同事对象交互的抽象方法，实现所有相互影响的同事类的公共功能。</li><li>具体同事类（Concrete Colleague）角色：是抽象同事类的实现者，当需要与其他同事对象交互时，由中介者对象负责后续的交互。</li></ul><p>7.1 代码实现</p><p>通过一个租房例子简单实现下逻辑，房主通过中介公司发布自己的房子的信息，而租客则需要通过中介公司获取到房子的信息：</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">// 抽象同事类</span>@AllArgsConstructor<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> String name<span class="token punctuation">;</span>    <span class="token keyword">protected</span> MediatorCompany mediatorCompany<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 房主</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HouseOwner</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">HouseOwner</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> MediatorCompany mediatorCompany<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> mediatorCompany<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 联络方法</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">connection</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span> <span class="token punctuation">{</span>        mediatorCompany<span class="token punctuation">.</span><span class="token function">connection</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 获取消息</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getMessage</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"房主"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"获取到的信息:"</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 租客</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Tenant</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">Tenant</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> MediatorCompany mediatorCompany<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> mediatorCompany<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">connection</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span> <span class="token punctuation">{</span>        mediatorCompany<span class="token punctuation">.</span><span class="token function">connection</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getMessage</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"租客"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"获取到的信息:"</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 中介公司(中介者)</span>@Data<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MediatorCompany</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> HouseOwner houseOwner<span class="token punctuation">;</span>    <span class="token keyword">private</span> Tenant tenant<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">connection</span><span class="token punctuation">(</span>Person person<span class="token punctuation">,</span> String message<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 房主需要通过中介获取租客信息</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>houseOwner<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>tenant<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 反之租客通过中介获取房主信息</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>houseOwner<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 先创建三个角色，中介公司，房主，租客</span>        MediatorCompany mediatorCompany <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediatorCompany</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 房主和租客都在同一家中介公司</span>        HouseOwner houseOwner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HouseOwner</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">,</span> mediatorCompany<span class="token punctuation">)</span><span class="token punctuation">;</span>        Tenant tenant <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tenant</span><span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">,</span> mediatorCompany<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 中介公司获取房主和租客的信息</span>        mediatorCompany<span class="token punctuation">.</span><span class="token function">setHouseOwner</span><span class="token punctuation">(</span>houseOwner<span class="token punctuation">)</span><span class="token punctuation">;</span>        mediatorCompany<span class="token punctuation">.</span><span class="token function">setTenant</span><span class="token punctuation">(</span>tenant<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 房主和租客都在这家中介公司发布消息，获取到对应的消息</span>        tenant<span class="token punctuation">.</span><span class="token function">connection</span><span class="token punctuation">(</span>tenant<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"想租一房一厅!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        houseOwner<span class="token punctuation">.</span><span class="token function">connection</span><span class="token punctuation">(</span>houseOwner<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"这里有!来看看呗!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 测试结果</span>        <span class="token comment" spellcheck="true">// 房主张三获取到的信息:李四想租一房一厅!</span>        <span class="token comment" spellcheck="true">// 租客李四获取到的信息:张三这里有!来看看呗!</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>7.2 总结</p><p>适用场景：</p><ul><li>系统中对象之间存在复杂的引用关系，产生的我相互依赖关系结构混乱且难以理解。</li><li>交互的公共行为，如果需要改变行为则可以增加新的中介者类。</li></ul><p>优点：</p><ul><li>减少类间的依赖，将多对多依赖转化成了一对多，降低了类间耦合。</li><li>类间各司其职，符合迪米特法则。</li></ul><p>缺点：</p><ul><li>中介者模式中将原本多个对象直接的相互依赖变成了中介者和多个同事类的依赖关系。当同事类越多时，中介者就会越臃肿，变得复杂且难以维护。</li></ul><h4 id="8-迭代器模式（Iterator-Pattern）"><a href="#8-迭代器模式（Iterator-Pattern）" class="headerlink" title="8.迭代器模式（Iterator Pattern）"></a>8.迭代器模式（Iterator Pattern）</h4><p>迭代器模式又称为游标模式（Cursor Pattern），它提供一种顺序访问集合/容器对象元素的方法，而又无须暴露结合内部表示。</p><p>本质：抽离集合对象迭代行为到迭代器中，提供一致访问接口。</p><p>迭代器模式主要包含以下角色：</p><ul><li>抽象聚合（Aggregate）角色：定义存储、添加、删除聚合元素以及创建迭代器对象的接口。</li><li>具体聚合（ConcreteAggregate）角色：实现抽象聚合类，返回一个具体迭代器的实例。</li><li>抽象迭代器（Iterator）角色：定义访问和遍历聚合元素的接口，通常包含 hasNext()、next() 等方法。</li><li>具体迭代器（Concretelterator）角色：实现抽象迭代器接口中所定义的方法，完成对聚合对象的遍历，记录遍历的当前位置。</li></ul><p>8.1 代码实现</p><pre class="line-numbers language-csharp"><code class="language-csharp"><span class="token comment" spellcheck="true">// 迭代器接口</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Iterator</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>    Boolean <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    T <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 迭代器接口实现类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IteratorImpl</span><span class="token operator">&lt;</span>T<span class="token operator">></span> implements <span class="token class-name">Iterator</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>T<span class="token operator">></span> list<span class="token punctuation">;</span>    <span class="token keyword">private</span> Integer cursor<span class="token punctuation">;</span>    <span class="token keyword">private</span> T element<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">IteratorImpl</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>T<span class="token operator">></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> list<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> Boolean <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> cursor <span class="token operator">&lt;</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> T <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        element <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>cursor<span class="token punctuation">)</span><span class="token punctuation">;</span>        cursor<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> element<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 容器接口</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Aggregate</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token keyword">add</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token keyword">remove</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span><span class="token punctuation">;</span>    Iterator<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 容器接口实现类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AggregateImpl</span><span class="token operator">&lt;</span>T<span class="token operator">></span> implements <span class="token class-name">Aggregate</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>T<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">add</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span> <span class="token punctuation">{</span>        list<span class="token punctuation">.</span><span class="token keyword">add</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">remove</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span> <span class="token punctuation">{</span>        list<span class="token punctuation">.</span><span class="token keyword">remove</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> Iterator<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IteratorImpl</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>PS：具体测试的话可以自己写一个集合测试一下即可</p><p>8.2 总结</p><p>适用场景：</p><ul><li>访问一个集合对象的内容而无需暴露它的内部表示。</li><li>为遍历不同的集合结构提供一个统一的访问接口。</li></ul><p>优点：</p><ul><li>多态迭代：为不同的聚合结构提供一致的遍历接口，即一个迭代接口可以访问不同的聚集对象。</li><li>简化集合对象接口：迭代器模式将集合对象本身应该提供的元素迭代接口抽取到了迭代器中，使集合对象无须关心具体迭代行为。</li><li>元素迭代功能多样化：每个集合对象都可以提供一个或多个不同的迭代器，使的同种元素聚合结构可以有不同的迭代行为。</li><li>解耦迭代与集合：迭代器模式封装了具体的迭代算法，迭代算法的变化，不会影响到集合对象的架构。</li></ul><p>缺点：</p><ul><li>对于比较简单的遍历（像数组或者有序列表），使用迭代器方式遍历较为繁琐。</li><li>增加了类的个数，在一定程度上增加了系统的复杂性。</li></ul><h4 id="9-访问者模式（Visitor-Pattern）"><a href="#9-访问者模式（Visitor-Pattern）" class="headerlink" title="9.访问者模式（Visitor Pattern）"></a>9.访问者模式（Visitor Pattern）</h4><p>访问者模式是一种将数据结构与数据操作分离的设计模式。是指封装一些作用于某种数据结构中的各元素的操作。</p><p>特征：可以在不改变数据结构的前提下定义作用于这些元素的新的操作。</p><p>访问者模式包含以下主要角色:</p><ul><li>抽象访问者（Visitor）角色：定义了对每一个元素 （Element） 访问的行为，它的参数就是可以访问的元素，它的方法个数理论上来讲与元素类个数（Element的实现类个数）是一样的，从这点不难看出，访问者模式要求元素类的个数不能改变。</li><li>具体访问者（ConcreteVisitor）角色：给出对每一个元素类访问时所产生的具体行为。</li><li>抽象元素（Element）角色：定义了一个接受访问者的方法（ accept ），其意义是指，每一个元素都要可以被访问者访问。</li><li>具体元素（ConcreteElement）角色： 提供接受访问方法的具体实现，而这个具体的实现，通常情况下是使用访问者提供的访问该元素类的方法。</li><li>对象结构（Object Structure）角色：定义当中所提到的对象结构，对象结构是一个抽象表述，具体点可以理解为一个具有容器性质或者复合对象特性的类，它会含有一组元素（ Element ），并且可以迭代这些元素，供访问者访问。</li></ul><p>9.1 代码实现</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 访问者接口</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IVisitor</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Engineer engineer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Pm pm<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 具体的访问者类,访问者角色(CEO)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CeoVisitor</span> <span class="token keyword">implements</span> <span class="token class-name">IVisitor</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Engineer engineer<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>engineer<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"KPI为:"</span> <span class="token operator">+</span> engineer<span class="token punctuation">.</span><span class="token function">getKpi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Pm pm<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pm<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"KPI为:"</span> <span class="token operator">+</span> pm<span class="token punctuation">.</span><span class="token function">getKpi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 具体的访问者类,访问者角色(CTO)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CtoVisitor</span> <span class="token keyword">implements</span> <span class="token class-name">IVisitor</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Engineer engineer<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>engineer<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"工作内容:"</span> <span class="token operator">+</span> engineer<span class="token punctuation">.</span><span class="token function">getCodeLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"行代码"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span>Pm pm<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pm<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"工作内容:"</span> <span class="token operator">+</span> pm<span class="token punctuation">.</span><span class="token function">getProject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"个项目"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Data</span><span class="token comment" spellcheck="true">// 抽象元素(员工)</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">private</span> Integer kpi<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Employee</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>kpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>IVisitor visitor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 具体元素(程序员)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Engineer</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">Engineer</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>IVisitor visitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>        visitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Integer <span class="token function">getCodeLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 具体元素(项目经理)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Pm</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">Pm</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>IVisitor visitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>        visitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Integer <span class="token function">getProject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Report</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>Employee<span class="token operator">></span> employeeList<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">showReport</span><span class="token punctuation">(</span>IVisitor visitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>Employee employee <span class="token operator">:</span> employeeList<span class="token punctuation">)</span> <span class="token punctuation">{</span>            employee<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>visitor<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>      List<span class="token operator">&lt;</span>Employee<span class="token operator">></span> employeeList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      employeeList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Engineer</span><span class="token punctuation">(</span><span class="token string">"工程师A"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      employeeList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Engineer</span><span class="token punctuation">(</span><span class="token string">"工程师B"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      employeeList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Pm</span><span class="token punctuation">(</span><span class="token string">"项目经理A"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      employeeList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Engineer</span><span class="token punctuation">(</span><span class="token string">"工程师C"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      employeeList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Engineer</span><span class="token punctuation">(</span><span class="token string">"工程师D"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      employeeList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Pm</span><span class="token punctuation">(</span><span class="token string">"项目经理B"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      Report report <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Report</span><span class="token punctuation">(</span>employeeList<span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=============CEO=============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      report<span class="token punctuation">.</span><span class="token function">showReport</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CeoVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=============CTO=============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      report<span class="token punctuation">.</span><span class="token function">showReport</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CtoVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// =============CEO==============</span>      <span class="token comment" spellcheck="true">// 工程师AKPI为:2</span>      <span class="token comment" spellcheck="true">// 工程师BKPI为:4</span>      <span class="token comment" spellcheck="true">// 项目经理AKPI为:4</span>      <span class="token comment" spellcheck="true">// 工程师CKPI为:2</span>      <span class="token comment" spellcheck="true">// 工程师DKPI为:0</span>      <span class="token comment" spellcheck="true">// 项目经理BKPI为:0</span>      <span class="token comment" spellcheck="true">// =============CTO==============</span>      <span class="token comment" spellcheck="true">// 工程师A工作内容:5811行代码</span>      <span class="token comment" spellcheck="true">// 工程师B工作内容:9930行代码</span>      <span class="token comment" spellcheck="true">// 项目经理A工作内容:7个项目</span>      <span class="token comment" spellcheck="true">// 工程师C工作内容:4591行代码</span>      <span class="token comment" spellcheck="true">// 工程师D工作内容:333行代码</span>      <span class="token comment" spellcheck="true">// 项目经理B工作内容:4个项目</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>9.2 伪动态双分派</p><p>访问者模式用到了一种伪动态双分派的技术。</p><p>9.2.1 分派</p><p>变量被声明时的类型叫做变量的静态类型，有些人又把静态类型叫做明显类型；而变量所引用的对象的真实类型又叫做变量的实际类型。比如Map map = new HashMap() ，map变量的静态类型是Map，实际类型是 HashMap 。根据对象的类型而对方法进行的选择，就是分派(Dispatch)，分派(Dispatch)又分为两种，即静态分派和动态分派。</p><ul><li><strong>静态分派(Static Dispatch)</strong> 发生在编译时期，分派根据静态类型信息发生。静态分派对于我们来说并不陌生，方法重载就是静态分派。</li><li><strong>动态分派(Dynamic Dispatch)</strong> 发生在运行时期，动态分派动态地置换掉某个方法。Java通过方法的重写支持动态分派。</li></ul><p>9.2.2 伪动态双分派</p><p>所谓双分派技术就是在选择一个方法的时候，不仅仅要根据消息接收者（receiver）的运行时区别，还要根据参数的运行时区别。</p><p>在上面代码中，客户端将IVisitor接口做为参数传递给Employee抽象类的变量调用的方法，这里完成第一次分派，这里是方法重写，所以是动态分派，也就是执行实际类型中的方法，同时也将自己this作为参数传递进去，这里就完成了第二次分派 ，这里的IVisitor接口中有多个重载的方法，而传递进行的是this，就是具体的实际类型的对象。</p><p>双分派实现动态绑定的本质，就是在重载方法委派的前面加上了继承体系中覆盖的环节，由于覆盖是动态的，所以重载就是动态的了。</p><p>9.3 总结</p><p>适用场景：</p><ul><li>数据结构稳定，作用于数据结构的操作经常变化的场景。</li><li>需要数据结构与数据操作分离的场景。</li><li>需要对不同数据类型（元素）进行操作，而不使用分支判断具体类型的场景。</li></ul><p>优点：</p><ul><li>解耦了数据结构与数据操作，使得操作集合可以独立变化。</li><li>扩展性好：可以通过扩展访问者角色，实现对数据集的不同操作。</li><li>元素具体类型并非单一，访问者均可操作。</li><li>各角色职责分离，符合单一职责原则。</li></ul><p>缺点：</p><ul><li>无法增加元素类型：若系统数据结构对象易于变化，经常有新的数据对象增加进来，则访问者类必须增加对应元素类型的操作，违背了开闭原则。</li><li>具体元素变更困难：具体元素增加属性，删除属性等操作会导致对应的访问者类需要进行相应的修改，尤其当有大量访问者类时，修改访问太大。</li><li>违背依赖倒置原则：为了达到“区别对待”，访问者依赖的是具体元素类型，而不是抽象。</li></ul><h4 id="10-备忘录模式（Memento-Pattern）"><a href="#10-备忘录模式（Memento-Pattern）" class="headerlink" title="10.备忘录模式（Memento Pattern）"></a>10.备忘录模式（Memento Pattern）</h4><p>备忘录模式又称为快照模式（Snapshot Pattern）或令牌模式（Token Pattern），是指在不破坏封装的前提下，捕获一个对象的内部状态，并在对象之外保存这个状态，这样以后就可将该对象恢复到原先保存的状态。</p><p>特征：“后悔药”</p><p>备忘录模式的主要角色如下：</p><ul><li>发起人（Originator）角色：记录当前时刻的内部状态信息，提供创建备忘录和恢复备忘录数据的功能，实现其他业务功能，它可以访问备忘录里的所有信息。</li><li>备忘录（Memento）角色：负责存储发起人的内部状态，在需要的时候提供这些内部状态给发起人。</li><li>管理者（Caretaker）角色：对备忘录进行管理，提供保存与获取备忘录的功能，但其不能对备忘录的内容进行访问与修改。</li></ul><p>备忘录有两个等效的接口：</p><ul><li>窄接口：管理者(Caretaker)对象（和其他发起人对象之外的任何对象）看到的是备忘录的窄接口(narror Interface)，这个窄接口只允许他把备忘录对象传给其他的对象。</li><li>宽接口：与管理者看到的窄接口相反，发起人对象可以看到一个宽接口(wide Interface)，这个宽接口允许它读取所有的数据，以便根据这些数据恢复这个发起人对象的内部状态。</li></ul><p>10.1 “白箱”备忘录模式</p><p>下面就以游戏打怪为简单的例子进行代码实现（下面“黑箱”同这个例子）：</p><p>备忘录角色对任何对象都提供一个宽接口，备忘录角色的内部所存储的状态就对所有对象公开。</p><pre class="line-numbers language-kotlin"><code class="language-kotlin"><span class="token comment" spellcheck="true">// 游戏角色类</span><span class="token annotation builtin">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> GameRole <span class="token punctuation">{</span>    <span class="token keyword">private</span> Integer vit<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 生命力</span>    <span class="token keyword">private</span> Integer atk<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 攻击力</span>    <span class="token keyword">private</span> Integer def<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 防御力</span>    <span class="token comment" spellcheck="true">// 初始化状态</span>    <span class="token keyword">public</span> void <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 战斗到0</span>    <span class="token keyword">public</span> void <span class="token function">fight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 保存角色状态</span>    <span class="token keyword">public</span> RoleStateMemento <span class="token function">saveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> new <span class="token function">RoleStateMemento</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vit<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>atk<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>def<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 回复角色状态</span>    <span class="token keyword">public</span> void <span class="token function">recoverState</span><span class="token punctuation">(</span>RoleStateMemento roleStateMemento<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> roleStateMemento<span class="token punctuation">.</span><span class="token function">getVit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> roleStateMemento<span class="token punctuation">.</span><span class="token function">getAtk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> roleStateMemento<span class="token punctuation">.</span><span class="token function">getDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 展示状态</span>    <span class="token keyword">public</span> void <span class="token function">showState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"角色生命力:"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vit<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"角色攻击力:"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>atk<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"角色防御力:"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>def<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 游戏状态存储类(备忘录类)</span><span class="token annotation builtin">@Data</span><span class="token annotation builtin">@AllArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> RoleStateMemento <span class="token punctuation">{</span>    <span class="token keyword">private</span> Integer vit<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 生命力</span>    <span class="token keyword">private</span> Integer atk<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 攻击力</span>    <span class="token keyword">private</span> Integer def<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 防御力</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 角色状态管理者类</span><span class="token annotation builtin">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> RoleStateCaretaker <span class="token punctuation">{</span>    <span class="token keyword">private</span> RoleStateMemento roleStateMemento<span class="token punctuation">;</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试结果</span>    <span class="token keyword">public</span> static void <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===========打boss前状态==========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      GameRole gameRole <span class="token operator">=</span> new <span class="token function">GameRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      gameRole<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      gameRole<span class="token punctuation">.</span><span class="token function">showState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// 保存进度</span>      RoleStateCaretaker roleStateCaretaker <span class="token operator">=</span> new <span class="token function">RoleStateCaretaker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      roleStateCaretaker<span class="token punctuation">.</span><span class="token function">setRoleStateMemento</span><span class="token punctuation">(</span>gameRole<span class="token punctuation">.</span><span class="token function">saveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===========打boss后状态==========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      gameRole<span class="token punctuation">.</span><span class="token function">fight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      gameRole<span class="token punctuation">.</span><span class="token function">showState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===========恢复状态==========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      gameRole<span class="token punctuation">.</span><span class="token function">recoverState</span><span class="token punctuation">(</span>roleStateCaretaker<span class="token punctuation">.</span><span class="token function">getRoleStateMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      gameRole<span class="token punctuation">.</span><span class="token function">showState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// ===========打boss前状态===========</span>      <span class="token comment" spellcheck="true">// 角色生命力:100</span>      <span class="token comment" spellcheck="true">// 角色攻击力:100</span>      <span class="token comment" spellcheck="true">// 角色防御力:100</span>      <span class="token comment" spellcheck="true">// ===========打boss后状态===========</span>      <span class="token comment" spellcheck="true">// 角色生命力:0</span>      <span class="token comment" spellcheck="true">// 角色攻击力:0</span>      <span class="token comment" spellcheck="true">// 角色防御力:0</span>      <span class="token comment" spellcheck="true">// ===========恢复状态===========</span>      <span class="token comment" spellcheck="true">// 角色生命力:100</span>      <span class="token comment" spellcheck="true">// 角色攻击力:100</span>      <span class="token comment" spellcheck="true">// 角色防御力:100</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>“白箱”备忘录模式是破坏封装性的，但是通过程序员自律，同样可以在一定程度上实现大部分的用意。</p><p>10.2 “黑箱”备忘录模式</p><p>备忘录角色对发起人对象提供了一个宽接口，而为其他对象提供一个窄接口，在Java语言中，实现双重接口的办法就是将备忘录类设计成发起人类的内部成员类。</p><p>将RoleStateMemento设为GameRole的内部类，从而将RoleStateMemento对象封装在GameRole 里面；在外面提供一个标识接口Memento给RoleStateCaretaker及其他对象使用。这样GameRole类看到的是RoleStateMemento所有的接口，而RoleStateCaretaker及其他对象看到的仅仅是标识接口Memento所暴露出来的接口，从而维护了封装型。</p><pre class="line-numbers language-kotlin"><code class="language-kotlin"><span class="token comment" spellcheck="true">// 窄接口,标识接口</span><span class="token keyword">public</span> <span class="token keyword">interface</span> Memento <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 角色状态管理者类</span><span class="token annotation builtin">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> RoleStateCaretaker <span class="token punctuation">{</span>    <span class="token keyword">private</span> Memento memento<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 游戏角色类</span><span class="token annotation builtin">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> GameRole <span class="token punctuation">{</span>    <span class="token keyword">private</span> Integer vit<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 生命力</span>    <span class="token keyword">private</span> Integer atk<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 攻击力</span>    <span class="token keyword">private</span> Integer def<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 防御力</span>    <span class="token comment" spellcheck="true">// 初始化状态</span>    <span class="token keyword">public</span> void <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 战斗到0</span>    <span class="token keyword">public</span> void <span class="token function">fight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 保存角色状态</span>    <span class="token keyword">public</span> RoleStateMemento <span class="token function">saveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> new <span class="token function">RoleStateMemento</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vit<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>atk<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>def<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 回复角色状态</span>    <span class="token keyword">public</span> void <span class="token function">recoverState</span><span class="token punctuation">(</span>Memento memento<span class="token punctuation">)</span> <span class="token punctuation">{</span>        RoleStateMemento roleStateMemento <span class="token operator">=</span> <span class="token punctuation">(</span>RoleStateMemento<span class="token punctuation">)</span> memento<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> roleStateMemento<span class="token punctuation">.</span><span class="token function">getVit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> roleStateMemento<span class="token punctuation">.</span><span class="token function">getAtk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> roleStateMemento<span class="token punctuation">.</span><span class="token function">getDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 展示状态</span>    <span class="token keyword">public</span> void <span class="token function">showState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"角色生命力:"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vit<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"角色攻击力:"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>atk<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"角色防御力:"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>def<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 备忘录内部类</span>    <span class="token annotation builtin">@Data</span>    <span class="token annotation builtin">@AllArgsConstructor</span>    <span class="token keyword">private</span> <span class="token keyword">class</span> RoleStateMemento implements Memento <span class="token punctuation">{</span>        <span class="token keyword">private</span> Integer vit<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 生命力</span>        <span class="token keyword">private</span> Integer atk<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 攻击力</span>        <span class="token keyword">private</span> Integer def<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 防御力</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试结果</span>    <span class="token keyword">public</span> static void <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===========打boss前状态==========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      GameRole gameRole <span class="token operator">=</span> new <span class="token function">GameRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      gameRole<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      gameRole<span class="token punctuation">.</span><span class="token function">showState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// 保存进度</span>      RoleStateCaretaker roleStateCaretaker <span class="token operator">=</span> new <span class="token function">RoleStateCaretaker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      roleStateCaretaker<span class="token punctuation">.</span><span class="token function">setMemento</span><span class="token punctuation">(</span>gameRole<span class="token punctuation">.</span><span class="token function">saveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===========打boss后状态==========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      gameRole<span class="token punctuation">.</span><span class="token function">fight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      gameRole<span class="token punctuation">.</span><span class="token function">showState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===========恢复状态==========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      gameRole<span class="token punctuation">.</span><span class="token function">recoverState</span><span class="token punctuation">(</span>roleStateCaretaker<span class="token punctuation">.</span><span class="token function">getMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      gameRole<span class="token punctuation">.</span><span class="token function">showState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// ===========打boss前状态===========</span>      <span class="token comment" spellcheck="true">// 角色生命力:100</span>      <span class="token comment" spellcheck="true">// 角色攻击力:100</span>      <span class="token comment" spellcheck="true">// 角色防御力:100</span>      <span class="token comment" spellcheck="true">// ===========打boss后状态===========</span>      <span class="token comment" spellcheck="true">// 角色生命力:0</span>      <span class="token comment" spellcheck="true">// 角色攻击力:0</span>      <span class="token comment" spellcheck="true">// 角色防御力:0</span>      <span class="token comment" spellcheck="true">// ===========恢复状态===========</span>      <span class="token comment" spellcheck="true">// 角色生命力:100</span>      <span class="token comment" spellcheck="true">// 角色攻击力:100</span>      <span class="token comment" spellcheck="true">// 角色防御力:100</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>10.3 总结</p><p>适用场景：</p><ul><li>需要保存历史快照的场景。</li><li>希望在对象之外保存状态，且除了自己其他类对象无法访问状态保存具体内容。</li></ul><p>优点：</p><ul><li>简化发起人实体类职责，隔离状态存储与获取，实现了信息的封装，客户端无需关心状态的保存细节。</li><li>提供状态回滚功能。</li></ul><p>缺点：</p><ul><li>消耗资源：如果需要保存的状态过多时，每一次保存都会消耗很多内存。</li></ul><h4 id="11-解释器模式（interpreter-pattern）"><a href="#11-解释器模式（interpreter-pattern）" class="headerlink" title="11.解释器模式（interpreter pattern）"></a>11.解释器模式（interpreter pattern）</h4><p>解释器模式给定一个语言，定义它的文法的一种表示，并定义一个解释器，这个解释器使用该表示来解释语言中的句子。</p><p>特征：为了解释一种语言，而为语言创建的解释器。</p><p>解释器模式包含以下主要角色：</p><ul><li>抽象表达式（Abstract Expression）角色：定义解释器的接口，约定解释器的解释操作，主要包含解释方法 interpret()。</li><li>终结符表达式（Terminal Expression）角色：是抽象表达式的子类，用来实现文法中与终结符相关的操作，文法中的每一个终结符都有一个具体终结表达式与之相对应。</li><li>非终结符表达式（Nonterminal Expression）角色：也是抽象表达式的子类，用来实现文法中与非终结符相关的操作，文法中的每条规则都对应于一个非终结符表达式。</li><li>环境（Context）角色：通常包含各个解释器需要的数据或是公共的功能，一般用来传递被所有解释器共享的数据，后面的解释器可以从这里获取这些值。</li><li>客户端（Client）：主要任务是将需要分析的句子或表达式转换成使用解释器对象描述的抽象语法树，然后调用解释器的解释方法，当然也可以通过环境角色间接访问解释器的解释方法。</li></ul><p>11.1 代码实现</p><p>下面以简单的加减乘除为例子实现解释器模式：</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token comment" spellcheck="true">// 抽象角色 定义解释器</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Expression</span> <span class="token punctuation">{</span>    int <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>@AllArgsConstructor<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NumberTerminal</span> <span class="token keyword">implements</span> <span class="token class-name">Expression</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> int <span class="token keyword">number</span><span class="token punctuation">;</span>    @Override    <span class="token keyword">public</span> int <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">number</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 非终结表达式（抽象类）</span>@AllArgsConstructor<span class="token keyword">public</span> abstract <span class="token keyword">class</span> <span class="token class-name">NonTerminal</span> <span class="token keyword">implements</span> <span class="token class-name">Expression</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> Expression left<span class="token punctuation">;</span>    <span class="token keyword">protected</span> Expression right<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 非终结表达式（加法）</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PlusNonTerminal</span> <span class="token keyword">extends</span> <span class="token class-name">NonTerminal</span> <span class="token keyword">implements</span> <span class="token class-name">Expression</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">PlusNonTerminal</span><span class="token punctuation">(</span>Expression left<span class="token punctuation">,</span> Expression right<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> int <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> left<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> right<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 非终结表达式（减法）</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MinusNonTerminal</span> <span class="token keyword">extends</span> <span class="token class-name">NonTerminal</span> <span class="token keyword">implements</span> <span class="token class-name">Expression</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">MinusNonTerminal</span><span class="token punctuation">(</span>Expression left<span class="token punctuation">,</span> Expression right<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> int <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> left<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> right<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 非终结表达式（乘法）</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MclNonTerminal</span> <span class="token keyword">extends</span> <span class="token class-name">NonTerminal</span> <span class="token keyword">implements</span> <span class="token class-name">Expression</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">MclNonTerminal</span><span class="token punctuation">(</span>Expression left<span class="token punctuation">,</span> Expression right<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> int <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> left<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> right<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 非终结表达式（除法）</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DivisionNonTerminal</span> <span class="token keyword">extends</span> <span class="token class-name">NonTerminal</span> <span class="token keyword">implements</span> <span class="token class-name">Expression</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">DivisionNonTerminal</span><span class="token punctuation">(</span>Expression left<span class="token punctuation">,</span> Expression right<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> int <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> left<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> right<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 计算器类（实现运算逻辑）</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cal</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Expression left<span class="token punctuation">;</span>    <span class="token keyword">private</span> Expression right<span class="token punctuation">;</span>    <span class="token keyword">private</span> Integer result<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Cal</span><span class="token punctuation">(</span>String expression<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> Integer <span class="token function">parse</span><span class="token punctuation">(</span>String expression<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 获取表达式元素</span>        String <span class="token punctuation">[</span><span class="token punctuation">]</span> elements <span class="token operator">=</span> expression<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            String element <span class="token operator">=</span> elements<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 判断是否是运算符号</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>OperatorUtils<span class="token punctuation">.</span><span class="token function">isOperator</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// 运算符号的右边就是右终结符</span>                right <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NumberTerminal</span><span class="token punctuation">(</span>Integer<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>elements<span class="token punctuation">[</span><span class="token operator">++</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">//计算结果</span>                result <span class="token operator">=</span> OperatorUtils<span class="token punctuation">.</span><span class="token function">getNonTerminal</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// 计算结果重新成为左终结符</span>                left <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NumberTerminal</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                left <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NumberTerminal</span><span class="token punctuation">(</span>Integer<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Integer <span class="token function">cal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 操作工具类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OperatorUtils</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 判断是不是非终结符</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isOperator</span><span class="token punctuation">(</span>String symbol<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> symbol<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">)</span> <span class="token operator">||</span> symbol<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span> <span class="token operator">||</span> symbol<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token operator">||</span> symbol<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 简单工厂</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> NonTerminal <span class="token function">getNonTerminal</span><span class="token punctuation">(</span>Expression left<span class="token punctuation">,</span> Expression right<span class="token punctuation">,</span> String symbol<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>symbol<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PlusNonTerminal</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>symbol<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MinusNonTerminal</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>symbol<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MclNonTerminal</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>symbol<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DivisionNonTerminal</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 测试</span>    <span class="token comment" spellcheck="true">// PS：此处进行的逻辑仅仅实现从左到右运算，并没有先乘除后加减的逻辑</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Cal</span><span class="token punctuation">(</span><span class="token string">"10 + 20 - 40 * 60"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// -600</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Cal</span><span class="token punctuation">(</span><span class="token string">"20 + 50 - 60 * 2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 20</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>11.2 Spring中的解释器模式</p><pre class="line-numbers language-abnf"><code class="language-abnf">public static void main(String[] args) {        ExpressionParser expressionParser = new SpelExpressionParser();        org.springframework.expression.Expression expression = expressionParser.parseExpression("10 + 20 + 30 * 4");        Integer value = expression.getValue(Integer.class);        System.out.println(value); // 150        expression = expressionParser.parseExpression("(10+20+30)*4");        value = expression.getValue(Integer.class);        System.out.println(value); // 240    }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到Spring中解释器写的是比较完善的，不仅有先乘除后加减和先括号进行运算的日常计算规则，而且对于空格也并没有要求，仅需要写出完整的表达式即可运算出来。</p><p>11.3 总结</p><p>适用场景：</p><ul><li>一些重复出现的问题可以用一种简单的语言来进行表述。</li><li>一个简单语法需要解释的场景。</li></ul><p>优点：</p><ul><li>扩展性强：在解释器模式中由于语法是由很多类表示的，当语法规则更改时，只需修改相应的非终结符表达式即可；若扩展语法时，只需添加相应非终结符类即可。</li><li>增加了新的解释表达式的方式。</li><li>易于实现文法：解释器模式对应的文法应当是比较简单且易于实现的，过于复杂的语法并不适合使用解释器模式。</li></ul><p>缺点：</p><ul><li>语法规则较复杂时，会引起类膨胀。</li><li>执行效率比较低</li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>工作思考</title>
      <link href="/2024/04/15/blog-open-source-work-thinking/"/>
      <url>/2024/04/15/blog-open-source-work-thinking/</url>
      
        <content type="html"><![CDATA[<iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="100%" height="86" src="//music.163.com/outchain/player?type=2&amp;id=2140943587&amp;auto=1&amp;height=66"></iframe><h1 id="工作思考，上班只是偷师学艺，如何能转型突破瓶颈"><a href="#工作思考，上班只是偷师学艺，如何能转型突破瓶颈" class="headerlink" title="工作思考，上班只是偷师学艺，如何能转型突破瓶颈"></a>工作思考，上班只是偷师学艺，如何能转型突破瓶颈</h1><p>平时的工作如何体现一个人的技术深度？平时工作中很多时候需求细而碎的，如何在工作中积累技术深度？又如何体现一个人的技术深度？</p><h2 id="思考：做需求与做需求的差异"><a href="#思考：做需求与做需求的差异" class="headerlink" title="思考：做需求与做需求的差异"></a><strong>思考：做需求与做需求的差异</strong></h2><p>再回答问题之前，我想先抛开「技术深度」这次词，讲讲做需求这件事，说说我对做需求的理解。每一个程序员都是从刚毕业做需求开始，为什么有的人逐渐成为大牛，主导大型技术项目或走向团队管理岗位，而有的人一直还在做需求。我觉得这里面的差异在于：每一个对做需求这件事的理解有所不同。</p><p>这里面的差异在于，你是抱着一种什么样的心态去完成这个需求，是把这个需求做到极致，还是只是当做任务完成这个需求，达到产品想要的功能就行。这两个表面上看似差不多其实相差极大，差异在于，你有没有站在更高的角度，希望这件事做到完美。</p><p>从需求角度有没有思考产品设计当中的缺陷，能不能反向为产品设计提供建议，从技术角度能不能做到高质量高兼容性无bug，以及下次再有类似的需求能不能快速高效率的迭代。</p><p>用一句话来描述就是，能不能跳出自己是一个程序员是一个被动执行人的角色，而是将自己当做产品当做技术负责人的心态去做这件事。</p><h2 id="业务需求该怎么做"><a href="#业务需求该怎么做" class="headerlink" title="业务需求该怎么做"></a><strong>业务需求该怎么做</strong></h2><p>知易行难。如果一开始做不到，那就先着眼小事：关注细节，从需求开始的需求评审、编写技术方案文档、设计文档、到开发的代码注释、结构设计，保证高质量，完善无漏洞的代码逻辑，再到异常埋点、指标监控、线上可用性运维等等，认真对待一个需求的每一个环节。</p><p>当你自认为已经做好整个流程的每一件小事之后，接下来可以通过深入细节，思考整个流程是否存在问题。做需求过程中沟通协作的有没有问题，流程规范的有没有问题，机制环节哪方面问题，代码公共基础能力的是否有缺失，开发过程中你所遇到的问题是不是一个通用问题，能不能抽象出一个公共库解决大家的问题，能不能制定一个SOP的解决方案流程，亦或是提炼出一个最佳实践在组内外分享经验。</p><p>通过这些一件件小事来锻炼自己解决问题的能力，以及更深层级的发现问题的能力。再通过不断的发现问题，思考问题出现的原因，拿出解决方案，最终落地解决了自己或组内或协作方的问题，锻炼自己的综合能力逐步慢慢成长。</p><h2 id="再说「技术深度」"><a href="#再说「技术深度」" class="headerlink" title="再说「技术深度」"></a><strong>再说「技术深度」</strong></h2><p>说了这么多，你可能会说，这跟我问的技术深度有什么关系？我想说：抛开业务需求谈技术深度都是耍流氓。</p><p>举一个例子，数据可视化方面3D three.js，视频直播方面的编解码压缩，客户端安全方面的攻防渗透，每一个都是有技术深度的事情，但问题是即使你掌握了这些领域拥有了非常高的技术深度之后呢，不能应用于业务需求，不能解决产品急迫要解决的问题，不能完成你老板的OKR，达成部门的战略目标，还是英雄无用武之地（当然你也可以选择一个可以用得上的团队，那是就是另外一回事了）。</p><p>由于这些单点的有技术深度的事情，不能为你带来直观和显而易见的 「回报」（也就是颜如玉、黄金屋与金榜题名），也就间接的打击了积极性（当然自己对某门技术感兴趣而钻研的不再本次讨论之列）。</p><p>所以提升自己的技术深度，最好的方式还是在公司业务中，发现有深度的事，然后去在攻克这个问题的过程中，提升了自己的技术深度，即跟随公司业务的发展的同时自身也获得了成长，你用技术能力为公司解决了业务发展过程中的问题，自然也就从公司获得了该有的回报。这是一个ROI投入产出比最高的获得技术深度的方式。</p><h2 id="获取做有深度事情的授权"><a href="#获取做有深度事情的授权" class="headerlink" title="获取做有深度事情的授权"></a><strong>获取做有深度事情的授权</strong></h2><p>当想明白获取技术深度的路径之后，接下来要解决的就是：如何让领导给你安排有技术深度的事情？</p><p>业务发展中有很多有技术深度有技术难度的事情，为什么领导要安排你来做这件事呢？你凭什么让领导觉得你 「有能力」 也 「有意愿」 来完成这件事？能力与意愿是作为领导在分配工作当中的最重要的两个决策项。</p><p>既然你能提问如何积累技术深度，我相信你一定是有强烈意愿的，那么剩下的就是如何让领导认为你有完成这个有技术深度的事情的能力？最简单来讲就是，你能不能在开发需求中做到深度思考、追求极致、精益求精、有责任心、有主人翁意识与主R意识，在每件小事中能做到 「自闭环」，之后才会逐步让你承担更大范围更高挑战更大深度的事情，形成正向循环。</p><p>这也是我前面为什么要先重点强调做好每一件小事的重要性。</p><h2 id="技术深度不是唯一标准"><a href="#技术深度不是唯一标准" class="headerlink" title="技术深度不是唯一标准"></a><strong>技术深度不是唯一标准</strong></h2><p>作为一个程序员，在职业生涯的初期，确实是以技术深度也就是技术能力作为最大的衡量标准。</p><p>但随着职业生涯的发展，职级从L5到L8，站在从公司角度，对一个人的需求，也会从能完成一个业务需求，变成能带领一帮人完成一个更大的维度的需求，能不能为组织解决问题，为事业部达成战略目标，对人的要求的重心也会慢慢发生变化，这种变化可以参考公司的职级能力模型体系的雷达图。</p><p>所以一味的追求积累技术深度就跑偏了，但不是说技术深度不重要，技术能力是作为程序员的安身立命之本，但是在积累技术深度的同时，也需要学习锻炼技术深度以外的能力。具体到底是什么其他能力，这就够再展开好几篇文章的篇幅了，今天在这就不细说了。</p><h2 id="人员招聘，团队的管理"><a href="#人员招聘，团队的管理" class="headerlink" title="人员招聘，团队的管理"></a>人员招聘，团队的管理</h2><h3 id="人员招聘"><a href="#人员招聘" class="headerlink" title="人员招聘"></a>人员招聘</h3><p>如下是对于当时的人员招聘的一些感受：</p><ol><li>小公司的人员招聘是相对比较难的，特别是还给不了多少钱的；</li><li>好在我们选择的技术方案，只要对于JS掌握的比较好就可以了，前后端都要开发一点，也方便人员工作调整，避免开发资源的浪费。</li></ol><h3 id="团队管理"><a href="#团队管理" class="headerlink" title="团队管理"></a>团队管理</h3><p>对于小团队的管理的一些个人理解：</p><ol><li>小公司刚起步，就应该实事求是，以业务为导向；</li><li>小公司最好采取全栈的开发方式，避免任务的不协调，造成开发资源的浪费；</li><li>设置推荐的代码规范，参照大家日常的代码习惯来制定，目标就是让大家的代码相对规范；</li><li>要求按照规范的流程设计与开发、避免一些流程的问题造成管理的混乱和公司的损失；</li><li>如按照常规的业务开发流程，产品评估 =&gt; 任务分配 =&gt; 技术评估 =&gt; 开发 =&gt; 测试 =&gt; cr =&gt; 上线 =&gt; 线上问题跟踪处理；</li><li>行之有效可量化的考核规范，如开发任务的截止日期完成、核心流程开发文档的书写、是否有线上bug、严谨手动修改数据库等；</li><li>鼓励分享，相互学习，一段工作经历总要有所提升，有所收获才是有意义的；</li><li>及时沟通反馈、团队成员的个人想法、掌握开发进度、工作难点等；</li></ol><h2 id="最后总结及选择创业公司避坑建议-important"><a href="#最后总结及选择创业公司避坑建议-important" class="headerlink" title="最后总结及选择创业公司避坑建议!important"></a>最后总结及选择创业公司避坑建议!important</h2><ol><li>选择创业公司，一定要确认老板是一个靠谱的人，别是一个总是画饼的油腻老司机，或者一个优柔寡断，没有主见的人，这样的情况下，大概率事情是干不成的；</li><li>老板靠谱，即使当前的项目搞不成，也可能未来在别的地方做出一番事情；</li><li>初了上边这个，最核心的就是，怎么样赚钱，现在这种融资环境，如果自己不能赚钱，大概率是活不下去的@自己；</li><li>抓住核心矛盾，解决主要问题，业务永远是最重要的。至于说选择的开发技术、代码规范等等这些都可以往后放；</li><li>对上要及时反馈自己的工作进度，保持好沟通，老板总是站在更高一层考虑问题，肯定会有一些不一样的想法，别总自以为什么什么的；</li><li>每段经历最好都能有所收获，人生的每一步都有意义。</li></ol><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a><strong>最后</strong></h2><p>故不积跬步无以至千里，不积小流无以成江海。先从做好每一件小事开始，把每个业务需求做到120分，深度思考、发现问题、解决问题，逐步建立起靠谱、有责任心、技术牛的人设，逐步负责有技术难度的事情，跟随公司业务发展积累自己的业务领域经验与技术深度，从而获得双赢的回报。</p><p>这是我对如何积累技术深度这件事的理解，或许会有一些片面和偏激，毕竟不是谁都有一个能知人善任的好领导，不是谁都能遇到一个快速发展的业务，不是谁都能遇到有技术难度与技术挑战的场景，无论我怎么说，都会有幸存者偏差的存在。</p><p>努力与机遇并存，机遇可遇不可求，所以我们能做的事，就是学会正确做事的思路和方法，并为之坚持不懈的践行它。知易行难，学会方法容易，坚持践行难于上青天。自己该做的都做好了，机遇来了就可以抓住，即使抓不住，你也有了「选择的能力」，有了选择更好机遇、更好公司的能力。</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>职场杂谈</title>
      <link href="/2024/04/15/blog-open-source-workplace/"/>
      <url>/2024/04/15/blog-open-source-workplace/</url>
      
        <content type="html"><![CDATA[<iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="100%" height="86" src="//music.163.com/outchain/player?type=2&amp;id=1973133244&amp;auto=1&amp;height=66"></iframe><p>职场如战场，尤其在不稳定的环境下，有时候说错一句话，可能就丢了工作。尤其在面对上级或老板时。</p><p>  昨天一位读者留言：<strong>今天开会时，老板谈到一个新项目，说让技术看下可行性，听了老板的一顿介绍，没等上级说话，旁边同事就顺嘴说了一句：这个我们没做过呀。上级狠狠瞪了他一眼。</strong></p><p>  这个现象在职场中经常会发生，往往祸从口出，但很多人还不知道自己错在哪里。</p><p>  <strong>我们首先要明确一点，工作是来解决问题的。</strong></p><p>  说得现实一点，解决问题后能创造利润，才是你的职场价值。</p><p>  <strong>其实赚钱的本质是能帮多少人解决问题，你来工作是帮老板解决问题，不是来听你抱怨，发牢骚的。</strong></p><p>  说话是一门艺术，话说对了，能让你直上青云，说错了，会被列入黑名单。</p><p>  职场中这几句话是雷区，初入职场的人千万不要踩到。</p><p>  <strong>1.这个我之前没做过</strong></p><p>  技能是在工作和生活中一点点积攒起来的，谁也不是天生就会，我们要适配工作，而不是让工作来适配我们。</p><p>  遇到自己不会的，利用一切资源学习，积极寻求同事或领导的帮助，让大家看到你的潜力和勤奋才对。</p><p>  <strong>2.这也不是我的错啊</strong></p><p>  这话听起来就是在抱怨，同时想推卸责任。</p><p>  领导会觉得你不想担事，以后交代任务也害怕交到你手上。</p><p>  正确的做法是，保持冷静，精简的说出事情的来龙去脉和问题所在，真实说明情况，要知道，工作态度也是很重要的。</p><p>  <strong>3.这个我搞不定的</strong></p><p>  这句话表现出来的是我不会，需要帮助，但也侧面说明了你这个人很懒，喜欢依赖别人。</p><p>  直面问题，面对挑战，一个一个解决，必要时寻求帮助，而不是回避问题。</p><p>  <strong>在职场，谁也做不了巨婴，没有人有义务帮你完成工作。</strong></p><p>  还有诸如此类的话语，比如：“我不知道啊”，“这跟我没关系”，“我不会”。</p><p>  把话语变成：“我去做做调研”，“我去了解一下情况”，最好及时给出解决方案，不要让领导觉得你事不关己，高高挂起，这很容易让领导对你失去信心。</p><p>  在职场中，做到事事有回应，件件让放心，职场之路才会越走越宽。</p><p>  最后，本着赚钱就是帮助别人解决问题这个原则，如果你能帮很多人解决问题，就能赚到更多的钱，你想想是不是这个道理。</p><p>  提高自己解决问题的能力，远比说这些负面的话语有用。</p><p>  祝好。</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>代码分层</title>
      <link href="/2024/03/18/blog-open-source-codelayering/"/>
      <url>/2024/03/18/blog-open-source-codelayering/</url>
      
        <content type="html"><![CDATA[<iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="100%" height="86" src="//music.163.com/outchain/player?type=2&amp;id=65536&amp;auto=0&amp;height=66"></iframe><h1 id="优秀的代码都是如何分层的"><a href="#优秀的代码都是如何分层的" class="headerlink" title="优秀的代码都是如何分层的"></a>优秀的代码都是如何分层的</h1><hr><h2 id="1-背景"><a href="#1-背景" class="headerlink" title="1.背景"></a><strong>1.背景</strong></h2><p>说起应用分层，大部分人都会认为这个不是很简单嘛 就controller，service, mapper三层。看起来简单，很多人其实并没有把他们职责划分开，在很多代码中,controller做的逻辑比service还多,service往往当成透传了，这其实是很多人开发代码都没有注意到的地方，反正功能也能用，至于放哪无所谓呗。这样往往造成后面代码无法复用，层级关系混乱，对后续代码的维护非常麻烦。</p><p>的确在这些人眼中分层只是一个形式，前辈们的代码这么写的，其他项目代码这么写的，那么我也这么跟着写。但是在真正的团队开发中每个人的习惯都不同，写出来的代码必然带着自己的标签，有的人习惯controller写大量的业务逻辑，有的人习惯在service中之间调用远程服务，这样就导致了每个人的开发代码风格完全不同，后续其他人修改的时候，一看，我靠这个人写的代码和我平常的习惯完全不同，修改的时候到底是按着自己以前的习惯改，还是跟着前辈们走，这又是个艰难的选择，选择一旦有偏差，你的后辈又维护你的代码的时候，恐怕就要骂人了。</p><p>所以一个好的应用分层需要具备以下几点:</p><ul><li>方便后续代码进行维护扩展。</li><li>分层的效果需要让整个团队都接受</li><li>各个层职责边界清晰</li></ul><h2 id="2-如何进行分层"><a href="#2-如何进行分层" class="headerlink" title="2.如何进行分层"></a><strong>2.如何进行分层</strong></h2><h3 id="2-1阿里规范"><a href="#2-1阿里规范" class="headerlink" title="2.1阿里规范"></a>2.1阿里规范</h3><p>在阿里的编码规范中约束的分层如下:</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/sz_mmbiz_jpg/knmrNHnmCLGl8eqZOfpWFxiajvzD6IplVfoZH2a37JDGt5m4hXUqAthwiabialEnPqW1xCw3UyDUq8ePf6HxTaGOA/640?wx_fmt=other&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>图片</p><p>开放接口层:可直接封装 Service 方法暴露成 RPC 接口;通过 Web 封装成 http 接口;进行 网关安全控制、流量控制等。</p><p>终端显示层:各个端的模板渲染并执行显示的层。当前主要是 velocity 渲染，JS 渲染， JSP 渲染，移动端展示等。</p><p>Web 层:主要是对访问控制进行转发，各类基本参数校验，或者不复用的业务简单处理等。</p><p>Service 层:相对具体的业务逻辑服务层。</p><p>Manager 层:通用业务处理层，它有如下特征:1. 对第三方平台封装的层，预处理返回结果及转化异常信息;2. 对Service层通用能力的下沉，如缓存方案、中间件通用处理;3. 与DAO层交互，对多个DAO的组合复用。</p><p>DAO 层:数据访问层，与底层 MySQL、Oracle、Hbase 进行数据交互。</p><p>阿里巴巴规约中的分层比较清晰简单明了，但是描述得还是过于简单了，以及service层和manager层有很多同学还是有点分不清楚之间的关系，就导致了很多项目中根本没有Manager层的存在。下面介绍一下具体业务中应该如何实现分层</p><h3 id="2-2优化分层"><a href="#2-2优化分层" class="headerlink" title="2.2优化分层"></a>2.2优化分层</h3><p>从我们的业务开发中总结了一个较为的理想模型,这里要先说明一下由于我们的rpc框架选用的是thrift可能会比其他的一些rpc框架例如dubbo会多出一层,作用和controller层类似<img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/sz_mmbiz_jpg/knmrNHnmCLGl8eqZOfpWFxiajvzD6IplVPuQ4xZXBZWBYxMAYMLFlcWjYvYhjpYyk9T6ticQd9mhk0icbAibDAQXqA/640?wx_fmt=other&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>1.最上层controller和TService是我们阿里分层规范里面的第一层:轻业务逻辑，参数校验，异常兜底。通常这种接口可以轻易更换接口类型,所以业务逻辑必须要轻，甚至不做具体逻辑。</p><p>2.Service：业务层，复用性较低，这里推荐每一个controller方法都得对应一个service,不要把业务编排放在controller中去做，为什么呢？如果我们把业务编排放在controller层去做的话，如果以后我们要接入thrift,我们这里又需要把业务编排在做一次，这样会导致我们每接入一个入口层这个代码都得重新复制一份如下图所示:<img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/sz_mmbiz_jpg/knmrNHnmCLGl8eqZOfpWFxiajvzD6IplVSexetSjaTPggZJICMDTUSE1LAIVnRu4SW5coY1LFlC4uH0R43nTF7A/640?wx_fmt=other&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>这样大量的重复工作必定会导致我们开发效率下降，所以我们需要把业务编排逻辑都得放进service中去做:<img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/sz_mmbiz_jpg/knmrNHnmCLGl8eqZOfpWFxiajvzD6IplV3aPmIR5qMdMJPUraVRCjUy2Ub5Rk678GYicNT7gliaS88GyfMTWCfh3A/640?wx_fmt=other&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>3.Mannager：可复用逻辑层。这里的Mannager可以是单个服务的，比如我们的cache,mq等等，当然也可以是复合的，当你需要调用多个Mannager的时候，这个可以合为一个Mannager，比如逻辑上的连表查询等。如果是httpMannager或rpcMannager需要在这一层做一些数据转换</p><p>4.DAO：数据库访问层。主要负责“操作数据库的某张表，映射到某个java对象”，dao应该只允许自己的Service访问，其他Service要访问我的数据必须通过对应的Service。</p><h2 id="3-分层领域模型的转换"><a href="#3-分层领域模型的转换" class="headerlink" title="3.分层领域模型的转换"></a><strong>3.分层领域模型的转换</strong></h2><p>在阿里巴巴编码规约中列举了下面几个领域模型规约:</p><ul><li>DO（Data Object）：与数据库表结构一一对应，通过DAO层向上传输数据源对象。</li><li>DTO（Data Transfer Object）：数据传输对象，Service或Manager向外传输的对象。</li><li>BO（Business Object）：业务对象。由Service层输出的封装业务逻辑的对象。</li><li>AO（Application Object）：应用对象。在Web层与Service层之间抽象的复用对象模型，极为贴近展示层，复用度不高。</li><li>VO（View Object）：显示层对象，通常是Web向模板渲染引擎层传输的对象。</li><li>Query：数据查询对象，各层接收上层的查询请求。注意超过2个参数的查询封装，禁止使用Map类来传输。</li></ul><table><thead><tr><th align="left">层次</th><th align="left">领域模型</th></tr></thead><tbody><tr><td align="left">Controller/TService</td><td align="left">VO/DTO</td></tr><tr><td align="left">Service/Manager</td><td align="left">AO/BO</td></tr><tr><td align="left">DAO</td><td align="left">DO</td></tr></tbody></table><p>每一个层基本都自己对应的领域模型，这样就导致了有些人过于追求每一层都是用自己的领域模型，这样就导致了一个对象可能会出现3次甚至4次转换在一次请求中，当返回的时候同样也会出现3-4次转换，这样有可能一次完整的请求-返回会出现很多次对象转换。如果在开发中真的按照这么来，恐怕就别写其他的了，一天就光写这个重复无用的逻辑算了吧。</p><p>所以我们得采取一个折中的方案:</p><p>1.允许Service/Manager可以操作数据领域模型，对于这个层级来说，本来自己做的工作也是做的是业务逻辑处理和数据组装。</p><p>2.Controller/TService层的领域模型不允许传入DAO层，这样就不符合职责划分了。</p><p>3.同理，不允许DAO层的数据传入到Controller/TService.</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/sz_mmbiz_jpg/knmrNHnmCLGl8eqZOfpWFxiajvzD6IplVgpfGZyxKOIBl4DNaxiaKxFE9QPRvG4xiaoUsiaqyBTechicUQrGUCGJBOQ/640?wx_fmt=other&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>图片</p><h2 id="4-总结"><a href="#4-总结" class="headerlink" title="4.总结"></a><strong>4.总结</strong></h2><p>总的来说业务分层对于代码规范是比较重要，决定着以后的代码是否可复用，是否职责清晰，边界清晰。</p><p>当然这种分层其实见仁见智, 团队中的所有人的分层习惯也不同，所以很难权衡出一个标准的准则，总的来说只要满足职责逻辑清晰，后续维护容易，就是好的分层。</p><p>最后，如果你的团队有更好的分层，或者上面所描述的有什么错误的地方还请留言指正一下。</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java之Lambda表达式详解</title>
      <link href="/2023/05/21/blog-open-source-java-lambda/"/>
      <url>/2023/05/21/blog-open-source-java-lambda/</url>
      
        <content type="html"><![CDATA[<iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="100%" height="86" src="//music.163.com/outchain/player?type=2&amp;id=255219&amp;auto=1&amp;height=66"></iframe><h1 id="Lambda-表达式详解"><a href="#Lambda-表达式详解" class="headerlink" title="Lambda 表达式详解"></a>Lambda 表达式详解</h1><h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1. 介绍"></a><strong>1. 介绍</strong></h2><ul><li>Lambda 表达式是 JavaSE8 中的一个重要的新特性</li><li>Lambda 表达式允许你通过表达式来代替功能接口</li><li>Lambda 表达式和方法一样，它提供了一个正常的参数列表和一个使用这些参数的主体</li><li>Lambda 表达式可以看作是一个匿名函数，基于数学中的 λ 演算得名，也可以称其为闭包</li><li>Lambda 表达式允许把函数作为一个方法的参数</li></ul><h2 id="2-Lambda-表达式的语法"><a href="#2-Lambda-表达式的语法" class="headerlink" title="2. Lambda 表达式的语法"></a><strong>2. Lambda 表达式的语法</strong></h2><p>基本形式：Lambda 表达式由三部分组成：参数、-&gt;符号、方法体</p><pre class="line-numbers language-text"><code class="language-text">(参数列表)->{ 方法体}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="补充："><a href="#补充：" class="headerlink" title="补充："></a><strong>补充：</strong></h3><ul><li>Lambda 表达式的参数可以是零个或多个</li><li>参数的类型可以明确声明，也可以不声明，由 JVM 隐式的推断，例如 <code>(int a)</code> 和 <code>(a)</code> 效果相同</li><li>当参数只有一个，且类型可推导时，可以省略括号，例如 <code>(a)</code> 与 <code>a</code> 效果相同</li><li>如果 Lambda 表达式的方法体只有一条语句时，可以省略花括号</li><li>如果 Lambda 表达式的方法体只有一条语句，且为返回值的时候，可以省略 return</li></ul><h3 id="代码示例："><a href="#代码示例：" class="headerlink" title="代码示例："></a><strong>代码示例：</strong></h3><pre class="line-numbers language-text"><code class="language-text">// 不需要参数，返回值为 2()->2// 接收一个参数（数字类型），返回值为其2倍的值x->2*x// 接收两个参数（数字类型），并返回它们的和(x,y)->x+y// 接收两个 int 类型参数，返回它们的乘积(int x,int y)->x*y// 接收一个 String 对象，并在控制台打印(String s)->System.out.println(s)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-函数接口"><a href="#3-函数接口" class="headerlink" title="3. 函数接口"></a><strong>3. 函数接口</strong></h2><p>如果一个接口中有且只有一个 abstract 方法，称这样的接口为单接口。从 JDK8 开始，Java 使用 Lambda 表达式，并将单接口称为函数接口</p><h3 id="注意："><a href="#注意：" class="headerlink" title="注意："></a><strong>注意：</strong></h3><pre class="line-numbers language-text"><code class="language-text">@FunctionInterface<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="示例代码："><a href="#示例代码：" class="headerlink" title="示例代码："></a><strong>示例代码：</strong></h3><pre class="line-numbers language-text"><code class="language-text">@functionInterfaceinterface A{    void test();}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-Lamdba-表达式的使用"><a href="#4-Lamdba-表达式的使用" class="headerlink" title="4. Lamdba 表达式的使用"></a><strong>4. Lamdba 表达式的使用</strong></h2><p>接下来为大家演示 Lambda 表达式的使用</p><pre class="line-numbers language-text"><code class="language-text">// 无返回值无参数 @FunctionalInterface interface NoParameterNoReturn {  void test(); }// 无返回值一个参数 @FunctionalInterface interface OneParameterNoReturn {  void test(int a); }// 无返回值多个参数 @FunctionalInterface interface MoreParameterNoReturn {  void test(int a,int b); }// 有返回值无参数 @FunctionalInterface interface NoParameterReturn {  int test(); }// 有返回值一个参数 @FunctionalInterface interface OneParameterReturn {  int test(int a); }// 有返回值多参数 @FunctionalInterface interface MoreParameterReturn {  int test(int a,int b); }public class TestDemo {    public static void main(String[] args) {        NoParameterNoReturn noParameterNoReturn = ()->{  System.out.println("无参数无返回值"); };        noParameterNoReturn.test();         OneParameterNoReturn oneParameterNoReturn = (int a)->{  System.out.println("无参数一个返回值："+ a); };        oneParameterNoReturn.test(10);         MoreParameterNoReturn moreParameterNoReturn = (int a,int b)->{  System.out.println("无返回值多个参数："+a+" "+b); };        moreParameterNoReturn.test(20,30);         NoParameterReturn noParameterReturn = ()->{  System.out.println("有返回值无参数！"); return 40; };        //接收函数的返回值         int ret = noParameterReturn.test();         System.out.println(ret);         OneParameterReturn oneParameterReturn = (int a)->{  System.out.println("有返回值有参数！"); return a; };        ret = oneParameterReturn.test(50);         System.out.println(ret);         MoreParameterReturn moreParameterReturn = (int a,int b)->{  System.out.println("有返回值多个参数！"); return a+b; };        ret = moreParameterReturn.test(60,70);        System.out.println(ret);     } }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-变量捕获"><a href="#5-变量捕获" class="headerlink" title="5. 变量捕获"></a><strong>5. 变量捕获</strong></h2><h3 id="5-1-介绍"><a href="#5-1-介绍" class="headerlink" title="5.1 介绍"></a><strong>5.1 介绍</strong></h3><p>Java 中的局部类和匿名类都存在变量捕获</p><p>只有理解了什么是变量捕获之后，我们才能更好地理解 Lambda 表达式的作用域，因为 Lambda 表达式也存在变量捕获。</p><h3 id="5-2-匿名内部类的变量捕获"><a href="#5-2-匿名内部类的变量捕获" class="headerlink" title="5.2 匿名内部类的变量捕获"></a><strong>5.2 匿名内部类的变量捕获</strong></h3><pre class="line-numbers language-text"><code class="language-text">class A {    public void func(){        System.out.println("func()");     } }public class TestDemo {    public static void main(String[] args) {        int a = 100;         new Test(){            @Override public void func() {                System.out.println("我是内部类，且重写了func这个方法！");                System.out.println("我是捕获到变量 a == "+a +" 我是一个常量，或者是一个没有改变过值的变量！");             }         };     } }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上述代码中的变量 a 就是捕获变量，这个变量要么是被 final 修饰，要么就要保证此变量在匿名内部类中使用时没有被修改，如果修改就会编译出错</p><h3 id="5-3-Lambda-的变量捕获"><a href="#5-3-Lambda-的变量捕获" class="headerlink" title="5.3 Lambda 的变量捕获"></a><strong>5.3 Lambda 的变量捕获</strong></h3><p>在 Lambda 中也可以进行变量捕获</p><pre class="line-numbers language-text"><code class="language-text">@FunctionalInterface interface A {    void test(); }public static void main(String[] args) {    int a = 10;     NoParameterNoReturn noParameterNoReturn = ()->{        // a = 99; 如果修改a，则会报错         System.out.println("捕获变量："+a);     };    noParameterNoReturn.test(); }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="6-Lambda-在集合中的使用"><a href="#6-Lambda-在集合中的使用" class="headerlink" title="6. Lambda 在集合中的使用"></a><strong>6. Lambda 在集合中的使用</strong></h2><p>为了能够让 Lambda 和 Java 的集合类集更好的一起使用，集合当中也新增了部分接口，以便与 Lambda 表达式对接</p><table><thead><tr><th>对应的接口</th><th>新增的方法</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><h3 id="补充：-1"><a href="#补充：-1" class="headerlink" title="补充："></a><strong>补充：</strong></h3><p>Collection 的 <code>forEach()</code> 方法是从接口 <code>java.lang.Interable</code> 继承的</p><h3 id="6-1-Collection-接口"><a href="#6-1-Collection-接口" class="headerlink" title="6.1 Collection 接口"></a><strong>6.1 Collection 接口</strong></h3><p>使用 forEach() 方法进行演示</p><p><code>forEach()</code> 源码：</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://pic3.zhimg.com/80/v2-0bc2e3214281413f2a1b58f089fc3d9e_1440w.webp" alt="img"></p><p>代码示例：使用匿名内部类</p><pre class="line-numbers language-text"><code class="language-text">public class TestDemo{    public static void main(String[] args) {        List<String> list=new ArrayList<>();        list.add("aaa");        list.add("bbb");        list.add("ccc");        list.forEach(new Consumer<String>() {            @Override            public void accept(String s) {                System.out.print(s+" ");            }        });    }}// 结果为：aaa bbb ccc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>代码示例：使用 Lambda</p><pre class="line-numbers language-text"><code class="language-text">public class TestDemo{    public static void main(String[] args) {        List<String> list=new ArrayList<>();        list.add("aaa");        list.add("bbb");        list.add("ccc");        list.forEach(s -> System.out.print(s+" "));    }}// 结果为：aaa bbb ccc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-2-List-接口"><a href="#6-2-List-接口" class="headerlink" title="6.2 List 接口"></a><strong>6.2 List 接口</strong></h3><p>使用 sort() 方法进行演示</p><p><code>sort()</code> 源码：</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://pic2.zhimg.com/80/v2-3fbcdf6076860970998ea91fce1a846d_1440w.webp" alt="img"></p><p>代码示例：使用匿名内部类</p><pre class="line-numbers language-text"><code class="language-text">public class TestDemo{    public static void main(String[] args) {        List<String> list=new ArrayList<>();        list.add("aaa");        list.add("bbb");        list.add("ccc");        list.sort(new Comparator<String>() {            @Override            public int compare(String o1, String o2) {                return o1.compareTo(o2);            }        });        System.out.println(list);    }}// 结果为：[aaa, bbb, ccc]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>代码示例：使用 Lambda</p><pre class="line-numbers language-text"><code class="language-text">public class TestDemo{    public static void main(String[] args) {        List<String> list=new ArrayList<>();        list.add("aaa");        list.add("bbb");        list.add("ccc");        list.sort((String o1,String o2)->o1.compareTo(o2));        System.out.println(list);    }}// 结果为：[aaa, bbb, ccc]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-3-Map-接口"><a href="#6-3-Map-接口" class="headerlink" title="6.3 Map 接口"></a><strong>6.3 Map 接口</strong></h3><p>使用 HashMap 的 forEach() 方法进行演示</p><h3 id="HashMap-的-forEach-源码："><a href="#HashMap-的-forEach-源码：" class="headerlink" title="HashMap 的 forEach() 源码："></a><strong><code>HashMap 的 forEach()</code></strong> <strong>源码：</strong></h3><p>代码示例：使用匿名内部类</p><pre class="line-numbers language-text"><code class="language-text">public class TestDemo{    public static void main(String[] args) {        Map<Integer,String> map=new HashMap<>();        map.put(1,"aaa");        map.put(2,"222");        map.put(3,"333");        map.forEach(new BiConsumer<Integer, String>() {            @Override            public void accept(Integer integer, String s) {                System.out.println("Key="+integer+" Value="+s);            }        });    }}/** 结果为：Key=1 Value=aaaKey=2 Value=222Key=3 Value=333*/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>代码示例：使用 Lambda</p><pre class="line-numbers language-text"><code class="language-text">public class TestDemo{    public static void main(String[] args) {        Map<Integer,String> map=new HashMap<>();        map.put(1,"aaa");        map.put(2,"222");        map.put(3,"333");        map.forEach((Integer integer,String s)->                System.out.println("Key="+integer+" Value="+s));    }}/** 结果为：Key=1 Value=aaaKey=2 Value=222Key=3 Value=333*/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="7-Lambda-表达式的优点和缺点"><a href="#7-Lambda-表达式的优点和缺点" class="headerlink" title="7. Lambda 表达式的优点和缺点"></a><strong>7. Lambda 表达式的优点和缺点</strong></h2><h3 id="优点："><a href="#优点：" class="headerlink" title="优点："></a><strong>优点：</strong></h3><ul><li>代码简洁，开发迅速</li><li>方便函数式编程</li><li>容易进行并行计算</li><li>Java 引入 Lambda，改善了集合操作</li></ul><h3 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a><strong>缺点：</strong></h3><ul><li>代码可读性变差</li><li>在非并行计算中，很多计算未必有传统 for 循环性能高</li></ul><p>虽然说，lambda表达式可以在⼀定程度上简化接口的实现。但是，并不是所有的接口都可以使用lambda表达式来简洁实现的。</p><p>lambda表达式毕竟只是⼀个匿名方法。当实现的接口中的方法过多或者多少的时候，lambda表达式都是不适用的。</p><p>lambda表达式，只能实现函数式接口。</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySql之SQL优化</title>
      <link href="/2023/05/21/blog-open-source-sqloptimization/"/>
      <url>/2023/05/21/blog-open-source-sqloptimization/</url>
      
        <content type="html"><![CDATA[<iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="100%" height="86" src="//music.163.com/outchain/player?type=2&amp;id=66285&amp;auto=1&amp;height=66"></iframe><h1 id="SQL-优化"><a href="#SQL-优化" class="headerlink" title="SQL 优化"></a>SQL 优化</h1><h2 id="一、查询SQL尽量不要使用select-，而是具体字段"><a href="#一、查询SQL尽量不要使用select-，而是具体字段" class="headerlink" title="一、查询SQL尽量不要使用select *，而是具体字段"></a><strong>一、查询SQL尽量不要使用select *，而是具体字段</strong></h2><p>1、反例</p><pre><code>SELECT * FROM user</code></pre><p>2、正例</p><pre><code>SELECT id,username,tel FROM user</code></pre><p>3、理由</p><ol><li>节省资源、减少网络开销。</li><li>可能用到覆盖索引，减少回表，提高查询效率。</li></ol><pre><code>注意：为节省时间，下面的样例字段都用*代替了。</code></pre><h2 id="二、避免在where子句中使用-or-来连接条件"><a href="#二、避免在where子句中使用-or-来连接条件" class="headerlink" title="二、避免在where子句中使用 or 来连接条件"></a>二、避免在where子句中使用 or 来连接条件</h2><p>1、反例</p><pre><code>SELECT * FROM user WHERE id=1 OR salary=5000</code></pre><p>2、正例</p><p>（1）使用union all</p><pre><code>SELECT * FROM user WHERE id=1 UNION ALLSELECT * FROM user WHERE salary=5000</code></pre><p>（2）分开两条sql写</p><pre><code>SELECT * FROM user WHERE id=1SELECT * FROM user WHERE salary=5000</code></pre><p>3、理由</p><ol><li>使用<code>or</code>可能会使索引失效，从而全表扫描；</li><li>对于<code>or</code>没有索引的<code>salary</code>这种情况，假设它走了<code>id</code>的索引，但是走到<code>salary</code>查询条件时，它还得全表扫描；</li><li>也就是说整个过程需要三步：全表扫描+索引扫描+合并。如果它一开始就走全表扫描，直接一遍扫描就搞定；</li><li>虽然<code>mysql</code>是有优化器的，出于效率与成本考虑，遇到<code>or</code>条件，索引还是可能失效的；</li></ol><h2 id="三、尽量使用数值替代字符串类型"><a href="#三、尽量使用数值替代字符串类型" class="headerlink" title="三、尽量使用数值替代字符串类型"></a>三、尽量使用数值替代字符串类型</h2><p>1、正例</p><ol><li>主键（id）：<code>primary key</code>优先使用数值类型<code>int</code>，<code>tinyint</code></li><li>性别（sex）：0代表女，1代表男；数据库没有布尔类型，<code>mysql</code>推荐使用<code>tinyint</code></li></ol><p>2、理由</p><ol><li>因为引擎在处理查询和连接时会逐个比较字符串中每一个字符；</li><li>而对于数字型而言只需要比较一次就够了；</li><li>字符会降低查询和连接的性能，并会增加存储开销；</li></ol><h2 id="四、使用varchar代替char"><a href="#四、使用varchar代替char" class="headerlink" title="四、使用varchar代替char"></a>四、使用varchar代替char</h2><p>1、反例</p><pre><code>`address` char(100) DEFAULT NULL COMMENT '地址'</code></pre><p>2、正例</p><pre><code>`address` varchar(100) DEFAULT NULL COMMENT '地址'</code></pre><p>3、理由</p><ol><li><code>varchar</code>变长字段按数据内容实际长度存储，存储空间小，可以节省存储空间；</li><li><code>char</code>按声明大小存储，不足补空格；</li><li>其次对于查询来说，在一个相对较小的字段内搜索，效率更高；</li></ol><h2 id="五、技术延伸，char与varchar2的区别？"><a href="#五、技术延伸，char与varchar2的区别？" class="headerlink" title="五、技术延伸，char与varchar2的区别？"></a>五、技术延伸，char与varchar2的区别？</h2><p>1、<code>char</code>的长度是固定的，而<code>varchar2</code>的长度是可以变化的。</p><p>比如，存储字符串<code>“101”</code>，对于<code>char(10)</code>，表示你存储的字符将占10个字节（包括7个空字符），在数据库中它是以空格占位的，而同样的<code>varchar2(10)</code>则只占用3个字节的长度，10只是最大值，当你存储的字符小于10时，按实际长度存储。</p><p>2、<code>char</code>的效率比<code>varchar2</code>的效率稍高。</p><p>3、何时用<code>char</code>，何时用<code>varchar2</code>?</p><p><code>char</code>和<code>varchar2</code>是一对矛盾的统一体，两者是互补的关系，<code>varchar2</code>比<code>char</code>节省空间，在效率上比<code>char</code>会稍微差一点，既想获取效率，就必须牺牲一点空间，这就是我们在数据库设计上常说的“以空间换效率”。</p><p><code>varchar2</code>虽然比<code>char</code>节省空间，但是假如一个<code>varchar2</code>列经常被修改，而且每次被修改的数据的长度不同，这会引起“行迁移”现象，而这造成多余的I/O，是数据库设计中要尽力避免的，这种情况下用<code>char</code>代替<code>varchar2</code>会更好一些。<code>char</code>中还会自动补齐空格，因为你<code>insert</code>到一个<code>char</code>字段自动补充了空格的,但是<code>select</code>后空格没有删除，因此<code>char</code>类型查询的时候一定要记得使用<code>trim</code>，这是写本文章的原因。</p><p>如果开发人员细化使用<code>rpad()</code>技巧将绑定变量转换为某种能与<code>char</code>字段相比较的类型（当然，与截断<code>trim</code>数据库列相比，填充绑定变量的做法更好一些，因为对列应用函数<code>trim</code>很容易导致无法使用该列上现有的索引），可能必须考虑到经过一段时间后列长度的变化。如果字段的大小有变化，应用就会受到影响，因为它必须修改字段宽度。</p><p>正是因为以上原因，定宽的存储空间可能导致表和相关索引比平常大出许多，还伴随着绑定变量问题，所以无论什么场合都要避免使用char类型。</p><h2 id="六、where中使用默认值代替null"><a href="#六、where中使用默认值代替null" class="headerlink" title="六、where中使用默认值代替null"></a>六、where中使用默认值代替null</h2><p>1、反例</p><pre><code>SELECT * FROM user WHERE age IS NOT NULL</code></pre><p>2、正例</p><pre><code>SELECT * FROM user WHERE age&gt;0</code></pre><p>3、理由</p><ol><li>并不是说使用了<code>is null</code>或者 <code>is not null</code>就会不走索引了，这个跟<code>mysql</code>版本以及查询成本都有关；</li><li>如果<code>mysql</code>优化器发现，走索引比不走索引成本还要高，就会放弃索引，这些条件 <code>!=，&lt;&gt;，is null，is not null</code>经常被认为让索引失效；</li><li>其实是因为一般情况下，查询的成本高，优化器自动放弃索引的；</li><li>如果把<code>null</code>值，换成默认值，很多时候让走索引成为可能，同时，表达意思也相对清晰一点；</li></ol><h2 id="七、避免在where子句中使用-或-lt-gt-操作符"><a href="#七、避免在where子句中使用-或-lt-gt-操作符" class="headerlink" title="七、避免在where子句中使用!=或<>操作符"></a>七、避免在where子句中使用!=或&lt;&gt;操作符</h2><p>1、反例</p><pre><code>SELECT * FROM user WHERE salary!=5000SELECT * FROM user WHERE salary&lt;&gt;5000</code></pre><p>2、理由</p><ol><li>使用<code>!=</code>和<code>&lt;&gt;</code>很可能会让索引失效</li><li>应尽量避免在<code>where</code>子句中使用<code>!=</code>或<code>&lt;&gt;</code>操作符，否则引擎将放弃使用索引而进行全表扫描</li><li>实现业务优先，实在没办法，就只能使用，并不是不能使用</li></ol><h2 id="八、inner-join-、left-join、right-join，优先使用inner-join"><a href="#八、inner-join-、left-join、right-join，优先使用inner-join" class="headerlink" title="八、inner join 、left join、right join，优先使用inner join"></a>八、inner join 、left join、right join，优先使用inner join</h2><p>三种连接如果结果相同，优先使用inner join，如果使用left join左边表尽量小。</p><ul><li>inner join 内连接，只保留两张表中完全匹配的结果集；</li><li>left join会返回左表所有的行，即使在右表中没有匹配的记录；</li><li>right join会返回右表所有的行，即使在左表中没有匹配的记录；</li></ul><p>为什么？</p><ul><li>如果inner join是等值连接，返回的行数比较少，所以性能相对会好一点；</li><li>使用了左连接，左边表数据结果尽量小，条件尽量放到左边处理，意味着返回的行数可能比较少；</li><li>这是mysql优化原则，就是小表驱动大表，小的数据集驱动大的数据集，从而让性能更优；</li></ul><h2 id="九、提高group-by语句的效率"><a href="#九、提高group-by语句的效率" class="headerlink" title="九、提高group by语句的效率"></a>九、提高group by语句的效率</h2><p>1、反例</p><p>先分组，再过滤</p><pre><code>select job, avg（salary） from employee group by jobhaving job ='develop' or job = 'test';</code></pre><p>2、正例</p><p>先过滤，后分组</p><pre><code>select job，avg（salary） from employee where job ='develop' or job = 'test' group by job;</code></pre><p>3、理由</p><p>可以在执行到该语句前，把不需要的记录过滤掉</p><h2 id="十、清空表时优先使用truncate"><a href="#十、清空表时优先使用truncate" class="headerlink" title="十、清空表时优先使用truncate"></a>十、清空表时优先使用truncate</h2><p><code>truncate table</code>在功能上与不带 <code>where</code>子句的 <code>delete</code>语句相同：二者均删除表中的全部行。但 <code>truncate table</code>比 <code>delete</code>速度快，且使用的系统和事务日志资源少。</p><p><code>delete</code>语句每次删除一行，并在事务日志中为所删除的每行记录一项。<code>truncate table</code>通过释放存储表数据所用的数据页来删除数据，并且只在事务日志中记录页的释放。</p><p><code>truncate table</code>删除表中的所有行，但表结构及其列、约束、索引等保持不变。新行标识所用的计数值重置为该列的种子。如果想保留标识计数值，请改用 DELETE。如果要删除表定义及其数据，请使用 <code>drop table</code>语句。</p><p>对于由 <code>foreign key</code>约束引用的表，不能使用 <code>truncate table</code>，而应使用不带  <code>where</code>子句的 DELETE 语句。由于 <code>truncate table</code>不记录在日志中，所以它不能激活触发器。</p><p><code>truncate table</code>不能用于参与了索引视图的表。</p><h2 id="十一、操作delete或者update语句，加个limit或者循环分批次删除"><a href="#十一、操作delete或者update语句，加个limit或者循环分批次删除" class="headerlink" title="十一、操作delete或者update语句，加个limit或者循环分批次删除"></a>十一、操作delete或者update语句，加个limit或者循环分批次删除</h2><p>1、降低写错SQL的代价</p><p>清空表数据可不是小事情，一个手抖全没了，删库跑路？如果加limit，删错也只是丢失部分数据，可以通过binlog日志快速恢复的。</p><p>2、SQL效率很可能更高</p><p>SQL中加了<code>limit 1</code>，如果第一条就命中目标<code>return</code>， 没有<code>limit</code>的话，还会继续执行扫描表。</p><p>3、避免长事务</p><p><code>delete</code>执行时,如果<code>age</code>加了索引，MySQL会将所有相关的行加写锁和间隙锁，所有执行相关行会被锁住，如果删除数量大，会直接影响相关业务无法使用。</p><p>4、数据量大的话，容易把CPU打满</p><p>如果你删除数据量很大时，不加 limit限制一下记录数，容易把<code>cpu</code>打满，导致越删越慢。</p><p>5、锁表</p><p>一次性删除太多数据，可能造成锁表，会有lock wait timeout exceed的错误，所以建议分批操作。</p><h2 id="十二、UNION操作符"><a href="#十二、UNION操作符" class="headerlink" title="十二、UNION操作符"></a>十二、UNION操作符</h2><p><code>UNION</code>在进行表链接后会筛选掉重复的记录，所以在表链接后会对所产生的结果集进行排序运算，删除重复的记录再返回结果。实际大部分应用中是不会产生重复的记录，最常见的是过程表与历史表<code>UNION</code>。如：</p><pre><code>select username,tel from userunionselect departmentname from department</code></pre><p>这个SQL在运行时先取出两个表的结果，再用排序空间进行排序删除重复的记录，最后返回结果集，如果表数据量大的话可能会导致用磁盘进行排序。推荐方案：采用<code>UNION ALL</code>操作符替代<code>UNION</code>，因为<code>UNION ALL</code>操作只是简单的将两个结果合并后就返回。</p><h2 id="十三、批量插入性能提升"><a href="#十三、批量插入性能提升" class="headerlink" title="十三、批量插入性能提升"></a>十三、批量插入性能提升</h2><p>1、多条提交</p><pre><code>INSERT INTO user (id,username) VALUES(1,'哪吒编程');INSERT INTO user (id,username) VALUES(2,'妲己');</code></pre><p>2、批量提交</p><pre><code>INSERT INTO user (id,username) VALUES(1,'哪吒编程'),(2,'妲己');</code></pre><p>3、理由</p><p>默认新增SQL有事务控制，导致每条都需要事务开启和事务提交，而批量处理是一次事务开启和提交，效率提升明显，达到一定量级，效果显著，平时看不出来。</p><h2 id="十四、表连接不宜太多，索引不宜太多，一般5个以内"><a href="#十四、表连接不宜太多，索引不宜太多，一般5个以内" class="headerlink" title="十四、表连接不宜太多，索引不宜太多，一般5个以内"></a>十四、表连接不宜太多，索引不宜太多，一般5个以内</h2><p>1、表连接不宜太多，一般5个以内</p><ol><li>关联的表个数越多，编译的时间和开销也就越大</li><li>每次关联内存中都生成一个临时表</li><li>应该把连接表拆开成较小的几个执行，可读性更高</li><li>如果一定需要连接很多表才能得到数据，那么意味着这是个糟糕的设计了</li><li>阿里规范中，建议多表联查三张表以下</li></ol><p>2、索引不宜太多，一般5个以内</p><ol><li>索引并不是越多越好，虽其提高了查询的效率，但却会降低插入和更新的效率；</li><li>索引可以理解为一个就是一张表，其可以存储数据，其数据就要占空间；</li><li>索引表的数据是排序的，排序也是要花时间的；</li><li><code>insert</code>或<code>update</code>时有可能会重建索引，如果数据量巨大，重建将进行记录的重新排序，所以建索引需要慎重考虑，视具体情况来定；</li><li>一个表的索引数最好不要超过5个，若太多需要考虑一些索引是否有存在的必要；</li></ol><h2 id="十五、避免在索引列上使用内置函数"><a href="#十五、避免在索引列上使用内置函数" class="headerlink" title="十五、避免在索引列上使用内置函数"></a>十五、避免在索引列上使用内置函数</h2><p>1、反例</p><pre><code>SELECT * FROM user WHERE DATE_ADD(birthday,INTERVAL 7 DAY) &gt;=NOW();</code></pre><p>2、正例</p><pre><code>SELECT * FROM user WHERE  birthday &gt;= DATE_ADD(NOW(),INTERVAL 7 DAY);</code></pre><p>3、理由</p><p>使用索引列上内置函数，索引失效。</p><h2 id="十六、组合索引"><a href="#十六、组合索引" class="headerlink" title="十六、组合索引"></a>十六、组合索引</h2><p>排序时应按照组合索引中各列的顺序进行排序，即使索引中只有一个列是要排序的，否则排序性能会比较差。</p><pre><code>create index IDX_USERNAME_TEL on user(deptid,position,createtime);select username,tel from user where deptid= 1 and position = 'java开发' order by deptid,position,createtime desc; </code></pre><p>实际上只是查询出符合 <code>deptid= 1 and position = 'java开发'</code>条件的记录并按createtime降序排序，但写成order by createtime desc性能较差。</p><h2 id="十七、复合索引最左特性"><a href="#十七、复合索引最左特性" class="headerlink" title="十七、复合索引最左特性"></a>十七、复合索引最左特性</h2><p>1、创建复合索引</p><pre><code>ALTER TABLE employee ADD INDEX idx_name_salary (name,salary)</code></pre><p>2、满足复合索引的最左特性，哪怕只是部分，复合索引生效</p><pre><code>SELECT * FROM employee WHERE NAME='哪吒编程'</code></pre><p>3、没有出现左边的字段，则不满足最左特性，索引失效</p><pre><code>SELECT * FROM employee WHERE salary=5000</code></pre><p>4、复合索引全使用，按左侧顺序出现 name,salary，索引生效</p><pre><code>SELECT * FROM employee WHERE NAME='哪吒编程' AND salary=5000</code></pre><p>5、虽然违背了最左特性，但MySQL执行SQL时会进行优化，底层进行颠倒优化</p><pre><code>SELECT * FROM employee WHERE salary=5000 AND NAME='哪吒编程'</code></pre><p>6、理由</p><p>复合索引也称为联合索引，当我们创建一个联合索引的时候，如(k1,k2,k3)，相当于创建了（k1）、(k1,k2)和(k1,k2,k3)三个索引，这就是最左匹配原则。</p><p>联合索引不满足最左原则，索引一般会失效。</p><h2 id="十八、优化like语句"><a href="#十八、优化like语句" class="headerlink" title="十八、优化like语句"></a>十八、优化like语句</h2><p>模糊查询，程序员最喜欢的就是使用<code>like</code>，但是<code>like</code>很可能让你的索引失效。</p><p>1、反例</p><pre><code>select * from citys where name like '%大连' (不使用索引)select * from citys where name like '%大连%' (不使用索引)</code></pre><p>2、正例</p><pre><code>select * from citys where name like '大连%' (使用索引) 。</code></pre><p>3、理由</p><ul><li>首先尽量避免模糊查询，如果必须使用，不采用全模糊查询，也应尽量采用右模糊查询， 即<code>like ‘…%’</code>，是会使用索引的；</li><li>左模糊<code>like ‘%...’</code>无法直接使用索引，但可以利用<code>reverse + function index</code>的形式，变化成 <code>like ‘…%’</code>；</li><li>全模糊查询是无法优化的，一定要使用的话建议使用搜索引擎。</li></ul><h2 id="十九、使用explain分析你SQL执行计划"><a href="#十九、使用explain分析你SQL执行计划" class="headerlink" title="十九、使用explain分析你SQL执行计划"></a>十九、使用explain分析你SQL执行计划</h2><p>1、type</p><ol><li>system：表仅有一行，基本用不到；</li><li>const：表最多一行数据配合，主键查询时触发较多；</li><li>eq_ref：对于每个来自于前面的表的行组合，从该表中读取一行。这可能是最好的联接类型，除了const类型；</li><li>ref：对于每个来自于前面的表的行组合，所有有匹配索引值的行将从这张表中读取；</li><li>range：只检索给定范围的行，使用一个索引来选择行。当使用=、&lt;&gt;、&gt;、&gt;=、&lt;、&lt;=、IS NULL、&lt;=&gt;、BETWEEN或者IN操作符，用常量比较关键字列时，可以使用range；</li><li>index：该联接类型与ALL相同，除了只有索引树被扫描。这通常比ALL快，因为索引文件通常比数据文件小；</li><li>all：全表扫描；</li><li>性能排名：system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; all。</li><li>实际sql优化中，最后达到ref或range级别。</li></ol><p>2、Extra常用关键字</p><ul><li>Using index：只从索引树中获取信息，而不需要回表查询；</li><li>Using where：WHERE子句用于限制哪一个行匹配下一个表或发送到客户。除非你专门从表中索取或检查所有行，如果Extra值不为Using where并且表联接类型为ALL或index，查询可能会有一些错误。需要回表查询。</li><li>Using temporary：mysql常建一个临时表来容纳结果，典型情况如查询包含可以按不同情况列出列的<code>GROUP BY</code>和<code>ORDER BY</code>子句时；</li></ul><h2 id="二十、一些其它优化方式"><a href="#二十、一些其它优化方式" class="headerlink" title="二十、一些其它优化方式"></a>二十、一些其它优化方式</h2><p>1、设计表的时候，所有表和字段都添加相应的注释。</p><p>2、SQL书写格式，关键字大小保持一致，使用缩进。</p><p>3、修改或删除重要数据前，要先备份。</p><p>4、很多时候用 exists 代替 in 是一个好的选择</p><p>5、where后面的字段，留意其数据类型的隐式转换。</p><p>未使用索引</p><pre><code>SELECT * FROM user WHERE NAME=110</code></pre><p>（1） 因为不加单引号时，是字符串跟数字的比较，它们类型不匹配； </p><p>（2）MySQL会做隐式的类型转换，把它们转换为数值类型再做比较；</p><p>6、尽量把所有列定义为<code>NOT NULL</code></p><p><code>NOT NULL</code>列更节省空间，<code>NULL</code>列需要一个额外字节作为判断是否为 <code>NULL</code>的标志位。<code>NULL</code>列需要注意空指针问题，<code>NULL</code>列在计算和比较的时候，需要注意空指针问题。</p><p>7、伪删除设计</p><p>8、数据库和表的字符集尽量统一使用UTF8</p><p>（1）可以避免乱码问题；</p><p>（2）可以避免，不同字符集比较转换，导致的索引失效问题；</p><p>9、select count(*) from table；</p><p>这样不带任何条件的count会引起全表扫描，并且没有任何业务意义，是一定要杜绝的。</p><p>10、避免在where中对字段进行表达式操作</p><p>（1）SQL解析时，如果字段相关的是表达式就进行全表扫描 ；</p><p>（2）字段干净无表达式，索引生效；</p><p>11、关于临时表</p><p>（1）避免频繁创建和删除临时表，以减少系统表资源的消耗；</p><p>（2）在新建临时表时，如果一次性插入数据量很大，那么可以使用 select into 代替 create table，避免造成大量 log；</p><p>（3）如果数据量不大，为了缓和系统表的资源，应先create table，然后insert；</p><p>（4）如果使用到了临时表，在存储过程的最后务必将所有的临时表显式删除。先 truncate table ，然后 drop table ，这样可以避免系统表的较长时间锁定；</p><p>12、索引不适合建在有大量重复数据的字段上，比如性别，排序字段应创建索引</p><p>13、去重distinct过滤字段要少</p><ol><li>带distinct的语句占用<code>cpu</code>时间高于不带<code>distinct</code>的语句</li><li>当查询很多字段时，如果使用<code>distinct</code>，数据库引擎就会对数据进行比较，过滤掉重复数据</li><li>然而这个比较、过滤的过程会占用系统资源，如<code>cpu</code>时间</li></ol><p>14、尽量避免大事务操作，提高系统并发能力</p><p>15、所有表必须使用<code>Innodb</code>存储引擎</p><p><code>Innodb</code>「支持事务，支持行级锁，更好的恢复性」，高并发下性能更好，所以呢，没有特殊要求（即<code>Innodb</code>无法满足的功能如：列存储，存储空间数据等）的情况下，所有表必须使用<code>Innodb</code>存储引擎。</p><p>16、尽量避免使用游标</p><p>因为游标的效率较差，如果游标操作的数据超过1万行，那么就应该考虑改写。</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> MySql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java循环删除List中的元素</title>
      <link href="/2023/05/20/blog-open-source-circular-deletion-of-elements-in-list/"/>
      <url>/2023/05/20/blog-open-source-circular-deletion-of-elements-in-list/</url>
      
        <content type="html"><![CDATA[<iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="100%" height="86" src="//music.163.com/outchain/player?type=2&amp;id=478507889&amp;auto=1&amp;height=66"></iframe><h1 id="循环删除-List-中的元素"><a href="#循环删除-List-中的元素" class="headerlink" title="循环删除 List 中的元素"></a>循环删除 List 中的元素</h1><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>比如有以下这个 List：</p><pre><code>public List&lt;String&gt; initList = Arrays.asList("张三", "李四", "周一", "刘四", "李强", "李白");</code></pre><p>怎么删除 List 中姓李的人？</p><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><h3 id="1、普通-for-循环删除（不可靠）"><a href="#1、普通-for-循环删除（不可靠）" class="headerlink" title="1、普通 for 循环删除（不可靠）"></a>1、普通 for 循环删除（不可靠）</h3><pre><code>/** * 普通 for 循环删除 *  */@Testpublic void remove1() {    List&lt;String&gt; list = new ArrayList(initList);    for (int i = 0; i &lt; list.size(); i++) {        String str = list.get(i);        if (str.startsWith("李")) {            list.remove(i);        }    }    System.out.println(list);}</code></pre><p>输出结果：</p><blockquote><p>[张三, 周一, 刘四, 李白]</p></blockquote><p>李白没删掉</p><p>问题就出在 list.size()，因为 list.size() 和 i 都是动态变化的，i 的值一直在累加，list.size() 一直在减少，所以 list 就会早早结束了循环。</p><p>所以这种方式虽然不会报错，但存在隐患，并且不容易被察觉，不建议使用。</p><h3 id="2、普通-for-循环提取变量删除（抛异常）"><a href="#2、普通-for-循环提取变量删除（抛异常）" class="headerlink" title="2、普通 for 循环提取变量删除（抛异常）"></a>2、普通 for 循环提取变量删除（抛异常）</h3><p>把上面的示例中的 size 提出变量：</p><pre><code>/** * 普通 for 循环删除（size提出变量） *  */@Testpublic void remove2() {    List&lt;String&gt; list = new ArrayList(initList);    int size = list.size();    for (int i = 0; i &lt; size; i++) {        String str = list.get(i);        if (str.startsWith("李")) {            list.remove(i);        }    }    System.out.println(list);}</code></pre><p>直接干下标溢出异常了。。</p><p>这里也很明显，因为 size 变量是固定的，但 list 的实际大小是不断减小的，而 i 的大小是不断累加的，一旦 i &gt;= list 的实际大小肯定就异常了。</p><h3 id="3、普通-for-循环倒序删除（可靠）"><a href="#3、普通-for-循环倒序删除（可靠）" class="headerlink" title="3、普通 for 循环倒序删除（可靠）"></a>3、普通 for 循环倒序删除（可靠）</h3><pre><code>/** * 普通 for 循环倒序删除 *  */@Testpublic void remove3() {    List&lt;String&gt; list = new ArrayList(initList);    for (int i = list.size() - 1; i &gt; 0; i--) {        String str = list.get(i);        if (str.startsWith("李")) {            list.remove(i);        }    }    System.out.println(list);}</code></pre><p>输出结果：</p><blockquote><p>[张三, 周一, 刘四]</p></blockquote><p>结果输出正常，这种删除方式就算把 list.size() 提出变量也是 OK 的，因为循环中只用到了一次。</p><h3 id="4、增强-for-循环删除（抛异常）"><a href="#4、增强-for-循环删除（抛异常）" class="headerlink" title="4、增强 for 循环删除（抛异常）"></a>4、增强 for 循环删除（抛异常）</h3><pre><code>/** * 增强 for 循环删除 *  */@Testpublic void remove4() {    List&lt;String&gt; list = new ArrayList(initList);    for (String element : list) {        if (element.startsWith("李")) {            list.remove(element);        }    }    System.out.println(list);}</code></pre><p>抛异常了。不过这次的异常和上面的下标异常不太一样，这次是：</p><p>java.util.ConcurrentModificationException</p><p>这个是集合操作中很常见的异常之一，即并发修改异常！</p><p>for(xx in xx) 就是增强的 for循环，即迭代器 Iterator 的加强实现，其内部是调用的 Iterator 的方法，取下个元素的时候都会去判断要修改的数量（modCount）和期待修改的数量（expectedModCount）是否一致，不一致则会报错，而 ArrayList 中的 remove 方法并没有同步期待修改的数量（expectedModCount）值，所以会抛异常了。</p><h3 id="5、迭代器循环迭代器删除（可靠）"><a href="#5、迭代器循环迭代器删除（可靠）" class="headerlink" title="5、迭代器循环迭代器删除（可靠）"></a>5、迭代器循环迭代器删除（可靠）</h3><pre><code>/** * 迭代器循环删除（iterator.remove） *  */@Testpublic void remove5() {    List&lt;String&gt; list = new ArrayList(initList);    for (Iterator&lt;String&gt; iterator = list.iterator(); iterator.hasNext(); ) {        String str = iterator.next();        if (str.contains("李")) {            iterator.remove();        }    }    System.out.println(list);}</code></pre><p>输出结果：</p><p>[张三, 周一, 刘四]</p><p>结果输出正常，这是因为迭代器中的 remove 方法将期待修改的数量（expectedModCount）值进行了同步：所以，这种删除方法是安全的，推荐使用。</p><h3 id="6、迭代器循环集合删除（抛异常）"><a href="#6、迭代器循环集合删除（抛异常）" class="headerlink" title="6、迭代器循环集合删除（抛异常）"></a>6、迭代器循环集合删除（抛异常）</h3><pre><code>/** * 迭代器循环删除（list.remove） *  */@Testpublic void remove6() {    List&lt;String&gt; list = new ArrayList(initList);    for (Iterator&lt;String&gt; ite = list.iterator(); ite.hasNext(); ) {        String str = ite.next();        if (str.contains("李")) {            list.remove(str);        }    }    System.out.println(list);}</code></pre><p>又是那个并发修改异常，这个示例虽然使用了 Iterator 循环，但删除的时候却使用了 list.remove 方法，同样是有问题的，注意了，千万别用错了。</p><h3 id="7、集合-forEach-方法循环删除（抛异常）"><a href="#7、集合-forEach-方法循环删除（抛异常）" class="headerlink" title="7、集合 forEach 方法循环删除（抛异常）"></a>7、集合 forEach 方法循环删除（抛异常）</h3><pre><code>/** * list.forEach 删除 *  */@Testpublic void remove7() {    List&lt;String&gt; list = new ArrayList(initList);    list.forEach((e) -&gt; {        if (e.contains("李")) {            list.remove(e);        }    });    System.out.println(list);}</code></pre><p>forEach 方法的背后其实就是增强的 for 循环，底层即迭代器，所以使用 list.remove 同样抛出 ConcurrentModificationException 异常。</p><h3 id="8、stream-filter-过滤（可靠）"><a href="#8、stream-filter-过滤（可靠）" class="headerlink" title="8、stream filter 过滤（可靠）"></a>8、stream filter 过滤（可靠）</h3><pre><code>/** * stream filter 过滤 *  */@Testpublic void remove8() {    List&lt;String&gt; list = new ArrayList(initList);    list = list.stream().filter(e -&gt; !e.startsWith("李")).collect(Collectors.toList());    System.out.println(list);}</code></pre><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文总结了 8 种循环删除 List 元素的方法：</p><ul><li>普通 for 循环删除（不可靠）</li><li>普通 for 循环提取变量删除（抛异常）</li><li><strong><em>普通 for 循环倒序删除（可靠）</em></strong></li><li>增强 for 循环删除（抛异常）</li><li><strong><em>迭代器循环迭代器删除（可靠）</em></strong></li><li>迭代器循环集合删除（抛异常）</li><li>集合 forEach 方法循环删除（抛异常）</li><li><strong><em>stream filter 过滤（可靠）</em></strong></li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySql基础篇</title>
      <link href="/2023/05/19/blog-open-source-mysqlfoundation/"/>
      <url>/2023/05/19/blog-open-source-mysqlfoundation/</url>
      
        <content type="html"><![CDATA[<h2 id="MyISAM和InnoDB"><a href="#MyISAM和InnoDB" class="headerlink" title="MyISAM和InnoDB"></a>MyISAM和InnoDB</h2><table><thead><tr><th>对比</th><th>MyISAM</th><th><strong>InnoDB</strong></th></tr></thead><tbody><tr><td>主外键</td><td>不支持</td><td>支持</td></tr><tr><td>事务</td><td>不支持</td><td>支持</td></tr><tr><td>行表锁</td><td>表锁，操作时即使操作一条记录也会锁住一整张表，不适合高并发的操作</td><td>行锁，操作时只锁住某一行，不会影响到其他行，适合高并发</td></tr><tr><td>缓存</td><td>只缓存索引，不缓存其他数据</td><td>缓存索引和真实数据，对内存要求较高，而且内存大小对性能有影响</td></tr><tr><td>表空间</td><td>小</td><td>大</td></tr><tr><td>关注点</td><td>性能</td><td>事务</td></tr><tr><td>默认安装</td><td>Y</td><td>Y</td></tr></tbody></table><h2 id="性能下降SQL慢的原因："><a href="#性能下降SQL慢的原因：" class="headerlink" title="性能下降SQL慢的原因："></a>性能下降SQL慢的原因：</h2><ol><li>查询语句写的差</li><li>索引失效</li><li>关联查询太多join （设计缺陷或不得已的需求）</li><li>服务器调优及各个参数设置(缓冲，线程参数)</li></ol><h2 id="Mysql执行顺序"><a href="#Mysql执行顺序" class="headerlink" title="Mysql执行顺序"></a>Mysql执行顺序</h2><ol><li>手写</li><li>机读先从from开始</li><li><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/99a73a32d8b1430180bdccc3c5ac4223.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6L-b5Ye75Zyw5bCP55m9,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></li></ol><p>mysql执行顺序如下：</p><ol><li><p>from 阶段</p></li><li><p>where 阶段</p></li><li><p>group by 阶段</p></li><li><p>having 阶段</p></li><li><p>select 阶段</p></li><li><p>order by 阶段</p></li><li><p>limit 阶段</p></li></ol><p>按照以上书写顺序，完整的执行顺序应该是这样：</p><p>1、from子句识别查询表的数据；</p><p>2、where子句基于指定的条件对记录进行筛选；</p><p>3、group by 子句将数据划分成多个组别，如按性别男、女分组；</p><p>4、有聚合函数时，要使用聚集函数进行数据计算；</p><p>5、Having子句筛选满足第二条件的数据；</p><p>6、执行select语句进行字段筛选</p><p>7、筛选重复数据；</p><p>8、对数据进行排序；</p><p>9、执行limit进行结果限定</p><h2 id="SQL优化"><a href="#SQL优化" class="headerlink" title="SQL优化"></a>SQL优化</h2><h3 id="优化目标"><a href="#优化目标" class="headerlink" title="优化目标"></a><strong>优化目标</strong></h3><p>　　1.减少 IO 次数</p><p>　　IO永远是数据库最容易瓶颈的地方，这是由数据库的职责所决定的，大部分数据库操作中超过90%的时间都是 IO 操作所占用的，减少 IO 次数是 SQL 优化中需要第一优先考虑，当然，也是收效最明显的优化手段。</p><p>　　2.降低 CPU 计算</p><p>　　除了 IO 瓶颈之外，SQL优化中需要考虑的就是 CPU 运算量的优化了。order by, group by,distinct … 都是消耗 CPU 的大户(这些操作基本上都是 CPU 处理内存中的数据比较运算)。当我们的 IO 优化做到一定阶段之后，降低 CPU 计算也就成为了我们 SQL 优化的重要目标</p><h3 id="优化方法"><a href="#优化方法" class="headerlink" title="优化方法"></a>优化方法</h3><p>　　改变 SQL 执行计划</p><p>　　明确了优化目标之后，我们需要确定达到我们目标的方法。对于 SQL 语句来说，达到上述2个目标的方法其实只有一个，那就是改变 SQL 的执行计划，让他尽量“少走弯路”，尽量通过各种“捷径”来找到我们需要的数据，以达到 “减少 IO 次数” 和 “降低 CPU 计算” 的目标</p><h3 id="常见误区"><a href="#常见误区" class="headerlink" title="常见误区"></a>常见误区</h3><p>1.count(1)和count(primary_key) 优于 count(*)</p><p>　　很多人为了统计记录条数，就使用 count(1) 和 count(primary_key) 而不是 count(<em>) ，他们认为这样性能更好，其实这是一个误区。对于有些场景，这样做可能性能会更差，应为数据库对 count(</em>) 计数操作做了一些特别的优化。</p><p>2.count(column) 和 count(*) 是一样的</p><p>　　这个误区甚至在很多的资深工程师或者是 DBA 中都普遍存在，很多人都会认为这是理所当然的。实际上，count(column) 和 count(*) 是一个完全不一样的操作，所代表的意义也完全不一样。</p><p>　　count(column) 是表示结果集中有多少个column字段不为空的记录</p><p>　　count(*) 是表示整个结果集有多少条记录</p><p>3.select a,b from … 比 select a,b,c from … 可以让数据库访问更少的数据量</p><p>　　这个误区主要存在于大量的开发人员中，主要原因是对数据库的存储原理不是太了解。</p><p>　　实际上，大多数关系型数据库都是按照行(row)的方式存储，而数据存取操作都是以一个固定大小的IO单元(被称作 block 或者 page)为单位，一般为4KB，8KB… 大多数时候，每个IO单元中存储了多行，每行都是存储了该行的所有字段(lob等特殊类型字段除外)。</p><p>　　所以，我们是取一个字段还是多个字段，实际上数据库在表中需要访问的数据量其实是一样的。</p><p>　　当然，也有例外情况，那就是我们的这个查询在索引中就可以完成，也就是说当只取 a,b两个字段的时候，不需要回表，而c这个字段不在使用的索引中，需要回表取得其数据。在这样的情况下，二者的IO量会有较大差异。</p><p>4.order by 一定需要排序操作</p><p>　　我们知道索引数据实际上是有序的，如果我们的需要的数据和某个索引的顺序一致，而且我们的查询又通过这个索引来执行，那么数据库一般会省略排序操作，而直接将数据返回，因为数据库知道数据已经满足我们的排序需求了。</p><p>　　实际上，利用索引来优化有排序需求的 SQL，是一个非常重要的优化手段</p><p>　　延伸阅读：MySQL ORDER BY 的实现分析，MySQL 中 GROUP BY 基本实现原理以及 MySQL DISTINCT 的基本实现原理这3篇文章中有更为深入的分析，尤其是第一篇</p><p>5.执行计划中有 filesort 就会进行磁盘文件排序</p><p>　　有这个误区其实并不能怪我们，而是因为 MySQL 开发者在用词方面的问题。filesort 是我们在使用 explain 命令查看一条 SQL 的执行计划的时候可能会看到在 “Extra” 一列显示的信息。</p><p>　　实际上，只要一条 SQL 语句需要进行排序操作，都会显示“Using filesort”，这并不表示就会有文件排序操作。</p><h3 id="基本原则"><a href="#基本原则" class="headerlink" title="基本原则"></a>基本原则</h3><p>1.尽量少 join</p><p>　　MySQL 的优势在于简单，但这在某些方面其实也是其劣势。MySQL 优化器效率高，但是由于其统计信息的量有限，优化器工作过程出现偏差的可能性也就更多。对于复杂的多表 Join，一方面由于其优化器受限，再者在 Join 这方面所下的功夫还不够，所以性能表现离 Oracle 等关系型数据库前辈还是有一定距离。但如果是简单的单表查询，这一差距就会极小甚至在有些场景下要优于这些数据库前辈。</p><p>2.尽量少排序</p><p>　　排序操作会消耗较多的 CPU 资源，所以减少排序可以在缓存命中率高等 IO 能力足够的场景下会较大影响 SQL 的响应时间。</p><p>　　对于MySQL来说，减少排序有多种办法，比如：</p><p>　　上面误区中提到的通过利用索引来排序的方式进行优化</p><p>　　减少参与排序的记录条数</p><p>　　非必要不对数据进行排序</p><p>　　…</p><p>3.尽量避免 select *</p><p>　　很多人看到这一点后觉得比较难理解，上面不是在误区中刚刚说 select 子句中字段的多少并不会影响到读取的数据吗?</p><p>　　是的，大多数时候并不会影响到 IO 量，但是当我们还存在 order by 操作的时候，select 子句中的字段多少会在很大程度上影响到我们的排序效率，这一点可以通过我之前一篇介绍 MySQL ORDER BY 的实现分析的文章中有较为详细的介绍。</p><p>　　此外，上面误区中不是也说了，只是大多数时候是不会影响到 IO 量，当我们的查询结果仅仅只需要在索引中就能找到的时候，还是会极大减少 IO 量的。</p><p>4.尽量用 join 代替子查询</p><p>　　虽然 Join 性能并不佳，但是和 MySQL 的子查询比起来还是有非常大的性能优势。MySQL 的子查询执行计划一直存在较大的问题，虽然这个问题已经存在多年，但是到目前已经发布的所有稳定版本中都普遍存在，一直没有太大改善。虽然官方也在很早就承认这一问题，并且承诺尽快解决，但是至少到目前为止我们还没有看到哪一个版本较好的解决了这一问题。</p><p>5.尽量少 or</p><p>　　当 where 子句中存在多个条件以“或”并存的时候，MySQL 的优化器并没有很好的解决其执行计划优化问题，再加上 MySQL 特有的 SQL 与 Storage 分层架构方式，造成了其性能比较低下，很多时候使用 union all 或者是union(必要的时候)的方式来代替“or”会得到更好的效果。</p><p>6.尽量用 union all 代替 union</p><p>　　union 和 union all 的差异主要是前者需要将两个(或者多个)结果集合并后再进行唯一性过滤操作，这就会涉及到排序，增加大量的 CPU 运算，加大资源消耗及延迟。所以当我们可以确认不可能出现重复结果集或者不在乎重复结果集的时候，尽量使用 union all 而不是 union。</p><p>7.尽量早过滤</p><p>　　这一优化策略其实最常见于索引的优化设计中(将过滤性更好的字段放得更靠前)。</p><p>　　在 SQL 编写中同样可以使用这一原则来优化一些 Join 的 SQL。比如我们在多个表进行分页数据查询的时候，我们最好是能够在一个表上先过滤好数据分好页，然后再用分好页的结果集与另外的表 Join，这样可以尽可能多的减少不必要的 IO 操作，大大节省 IO 操作所消耗的时间。</p><p>8.避免类型转换</p><p>　　这里所说的“类型转换”是指 where 子句中出现 column 字段的类型和传入的参数类型不一致的时候发生的类型转换：</p><p>　　人为在column_name 上通过转换函数进行转换</p><p>　　直接导致 MySQL(实际上其他数据库也会有同样的问题)无法使用索引，如果非要转换，应该在传入的参数上进行转换</p><p>　　由数据库自己进行转换</p><p>　　如果我们传入的数据类型和字段类型不一致，同时我们又没有做任何类型转换处理，MySQL 可能会自己对我们的数据进行类型转换操作，也可能不进行处理而交由存储引擎去处理，这样一来，就会出现索引无法使用的情况而造成执行计划问题。</p><p>9.优先优化高并发的 SQL，而不是执行频率低某些“大”SQL</p><p>　　对于破坏性来说，高并发的 SQL 总是会比低频率的来得大，因为高并发的 SQL 一旦出现问题，甚至不会给我们任何喘息的机会就会将系统压跨。而对于一些虽然需要消耗大量 IO 而且响应很慢的 SQL，由于频率低，即使遇到，最多就是让整个系统响应慢一点，但至少可能撑一会儿，让我们有缓冲的机会。</p><p>10.从全局出发优化，而不是片面调整</p><p>　　SQL 优化不能是单独针对某一个进行，而应充分考虑系统中所有的 SQL，尤其是在通过调整索引优化 SQL 的执行计划的时候，千万不能顾此失彼，因小失大。</p><p>11.尽可能对每一条运行在数据库中的SQL进行 explain</p><p>　　优化 SQL，需要做到心中有数，知道 SQL 的执行计划才能判断是否有优化余地，才能判断是否存在执行计划问题。在对数据库中运行的 SQL 进行了一段时间的优化之后，很明显的问题 SQL 可能已经很少了，大多都需要去发掘，这时候就需要进行大量的 explain 操作收集执行计划，并判断是否需要进行优化。</p><h2 id="通用语法及分类"><a href="#通用语法及分类" class="headerlink" title="通用语法及分类"></a>通用语法及分类</h2><ul><li><code>DDL</code>: 数据定义语言，用来定义数据库对象（数据库、表、字段）</li><li><code>DML</code>: 数据操作语言，用来对数据库表中的数据进行增删改</li><li><code>DQL</code>: 数据查询语言，用来查询数据库中表的记录</li><li><code>DCL</code>: 数据控制语言，用来创建数据库用户、控制数据库的控制权限</li></ul><h3 id="DDL（数据定义语言）"><a href="#DDL（数据定义语言）" class="headerlink" title="DDL（数据定义语言）"></a>DDL（数据定义语言）</h3><h4 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h4><p>查询所有数据库：<br><code>SHOW DATABASES;</code><br>查询当前数据库：<br><code>SELECT DATABASE();</code><br>创建数据库：<br><code>CREATE DATABASE [ IF NOT EXISTS ] 数据库名 [ DEFAULT CHARSET 字符集] [COLLATE 排序规则 ];</code><br>删除数据库：<br><code>DROP DATABASE [ IF EXISTS ] 数据库名;</code><br>使用数据库：<br><code>USE 数据库名;</code></p><h5 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h5><ul><li>UTF8字符集长度为3字节，有些符号占4字节，所以推荐用<strong>utf8mb4</strong>字符集</li></ul><h4 id="表操作"><a href="#表操作" class="headerlink" title="表操作"></a>表操作</h4><p>查询当前数据库所有表：<br><code>SHOW TABLES;</code></p><pre class="line-numbers language-sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">----------------+</span><span class="token operator">|</span> Tables_in_mydb <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">----------------+</span><span class="token operator">|</span> Course         <span class="token operator">|</span><span class="token operator">|</span> Score          <span class="token operator">|</span><span class="token operator">|</span> Student        <span class="token operator">|</span><span class="token operator">|</span> Teacher        <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">----------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>查询表结构：<br><code>DESC 表名;</code></p><pre class="line-numbers language-sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">desc</span> Student<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">---------+-------------+------+-----+---------+-------+</span><span class="token operator">|</span> Field   <span class="token operator">|</span> <span class="token keyword">Type</span>        <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">---------+-------------+------+-----+---------+-------+</span><span class="token operator">|</span> s_id    <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> PRI <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>       <span class="token operator">|</span><span class="token operator">|</span> s_name  <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span>         <span class="token operator">|</span>       <span class="token operator">|</span><span class="token operator">|</span> s_birth <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span>         <span class="token operator">|</span>       <span class="token operator">|</span><span class="token operator">|</span> s_sex   <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span>         <span class="token operator">|</span>       <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">---------+-------------+------+-----+---------+-------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>查询指定表的建表语句：<br><code>SHOW CREATE TABLE 表名;</code></p><p>创建表：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 表名<span class="token punctuation">(</span>    字段<span class="token number">1</span> 字段<span class="token number">1</span>类型 <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> 字段<span class="token number">1</span>注释<span class="token punctuation">]</span><span class="token punctuation">,</span>    字段<span class="token number">2</span> 字段<span class="token number">2</span>类型 <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> 字段<span class="token number">2</span>注释<span class="token punctuation">]</span><span class="token punctuation">,</span>    字段<span class="token number">3</span> 字段<span class="token number">3</span>类型 <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> 字段<span class="token number">3</span>注释<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    字段n 字段n类型 <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> 字段n注释<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span> <span class="token keyword">COMMENT</span> 表注释 <span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>最后一个字段后面没有逗号</strong></p><p>添加字段：<br><code>ALTER TABLE 表名 ADD 字段名 类型(长度) [COMMENT 注释] [约束];</code><br>例：<code>ALTER TABLE emp ADD nickname varchar(20) COMMENT '昵称';</code></p><p>修改数据类型：<br><code>ALTER TABLE 表名 MODIFY 字段名 新数据类型(长度);</code><br>修改字段名和字段类型：<br><code>ALTER TABLE 表名 CHANGE 旧字段名 新字段名 类型(长度) [COMMENT 注释] [约束];</code><br>例：将emp表的nickname字段修改为username，类型为varchar(30)<br><code>ALTER TABLE emp CHANGE nickname username varchar(30) COMMENT '昵称';</code></p><p>删除字段：<br><code>ALTER TABLE 表名 DROP 字段名;</code></p><p>修改表名：<br><code>ALTER TABLE 表名 RENAME TO 新表名</code></p><p>删除表：<br><code>DROP TABLE [IF EXISTS] 表名;</code><br>删除表，并重新创建该表：<br><code>TRUNCATE TABLE 表名;</code></p><h3 id="DML（数据操作语言）"><a href="#DML（数据操作语言）" class="headerlink" title="DML（数据操作语言）"></a>DML（数据操作语言）</h3><h4 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h4><p>指定字段：<br><code>INSERT INTO 表名 (字段名1, 字段名2, ...) VALUES (值1, 值2, ...);</code><br>全部字段：<br><code>INSERT INTO 表名 VALUES (值1, 值2, ...);</code></p><p>批量添加数据：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> 表名 <span class="token punctuation">(</span>字段名<span class="token number">1</span><span class="token punctuation">,</span> 字段名<span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>值<span class="token number">1</span><span class="token punctuation">,</span> 值<span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>值<span class="token number">1</span><span class="token punctuation">,</span> 值<span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>值<span class="token number">1</span><span class="token punctuation">,</span> 值<span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> 表名 <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>值<span class="token number">1</span><span class="token punctuation">,</span> 值<span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>值<span class="token number">1</span><span class="token punctuation">,</span> 值<span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>值<span class="token number">1</span><span class="token punctuation">,</span> 值<span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="注意事项-1"><a href="#注意事项-1" class="headerlink" title="注意事项"></a>注意事项</h5><ul><li>字符串和日期类型数据应该包含在引号中</li><li>插入的数据大小应该在字段的规定范围内</li></ul><h4 id="更新和删除数据"><a href="#更新和删除数据" class="headerlink" title="更新和删除数据"></a>更新和删除数据</h4><p>修改数据：<br><code>UPDATE 表名 SET 字段名1 = 值1, 字段名2 = 值2, ... [ WHERE 条件 ];</code><br>例：<br><code>UPDATE emp SET name = 'Jack' WHERE id = 1;</code></p><p>删除数据：<br><code>DELETE FROM 表名 [ WHERE 条件 ];</code></p><h3 id="DQL（数据查询语言）"><a href="#DQL（数据查询语言）" class="headerlink" title="DQL（数据查询语言）"></a>DQL（数据查询语言）</h3><p>语法：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span>    字段列表<span class="token keyword">FROM</span>    表名字段<span class="token keyword">WHERE</span>    条件列表<span class="token keyword">GROUP</span> <span class="token keyword">BY</span>    分组字段列表<span class="token keyword">HAVING</span>    分组后的条件列表<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>    排序字段列表<span class="token keyword">LIMIT</span>    分页参数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="基础查询"><a href="#基础查询" class="headerlink" title="基础查询"></a>基础查询</h4><p>查询多个字段：<br><code>SELECT 字段1, 字段2, 字段3, ... FROM 表名;</code><br><code>SELECT * FROM 表名;</code></p><p>设置别名：<br><code>SELECT 字段1 [ AS 别名1 ], 字段2 [ AS 别名2 ], 字段3 [ AS 别名3 ], ... FROM 表名;</code><br><code>SELECT 字段1 [ 别名1 ], 字段2 [ 别名2 ], 字段3 [ 别名3 ], ... FROM 表名;</code></p><p>去除重复记录：<br><code>SELECT DISTINCT 字段列表 FROM 表名;</code></p><p>例如：</p><pre class="line-numbers language-sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Score<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+------+---------+</span><span class="token operator">|</span> s_id <span class="token operator">|</span> c_id <span class="token operator">|</span> s_score <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+------+---------+</span><span class="token operator">|</span> <span class="token number">01</span>   <span class="token operator">|</span> <span class="token number">01</span>   <span class="token operator">|</span>      <span class="token number">80</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">01</span>   <span class="token operator">|</span> <span class="token number">02</span>   <span class="token operator">|</span>      <span class="token number">90</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">01</span>   <span class="token operator">|</span> <span class="token number">03</span>   <span class="token operator">|</span>      <span class="token number">99</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">02</span>   <span class="token operator">|</span> <span class="token number">01</span>   <span class="token operator">|</span>      <span class="token number">70</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">02</span>   <span class="token operator">|</span> <span class="token number">02</span>   <span class="token operator">|</span>      <span class="token number">60</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">02</span>   <span class="token operator">|</span> <span class="token number">03</span>   <span class="token operator">|</span>      <span class="token number">80</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">03</span>   <span class="token operator">|</span> <span class="token number">01</span>   <span class="token operator">|</span>      <span class="token number">80</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">03</span>   <span class="token operator">|</span> <span class="token number">02</span>   <span class="token operator">|</span>      <span class="token number">80</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">03</span>   <span class="token operator">|</span> <span class="token number">03</span>   <span class="token operator">|</span>      <span class="token number">80</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">04</span>   <span class="token operator">|</span> <span class="token number">01</span>   <span class="token operator">|</span>      <span class="token number">50</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">04</span>   <span class="token operator">|</span> <span class="token number">02</span>   <span class="token operator">|</span>      <span class="token number">30</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">04</span>   <span class="token operator">|</span> <span class="token number">03</span>   <span class="token operator">|</span>      <span class="token number">20</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">05</span>   <span class="token operator">|</span> <span class="token number">01</span>   <span class="token operator">|</span>      <span class="token number">76</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">05</span>   <span class="token operator">|</span> <span class="token number">02</span>   <span class="token operator">|</span>      <span class="token number">87</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">06</span>   <span class="token operator">|</span> <span class="token number">01</span>   <span class="token operator">|</span>      <span class="token number">31</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">06</span>   <span class="token operator">|</span> <span class="token number">03</span>   <span class="token operator">|</span>      <span class="token number">34</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">07</span>   <span class="token operator">|</span> <span class="token number">02</span>   <span class="token operator">|</span>      <span class="token number">89</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">07</span>   <span class="token operator">|</span> <span class="token number">03</span>   <span class="token operator">|</span>      <span class="token number">98</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">07</span>   <span class="token operator">|</span> <span class="token number">04</span>   <span class="token operator">|</span>      <span class="token number">87</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+------+---------+</span><span class="token comment" spellcheck="true">-- 去除重复学号</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> s_id <span class="token keyword">FROM</span> Score<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+</span><span class="token operator">|</span> s_id <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+</span><span class="token operator">|</span> <span class="token number">01</span>   <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">02</span>   <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">03</span>   <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">04</span>   <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">05</span>   <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">06</span>   <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">07</span>   <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>转义：<br><code>SELECT * FROM 表名 WHERE name LIKE '/_张三' ESCAPE '/'</code><br>/ 之后的_不作为通配符</p><h4 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h4><p>语法：<br><code>SELECT 字段列表 FROM 表名 WHERE 条件列表;</code></p><p>条件：</p><table><thead><tr><th>比较运算符</th><th>功能</th></tr></thead><tbody><tr><td>&gt;</td><td>大于</td></tr><tr><td>&gt;=</td><td>大于等于</td></tr><tr><td>&lt;</td><td>小于</td></tr><tr><td>&lt;=</td><td>小于等于</td></tr><tr><td>=</td><td>等于</td></tr><tr><td>&lt;&gt; 或 !=</td><td>不等于</td></tr><tr><td>BETWEEN … AND …</td><td>在某个范围内（含最小、最大值）</td></tr><tr><td>IN(…)</td><td>在in之后的列表中的值，多选一，和or查询结果等价</td></tr><tr><td>LIKE 占位符</td><td>模糊匹配（_匹配单个字符，%匹配任意个字符）</td></tr><tr><td>IS NULL</td><td>是NULL</td></tr></tbody></table><table><thead><tr><th>逻辑运算符</th><th>功能</th></tr></thead><tbody><tr><td>AND 或 &amp;&amp;</td><td>并且（多个条件同时成立）</td></tr><tr><td>OR 或 ||</td><td>或者（多个条件任意一个成立）</td></tr><tr><td>NOT 或 !</td><td>非，不是</td></tr></tbody></table><p>例子：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 年龄等于30</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> age <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 年龄小于30</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> age <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 小于等于</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> age <span class="token operator">&lt;=</span> <span class="token number">30</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 没有身份证</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> idcard <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token operator">or</span> idcard <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 有身份证</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> idcard<span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> idcard <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 不等于</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> age <span class="token operator">!=</span> <span class="token number">30</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 年龄在20到30之间</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> age <span class="token operator">between</span> <span class="token number">20</span> <span class="token operator">and</span> <span class="token number">30</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> age <span class="token operator">>=</span> <span class="token number">20</span> <span class="token operator">and</span> age <span class="token operator">&lt;=</span> <span class="token number">30</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 下面语句不报错，但查不到任何信息</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> age <span class="token operator">between</span> <span class="token number">30</span> <span class="token operator">and</span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 性别为女且年龄小于30</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> age <span class="token operator">&lt;</span> <span class="token number">30</span> <span class="token operator">and</span> gender <span class="token operator">=</span> <span class="token string">'女'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 年龄等于25或30或35</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> age <span class="token operator">=</span> <span class="token number">25</span> <span class="token operator">or</span> age <span class="token operator">=</span> <span class="token number">30</span> <span class="token operator">or</span> age <span class="token operator">=</span> <span class="token number">35</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> age <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 姓名为两个字</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">'__'</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">-- 下滑线代表单个字符</span><span class="token comment" spellcheck="true">-- 身份证最后为X</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> idcard <span class="token operator">like</span> <span class="token string">'%X'</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">-- 百分号代表任意字符</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="聚合查询（聚合函数）"><a href="#聚合查询（聚合函数）" class="headerlink" title="聚合查询（聚合函数）"></a>聚合查询（聚合函数）</h4><p>搭配分组查询使用。</p><p>将一列数据作为一个整体，进行纵向计算。</p><p>常见聚合函数：</p><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>count</td><td>统计数量</td></tr><tr><td>max</td><td>最大值</td></tr><tr><td>min</td><td>最小值</td></tr><tr><td>avg</td><td>平均值</td></tr><tr><td>sum</td><td>求和</td></tr></tbody></table><p>语法：<br><code>SELECT 聚合函数(字段列表) FROM 表名;</code><br>例：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 01学生的课程号和分数都是不同的，所以聚合时不能筛选，而共有的重复数据则可以选择</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> Score <span class="token keyword">WHERE</span> s_id <span class="token operator">=</span> <span class="token string">"01"</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+------+---------+</span><span class="token operator">|</span> s_id <span class="token operator">|</span> c_id <span class="token operator">|</span> s_score <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+------+---------+</span><span class="token operator">|</span> <span class="token number">01</span>   <span class="token operator">|</span> <span class="token number">01</span>   <span class="token operator">|</span>      <span class="token number">80</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">01</span>   <span class="token operator">|</span> <span class="token number">02</span>   <span class="token operator">|</span>      <span class="token number">90</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">01</span>   <span class="token operator">|</span> <span class="token number">03</span>   <span class="token operator">|</span>      <span class="token number">99</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+------+---------+</span><span class="token comment" spellcheck="true">-- 计算学号01学生的平均成绩</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> s_id<span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>s_score<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">"平均成绩"</span> <span class="token keyword">from</span> Score <span class="token keyword">WHERE</span> s_id <span class="token operator">=</span> <span class="token string">"01"</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+--------------+</span><span class="token operator">|</span> s_id <span class="token operator">|</span>    平均成绩   <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+--------------+</span><span class="token operator">|</span> <span class="token number">01</span>   <span class="token operator">|</span>      <span class="token number">89.6667</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+--------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h4><p>一般求分组字段和聚合函数的字段。</p><p>语法：<br><code>SELECT 字段列表 FROM 表名 [ WHERE 条件 ] GROUP BY 分组字段名 [ HAVING 分组后的过滤条件 ];</code></p><p>where 和 having 的区别：</p><ul><li>执行时机不同：where是分组之前进行过滤，<code>不满足where条件不参与分组</code>；having是分组后对结果进行过滤。</li><li>判断条件不同：where不能对聚合函数进行判断，而having可以。</li></ul><p>例子：</p><pre class="line-numbers language-sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+--------+------------+-------+</span><span class="token operator">|</span> s_id <span class="token operator">|</span> s_name <span class="token operator">|</span> s_birth    <span class="token operator">|</span> s_sex <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+--------+------------+-------+</span><span class="token operator">|</span> <span class="token number">01</span>   <span class="token operator">|</span> 赵雷   <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> 男    <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">02</span>   <span class="token operator">|</span> 钱电   <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">21</span> <span class="token operator">|</span> 男    <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">03</span>   <span class="token operator">|</span> 孙风   <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">20</span> <span class="token operator">|</span> 男    <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">04</span>   <span class="token operator">|</span> 李云   <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">06</span> <span class="token operator">|</span> 男    <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">05</span>   <span class="token operator">|</span> 周梅   <span class="token operator">|</span> <span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> 女    <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">06</span>   <span class="token operator">|</span> 吴兰   <span class="token operator">|</span> <span class="token number">1992</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> 女    <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">07</span>   <span class="token operator">|</span> 郑竹   <span class="token operator">|</span> <span class="token number">1989</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> 女    <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">08</span>   <span class="token operator">|</span> 王菊   <span class="token operator">|</span> <span class="token number">1990</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">20</span> <span class="token operator">|</span> 女    <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+--------+------------+-------+</span><span class="token comment" spellcheck="true">-- 根据性别分组，统计男性和女性数量（只显示分组数量，不显示哪个是男哪个是女）</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> Student <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> s_sex<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">----------+</span><span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">----------+</span><span class="token operator">|</span>        <span class="token number">4</span> <span class="token operator">|</span><span class="token operator">|</span>        <span class="token number">4</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">----------+</span><span class="token comment" spellcheck="true">-- 根据性别分组，统计男性和女性数量</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> s_sex<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">"人数"</span> <span class="token keyword">FROM</span> Student <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> s_sex<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">-------+--------+</span><span class="token operator">|</span> s_sex <span class="token operator">|</span> 人数   <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">-------+--------+</span><span class="token operator">|</span> 男    <span class="token operator">|</span>      <span class="token number">4</span> <span class="token operator">|</span><span class="token operator">|</span> 女    <span class="token operator">|</span>      <span class="token number">4</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">-------+--------+</span><span class="token comment" spellcheck="true">-- 年龄小于45，并根据工作地址分组</span><span class="token keyword">select</span> workaddress<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> age <span class="token operator">&lt;</span> <span class="token number">45</span> <span class="token keyword">group</span> <span class="token keyword">by</span> workaddress<span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 年龄小于45，并根据工作地址分组，获取员工数量大于等于3的工作地址</span><span class="token keyword">select</span> workaddress<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> address_count <span class="token keyword">from</span> employee <span class="token keyword">where</span> age <span class="token operator">&lt;</span> <span class="token number">45</span> <span class="token keyword">group</span> <span class="token keyword">by</span> workaddress <span class="token punctuation">`</span><span class="token keyword">having</span> address_count <span class="token operator">>=</span> <span class="token number">3</span><span class="token punctuation">`</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">-- having 后可以使用聚合函数的结果而where不可以</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="注意事项-2"><a href="#注意事项-2" class="headerlink" title="注意事项"></a>注意事项</h5><ul><li>执行顺序：where &gt; 聚合函数 &gt; having</li><li>分组之后，查询的字段一般为聚合函数和分组字段，查询其他字段无任何意义</li></ul><h4 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h4><p>语法：<br><code>SELECT 字段列表 FROM 表名 ORDER BY 字段1 排序方式1 [, 字段2 排序方式2];</code></p><p>排序方式：</p><ul><li>ASC: 升序（<strong>默认</strong>）</li><li><code>DESC</code>: 降序</li></ul><p>例子：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 根据年龄升序排序</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employee <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> age <span class="token keyword">ASC</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employee <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> age<span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 两字段排序，根据年龄升序排序，入职时间降序排序</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employee <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> age <span class="token keyword">ASC</span><span class="token punctuation">,</span> entrydate <span class="token keyword">DESC</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="注意事项-3"><a href="#注意事项-3" class="headerlink" title="注意事项"></a>注意事项</h5><p>如果是多字段排序，当第一个字段值相同时，才会根据第二个字段进行排序</p><h4 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h4><p>语法：<br><code>SELECT 字段列表 FROM 表名 LIMIT 起始索引, 查询记录数;</code></p><p>例子：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 查询第一页数据，展示10条</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employee <span class="token keyword">LIMIT</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 查询第二页</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employee <span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="注意事项-4"><a href="#注意事项-4" class="headerlink" title="注意事项"></a>注意事项</h5><ul><li>起始索引从0开始，起始索引 = （查询页码 - 1） * 每页显示记录数</li><li>分页查询是数据库的方言，不同数据库有不同实现，MySQL是LIMIT</li><li>如果查询的是第一页数据，起始索引可以省略，直接简写 LIMIT 10</li></ul><h4 id="DQL执行顺序"><a href="#DQL执行顺序" class="headerlink" title="DQL执行顺序"></a>DQL执行顺序</h4><p>from先找到表，where确定数据范围，group by对所选数据进行分组，select选择要返回的字段，order by指定排序，最后根据limit的索引和范围返回数据。</p><p>FROM -&gt; WHERE -&gt; GROUP BY -&gt; SELECT -&gt; ORDER BY -&gt; LIMIT</p><h3 id="DCL"><a href="#DCL" class="headerlink" title="DCL"></a>DCL</h3><h4 id="管理用户"><a href="#管理用户" class="headerlink" title="管理用户"></a>管理用户</h4><p>查询用户：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">USE</span> mysql<span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>创建用户:<br><code>CREATE USER '用户名'@'主机名' IDENTIFIED BY '密码';</code></p><p>修改用户密码：<br><code>ALTER USER '用户名'@'主机名' IDENTIFIED WITH mysql_native_password BY '新密码';</code></p><p>删除用户：<br><code>DROP USER '用户名'@'主机名';</code></p><p>例子：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 创建用户test，只能在当前主机localhost访问</span><span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">'test'</span>@'localhost<span class="token string">' identified by '</span><span class="token number">123456</span>'<span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 创建用户test，能在任意主机访问</span><span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">'test'</span>@'<span class="token operator">%</span><span class="token string">' identified by '</span><span class="token number">123456</span><span class="token string">';create user '</span>test<span class="token string">' identified by '</span><span class="token number">123456</span>'<span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 修改密码                                     加密方式：mysql_native_password</span><span class="token keyword">alter</span> <span class="token keyword">user</span> <span class="token string">'test'</span>@'localhost<span class="token string">' identified with mysql_native_password by '</span><span class="token number">1234</span>'<span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 删除用户</span><span class="token keyword">drop</span> <span class="token keyword">user</span> <span class="token string">'test'</span><span class="token variable">@'localhost'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="注意事项-5"><a href="#注意事项-5" class="headerlink" title="注意事项"></a>注意事项</h5><ul><li>主机名可以使用 % 通配</li></ul><h4 id="权限控制"><a href="#权限控制" class="headerlink" title="权限控制"></a>权限控制</h4><p>常用权限：</p><table><thead><tr><th>权限</th><th>说明</th></tr></thead><tbody><tr><td>ALL, ALL PRIVILEGES</td><td>所有权限</td></tr><tr><td>SELECT</td><td>查询数据</td></tr><tr><td>INSERT</td><td>插入数据</td></tr><tr><td>UPDATE</td><td>修改数据</td></tr><tr><td>DELETE</td><td>删除数据</td></tr><tr><td>ALTER</td><td>修改表</td></tr><tr><td>DROP</td><td>删除数据库/表/视图</td></tr><tr><td>CREATE</td><td>创建数据库/表</td></tr></tbody></table><p>查询权限：<br><code>SHOW GRANTS FOR '用户名'@'主机名';</code></p><p>授予权限：<br><code>GRANT 权限列表 ON 数据库名.表名 TO '用户名'@'主机名';</code></p><p>撤销权限：<br><code>REVOKE 权限列表 ON 数据库名.表名 FROM '用户名'@'主机名';</code></p><pre class="line-numbers language-sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> <span class="token string">'ravi'</span><span class="token variable">@'localhost'</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------------------------------------------+</span><span class="token operator">|</span> Grants <span class="token keyword">for</span> ravi<span class="token variable">@localhost</span>                <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------------------------------------------+</span><span class="token operator">|</span> <span class="token keyword">GRANT</span> <span class="token keyword">USAGE</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token punctuation">`</span>ravi<span class="token punctuation">`</span><span class="token variable">@`localhost`</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------------------------------------------+</span>mysql<span class="token operator">></span> <span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">ON</span> myDb<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'ravi'</span>@'localhost<span class="token string">';Query OK, 0 rows affected (0.00 sec)mysql> GRANT ALL ON checkup.* to '</span>ravi<span class="token string">'@'</span>localhost'<span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span><span class="token comment" spellcheck="true">-- 登陆</span>mysql <span class="token operator">-</span>u ravi <span class="token operator">-</span>pWelcome <span class="token keyword">to</span> the MySQL monitor<span class="token punctuation">.</span>  Commands <span class="token keyword">end</span> <span class="token keyword">with</span> <span class="token punctuation">;</span> <span class="token operator">or</span> \g<span class="token punctuation">.</span>Your MySQL connection id <span class="token operator">is</span> <span class="token number">18</span>mysql<span class="token operator">></span> <span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">--------------------+</span><span class="token operator">|</span> <span class="token keyword">Database</span>           <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">--------------------+</span><span class="token operator">|</span> checkup            <span class="token operator">|</span><span class="token operator">|</span> information_schema <span class="token operator">|</span><span class="token operator">|</span> myDb               <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">--------------------+</span><span class="token comment" spellcheck="true">-- 撤销权限</span>mysql<span class="token operator">></span> <span class="token keyword">REVOKE</span> <span class="token keyword">ALL</span> <span class="token keyword">ON</span> checkup<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token string">'ravi'</span><span class="token variable">@'localhost'</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">--------------------+</span><span class="token operator">|</span> <span class="token keyword">Database</span>           <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">--------------------+</span><span class="token operator">|</span> information_schema <span class="token operator">|</span><span class="token operator">|</span> myDb               <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">--------------------+</span><span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="注意事项-6"><a href="#注意事项-6" class="headerlink" title="注意事项"></a>注意事项</h5><ul><li>多个权限用逗号分隔</li><li>授权时，数据库名和表名可以用 * 进行通配，代表所有</li></ul><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><ul><li>字符串函数</li><li>数值函数</li><li>日期函数</li><li>流程函数</li></ul><h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><p>常用函数：</p><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>CONCAT(s1, s2, …, sn)</td><td>字符串拼接，将s1, s2, …, sn拼接成一个字符串</td></tr><tr><td>LOWER(str)</td><td>将字符串全部转为小写</td></tr><tr><td>UPPER(str)</td><td>将字符串全部转为大写</td></tr><tr><td>LPAD(str, n, pad)</td><td>左填充，用字符串pad对str的左边进行填充，达到n个字符串长度</td></tr><tr><td>RPAD(str, n, pad)</td><td>右填充，用字符串pad对str的右边进行填充，达到n个字符串长度</td></tr><tr><td>TRIM(str)</td><td>去掉字符串头部和尾部的空格</td></tr><tr><td>SUBSTRING(str, start, len)</td><td>返回从字符串str从start位置起的len个长度的字符串</td></tr></tbody></table><p>使用示例：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 拼接</span><span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token string">'World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 小写</span><span class="token keyword">SELECT</span> LOWER<span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 大写</span><span class="token keyword">SELECT</span> UPPER<span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 左填充</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> LPAD<span class="token punctuation">(</span><span class="token string">'01'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">--------------------+</span><span class="token operator">|</span> LPAD<span class="token punctuation">(</span><span class="token string">'01'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">--------------------+</span><span class="token operator">|</span> <span class="token comment" spellcheck="true">---01              |</span><span class="token operator">+</span><span class="token comment" spellcheck="true">--------------------+</span><span class="token comment" spellcheck="true">-- 右填充</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> RPAD<span class="token punctuation">(</span><span class="token string">'01'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">--------------------+</span><span class="token operator">|</span> RPAD<span class="token punctuation">(</span><span class="token string">'01'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">--------------------+</span><span class="token operator">|</span> <span class="token number">01</span><span class="token comment" spellcheck="true">---              |</span><span class="token operator">+</span><span class="token comment" spellcheck="true">--------------------+</span><span class="token comment" spellcheck="true">-- 去除空格</span><span class="token keyword">SELECT</span> TRIM<span class="token punctuation">(</span><span class="token string">' Hello World '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 切片（起始索引为1）</span><span class="token keyword">SELECT</span> SUBSTRING<span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">-- Hello</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="数值函数"><a href="#数值函数" class="headerlink" title="数值函数"></a>数值函数</h3><p>常见函数：</p><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>CEIL(x)</td><td>向上取整</td></tr><tr><td>FLOOR(x)</td><td>向下取整</td></tr><tr><td>MOD(x, y)</td><td>返回x/y的模</td></tr><tr><td>RAND()</td><td>返回0~1内的随机数</td></tr><tr><td>ROUND(x, y)</td><td>求参数x的四舍五入值，保留y位小数</td></tr></tbody></table><pre class="line-numbers language-sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> LPAD<span class="token punctuation">(</span><span class="token function">ROUND</span><span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000000</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">"验证码"</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">-----------+</span><span class="token operator">|</span> 验证码    <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">-----------+</span><span class="token operator">|</span> <span class="token number">022516</span>    <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">-----------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h3><p>常用函数：</p><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>CURDATE()</td><td>返回当前日期</td></tr><tr><td>CURTIME()</td><td>返回当前时间</td></tr><tr><td>NOW()</td><td>返回当前日期和时间</td></tr><tr><td>YEAR(date)</td><td>获取指定date的年份</td></tr><tr><td>MONTH(date)</td><td>获取指定date的月份</td></tr><tr><td>DAY(date)</td><td>获取指定date的日期</td></tr><tr><td>DATE_ADD(date, INTERVAL expr type)</td><td>返回一个日期/时间值加上一个时间间隔expr后的时间值</td></tr><tr><td>DATEDIFF(date1, date2)</td><td>返回起始时间date1和结束时间date2之间的天数</td></tr><tr><td>FROM_DAYS(number)</td><td>将日子总数转换为年月日</td></tr></tbody></table><p>例子：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- CURDATE</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">"today"</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------------+</span><span class="token operator">|</span> today      <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------------+</span><span class="token operator">|</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------------+</span><span class="token comment" spellcheck="true">-- CURTIME</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> CURTIME<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">"time"</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">----------+</span><span class="token operator">|</span> time     <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">----------+</span><span class="token operator">|</span> <span class="token number">20</span>:<span class="token number">26</span>:<span class="token number">02</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">----------+</span><span class="token comment" spellcheck="true">-- NOW</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">"now"</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">---------------------+</span><span class="token operator">|</span> now                 <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">---------------------+</span><span class="token operator">|</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">20</span>:<span class="token number">26</span>:<span class="token number">33</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">---------------------+</span><span class="token comment" spellcheck="true">-- year</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> YEAR<span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">"year"</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+</span><span class="token operator">|</span> year <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+</span><span class="token operator">|</span> <span class="token number">2022</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+</span><span class="token comment" spellcheck="true">-- DATE_ADD</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> DATE_ADD<span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> INTERVAL <span class="token number">70</span> YEAR<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">"70years later"</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">---------------------+</span><span class="token operator">|</span> 70years later       <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">---------------------+</span><span class="token operator">|</span> <span class="token number">2092</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">20</span>:<span class="token number">28</span>:<span class="token number">56</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">---------------------+</span><span class="token comment" spellcheck="true">-- DATEDIFF</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> DATEDIFF<span class="token punctuation">(</span><span class="token string">'2022-9-17'</span><span class="token punctuation">,</span> <span class="token string">'2021-12-10'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">"diff"</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+</span><span class="token operator">|</span> diff <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+</span><span class="token operator">|</span>  <span class="token number">281</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+</span><span class="token comment" spellcheck="true">-- 查询所有学生的年龄，并且根据年龄倒叙排序</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> s_id<span class="token punctuation">,</span> s_name<span class="token punctuation">,</span> YEAR<span class="token punctuation">(</span>FROM_DAYS<span class="token punctuation">(</span>DATEDIFF<span class="token punctuation">(</span>CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> s_birth<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> s_age <span class="token keyword">FROM</span> Student<span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> s_id<span class="token punctuation">,</span> s_name<span class="token punctuation">,</span> TIMESTAMPDIFF<span class="token punctuation">(</span>YEAR<span class="token punctuation">,</span>s_birth<span class="token punctuation">,</span>CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> s_age <span class="token keyword">FROM</span>Student<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+--------+-------+</span><span class="token operator">|</span> s_id <span class="token operator">|</span> s_name <span class="token operator">|</span> s_age <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+--------+-------+</span><span class="token operator">|</span> <span class="token number">01</span>   <span class="token operator">|</span> 赵雷   <span class="token operator">|</span>    <span class="token number">32</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">02</span>   <span class="token operator">|</span> 钱电   <span class="token operator">|</span>    <span class="token number">31</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">03</span>   <span class="token operator">|</span> 孙风   <span class="token operator">|</span>    <span class="token number">32</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">04</span>   <span class="token operator">|</span> 李云   <span class="token operator">|</span>    <span class="token number">32</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">05</span>   <span class="token operator">|</span> 周梅   <span class="token operator">|</span>    <span class="token number">30</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">06</span>   <span class="token operator">|</span> 吴兰   <span class="token operator">|</span>    <span class="token number">30</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">07</span>   <span class="token operator">|</span> 郑竹   <span class="token operator">|</span>    <span class="token number">33</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">08</span>   <span class="token operator">|</span> 王菊   <span class="token operator">|</span>    <span class="token number">32</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------+--------+-------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="流程函数"><a href="#流程函数" class="headerlink" title="流程函数"></a>流程函数</h3><p>常用函数：</p><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>IF(value, t, f)</td><td>如果value为true，则返回t，否则返回f</td></tr><tr><td>IFNULL(value1, value2)</td><td>如果value1不为空，返回value1，否则返回value2</td></tr><tr><td>CASE WHEN [ val1 ] THEN [ res1 ] … ELSE [ default ] END</td><td>如果val1为true，返回res1，… 否则返回default默认值</td></tr><tr><td>CASE [ expr ] WHEN [ val1 ] THEN [ res1 ] … ELSE [ default ] END</td><td>如果expr的值等于val1，返回res1，… 否则返回default默认值</td></tr></tbody></table><p>例子：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- IFNULL</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> IFNULL<span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">,</span><span class="token string">'default'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">-- 不为空</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------------------------+</span><span class="token operator">|</span> IFNULL<span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">,</span><span class="token string">'default'</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------------------------+</span><span class="token operator">|</span> ok                     <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------------------------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> IFNULL<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token string">'default'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">-- 空串，返回空串</span><span class="token operator">+</span><span class="token comment" spellcheck="true">----------------------+</span><span class="token operator">|</span> IFNULL<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token string">'default'</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">----------------------+</span><span class="token operator">|</span>                      <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">----------------------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> IFNULL<span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">'default'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">-- null</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------------------------+</span><span class="token operator">|</span> IFNULL<span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">'default'</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------------------------+</span><span class="token operator">|</span> <span class="token keyword">default</span>                <span class="token operator">|</span><span class="token operator">+</span><span class="token comment" spellcheck="true">------------------------+</span><span class="token keyword">select</span>    name<span class="token punctuation">,</span>    <span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> age <span class="token operator">></span> <span class="token number">30</span> <span class="token keyword">then</span> <span class="token string">'中年'</span> <span class="token keyword">else</span> <span class="token string">'青年'</span> <span class="token keyword">end</span><span class="token punctuation">)</span><span class="token keyword">from</span> employee<span class="token punctuation">;</span><span class="token keyword">select</span>    name<span class="token punctuation">,</span>    <span class="token punctuation">(</span><span class="token keyword">case</span> workaddress <span class="token keyword">when</span> <span class="token string">'北京市'</span> <span class="token keyword">then</span> <span class="token string">'一线城市'</span> <span class="token keyword">when</span> <span class="token string">'上海市'</span> <span class="token keyword">then</span> <span class="token string">'一线城市'</span> <span class="token keyword">else</span> <span class="token string">'二线城市'</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'工作地址'</span><span class="token keyword">from</span> employee<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h2><p>分类：</p><table><thead><tr><th>约束</th><th>描述</th><th>关键字</th></tr></thead><tbody><tr><td>非空约束</td><td>限制该字段的数据不能为null</td><td>NOT NULL</td></tr><tr><td>唯一约束</td><td>保证该字段的所有数据都是唯一、不重复的</td><td>UNIQUE</td></tr><tr><td>主键约束</td><td>主键是一行数据的唯一标识，要求非空且唯一</td><td>PRIMARY KEY</td></tr><tr><td>默认约束</td><td>保存数据时，如果未指定该字段的值，则采用默认值</td><td>DEFAULT</td></tr><tr><td>检查约束（8.0.1版本后）</td><td>保证字段值满足某一个条件</td><td>CHECK</td></tr><tr><td>外键约束</td><td>用来让两张图的数据之间建立连接，保证数据的一致性和完整性</td><td>FOREIGN KEY</td></tr></tbody></table><p>约束是作用于表中字段上的，可以再创建表/修改表的时候添加约束。</p><h3 id="常用约束"><a href="#常用约束" class="headerlink" title="常用约束"></a>常用约束</h3><table><thead><tr><th>约束条件</th><th>关键字</th></tr></thead><tbody><tr><td>主键</td><td>PRIMARY KEY</td></tr><tr><td>自动增长</td><td>AUTO_INCREMENT</td></tr><tr><td>不为空</td><td>NOT NULL</td></tr><tr><td>唯一</td><td>UNIQUE</td></tr><tr><td>逻辑条件</td><td>CHECK</td></tr><tr><td>默认值</td><td>DEFAULT</td></tr></tbody></table><p>例子：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">user</span><span class="token punctuation">(</span>    id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>    name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">unique</span><span class="token punctuation">,</span>    age <span class="token keyword">int</span> <span class="token keyword">check</span><span class="token punctuation">(</span>age <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">and</span> age <span class="token operator">&lt;</span> <span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">status</span> char<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">'1'</span><span class="token punctuation">,</span>    gender char<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h3><p>添加外键：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 表名<span class="token punctuation">(</span>    字段名 字段类型<span class="token punctuation">,</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">[</span><span class="token keyword">CONSTRAINT</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>外键名称<span class="token punctuation">]</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>外键字段名<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> 主表<span class="token punctuation">(</span>主表列名<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> 外键名称 <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>外键字段名<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> 主表<span class="token punctuation">(</span>主表列名<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 例子</span><span class="token keyword">alter</span> <span class="token keyword">table</span> emp <span class="token keyword">add</span> <span class="token keyword">constraint</span> fk_emp_dept_id <span class="token keyword">foreign</span> <span class="token keyword">key</span><span class="token punctuation">(</span>dept_id<span class="token punctuation">)</span> <span class="token keyword">references</span> dept<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>删除外键：<br><code>ALTER TABLE 表名 DROP FOREIGN KEY 外键名;</code></p><h4 id="删除-更新行为"><a href="#删除-更新行为" class="headerlink" title="删除/更新行为"></a>删除/更新行为</h4><table><thead><tr><th>行为</th><th>说明</th></tr></thead><tbody><tr><td>NO ACTION</td><td>当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除/更新（与RESTRICT一致）</td></tr><tr><td>RESTRICT</td><td>当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除/更新（与NO ACTION一致）</td></tr><tr><td>CASCADE</td><td>当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有则也删除/更新外键在子表中的记录</td></tr><tr><td>SET NULL</td><td>当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有则设置子表中该外键值为null（要求该外键允许为null）</td></tr><tr><td>SET DEFAULT</td><td>父表有变更时，子表将外键设为一个默认值（Innodb不支持）</td></tr></tbody></table><p>更改删除/更新行为：<br><code>ALTER TABLE 表名 ADD CONSTRAINT 外键名称 FOREIGN KEY (外键字段) REFERENCES 主表名(主表字段名) ON UPDATE 行为 ON DELETE 行为;</code></p><h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><h3 id="多表关系"><a href="#多表关系" class="headerlink" title="多表关系"></a>多表关系</h3><ul><li>一对多（多对一）</li><li>多对多</li><li>一对一</li></ul><h4 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h4><p>案例：部门与员工<br>关系：一个部门对应多个员工，一个员工对应一个部门<br>实现：在多的一方建立外键，关联一的一方的主键</p><h4 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h4><p>案例：学生与课程<br>关系：一个学生可以选多门课程，一门课程也可以供多个学生选修<br>实现：建立第三张中间表student_course，中间表至少包含两个外键，分别关联两方主键</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img2022.cnblogs.com/blog/2766516/202209/2766516-20220922155511399-1141192819.png" alt="image"></p><h4 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h4><p>案例：用户与用户详情<br>关系：一对一关系，多用于<code>单表拆分</code>，将一张表的基础字段放在一张表中，其他详情字段放在另一张表中，以提升操作效率<br>实现：在任意一方加入外键，关联另外一方的主键，并且设置外键为唯一的（UNIQUE）</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img2022.cnblogs.com/blog/2766516/202209/2766516-20220922155546461-1018107930.png" alt="image"></p><h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><p>合并查询（笛卡尔积，会展示所有组合结果）：<br><code>select * from employee, dept;</code></p><blockquote><p>笛卡尔积：两个集合A集合和B集合的所有组合情况（在多表查询时，需要消除无效的笛卡尔积）</p></blockquote><p>消除无效笛卡尔积：<br><code>select * from employee, dept where employee.dept = dept.id;</code></p><h3 id="内连接查询"><a href="#内连接查询" class="headerlink" title="内连接查询"></a>内连接查询</h3><p>内连接查询的是两张表交集的部分</p><p>如果有数据不满足相交条件，则不会被查询到。</p><p>隐式内连接：<br><code>SELECT 字段列表 FROM 表1, 表2 WHERE 条件 ...;</code></p><p>显式内连接：<br><code>SELECT 字段列表 FROM 表1 [ INNER ] JOIN 表2 ON 连接条件 ...;</code></p><p>显式性能比隐式高</p><p>例子：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 查询员工姓名，及关联的部门的名称</span><span class="token comment" spellcheck="true">-- 隐式</span><span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token number">d</span><span class="token punctuation">.</span>name <span class="token keyword">from</span> employee <span class="token keyword">as</span> <span class="token number">e</span><span class="token punctuation">,</span> dept <span class="token keyword">as</span> <span class="token number">d</span> <span class="token keyword">where</span> <span class="token number">e</span><span class="token punctuation">.</span>dept <span class="token operator">=</span> <span class="token number">d</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 显式</span><span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token number">d</span><span class="token punctuation">.</span>name <span class="token keyword">from</span> employee <span class="token keyword">as</span> <span class="token number">e</span> <span class="token keyword">inner</span> <span class="token keyword">join</span> dept <span class="token keyword">as</span> <span class="token number">d</span> <span class="token keyword">on</span> <span class="token number">e</span><span class="token punctuation">.</span>dept <span class="token operator">=</span> <span class="token number">d</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="外连接查询"><a href="#外连接查询" class="headerlink" title="外连接查询"></a>外连接查询</h3><p>左外连接：<br>查询左表所有数据，以及两张表交集部分数据<br><code>SELECT 字段列表 FROM 表1 LEFT [ OUTER ] JOIN 表2 ON 条件 ...;</code><br>相当于查询表1的所有数据，包含表1和表2交集部分数据</p><p>右外连接：<br>查询右表所有数据，以及两张表交集部分数据<br><code>SELECT 字段列表 FROM 表1 RIGHT [ OUTER ] JOIN 表2 ON 条件 ...;</code></p><p>例子：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 左</span><span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token number">d</span><span class="token punctuation">.</span>name <span class="token keyword">from</span> employee <span class="token keyword">as</span> <span class="token number">e</span> <span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> dept <span class="token keyword">as</span> <span class="token number">d</span> <span class="token keyword">on</span> <span class="token number">e</span><span class="token punctuation">.</span>dept <span class="token operator">=</span> <span class="token number">d</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token number">d</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token number">e</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> dept <span class="token number">d</span> <span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> emp <span class="token number">e</span> <span class="token keyword">on</span> <span class="token number">e</span><span class="token punctuation">.</span>dept <span class="token operator">=</span> <span class="token number">d</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">-- 这条语句与下面的语句效果一样</span><span class="token comment" spellcheck="true">-- 右</span><span class="token keyword">select</span> <span class="token number">d</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token number">e</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">as</span> <span class="token number">e</span> <span class="token keyword">right</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> dept <span class="token keyword">as</span> <span class="token number">d</span> <span class="token keyword">on</span> <span class="token number">e</span><span class="token punctuation">.</span>dept <span class="token operator">=</span> <span class="token number">d</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>左连接可以查询到没有dept的employee，右连接可以查询到没有employee的dept</p><h3 id="自连接查询"><a href="#自连接查询" class="headerlink" title="自连接查询"></a>自连接查询</h3><p>当前表与自身的连接查询，自连接必须使用表别名</p><p>语法：<br><code>SELECT 字段列表 FROM 表A 别名A JOIN 表A 别名B ON 条件 ...;</code></p><p>自连接查询，可以是内连接查询，也可以是外连接查询</p><p>例子：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 查询员工及其所属领导的名字</span><span class="token keyword">select</span> <span class="token number">a</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token number">b</span><span class="token punctuation">.</span>name <span class="token keyword">from</span> employee <span class="token number">a</span><span class="token punctuation">,</span> employee <span class="token number">b</span> <span class="token keyword">where</span> <span class="token number">a</span><span class="token punctuation">.</span>manager <span class="token operator">=</span> <span class="token number">b</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 没有领导的也查询出来</span><span class="token keyword">select</span> <span class="token number">a</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token number">b</span><span class="token punctuation">.</span>name <span class="token keyword">from</span> employee <span class="token number">a</span> <span class="token keyword">left</span> <span class="token keyword">join</span> employee <span class="token number">b</span> <span class="token keyword">on</span> <span class="token number">a</span><span class="token punctuation">.</span>manager <span class="token operator">=</span> <span class="token number">b</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="联合查询-union-union-all"><a href="#联合查询-union-union-all" class="headerlink" title="联合查询 union, union all"></a>联合查询 union, union all</h3><p>把多次查询的结果合并，形成一个新的查询集</p><p>语法：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> 字段列表 <span class="token keyword">FROM</span> 表A <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">UNION</span> <span class="token punctuation">[</span><span class="token keyword">ALL</span><span class="token punctuation">]</span><span class="token keyword">SELECT</span> 字段列表 <span class="token keyword">FROM</span> 表B <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>薪资低于5k的员工和年龄大于50的员工。</p><h4 id="注意事项-7"><a href="#注意事项-7" class="headerlink" title="注意事项"></a>注意事项</h4><ul><li>UNION ALL 会有重复结果，UNION 不会</li><li>多张表的列数和类型保持一致</li><li>联合查询比使用or效率高，不会使索引失效</li></ul><h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>SQL语句中嵌套SELECT语句，称谓嵌套查询，又称子查询。<br><code>SELECT * FROM t1 WHERE column1 = ( SELECT column1 FROM t2);</code><br><strong>子查询<code>外部</code>的语句可以是 INSERT / UPDATE / DELETE / SELECT 的任何一个</strong></p><p>根据子查询结果可以分为：</p><ul><li>标量子查询（子查询结果为单个值）</li><li>列子查询（子查询结果为一列）</li><li>行子查询（子查询结果为一行）</li><li>表子查询（子查询结果为多行多列）</li></ul><p>根据子查询位置可分为：</p><ul><li>WHERE 之后</li><li>FROM 之后</li><li>SELECT 之后</li></ul><h4 id="标量子查询"><a href="#标量子查询" class="headerlink" title="标量子查询"></a>标量子查询</h4><p>子查询返回的结果是单个值（数字、字符串、日期等）。<br>常用操作符：- &lt; &gt; &gt; &gt;= &lt; &lt;=</p><p>例子：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 查询销售部所有员工</span><span class="token comment" spellcheck="true">-- 查询销售部的部门ID</span><span class="token keyword">select</span> id <span class="token keyword">from</span> dept <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'销售部'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 根据销售部部门ID，查询员工信息</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> dept <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 合并（子查询）</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> dept <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> id <span class="token keyword">from</span> dept <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'销售部'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 查询xxx入职之后的员工信息</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> entrydate <span class="token operator">></span> <span class="token punctuation">(</span><span class="token keyword">select</span> entrydate <span class="token keyword">from</span> employee <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="列子查询"><a href="#列子查询" class="headerlink" title="列子查询"></a>列子查询</h4><p>返回的结果是一列（可以是多行）。</p><p>常用操作符：</p><table><thead><tr><th>操作符</th><th>描述</th></tr></thead><tbody><tr><td>IN</td><td>在指定的集合范围内，多选一</td></tr><tr><td>NOT IN</td><td>不在指定的集合范围内</td></tr><tr><td>ANY</td><td>子查询返回列表中，有任意一个满足即可</td></tr><tr><td>SOME</td><td>与ANY等同，使用SOME的地方都可以使用ANY</td></tr><tr><td>ALL</td><td>子查询返回列表的所有值都必须满足</td></tr></tbody></table><p>例子：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 查询销售部和市场部的所有员工信息</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> dept <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> id <span class="token keyword">from</span> dept <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'销售部'</span> <span class="token operator">or</span> name <span class="token operator">=</span> <span class="token string">'市场部'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 查询比财务部 【所有人】all 工资都高的员工信息</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> salary <span class="token operator">></span> <span class="token keyword">all</span><span class="token punctuation">(</span><span class="token keyword">select</span> salary <span class="token keyword">from</span> employee <span class="token keyword">where</span> dept <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> id <span class="token keyword">from</span> dept <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'财务部'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 查询比研发部任意一人工资高的员工信息</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> salary <span class="token operator">></span> <span class="token keyword">any</span> <span class="token punctuation">(</span><span class="token keyword">select</span> salary <span class="token keyword">from</span> employee <span class="token keyword">where</span> dept <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> id <span class="token keyword">from</span> dept <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'研发部'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="行子查询"><a href="#行子查询" class="headerlink" title="行子查询"></a>行子查询</h4><p>返回的结果是一行（可以是多列）。<br>常用操作符：=, &lt;, &gt;, IN, NOT IN</p><p>例子：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 查询与xxx的薪资及直属领导相同的员工信息</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> salary <span class="token operator">=</span> <span class="token number">12500</span> <span class="token operator">and</span> manager <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> <span class="token punctuation">(</span>salary<span class="token punctuation">,</span> manager<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">12500</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> <span class="token punctuation">(</span>salary<span class="token punctuation">,</span> manager<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> salary<span class="token punctuation">,</span> manager <span class="token keyword">from</span> employee <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="表子查询"><a href="#表子查询" class="headerlink" title="表子查询"></a>表子查询</h4><p>子查询结果是一张表</p><p>返回的结果是多行多列<br>常用操作符：IN</p><p>例子：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 查询与xxx1，xxx2的职位和薪资相同的员工</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> <span class="token punctuation">(</span>job<span class="token punctuation">,</span> salary<span class="token punctuation">)</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> job<span class="token punctuation">,</span> salary <span class="token keyword">from</span> employee <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'xxx1'</span> <span class="token operator">or</span> name <span class="token operator">=</span> <span class="token string">'xxx2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 查询入职日期是2006-01-01之后的员工，及其部门信息</span><span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token number">d</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employee <span class="token keyword">where</span> entrydate <span class="token operator">></span> <span class="token string">'2006-01-01'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token number">e</span> <span class="token keyword">left</span> <span class="token keyword">join</span> dept <span class="token keyword">as</span> <span class="token number">d</span> <span class="token keyword">on</span> <span class="token number">e</span><span class="token punctuation">.</span>dept <span class="token operator">=</span> <span class="token number">d</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>事务是一组操作的集合，事务会把所有操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。</p><p>基本操作：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 1. 查询张三账户余额</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> account <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'张三'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 2. 将张三账户余额-1000</span><span class="token keyword">update</span> account <span class="token keyword">set</span> money <span class="token operator">=</span> money <span class="token operator">-</span> <span class="token number">1000</span> <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'张三'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 此语句出错后张三钱减少但是李四钱没有增加</span>模拟sql语句错误<span class="token comment" spellcheck="true">-- 3. 将李四账户余额+1000</span><span class="token keyword">update</span> account <span class="token keyword">set</span> money <span class="token operator">=</span> money <span class="token operator">+</span> <span class="token number">1000</span> <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'李四'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 查看事务提交方式</span><span class="token keyword">SELECT</span> @<span class="token variable">@AUTOCOMMIT</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">-- 默认为1</span><span class="token comment" spellcheck="true">-- 设置事务提交方式，1为自动提交，0为手动提交，该设置只对当前会话有效</span><span class="token keyword">SET</span> @<span class="token variable">@AUTOCOMMIT</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 提交事务</span><span class="token keyword">COMMIT</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 回滚事务</span><span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- 设置手动提交后上面代码改为：</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> account <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'张三'</span><span class="token punctuation">;</span><span class="token keyword">update</span> account <span class="token keyword">set</span> money <span class="token operator">=</span> money <span class="token operator">-</span> <span class="token number">1000</span> <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'张三'</span><span class="token punctuation">;</span><span class="token keyword">update</span> account <span class="token keyword">set</span> money <span class="token operator">=</span> money <span class="token operator">+</span> <span class="token number">1000</span> <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'李四'</span><span class="token punctuation">;</span><span class="token keyword">commit</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>操作方式二：</p><p>开启事务：<br><code>START TRANSACTION 或 BEGIN TRANSACTION;</code><br>提交事务：<br><code>COMMIT;</code><br>回滚事务：<br><code>ROLLBACK;</code></p><p>操作实例：</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">start</span> <span class="token keyword">transaction</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> account <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'张三'</span><span class="token punctuation">;</span><span class="token keyword">update</span> account <span class="token keyword">set</span> money <span class="token operator">=</span> money <span class="token operator">-</span> <span class="token number">1000</span> <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'张三'</span><span class="token punctuation">;</span><span class="token keyword">update</span> account <span class="token keyword">set</span> money <span class="token operator">=</span> money <span class="token operator">+</span> <span class="token number">1000</span> <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'李四'</span><span class="token punctuation">;</span><span class="token keyword">commit</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="四大特性ACID"><a href="#四大特性ACID" class="headerlink" title="四大特性ACID"></a>四大特性ACID</h3><ul><li>原子性(Atomicity)：事务是不可分割的最小操作但愿，要么全部成功，要么全部失败</li><li>一致性(Consistency)：事务完成时，必须使所有数据都保持一致状态</li><li>隔离性(Isolation)：数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行</li><li>持久性(Durability)：事务一旦提交或回滚，它对数据库中的数据的改变就是永久的</li></ul><h3 id="并发事务"><a href="#并发事务" class="headerlink" title="并发事务"></a>并发事务</h3><table><thead><tr><th>问题</th><th>描述</th></tr></thead><tbody><tr><td>脏读</td><td>一个事务读到另一个事务还没提交的数据</td></tr><tr><td>不可重复读</td><td>一个事务先后读取同一条记录，但两次读取的数据不同</td></tr><tr><td>幻读</td><td>一个事务按照条件查询数据时，没有对应的数据行，但是再插入数据时，又发现这行数据已经存在</td></tr></tbody></table><h3 id="并发隔离级别"><a href="#并发隔离级别" class="headerlink" title="并发隔离级别"></a>并发隔离级别</h3><p>并发事务隔离级别：</p><table><thead><tr><th>隔离级别</th><th>脏读</th><th>不可重复读</th><th>幻读</th></tr></thead><tbody><tr><td>Read uncommitted</td><td>√</td><td>√</td><td>√</td></tr><tr><td>Read committed</td><td>×</td><td>√</td><td>√</td></tr><tr><td>Repeatable Read(默认)</td><td>×</td><td>×</td><td>√</td></tr><tr><td>Serializable</td><td>×</td><td>×</td><td>×</td></tr></tbody></table><ul><li>√表示在当前隔离级别下该问题会出现</li><li>Serializable 性能最低；Read uncommitted 性能最高，数据安全性最差</li></ul><p>查看事务隔离级别：<br><code>SELECT @@TRANSACTION_ISOLATION;</code><br>设置事务隔离级别：<br><code>SET [ SESSION | GLOBAL ] TRANSACTION ISOLATION LEVEL {READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE };</code><br>SESSION 是会话级别，表示只针对当前会话有效，GLOBAL 表示对所有会话有效</p><h3 id="Read-Uncommitted"><a href="#Read-Uncommitted" class="headerlink" title="Read Uncommitted"></a>Read Uncommitted</h3><p>设置隔离级别为Read uncommitted</p><h4 id="脏读"><a href="#脏读" class="headerlink" title="脏读"></a>脏读</h4><p>开启两个事务；</p><p>事务A查询余额表；事务B给其中一个用户U1的账户余额做修改，但未提交事务；此时事务A再次查询余额表，发现U1的余额和之前的查询不一致。</p><h3 id="Read-Committed"><a href="#Read-Committed" class="headerlink" title="Read Committed"></a>Read Committed</h3><h4 id="不可重复读"><a href="#不可重复读" class="headerlink" title="不可重复读"></a>不可重复读</h4><p>事务A查询余额表中U1的余额；事务B给U1的账户余额+100，并commit；事务A再次查询U1余额，发现U1账户有变化。</p><h3 id="Repeatable-Read"><a href="#Repeatable-Read" class="headerlink" title="Repeatable Read"></a>Repeatable Read</h3><p>解决不可重复读，即使事务B已经进行更新操作，但是事务A并未提交时，数据就不会更新，依然是事务A最初已知的值。</p><h4 id="幻读"><a href="#幻读" class="headerlink" title="幻读"></a>幻读</h4><p>事务A在余额表中查询id=3的记录，查到空集；【未提交】</p><p>事务B向余额表中插入id=3的记录，并提交；【已提交】</p><p>事务A向余额表中插入id=3的记录；【未提交】——报错</p><p>事务A第二次在余额表中查询id=3的记录，查到空集；【未提交】——产生幻读</p><h3 id="Serializable"><a href="#Serializable" class="headerlink" title="Serializable"></a>Serializable</h3><p>解决幻读：</p><p>事务A在余额表中查询id=4的记录，查到空集；【未提交】</p><p>事务B向余额表中插入id=3的记录，并提交——此时被阻塞，只有事务A提交，才允许提交。</p><h2 id="Linux操作服务端"><a href="#Linux操作服务端" class="headerlink" title="Linux操作服务端"></a>Linux操作服务端</h2><h3 id="下载服务端：sudo-apt-get-install-mysql-server"><a href="#下载服务端：sudo-apt-get-install-mysql-server" class="headerlink" title="下载服务端：sudo apt-get install mysql-server"></a>下载服务端：sudo apt-get install mysql-server</h3><h3 id="下载客户端：sudo-apt-get-install-mysql-client"><a href="#下载客户端：sudo-apt-get-install-mysql-client" class="headerlink" title="下载客户端：sudo apt-get install mysql-client"></a>下载客户端：sudo apt-get install mysql-client</h3><h3 id="查看服务状态：sudo-service-mysql-status"><a href="#查看服务状态：sudo-service-mysql-status" class="headerlink" title="查看服务状态：sudo service mysql status"></a>查看服务状态：sudo service mysql status</h3><h3 id="停止服务：sudo-service-mysql-stop"><a href="#停止服务：sudo-service-mysql-stop" class="headerlink" title="停止服务：sudo service mysql stop"></a>停止服务：sudo service mysql stop</h3><h3 id="启动服务：sudo-service-mysql-start"><a href="#启动服务：sudo-service-mysql-start" class="headerlink" title="启动服务：sudo service mysql start"></a>启动服务：sudo service mysql start</h3><h3 id="重启服务：sudo-service-mysql-restart"><a href="#重启服务：sudo-service-mysql-restart" class="headerlink" title="重启服务：sudo service mysql restart"></a>重启服务：sudo service mysql restart</h3><h3 id="mysql配置文件：-etc-mysql-mysql-conf-d"><a href="#mysql配置文件：-etc-mysql-mysql-conf-d" class="headerlink" title="mysql配置文件：/etc/mysql/mysql.conf.d/"></a>mysql配置文件：/etc/mysql/mysql.conf.d/</h3><p>mysqld.cnf</p><ul><li>端口号：3306</li><li>bind-address：127.0.0.1默认</li><li>datadir：/var/lib/mysql</li><li>log_error：/var/log/mysql/error.log</li></ul><h2 id="Linux操作客户端"><a href="#Linux操作客户端" class="headerlink" title="Linux操作客户端"></a>Linux操作客户端</h2><h3 id="连接服务端：mysql-uroot-p"><a href="#连接服务端：mysql-uroot-p" class="headerlink" title="连接服务端：mysql -uroot -p"></a>连接服务端：mysql -uroot -p</h3><h3 id="显示时间：select-now（）"><a href="#显示时间：select-now（）" class="headerlink" title="显示时间：select now（）"></a>显示时间：select now（）</h3><h3 id="退出连接：exit-quit"><a href="#退出连接：exit-quit" class="headerlink" title="退出连接：exit/quit"></a>退出连接：exit/quit</h3><h3 id="Mysql数据库操作"><a href="#Mysql数据库操作" class="headerlink" title="Mysql数据库操作"></a>Mysql数据库操作</h3><ul><li>查看所有数据库：show databases；</li><li>创建数据库：create database 数据库名<br> charset = ‘utf8’；</li><li>使用数据库：use 数据库名；</li><li>查看当前使用的数据库：select database（）；</li><li>删除数据库：drop 数据库名；</li></ul><h3 id="Mysql表操作"><a href="#Mysql表操作" class="headerlink" title="Mysql表操作"></a>Mysql表操作</h3><ul><li>查看当前库中所有表：show tables；</li><li>创建表：create table 表名(字段名，类型，可选约束条件…)；</li><li>修改表字段：alter table 表名 modify 列名 类型 约束；</li><li>删除表：drop table 表名；</li><li>查看表结构：desc 表名；</li></ul><h3 id="Mysql-CRUD操作"><a href="#Mysql-CRUD操作" class="headerlink" title="Mysql-CRUD操作"></a>Mysql-CRUD操作</h3><ul><li>select：查询<ul><li>select * from 表名 where 条件；</li></ul></li><li>insert：插入<ul><li>全列插入：insert into 表名 values (…)；</li><li>部分插入：insert into 表名(列1…) values (值1…)；</li></ul></li><li>update：更新<ul><li>update TABLENAME<br> set  ITEM1 = ‘VALUE’</li></ul></li><li>delete：删除<ul><li>delete from TABLENAME;</li></ul></li></ul><h3 id="Mysql备份和恢复"><a href="#Mysql备份和恢复" class="headerlink" title="Mysql备份和恢复"></a>Mysql备份和恢复</h3><ul><li>备份：mysqldump -u用户名 -p密码 数据库名 表名</li></ul><blockquote><p>data.sql</p></blockquote><pre class="line-numbers language-undefined"><code class="language-undefined">- --all：所有数据库<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>恢复：source data.sql</li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> MySql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>日常开发中，提升技术建议</title>
      <link href="/2023/05/17/blog-open-source-promotion/"/>
      <url>/2023/05/17/blog-open-source-promotion/</url>
      
        <content type="html"><![CDATA[<h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="日常开发中，提升技术建议"><a href="#日常开发中，提升技术建议" class="headerlink" title="日常开发中，提升技术建议"></a>日常开发中，提升技术建议</h1><h2 id="1-打好基础-深入学习语言特性"><a href="#1-打好基础-深入学习语言特性" class="headerlink" title="1. 打好基础,深入学习语言特性"></a>1. 打好基础,深入学习语言特性</h2><p><strong>先打好基础</strong> 比如，对于<code>Java</code>程序员来说,要了解<code>Java</code>语言的基本概念和核心特性，包括<strong>面向对象编程、集合框架、异常处理、多线程</strong>等等。可以通过阅读<code>Java</code>的官方文档、教程、参考书籍或在线资源来学习。</p><p><strong>如果最基本的基础都不扎实，就不要谈什么提升技术啦。</strong> 比如说：</p><ul><li>你知道<code>HashMap和ConcurrentHashMap</code>的区别嘛?</li><li>在什么时候使用<code>ConcurrentHashMap</code>？</li><li>操作文件的时候，你知道在<code>finally</code>块中释放资源嘛?</li><li>你知道在哪些场景适合用泛型嘛?</li></ul><p>因此,要提升自身技术,首先就是要<strong>把基础打扎实</strong>。有些小伙伴说,上班没时间学基础呀,其实不是这样的,基础这玩意,<strong>每天地铁上下班看看,下班后回到家再看看,周末在家看看，多点写写代码</strong>,一般一两个月,你的基础就很好啦。</p><p>又有些小伙伴说，如何提升Java基础呢？有哪些教程推荐呢？可以：</p><ul><li><strong>阅读Java相关书籍或教程</strong>，如Java编程思想、Java核心技术、Java虚拟机、菜鸟教程等</li><li><strong>阅读Java博客和社区参与讨论</strong>：关注Java领域的博客、论坛和社区，了解最新的技术动态和解决方案，与其他开发者交流。</li><li><strong>多实践，多敲代码</strong>：在B站找个Java基础视频看，<strong>平时多实践、多敲代码</strong></li></ul><h2 id="2-熟悉掌握常用的开发工具"><a href="#2-熟悉掌握常用的开发工具" class="headerlink" title="2. 熟悉掌握常用的开发工具"></a>2. 熟悉掌握常用的开发工具</h2><p><strong>工欲善其事，必先利其器</strong>. 所以一位好的程序员,往往编码效率就更高。<strong>而提升编码效率</strong>,一般要求熟悉并灵活应用工具.比如<code>Eclipse、IntelliJ IDEA、Maven、Navicat</code>等。熟悉运用这些工具，可以提高开发效率。</p><p>我举个例子,比如你熟悉掌握<code>IntelliJ IDEA</code>的快捷键,三两下就把实体类的<code>setter和getter</code>方法生成了,而有些的程序员,还在一行一行慢慢敲。。</p><h2 id="3-日常工作中，总结你踩过的坑"><a href="#3-日常工作中，总结你踩过的坑" class="headerlink" title="3. 日常工作中，总结你踩过的坑"></a>3. 日常工作中，总结你踩过的坑</h2><p>优秀的程序员,之所以优秀,是因为他会<strong>总结踩过的坑,避免重蹈覆辙</strong>。所以 ，日常开发中,如果你踩了哪些坑,就需要总结下来.<strong>茶余饭后,再温习温习</strong>.</p><p>比如,你知道：</p><ul><li>Redis分布式锁使用,可能会有哪些坑嘛?</li><li>线程池使用有哪些坑?</li><li>Java日期处理有哪些坑嘛?</li><li><code>Arrays.asList</code>使用可能有哪些坑?</li></ul><p>如果一时间忘记的话,可以看下我以前的这些文章:</p><ul><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&amp;mid=2247501030&amp;idx=1&amp;sn=0c0c8523d73d65ba7358856ea02fb5fc&amp;chksm=cf221bcff85592d9556cb3735357b96baad9544c1b9c3149d0bffc290dedab32bb86d40e1075&amp;token=1747899642&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">细数线程池的10个坑</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&amp;mid=2247503100&amp;idx=1&amp;sn=8612773ac3591f8ef7b5fa49b2394d91&amp;chksm=cf2213d5f8559ac38cf154b73c43c500667a9f383d08c5ec7c1c725170aa2d20e4d15b50524b&amp;token=1747899642&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">Redis分布式锁的10个坑</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&amp;mid=2247488115&amp;idx=1&amp;sn=bdd4a4ca36bc7ea902106d058e8537fb&amp;chksm=cf21cd5af856444cb36af600705615454b0aaa2b289b97ddb52d594556ac07a1915b73ecce19&amp;token=162724582&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">Java日常开发的21个坑，你踩过几个？</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&amp;mid=2247487973&amp;idx=1&amp;sn=0f713413098fb579e5f200b829f71e89&amp;chksm=cf21ceccf85647da450765d79bf5943da551c3be950447063b9f8c77c21bf2a39b99387a949b&amp;token=162724582&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">程序员必备：Java日期处理的十个坑</a></li></ul><p>这些都是我工作总结出来的,也希望你们日常开发中,遇到哪些坑,都总结下来哈。</p><h2 id="4-工作中-阅读你们系统优秀的代码和设计文档"><a href="#4-工作中-阅读你们系统优秀的代码和设计文档" class="headerlink" title="4.工作中,阅读你们系统优秀的代码和设计文档"></a>4.工作中,阅读你们系统优秀的代码和设计文档</h2><p><strong>孔子说,三人行,必有我师</strong>。大家平时在看代码的时候,不要总吐槽着项目的烂代码。其实,可以<strong>多点关注写得优秀的代码</strong>,然后看懂别人为什么这些写,仿造着来写。</p><p>当然,一些好的设计文档也是:<strong>人家为什么这么设计</strong>,好处在哪里,不足又在哪里,如果是你来设计,你如何思考等等。<strong>把好的设计,读懂后,记录下来,变成自己的知识</strong>.学习优秀的代码和设计文档</p><h2 id="5-日常工作中-总结一些通用的技术方案"><a href="#5-日常工作中-总结一些通用的技术方案" class="headerlink" title="5.日常工作中,总结一些通用的技术方案."></a>5.日常工作中,总结一些通用的技术方案.</h2><p>在日常工作中呢,注意整理一些通用的技术方案。</p><p>比如<strong>幂等设计、分布式锁如何设计、分布式事务设计、接口优化、限流设计、分库分表设计、深分页问题解决</strong>等等. 大家可以看下我之前的一些通用方案设计的文章哈:</p><ul><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&amp;mid=2247499388&amp;idx=1&amp;sn=49a22120a3238e13ad7c3d3b73d9e453&amp;chksm=cf222155f855a8434026b2c460d963c406186578c2527ca8f2bb829bbe849d87a2392a525a9b&amp;token=1747899642&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">后端思想篇：设计好接口的36个锦囊！</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&amp;mid=2247498625&amp;idx=1&amp;sn=0d7bd9d1b46eeff4c715a6761355e9b0&amp;chksm=cf2224a8f855adbea8931c8e011711f6c70cffeef8ddf8b87729c710eacef11b46eef80fda36&amp;token=1747899642&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">我们为什么要分库分表？</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&amp;mid=2247498595&amp;idx=1&amp;sn=4e5308930e151a609baa2df820e48a89&amp;chksm=cf22244af855ad5c71822cb33e828ce652c6f34202096a9344922b86dcbc08076d7922acde5f&amp;token=1747899642&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">面试必备：聊聊分布式锁的多种实现！</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&amp;mid=2247497427&amp;idx=1&amp;sn=2ed160c9917ad989eee1ac60d6122855&amp;chksm=cf2229faf855a0ecf5eb34c7335acdf6420426490ee99fc2b602d54ff4ffcecfdab24eeab0a3&amp;token=1747899642&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">聊聊幂等设计</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&amp;mid=2247495139&amp;idx=1&amp;sn=9dd98a8e09af48440cc5f01d3aafd87e&amp;chksm=cf2232caf855bbdc4ea538550ecde6c575c91a1d1b1c42f3bc6091c715dde1a4a5e90d3f7ce2&amp;token=1747899642&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">实战！聊聊如何解决MySQL深分页问题</a></li></ul><p>当然，日常开发中，把自己遇到的<strong>一些通用设计方案总结下来</strong>，熟悉掌握这些通用技术方案。</p><h2 id="6-参与技术讨论-积极技术分享"><a href="#6-参与技术讨论-积极技术分享" class="headerlink" title="6.参与技术讨论,积极技术分享"></a>6.参与技术讨论,积极技术分享</h2><p>参与技术讨论和交流，可以有助于<strong>你与其他Java开发者分享经验、解决问题和学习新知识</strong>。进行技术分享，可以加深自己的理解、建立专业声誉、促进个人成长、为技术社区做贡献等等。</p><p>比如你做需求遇到的一些难题，都可以跟有经验的同事、或者技术leader讨论讨论。一些常见的难题，讨论完可以记录下来，<strong>然后做技术分享</strong>。</p><h2 id="7-主人翁意识-积极攻克项目的难题"><a href="#7-主人翁意识-积极攻克项目的难题" class="headerlink" title="7. 主人翁意识,积极攻克项目的难题"></a>7. 主人翁意识,积极攻克项目的难题</h2><p>作为一名开发工程师，具备主人翁意识并积极<strong>攻克项目的难题</strong>，是非常重要的。遇到项目中的比较棘手问题时，先不管是谁的问题，我们都要<strong>持有主人翁意识</strong>，积极主动地找到解决方案并采取行动。</p><p>而在找技术解决方案的过程，我们也就成长了。当攻克问题后，你也获得领导的认可，<strong>好绩效不远了，一举多得</strong>！</p><h2 id="8-思考项目中-哪些可以提升效率"><a href="#8-思考项目中-哪些可以提升效率" class="headerlink" title="8. 思考项目中,哪些可以提升效率"></a>8. 思考项目中,哪些可以提升效率</h2><p>日常开发中，几乎大多数程序员都是在进行<strong>增删改查</strong>。如何如何避免自己成为平凡的增删改查程序员呢。</p><p>我觉得可以这样做：平时工作中，思考项目中，有哪些可以提升的效率。包括<strong>熟悉开发工具、掌握适当的调试技巧、熟悉常用框架、持续学习和关注技术发展 多思考，提升开发效率</strong>等等。</p><p>比如：</p><ul><li>好的的<code>debug</code>调试技巧，可以让你快速找到问题</li><li>再比如一个插件<code>easyyapi</code>可以一键让你快速生成<code>yapi</code>接口文档，而不用一个一个字段手工敲接口文档。</li></ul><p>当然，日常开发中，还有很多可以提升效率的技巧/工具，<strong>等待我们去发现</strong>。</p><h2 id="9-熟悉你的业务-让自己不容易被替代"><a href="#9-熟悉你的业务-让自己不容易被替代" class="headerlink" title="9. 熟悉你的业务,让自己不容易被替代"></a>9. 熟悉你的业务,让自己不容易被替代</h2><p>我们普通程序员，多数都是<strong>做业务的</strong>。一般工作个五年以上，水平差不了太多。如何避免自己被淘汰呢？我个人建议是，尽量做到熟悉你们做的业务，让自己变得不容易被替代。</p><h2 id="10-多看看你的系统，可能存在哪些问题，如接口耗时、慢SQL等等"><a href="#10-多看看你的系统，可能存在哪些问题，如接口耗时、慢SQL等等" class="headerlink" title="10. 多看看你的系统，可能存在哪些问题，如接口耗时、慢SQL等等"></a>10. 多看看你的系统，可能存在哪些问题，如接口耗时、慢SQL等等</h2><p>一般的系统，多多少少都有些问题。比如<strong>接口耗时过长、慢SQL、fullGC频繁</strong>等等。</p><p>首先需要掌握这些技能，比如<strong>如何优化接口，如何优化慢SQL、fullGC如何排查</strong>等等。大家可以看下这几篇文章哈：</p><ul><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&amp;mid=2247502660&amp;idx=1&amp;sn=17166646f82412cd81955930f799ab4e&amp;chksm=cf22146df8559d7bcf9becd82e1d8006c35a781e5dbd0a79e0a9e121803ee40d6eae7ebd7ccb&amp;token=1804795294&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">实战总结！18种接口优化方案的总结</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&amp;mid=2247499624&amp;idx=1&amp;sn=561b9cb7fe831ca7cb2d9fd65691e85e&amp;chksm=cf222041f855a957ac50c0a53baaec6d26be32427259b2974450620f33a8c834419fe535e83d&amp;token=1804795294&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">盘点MySQL慢查询的12个原因</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&amp;mid=2247501985&amp;idx=1&amp;sn=6771e8f761b6e45131f77459dbab55e0&amp;chksm=cf221788f8559e9e19fc6b3b0a8ec6e35101523c7e1ee755cca85ec57f74f972050efca5a0e5&amp;token=1804795294&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">SQL优化思路+经典案例分析</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&amp;mid=2247488076&amp;idx=1&amp;sn=748c4ab10eeb3416aa6dedb2f6df19cb&amp;chksm=cf21cd65f8564473ece84e70475ab42ce38c41e681d4229b66e03db2e52a1f34f0b27eee0306&amp;token=1804795294&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">JAVA线上故障排查全家桶</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&amp;mid=2247488012&amp;idx=1&amp;sn=1e4cf9ddacb56e2241f28b17e5f9c0b1&amp;chksm=cf21cd25f856443364548260c1cfd11922282dcaed87739ef983628b3887458c57f3af831041&amp;token=1804795294&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">线上服务的FGC问题排查，看这篇就够了！</a></li></ul><h2 id="11-学以致用，将理论知识应用到实际项目中"><a href="#11-学以致用，将理论知识应用到实际项目中" class="headerlink" title="11. 学以致用，将理论知识应用到实际项目中"></a>11. 学以致用，将理论知识应用到实际项目中</h2><p>很多小伙伴说，看过<strong>很多计算机相关的书，阅读过很多博客，背了很多八股文</strong>，依然做不好一个系统。</p><p>我觉得，大家可以多点思考，把平时积累的东西，应用到实际项目中。背八股文不是没用，你可以把它应用到实际开发中的。比如说，<a href="https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&amp;mid=2247496448&amp;idx=1&amp;sn=cd502f850290a25949dd4a11ac55a039&amp;chksm=cf222c29f855a53f094bde2868900fa252b07385e73564e9ee9f0510cb4e74387d9d23ab67e6&amp;token=1804795294&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">IO模型详解</a></p><p>这个表面看起来就是一个常见的八股文知识点，<strong>工作中似乎没用到</strong>。但是我在工作中，就用到这种<strong>类似的异步思想</strong>：</p><blockquote><p>比如发起一笔批量转账，但是批量转账处理比较耗时，这时候后端可以先告知前端转账提交成功，等到结果处理完，再通知前端结果即可。</p></blockquote><p>再比如<a href="https://mp.weixin.qq.com/s?__biz=Mzg3NzU5NTIwNg==&amp;mid=2247503690&amp;idx=1&amp;sn=73655f41a98f21217468115888aeeceb&amp;chksm=cf221063f855997590d48e605ac3cadbad14f4e91b71acf471a520a9ed9be2a9f2e2c5b64450&amp;token=1804795294&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">MySQL索引15连问，抗住！</a>，你是不是可以回头看看，你的系统中，<strong>那些sql的索引加的是否合理呢</strong>？是不是可以思考一下如何优化，对吧。因此，<strong>就是要学以致用</strong>。</p><h2 id="12-阅读一些优秀框架的源码，如spring、rockectMq等等"><a href="#12-阅读一些优秀框架的源码，如spring、rockectMq等等" class="headerlink" title="12. 阅读一些优秀框架的源码，如spring、rockectMq等等"></a>12. 阅读一些优秀框架的源码，如spring、rockectMq等等</h2><p>如果你有空余的时间，就建议你看看一些优化框架的源码，比如<code>spring、rockectMq</code>等等。</p><p>对于spring源码的话，可以按模块来呀，比如<code>aop，控制反转，spring事务</code>等，你先写个<code>demo</code>，然后<code>debug</code>跟踪流程，通过调试器逐步跟踪源码执行过程，观察各个方法的调用关系和数据变化。最好是结合电子书一起，如（<code>Spring源码深度解析</code>这本书一起）</p><p>优秀框架的源码，我们可以学习到很多编码思想的，加油。</p><h2 id="13-多编码，少偷懒，养成编程的好习惯"><a href="#13-多编码，少偷懒，养成编程的好习惯" class="headerlink" title="13. 多编码，少偷懒，养成编程的好习惯"></a>13. 多编码，少偷懒，养成编程的好习惯</h2><p>作为程序员，一定要多打代码，不要偷懒，代码敲多了，你就会了。还有就是，少点偷懒，坚持！努力！<strong>养成热爱编程的好习惯</strong>。</p><p>总之，提升技术需要<strong>不断学习、实践、总结和积累经验</strong>。</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git学习之常用命令</title>
      <link href="/2023/05/15/blog-open-source-gitlearn/"/>
      <url>/2023/05/15/blog-open-source-gitlearn/</url>
      
        <content type="html"><![CDATA[<h2 id="实际工作中常用命令汇总："><a href="#实际工作中常用命令汇总：" class="headerlink" title="实际工作中常用命令汇总："></a>实际工作中常用命令汇总：</h2><ol><li><p>查看远程分支：$ git branch -a</p></li><li><p>查看本地分支：$ git branch</p></li><li><p>切换分支：$ git checkout 分支名</p></li><li><p>更新到指定版本：$ git reset –hard 39c9064fe34a1331e3624fbbef33a3f66df8f6ba </p></li><li><p>更新到上个版本：$ git reset –hard HEAD^</p></li><li><p>将远程分支下载到本地：$ git checkout -b  branch1 origin/branch1</p></li><li><p>创建新分支，并立即切换到此新分支：$ git checkout -b branchname</p></li><li><p>从远程分支下载指定的分支：$ git pull origin branchname</p></li><li><p>查看某个文件作了哪些修改：$ git diff src/a.cpp</p></li><li><p>在合并进仓库之前，修改上次的提交：$ git commit –amend</p></li><li><p>撤销为提交的修改：$ git checkout – a.cpp</p></li><li><p>撤销当前目录下所有文件的修改(慎用)：$ git checkout .</p></li><li><p>查看某个文件详细的修改信息：$ git blame src/a.cpp</p></li><li><p>删除本地所有未提交的新增的文件(如果文件已经被staged不会被回退)：$ git clean -df</p></li><li><p>撤销本地所有未提交的更改(包括已经被staged的文件，但不包括新增的文件)：$ git reset –hard</p></li><li><p>修改指定文件的名字，如将a.cpp重命名为b.cpp：$ git mv a.cpp b.cpp</p></li><li><p>删除远程仓库中指定的文件src/a.cpp：$ git rm src/a.cpp</p></li><li><p>删除远程仓库中指定的目录src/aa：$ git rm src/aa -r -f</p></li><li><p>假如之前基于master新建了一个分支dev，但是后来master有了多于一次的提交，但是dev一直没有改动，假如现在想把master的提交更新到dev分支上，因为dev分支一直没有改动过，假如master提交了两次，除了手动调整改动的文件外还可以这样操作，当前在dev分支：$ git merge master  , $ git reset HEAD^^，因为master多于一次的提交，直接git merge master,在git push是不行的 </p></li><li><p>如果一个项目的提交记录太多，直接使用git log并不太方便查看提交历史，此时可通过tree的方式输出，执行如下命令后，每次查看时终端执行 $ git lg 即可</p></li></ol><p>git config –global alias.lg “log –graph –abbrev-commit –decorate –format=format:’%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(dim white)- %an%C(reset)%C(bold yellow)%d%C(reset)’ –all”<br>21. 本地执行git branch -a查看远程分支时出现了一些实际远程仓库中已不存在的分支，此时可在本地执行：git pull –prune命令清理远程仓库中已不存在的分支</p><ol start="22"><li>从另一个分支dev拷贝文件funset.hpp或目录到现在的分支master，则执行：$ git checkout dev funset.hpp ,执行后funset.hpp在master分支中默认是暂存状态；若取消暂存，可执行: $ get reset HEAD</li></ol><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfctpNAOqAHQjDkgrOMNf4tEjBP4yPUYN1EUC9f4hATBvG9h6VzlngjA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h3 id="1-git-clone"><a href="#1-git-clone" class="headerlink" title="1.git clone"></a>1.git clone</h3><p>当我们要进行开发，第一步就是克隆远程版本库到本地呢</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">git</span> clone url  克隆远程版本库<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZf0AEDyYuqhmTFKTampAVpjqph88gSHazXwYXuySe0XyBbuXow8jtasw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h3 id="2-git-checkout-b-dev"><a href="#2-git-checkout-b-dev" class="headerlink" title="2.git checkout -b dev"></a>2.git checkout -b dev</h3><p>克隆完之后呢，开发新需求的话，我们需要新建一个开发分支，比如新建开发分支dev</p><p>创建分支：</p><pre class="line-numbers language-css"><code class="language-css">git checkout -b dev   创建开发分支dev，并切换到该分支下<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZflCDYCEYiaQoyDPrgJwCG2B4zEFibGJOSPrDljlDxibVJtzHRYdIp0RbUQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h3 id="3-git-add"><a href="#3-git-add" class="headerlink" title="3.git add"></a>3.git add</h3><p>git add的使用格式：</p><pre class="line-numbers language-mipsasm"><code class="language-mipsasm">git add .添加当前目录的所有文件到暂存区git add [dir]添加指定目录到暂存区，包括子目录git add [file1]添加指定文件到暂存区<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>有了开发分支dev之后，我们就可以开始开发啦，假设我们开发完HelloWorld.java，可以把它加到暂存区，命令如下</p><pre class="line-numbers language-mipsasm"><code class="language-mipsasm">git add Hello.java  把HelloWorld.java文件添加到暂存区去<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfia4aAkyHiaCvAXLpChIprSTFXMSJMibOWe6ibShasibhyCSIsUh2ANMDjrA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h3 id="4-git-commit"><a href="#4-git-commit" class="headerlink" title="4.git commit"></a>4.git commit</h3><p>git commit的使用格式：</p><pre class="line-numbers language-css"><code class="language-css">git commit -m [message] 提交暂存区到仓库区,message为说明信息git commit [file<span class="token number">1</span>] -m [message] 提交暂存区的指定文件到本地仓库git commit --amend -m [message] 使用一次新的commit，替代上一次提交<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>把HelloWorld.java文件加到暂存区后，我们接着可以提交到本地仓库啦~</p><pre class="line-numbers language-sql"><code class="language-sql">git <span class="token keyword">commit</span> <span class="token operator">-</span>m <span class="token string">'helloworld开发'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfticEWTic8LdLghUAXo2vCM5PlWRDazPW68QicPJqE1MKygVh1SkadpktA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h3 id="5-git-status"><a href="#5-git-status" class="headerlink" title="5.git status"></a>5.git status</h3><p>git status,表示查看工作区状态，使用命令格式：</p><pre class="line-numbers language-lua"><code class="language-lua">git status  查看当前工作区暂存区变动git status <span class="token operator">-</span>s  查看当前工作区暂存区变动，概要信息git status  <span class="token comment" spellcheck="true">--show-stash 查询工作区中是否有stash（暂存的文件）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>当你忘记是否已把代码文件添加到暂存区或者是否提交到本地仓库，都可以用git status看看哦~</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfQT02Etj0ZSoTU1B75Kd9qUotoJBlyTK2KQEJouB0AWl2aYBmHCQx0A/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h3 id="6-git-log"><a href="#6-git-log" class="headerlink" title="6.git log"></a>6.git log</h3><p>git log，这个命令用得应该比较多，表示查看提交历史/提交日志~</p><pre class="line-numbers language-lua"><code class="language-lua">git log  查看提交历史git log <span class="token comment" spellcheck="true">--oneline 以精简模式显示查看提交历史</span>git log <span class="token operator">-</span>p <span class="token operator">&lt;</span>file<span class="token operator">></span> 查看指定文件的提交历史git blame <span class="token operator">&lt;</span>file<span class="token operator">></span> 一列表方式查看指定文件的提交历史<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>嘻嘻，看看dev分支上的提交历史吧<del>要回滚代码就经常用它喵喵提交历史</del><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZf5Piaa2ZH3ppiaSYS7olYibOu4FFwgXe7QLgGmtgFTYXvtOOuF2yeuSFew/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h3 id="7-git-diff"><a href="#7-git-diff" class="headerlink" title="7.git diff"></a>7.git diff</h3><pre class="line-numbers language-mipsasm"><code class="language-mipsasm">git diff 显示暂存区和工作区的差异git diff filepath   filepath路径文件中，工作区与暂存区的比较差异git diff HEAD filepath 工作区与HEAD ( 当前工作分支)的比较差异git diff branchName filepath 当前分支的文件与branchName分支的文件的比较差异git diff commitId filepath 与某一次提交的比较差异<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果你想对比一下你改了哪些内容，可以用git diff对比一下文件修改差异哦<img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfCA5TLyCRfmvicKCMLibkricrUcchhUC9KPhXZ1ibs8y8sY20wvGM6dV8zQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h3 id="8-git-pull-git-fetch"><a href="#8-git-pull-git-fetch" class="headerlink" title="8.git pull/git fetch"></a>8.git pull/git fetch</h3><pre class="line-numbers language-nginx"><code class="language-nginx">git pull  拉取远程仓库所有分支更新并合并到本地分支。git pull origin master 将远程master分支合并到当前本地分支git pull origin master<span class="token punctuation">:</span>master 将远程master分支合并到当前本地master分支，冒号后面表示本地分支git fetch <span class="token operator">--</span>all  拉取所有远端的最新代码git fetch origin master 拉取远程最新master分支代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们一般都会用git pull拉取最新代码看看的，解决一下冲突，再推送代码到远程仓库的。</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfwCRVfur2yoT9eE0Vqu4zttnONBMVWlmLPYAM1ibOKFeHAOOqGtDog2Q/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><blockquote><p>有些伙伴可能对使用git pull还是git fetch有点疑惑，其实 git pull = git fetch+ git merge。pull的话，拉取远程分支并与本地分支合并，fetch只是拉远程分支，怎么合并，可以自己再做选择。</p></blockquote><h3 id="9-git-push"><a href="#9-git-push" class="headerlink" title="9.git push"></a>9.git push</h3><p>git push 可以推送本地分支、标签到远程仓库，也可以删除远程分支哦。</p><pre class="line-numbers language-mipsasm"><code class="language-mipsasm">git push origin master 将本地分支的更新全部推送到远程仓库master分支。git push origin -d <branchname>   删除远程branchname分支git push --tags 推送所有标签<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果我们在dev开发完，或者就想把文件推送到远程仓库，给别的伙伴看看，就可以使用git push origin dev~<img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p><p> <img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfqG4djZgIcQyujjerQdpQoloa53wOfdtnpjhfxeOSiay19xfgB2vVflA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h2 id="Git-的相关理论基础"><a href="#Git-的相关理论基础" class="headerlink" title="Git 的相关理论基础"></a>Git 的相关理论基础</h2><h3 id="1-Git的四大工作区域"><a href="#1-Git的四大工作区域" class="headerlink" title="1.Git的四大工作区域"></a>1.Git的四大工作区域</h3><p>先复习Git的几个工作区域哈：<img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfYuV2icpSpH5bNJN6ib4fia6v6v4xcsfdcxhUgf2LLlN9jtT1841HOGicWg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><ul><li>Workspace：你电脑本地看到的文件和目录，在Git的版本控制下，构成了工作区。</li><li>Index/Stage：暂存区，一般存放在 .git目录下，即.git/index,它又叫待提交更新区，用于临时存放你未提交的改动。比如，你执行git add，这些改动就添加到这个区域啦。</li><li>Repository：本地仓库，你执行git clone 地址，就是把远程仓库克隆到本地仓库。它是一个存放在本地的版本库，其中HEAD指向最新放入仓库的版本。当你执行git commit，文件改动就到本地仓库来了~</li><li>Remote：远程仓库，就是类似github，码云等网站所提供的仓库，可以理解为远程数据交换的仓库~</li></ul><h3 id="2-Git的工作流程"><a href="#2-Git的工作流程" class="headerlink" title="2.Git的工作流程"></a>2.Git的工作流程</h3><p>上一小节介绍完Git的四大工作区域，这一小节呢，介绍Git的工作流程咯，把git的操作命令和几个工作区域结合起来，个人觉得更容易理解一些。</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfKypoNkwZdXhQxBou68Mve2Fr5obFSM9grAJ0XsHaficUib9UrSicpL3hg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">git 的正向工作流程一般就这样：</p><ul><li>从远程仓库拉取文件代码回来；</li><li>在工作目录，增删改查文件；</li><li>把改动的文件放入暂存区；</li><li>将暂存区的文件提交本地仓库；</li><li>将本地仓库的文件推送到远程仓库；</li></ul><h3 id="3-Git文件的四种状态"><a href="#3-Git文件的四种状态" class="headerlink" title="3.Git文件的四种状态"></a>3.Git文件的四种状态</h3><p>根据一个文件是否已加入版本控制，可以把文件状态分为：Tracked(已跟踪)和Untracked(未跟踪)，而tracked(已跟踪)又包括三种工作状态：Unmodified，Modified，Staged</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZf1VjPyfYNrLsAKocD1nlIIg7vEO3XsUdDUfh6SyWfCO3QCGib3BEoYdA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><ul><li>Untracked: 文件还没有加入到git库，还没参与版本控制，即未跟踪状态。这时候的文件，通过git add 状态，可以变为Staged状态</li><li>Unmodified：文件已经加入git库, 但是呢，还没修改, 就是说版本库中的文件快照内容与文件夹中还完全一致。Unmodified的文件如果被修改, 就会变为Modified. 如果使用git remove移出版本库, 则成为Untracked文件。</li><li>Modified：文件被修改了，就进入modified状态啦，文件这个状态通过stage命令可以进入staged状态</li><li>staged：暂存状态. 执行git commit则将修改同步到库中, 这时库中的文件和本地文件又变为一致, 文件为Unmodified状态.</li></ul><h3 id="4-一张图解释Git的工作原理"><a href="#4-一张图解释Git的工作原理" class="headerlink" title="4.一张图解释Git的工作原理"></a>4.一张图解释Git的工作原理</h3><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfT4LqV6vCXtjFnu0Sst51s44TH5ePAtibpjFnazWQYNmQ1iaubzAhS4gg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h2 id="Git-进阶之分支处理"><a href="#Git-进阶之分支处理" class="headerlink" title="Git 进阶之分支处理"></a><strong>Git 进阶之分支处理</strong></h2><p>Git一般都是存在多个分支的，开发分支，回归测试分支以及主干分支等，所以Git分支处理的命令也需要很熟悉的呀~</p><ul><li>git branch</li><li>git checkout</li><li>git merge</li></ul><h3 id="1-git-branch"><a href="#1-git-branch" class="headerlink" title="1.git branch"></a>1.git branch</h3><p>git branch用处多多呢，比如新建分支、查看分支、删除分支等等</p><p>新建分支：</p><pre class="line-numbers language-mipsasm"><code class="language-mipsasm">git checkout -b dev2  新建一个分支，并且切换到新的分支dev2git branch dev2 新建一个分支，但是仍停留在原来分支<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfudHPHyHFMVm6Xx6xK1beQkJP27LiaFicPsiaSDyOmk3GYZ6sQ4ERgRIZQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p><p>查看分支：</p><pre class="line-numbers language-mipsasm"><code class="language-mipsasm">git branch    查看本地所有的分支git branch -r  查看所有远程的分支git branch -a  查看所有远程分支和本地分支<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfR6iaex0F7ZUDiaLunv0wxeHwxmVp2Z3feuib43lzrH7LI5LwtCOWjLVmQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p><p>删除分支：</p><pre class="line-numbers language-mipsasm"><code class="language-mipsasm">git branch -D <branchname>  删除本地branchname分支<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZf4iacTlU3sMLuEPLPS8Yl6ibpicgIhtXwAGgXA5Cvtc5W26YBVkXwkP68A/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p><h3 id="2-git-checkout"><a href="#2-git-checkout" class="headerlink" title="2.git checkout"></a>2.git checkout</h3><p>切换分支：</p><pre class="line-numbers language-undefined"><code class="language-undefined">git checkout master 切换到master分支<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfP6DuFicFFyZ6rrshaognkhwKMcNBgz4iaK7eclga4qeMyjl0adFqXMUQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p><h3 id="3-git-merge"><a href="#3-git-merge" class="headerlink" title="3.git merge"></a>3.git merge</h3><p>我们在开发分支dev开发、测试完成在发布之前，我们一般需要把开发分支dev代码合并到master，所以git merge也是程序员必备的一个命令。</p><pre class="line-numbers language-sql"><code class="language-sql">git <span class="token keyword">merge</span> master  在当前分支上合并master分支过来git <span class="token keyword">merge</span> <span class="token comment" spellcheck="true">--no-ff origin/dev  在当前分支上合并远程分支dev</span>git <span class="token keyword">merge</span> <span class="token comment" spellcheck="true">--abort 终止本次merge，并回到merge前的状态</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>比如，你开发完需求后，发版需要把代码合到主干master分支，如下：<img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfRCH81PszDRLKhwGoprMyn87nkAx7EctlaibBzMXxAibKcr5K0QiaNXjFA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p><h2 id="Git-进阶之处理冲突"><a href="#Git-进阶之处理冲突" class="headerlink" title="Git 进阶之处理冲突"></a>Git 进阶之处理冲突</h2><p>Git版本控制，是多个人一起搞的，多个分支并存的，这就难免会有冲突出现~</p><h3 id="1-Git合并分支，冲突出现"><a href="#1-Git合并分支，冲突出现" class="headerlink" title="1.Git合并分支，冲突出现"></a>1.Git合并分支，冲突出现</h3><p>同一个文件，在合并分支的时候，如果同一行被多个分支或者不同人都修改了，合并的时候就会出现冲突。</p><p>举个粟子吧，我们现在在dev分支，修改HelloWorld.java文件，假设修改了第三行，并且commit提交到本地仓库，修改内容如下：</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello，捡田螺的小男孩！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们切回到master分支，也修改HelloWorld.java同一位置内容，如下：</p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello，jay！！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>再然后呢，我们提交一下master分支的这个改动，并把dev分支合并过下，就出现冲突啦，如图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZf9kesopicPOgRHNPFQt2gmhriaXOU9KQshTNEptrc0aiaqJrqrJtFYwQkw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p><h3 id="2-Git解决冲突"><a href="#2-Git解决冲突" class="headerlink" title="2.Git解决冲突"></a>2.Git解决冲突</h3><p>Git 解决冲突步骤如下：</p><ul><li>查看冲突文件内容</li><li>确定冲突内容保留哪些部分，修改文件</li><li>重新提交，done</li></ul><h4 id="1）查看冲突文件内容"><a href="#1）查看冲突文件内容" class="headerlink" title="1）查看冲突文件内容"></a>1）查看冲突文件内容</h4><p>git merge提示冲突后，我们切换到对应文件，看看冲突内容哈，，如下：<img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfDHjeZ0zu5F5a1UEnlriaTNd11Cw1ZByxoU3PutCN9ZyDzdiazQyMlWibw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p><h4 id="2）确定冲突内容保留哪些部分，修改文件"><a href="#2）确定冲突内容保留哪些部分，修改文件" class="headerlink" title="2）确定冲突内容保留哪些部分，修改文件"></a>2）确定冲突内容保留哪些部分，修改文件</h4><ul><li>Git用&lt;&lt;&lt;&lt;&lt;&lt;&lt;，=======，&gt;&gt;&gt;&gt;&gt;&gt;&gt;标记出不同分支的内容，</li><li>&lt;&lt;&lt;&lt;&lt;&lt;&lt;HEAD是指主分支修改的内容，&gt;&gt;&gt;&gt;&gt;&gt;&gt; dev是指dev分支上修改的内容</li></ul><p>所以呢，我们确定到底保留哪个分支内容，还是两个分支内容都保留呢，然后再去修改文件冲突内容~</p><h4 id="3）修改完冲突文件内容，我们重新提交，冲突done"><a href="#3）修改完冲突文件内容，我们重新提交，冲突done" class="headerlink" title="3）修改完冲突文件内容，我们重新提交，冲突done"></a>3）修改完冲突文件内容，我们重新提交，冲突done</h4><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZft27SC0nwJnsRAkwjd71wrpKsS40Liag2Uk7DG4Dj9U0U2Eppff2iba9w/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p><h2 id="Git-进阶之撤销与回退"><a href="#Git-进阶之撤销与回退" class="headerlink" title="Git 进阶之撤销与回退"></a><strong>Git 进阶之撤销与回退</strong></h2><p>Git的撤销与回退，在日常工作中使用的比较频繁。比如我们想将某个修改后的文件撤销到上一个版本，或者想撤销某次多余的提交，都要用到git的撤销和回退操作。</p><p>代码在Git的每个工作区域都是用哪些命令撤销或者回退的呢，如下图所示：<img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfoQIQOp1lGECs1hRqeYrtVh7icEjjOichyByUore961X1DgXqhzTmEiaWQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p><p>有关于Git的撤销与回退，一般就以下几个核心命令</p><ul><li>git checkout</li><li>git reset</li><li>git revert</li></ul><h3 id="1-git-checkout"><a href="#1-git-checkout" class="headerlink" title="1.git checkout"></a>1.git checkout</h3><p>如果文件还在工作区，还没添加到暂存区，可以使用git checkout撤销</p><pre class="line-numbers language-cmake"><code class="language-cmake">git checkout [file]  丢弃某个文件filegit checkout .  丢弃所有文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>以下demo，使用git checkout – test.txt 撤销了test.txt的修改<img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfyrLjKUQ0K0TytZXSicS0BGzGHibynPjFyeW8XytEMySGlAWoBvxuJsfw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p><h3 id="2-git-reset"><a href="#2-git-reset" class="headerlink" title="2.git reset"></a>2.git reset</h3><h4 id="git-reset的理解"><a href="#git-reset的理解" class="headerlink" title="git reset的理解"></a>git reset的理解</h4><blockquote><p>git reset的作用是修改HEAD的位置，即将HEAD指向的位置改变为之前存在的某个版本.</p></blockquote><p>为了更好地理解git reset，我们来回顾一下,Git的版本管理及HEAD的理解</p><blockquote><p>Git的所有提交，会连成一条时间轴线，这就是分支。如果当前分支是master，HEAD指针一般指向当前分支，如下：</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfgoKpDCZhia9H6TCBhNkDkocj6B4m5lIw5zlXpdAKGzpco4VDYLWfACg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p><p>假设执行git reset，回退到版本二之后，版本三不见了哦,如下：</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZflJQT8DIsQYwobjok0784iab8LJFDvl23OpSbLN2QNLz3JJkrMoUmeTQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p><h4 id="git-reset的使用"><a href="#git-reset的使用" class="headerlink" title="git reset的使用"></a>git reset的使用</h4><p>Git Reset的几种使用模式</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfeg4iaibjSbQWBmlFBBwK7MVghdyt2FnvrKYNaUicwiaYXG0hz6L4CltSSg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p><pre class="line-numbers language-perl"><code class="language-perl">git reset HEAD <span class="token operator">--</span>file回退暂存区里的某个文件，回退到当前版本工作区状态git reset –<span class="token operator">-</span>soft 目标版本号 可以把版本库上的提交回退到暂存区，修改记录保留git reset –<span class="token operator">-</span>mixed 目标版本号 可以把版本库上的提交回退到工作区，修改记录保留git reset –<span class="token operator">-</span>hard  可以把版本库上的提交彻底回退，修改的记录全部revert。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>先看一个粟子demo吧，代码git add到暂存区，并未commit提交,可以酱紫回退，如下：</p><pre class="line-numbers language-cmake"><code class="language-cmake">git reset HEAD file 取消暂存git checkout file 撤销修改<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfiblq2vwJzpHUOwn3EHqRgNpicAcf3EWM6oAAvHCEs2wkPWvicrQibvYhdg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p><p>再看另外一个粟子吧，代码已经git commit了，但是还没有push：</p><pre class="line-numbers language-lua"><code class="language-lua">git log  获取到想要回退的commit_idgit reset <span class="token comment" spellcheck="true">--hard commit_id  想回到过去，回到过去的commit_id</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZf2Vu4MESoh2RQ8EIBnQusA2s8ZywEXyJR7qiaVsLhWbcEC5ElSp8hevA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p><p>如果代码已经push到远程仓库了呢，也可以使用reset回滚哦(这里大家可以自己操作实践一下哦)~</p><pre class="line-numbers language-lua"><code class="language-lua">git loggit reset <span class="token comment" spellcheck="true">--hard commit_id</span>git push origin HEAD <span class="token comment" spellcheck="true">--force</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="3-git-revert"><a href="#3-git-revert" class="headerlink" title="3.git revert"></a>3.git revert</h3><blockquote><p>与git reset不同的是，revert复制了那个想要回退到的历史版本，将它加在当前分支的最前端。</p></blockquote><p>revert之前：</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfgoKpDCZhia9H6TCBhNkDkocj6B4m5lIw5zlXpdAKGzpco4VDYLWfACg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>revert 之后：</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfkqFZAfCictqs05d1uHbXelGpyLW9hpkzEX2HBGPhIW24EM0ia8PNRiaeg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>当然，如果代码已经推送到远程的话，还可以考虑revert回滚呢</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">git</span> log  得到你需要回退一次提交的commit <span class="token function">id</span><span class="token function">git</span> revert -n <span class="token operator">&lt;</span>commit_id<span class="token operator">></span>  撤销指定的版本，撤销也会作为一次提交进行保存<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfctBtiavSqKDAfhm6LKt220IE9UbOpHCUcY52CV6Jw3icUibkknJLQJghg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h2 id="Git-进阶之标签-tag"><a href="#Git-进阶之标签-tag" class="headerlink" title="Git 进阶之标签 tag"></a><strong>Git 进阶之标签 tag</strong></h2><p>打tag就是对发布的版本标注一个版本号，如果版本发布有问题，就把该版本拉取出来，修复bug，再合回去。</p><pre class="line-numbers language-css"><code class="language-css">git tag  列出所有taggit tag [tag] 新建一个tag在当前commitgit tag [tag] [commit] 新建一个tag在指定commitgit tag -d [tag] 删除本地taggit push origin [tag] 推送tag到远程git show [tag] 查看taggit checkout -b [branch] [tag] 新建一个分支，指向某个tag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzFs0frvIVCzia8LNcDRgicBZfvVCFsC1AoGDwO5V63AviblscOOlQibPFIZOoDRtqpM69htomO5a4KR1w/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h2 id="Git-其他一些经典命令"><a href="#Git-其他一些经典命令" class="headerlink" title="Git 其他一些经典命令"></a><strong>Git 其他一些经典命令</strong></h2><h3 id="1-git-rebase"><a href="#1-git-rebase" class="headerlink" title="1.git rebase"></a>1.git rebase</h3><p>rebase又称为衍合，是合并的另外一种选择。</p><p>假设有两个分支master和test</p><pre class="line-numbers language-css"><code class="language-css">      D---E test      / A---B---C---F--- master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>执行 git merge test得到的结果</p><pre class="line-numbers language-css"><code class="language-css">       D--------E      /          \ A---B---C---F----G---   test, master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>执行git rebase test，得到的结果</p><pre class="line-numbers language-css"><code class="language-css">A---B---D---E---C‘---F‘---   test, master<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>rebase好处是： 获得更优雅的提交树，可以线性的看到每一次提交，并且没有增加提交节点。所以很多时候，看到有些伙伴都是这个命令拉代码：git pull –rebase，就是因为想更优雅，哈哈</p><h3 id="2-git-stash"><a href="#2-git-stash" class="headerlink" title="2.git stash"></a>2.git stash</h3><p>stash命令可用于临时保存和恢复修改</p><pre class="line-numbers language-perl"><code class="language-perl">git stash  把当前的工作隐藏起来 等以后恢复现场后继续工作git stash list 显示保存的工作进度列表git stash pop stash<span class="token variable">@</span><span class="token punctuation">{</span>num<span class="token punctuation">}</span> 恢复工作进度到工作区git stash show ：显示做了哪些改动git stash drop stash<span class="token variable">@</span><span class="token punctuation">{</span>num<span class="token punctuation">}</span> ：删除一条保存的工作进度git stash clear 删除所有缓存的stash。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p><h3 id="3-git-reflog"><a href="#3-git-reflog" class="headerlink" title="3.git reflog"></a>3.git reflog</h3><p>显示当前分支的最近几次提交</p><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p><h3 id="4-git-blame-filepath"><a href="#4-git-blame-filepath" class="headerlink" title="4.git blame filepath"></a>4.git blame filepath</h3><p>git blame 记录了某个文件的更改历史和更改人，可以查看背锅人，哈哈<img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p><h3 id="5-git-remote"><a href="#5-git-remote" class="headerlink" title="5.git remote"></a>5.git remote</h3><pre class="line-numbers language-sql"><code class="language-sql">git remote   查看关联的远程仓库的名称git remote <span class="token keyword">add</span> url   添加一个远程仓库git remote <span class="token keyword">show</span> <span class="token punctuation">[</span>remote<span class="token punctuation">]</span> 显示某个远程仓库的信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatis-Plus学习记录</title>
      <link href="/2023/05/12/blog-open-source-mybatis-plus/"/>
      <url>/2023/05/12/blog-open-source-mybatis-plus/</url>
      
        <content type="html"><![CDATA[<h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="MyBatis-Plus通用查询"><a href="#MyBatis-Plus通用查询" class="headerlink" title="MyBatis-Plus通用查询"></a>MyBatis-Plus通用查询</h1><h2 id="CRUD接口"><a href="#CRUD接口" class="headerlink" title="CRUD接口"></a>CRUD接口</h2><p>service接口：service继承BaseMapper</p><h3 id="1、查询"><a href="#1、查询" class="headerlink" title="1、查询"></a>1、查询</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/*1、Get：查询一个*/</span><span class="token comment" spellcheck="true">// 根据 ID 查询</span>T <span class="token function">getById</span><span class="token punctuation">(</span>Serializable id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 根据 Wrapper，查询一条记录。结果集，如果是多个会抛出异常，随机取一条加上限制条件 wrapper.last("LIMIT 1")</span>T <span class="token function">getOne</span><span class="token punctuation">(</span>Wrapper<span class="token operator">&lt;</span>T<span class="token operator">></span> queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 根据 Wrapper，查询一条记录</span>T <span class="token function">getOne</span><span class="token punctuation">(</span>Wrapper<span class="token operator">&lt;</span>T<span class="token operator">></span> queryWrapper<span class="token punctuation">,</span> <span class="token keyword">boolean</span> throwEx<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 根据 Wrapper，查询一条记录</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">getMap</span><span class="token punctuation">(</span>Wrapper<span class="token operator">&lt;</span>T<span class="token operator">></span> queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*2、List：查询多条*/</span><span class="token comment" spellcheck="true">// 查询所有</span>List<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 查询列表</span>List<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">list</span><span class="token punctuation">(</span>Wrapper<span class="token operator">&lt;</span>T<span class="token operator">></span> queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 查询（根据ID 批量查询）</span>Collection<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">listByIds</span><span class="token punctuation">(</span>Collection<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Serializable</span><span class="token operator">></span> idList<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 查询（根据 columnMap 条件）</span>Collection<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">listByMap</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> columnMap<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 查询所有列表</span>List<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">>></span> <span class="token function">listMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 查询列表</span>List<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">>></span> <span class="token function">listMaps</span><span class="token punctuation">(</span>Wrapper<span class="token operator">&lt;</span>T<span class="token operator">></span> queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*3、Page：分页查询*/</span><span class="token comment" spellcheck="true">// 无条件分页查询</span>IPage<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">page</span><span class="token punctuation">(</span>IPage<span class="token operator">&lt;</span>T<span class="token operator">></span> page<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 条件分页查询</span>IPage<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">page</span><span class="token punctuation">(</span>IPage<span class="token operator">&lt;</span>T<span class="token operator">></span> page<span class="token punctuation">,</span> Wrapper<span class="token operator">&lt;</span>T<span class="token operator">></span> queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 无条件分页查询</span>IPage<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">>></span> <span class="token function">pageMaps</span><span class="token punctuation">(</span>IPage<span class="token operator">&lt;</span>T<span class="token operator">></span> page<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 条件分页查询</span>IPage<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">>></span> <span class="token function">pageMaps</span><span class="token punctuation">(</span>IPage<span class="token operator">&lt;</span>T<span class="token operator">></span> page<span class="token punctuation">,</span> Wrapper<span class="token operator">&lt;</span>T<span class="token operator">></span> queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">/</span><span class="token operator">*</span><span class="token number">4</span>、Count：条数<span class="token comment" spellcheck="true">// 查询总记录数</span><span class="token keyword">int</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 根据 Wrapper 条件，查询总记录数</span><span class="token keyword">int</span> <span class="token function">count</span><span class="token punctuation">(</span>Wrapper<span class="token operator">&lt;</span>T<span class="token operator">></span> queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2、添加"><a href="#2、添加" class="headerlink" title="2、添加"></a>2、添加</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/*1、Save*/</span><span class="token comment" spellcheck="true">// 插入一条记录（选择字段，策略插入）</span><span class="token keyword">boolean</span> <span class="token function">save</span><span class="token punctuation">(</span>T entity<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 插入（批量）</span><span class="token keyword">boolean</span> <span class="token function">saveBatch</span><span class="token punctuation">(</span>Collection<span class="token operator">&lt;</span>T<span class="token operator">></span> entityList<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 插入（批量）</span><span class="token keyword">boolean</span> <span class="token function">saveBatch</span><span class="token punctuation">(</span>Collection<span class="token operator">&lt;</span>T<span class="token operator">></span> entityList<span class="token punctuation">,</span> <span class="token keyword">int</span> batchSize<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*2、SaveOrUpdate*/</span><span class="token comment" spellcheck="true">// TableId 注解存在更新记录，否插入一条记录</span><span class="token keyword">boolean</span> <span class="token function">saveOrUpdate</span><span class="token punctuation">(</span>T entity<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 根据updateWrapper尝试更新，否继续执行saveOrUpdate(T)方法</span><span class="token keyword">boolean</span> <span class="token function">saveOrUpdate</span><span class="token punctuation">(</span>T entity<span class="token punctuation">,</span> Wrapper<span class="token operator">&lt;</span>T<span class="token operator">></span> updateWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 批量修改插入</span><span class="token keyword">boolean</span> <span class="token function">saveOrUpdateBatch</span><span class="token punctuation">(</span>Collection<span class="token operator">&lt;</span>T<span class="token operator">></span> entityList<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 批量修改插入</span><span class="token keyword">boolean</span> <span class="token function">saveOrUpdateBatch</span><span class="token punctuation">(</span>Collection<span class="token operator">&lt;</span>T<span class="token operator">></span> entityList<span class="token punctuation">,</span> <span class="token keyword">int</span> batchSize<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3、修改"><a href="#3、修改" class="headerlink" title="3、修改"></a>3、修改</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 根据 UpdateWrapper 条件，更新记录 需要设置sqlset</span><span class="token keyword">boolean</span> <span class="token function">update</span><span class="token punctuation">(</span>Wrapper<span class="token operator">&lt;</span>T<span class="token operator">></span> updateWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 根据 whereEntity 条件，更新记录</span><span class="token keyword">boolean</span> <span class="token function">update</span><span class="token punctuation">(</span>T entity<span class="token punctuation">,</span> Wrapper<span class="token operator">&lt;</span>T<span class="token operator">></span> updateWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 根据 ID 选择修改</span><span class="token keyword">boolean</span> <span class="token function">updateById</span><span class="token punctuation">(</span>T entity<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 根据ID 批量更新</span><span class="token keyword">boolean</span> <span class="token function">updateBatchById</span><span class="token punctuation">(</span>Collection<span class="token operator">&lt;</span>T<span class="token operator">></span> entityList<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 根据ID 批量更新</span><span class="token keyword">boolean</span> <span class="token function">updateBatchById</span><span class="token punctuation">(</span>Collection<span class="token operator">&lt;</span>T<span class="token operator">></span> entityList<span class="token punctuation">,</span> <span class="token keyword">int</span> batchSize<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4、删除"><a href="#4、删除" class="headerlink" title="4、删除"></a>4、删除</h3><pre><code>// 根据 entity 条件，删除记录boolean remove(Wrapper&lt;T&gt; queryWrapper);// 根据 ID 删除boolean removeById(Serializable id);// 根据 columnMap 条件，删除记录boolean removeByMap(Map&lt;String, Object&gt; columnMap);// 删除（根据ID 批量删除）boolean removeByIds(Collection&lt;? extends Serializable&gt; idList);</code></pre><h3 id="5、链式操作"><a href="#5、链式操作" class="headerlink" title="5、链式操作"></a>5、链式操作</h3><pre><code>// 链式查询 普通QueryChainWrapper&lt;T&gt; query();// 链式查询 lambda 式。注意：不支持 KotlinLambdaQueryChainWrapper&lt;T&gt; lambdaQuery(); // 示例：query().eq("column", value).one();lambdaQuery().eq(Entity::getId, value).list();// 链式更改 普通UpdateChainWrapper&lt;T&gt; update();// 链式更改 lambda 式。注意：不支持 Kotlin LambdaUpdateChainWrapper&lt;T&gt; lambdaUpdate();// 示例：update().eq("column", value).remove();lambdaUpdate().eq(Entity::getId, value).update(entity);</code></pre><h2 id="Lambda"><a href="#Lambda" class="headerlink" title="Lambda"></a>Lambda</h2><p>官方表示，3.x支持Lambda表达式，那应该怎么使用呢？我们来看个例子：</p><pre class="line-numbers language-java"><code class="language-java">QueryWrapper<span class="token operator">&lt;</span>Student<span class="token operator">></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>queryWrapper<span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>Student<span class="token operator">:</span><span class="token operator">:</span>getName<span class="token punctuation">,</span> <span class="token string">"SK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>List<span class="token operator">&lt;</span>Student<span class="token operator">></span> studentList <span class="token operator">=</span> <span class="token function">list</span><span class="token punctuation">(</span>queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>Student student <span class="token operator">:</span> studentList<span class="token punctuation">)</span>    Console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h2><p>【1】多<code>eq</code></p><pre><code>QueryWrapper&lt;Student&gt; queryWrapper = new QueryWrapper&lt;&gt;();queryWrapper.lambda()        .eq(Student::getName, "SK")        .eq(Student::getAge, 26);List&lt;Student&gt; studentList = list(queryWrapper);for (Student student : studentList)    Console.info(new Gson().toJson(student));</code></pre><p>对于这部分的测试，我想结果是毫无因为，那么你应该关注什么呢？没错，SQL，所以，我们直接看SQL。当然，结果也是可以看到的。</p><pre><code>==&gt;  Preparing: SELECT id,name,age,info,is_delete,create_time,update_time,gender,idcard_id,city_id FROM t_student WHERE name = ? AND age = ? ==&gt; Parameters: SK(String), 26(Integer)&lt;==    Columns: id, name, age, info, is_delete, create_time, update_time, gender, idcard_id, city_id&lt;==        Row: 1035789714459471874, SK, 26, &lt;&lt;BLOB&gt;&gt;, 0, 2018-09-01 15:21:26.0, 2018-09-01 15:21:26.0, 1, 1035789714388168706, 1035762001753501698&lt;==      Total: 1</code></pre><p>我们还可以这样写：</p><pre><code>QueryWrapper&lt;Student&gt; queryWrapper = new QueryWrapper&lt;&gt;();queryWrapper.lambda()        .and(obj -&gt;                obj.eq(Student::getName, "SK")                    .eq(Student::getAge, 26));List&lt;Student&gt; studentList = list(queryWrapper);for (Student student : studentList)    Console.info(new Gson().toJson(student));</code></pre><p>【2】<code>or</code></p><p>第一种：</p><pre><code>QueryWrapper&lt;Student&gt; queryWrapper = new QueryWrapper&lt;&gt;();queryWrapper.lambda()        .or(obj1 -&gt; obj1.eq(Student::getName, "SK"))        .or(obj2 -&gt; obj2.eq(Student::getName, "1"));List&lt;Student&gt; studentList = list(queryWrapper);for (Student student : studentList)    Console.info(new Gson().toJson(student));</code></pre><p>sql:</p><pre><code>SELECT * FROM t_student WHERE ( name = ? ) OR ( name = ? ) </code></pre><p>第二种：</p><pre><code>QueryWrapper&lt;Student&gt; queryWrapper = new QueryWrapper&lt;&gt;();queryWrapper.lambda()        .eq(Student::getName, "SK")        .or()        .eq(Student::getName, "1");List&lt;Student&gt; studentList = list(queryWrapper);for (Student student : studentList)    Console.info(new Gson().toJson(student));</code></pre><p>SQL:</p><pre><code>SELECT * FROM t_student WHERE name = ? OR name = ? </code></pre><p>这样的话，我们就可以拼接各种条件了。那么问题来了：到底有哪些关键字呢？性能如何呢？</p><h2 id="条件构造器"><a href="#条件构造器" class="headerlink" title="条件构造器"></a>条件构造器</h2><p><a href="https://baomidou.gitee.io/mybatis-plus-doc/#/wrapper?id=条件参数说明" target="_blank" rel="noopener">条件参数说明</a></p><table><thead><tr><th align="left">查询方式</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">setSqlSelect</td><td align="left">设置 SELECT 查询字段</td></tr><tr><td align="left">where</td><td align="left">WHERE 语句，拼接 + <code>WHERE 条件</code></td></tr><tr><td align="left">and</td><td align="left">AND 语句，拼接 + <code>AND 字段=值</code></td></tr><tr><td align="left">andNew</td><td align="left">AND 语句，拼接 + <code>AND (字段=值)</code></td></tr><tr><td align="left">or</td><td align="left">OR 语句，拼接 + <code>OR 字段=值</code></td></tr><tr><td align="left">orNew</td><td align="left">OR 语句，拼接 + <code>OR (字段=值)</code></td></tr><tr><td align="left">eq</td><td align="left">等于=</td></tr><tr><td align="left">allEq</td><td align="left">基于 map 内容等于=</td></tr><tr><td align="left">ne</td><td align="left">不等于&lt;&gt;</td></tr><tr><td align="left">gt</td><td align="left">大于&gt;</td></tr><tr><td align="left">ge</td><td align="left">大于等于&gt;=</td></tr><tr><td align="left">lt</td><td align="left">小于&lt;</td></tr><tr><td align="left">le</td><td align="left">小于等于&lt;=</td></tr><tr><td align="left">like</td><td align="left">模糊查询 LIKE</td></tr><tr><td align="left">notLike</td><td align="left">模糊查询 NOT LIKE</td></tr><tr><td align="left">in</td><td align="left">IN 查询</td></tr><tr><td align="left">notIn</td><td align="left">NOT IN 查询</td></tr><tr><td align="left">isNull</td><td align="left">NULL 值查询</td></tr><tr><td align="left">isNotNull</td><td align="left">IS NOT NULL</td></tr><tr><td align="left">groupBy</td><td align="left">分组 GROUP BY</td></tr><tr><td align="left">having</td><td align="left">HAVING 关键词</td></tr><tr><td align="left">orderBy</td><td align="left">排序 ORDER BY</td></tr><tr><td align="left">orderAsc</td><td align="left">ASC 排序 ORDER BY</td></tr><tr><td align="left">orderDesc</td><td align="left">DESC 排序 ORDER BY</td></tr><tr><td align="left">exists</td><td align="left">EXISTS 条件语句</td></tr><tr><td align="left">notExists</td><td align="left">NOT EXISTS 条件语句</td></tr><tr><td align="left">between</td><td align="left">BETWEEN 条件语句</td></tr><tr><td align="left">notBetween</td><td align="left">NOT BETWEEN 条件语句</td></tr><tr><td align="left">addFilter</td><td align="left">自由拼接 SQL</td></tr><tr><td align="left">last</td><td align="left">拼接在最后，例如：last(“LIMIT 1”)</td></tr></tbody></table><p>注意！ xxNew 都是另起 <code>( ... )</code> 括号包裹。</p><h2 id="自定义sql"><a href="#自定义sql" class="headerlink" title="自定义sql"></a>自定义sql</h2><p>如果官方提供的满足不了你的需求，或者你的需求很复杂，导致你不知道如何使用条件构造器，那应该怎么办呢？</p><p>很简单。</p><p>第一步：找到 Dao，写一个数据库操作接口</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StudentDao</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token operator">&lt;</span>Student<span class="token operator">></span> <span class="token punctuation">{</span>    List<span class="token operator">&lt;</span>Student<span class="token operator">></span> <span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>第二步：在xml文件中写sql</p><pre><code>&lt;!--List&lt;Student&gt; selectAll();--&gt;&lt;select id="selectAll" resultMap="BaseResultMap"&gt;    select * from t_student&lt;/select&gt;</code></pre><p>这样我们就可以使用了：</p><pre><code>@ResourceStudentDao studentDao;List&lt;Student&gt; studentList = studentDao.selectAll();for (Student student : studentList)    Console.info(new Gson().toJson(student));</code></pre><p>测试：</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" alt="自定义sql测试"></p><h2 id="封装我们自己的Service"><a href="#封装我们自己的Service" class="headerlink" title="封装我们自己的Service"></a>封装我们自己的Service</h2><p>前面我们就说了，我是很不喜欢MP的查询接口的，我们就把他弄成我们喜欢的吧，我这里借鉴 JPA接口了，哈哈</p><p>interface:</p><pre><code>/** * 查询所有数据 * @return List&lt;Student&gt; */List&lt;Student&gt; findAll();/** * 查询部分数据 * @return List&lt;Student&gt; */List&lt;Student&gt; findList();/** * 查询一条数据 * @return Student */Student findOne();/** * 根据主键ID查询数据 * @param id 主键ID，为null，返回null * @return Student */Student findById(Long id);</code></pre><p>impl:</p><pre><code>@Overridepublic List&lt;Student&gt; findAll() {    return list(null);}@Overridepublic List&lt;Student&gt; findList() {    return list(null);}@Overridepublic Student findOne() {    return getOne(null);}@Overridepublic Student findById(Long id) {    ExceptionUtil.notNull(id, "id must not null.");    return getById(id);}预览</code></pre><p>一、条件构造器关系介绍</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/20210903205722934.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Lme5Yqb6ams5omO572X44Gu6buO5piO,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p><p>条件构造器关系介绍 ：<br>上图绿色框为抽象类abstract<br>蓝色框为正常class类，可new对象<br>黄色箭头指向为父子类关系，箭头指向为父类</p><p>wapper介绍 ：</p><p>Wrapper ： 条件构造抽象类，最顶端父类</p><p>AbstractWrapper ： 用于查询条件封装，生成 sql 的 where 条件</p><p>QueryWrapper ： Entity 对象封装操作类，不是用lambda语法</p><p>UpdateWrapper ： Update 条件封装，用于Entity对象更新操作</p><p>AbstractLambdaWrapper ： Lambda 语法使用 Wrapper统一处理解析 lambda 获取 column。</p><p>LambdaQueryWrapper ：看名称也能明白就是用于Lambda语法使用的查询Wrapper</p><p>LambdaUpdateWrapper ： Lambda 更新封装Wrapper</p><p>先了解一下内外连接：<br>什么是连接表？<br>多表查询原理：将多个表通过笛卡尔积形成一个虚表，再根据查询条件筛选符合条件的数据。<br>在关系数据库中，数据分布在多个逻辑表中。 要获得完整有意义的数据集，需要使用连接来查询这些表<br>中的数据。 SQL Server支持多种<br>连接包括<br><strong>INNER JOIN:内连接,</strong>关键字在表中存在至少一个匹配时返回行。<br>left join : 左连接，返回左表中所有的记录以及右表中连接字段相等的记录。<br>right join : 右连接，返回右表中所有的记录以及左表中连接字段相等的记录。<br>inner join : 内连接，又叫等值连接，只返回两个表中连接字段相等的行。<br>full join : 外连接，返回两个表中的行：left join + right join。<br>cross join : 结果是笛卡尔积，就是第一个表的行数乘以第二个表的行数。<br>GROUP BY:全外连接， 子句必须放在 WHERE 子句中的条件之后，必须放在 ORDER BY 子句之前<br>每种连接类型指定SQL Server如何使用一个表中的数据来选择另一个表中的行</p><p>SQL内连接(INNER JOIN)<br>返回两张表中符合连接条件的数据行</p><p>内连接是从结果表中删除与被连接表中未匹配行的所有行，所以内连接可能会丢失信息</p><p>SQL外连接（OUTER JOIN）</p><p>外连接（OUTER JOIN）分 为左连接、右连接和全连接</p><p>左连接：返回左表中的所以行，如果左表中行在右表中没有匹配行，则结果中右表中的列返回空值NULL</p><p>语法：SELECT * FROM 表1 LEFT OUTER JOIN 表2 ON 条件<br>eg：我们左连接Student表、Score表查询学生的成绩，SQL 语句如下：<br>SELECT * FROM Student LEFT OUTER JOIN Score ON Student.id = Score.studentID</p><p>右 连 接：返回右表中的所以行，如果右表中行在左表中没有匹配行，则结果中左表中的列返回空值NULL</p><p>语法：SELECT * FROM 表1 RIGHT OUTER JOIN 表2 ON 条件<br>eg：我们右连接Student表、Score表查询学生的成绩，SQL 语句如下：<br>SELECT * FROM Student RIGHT OUTER JOIN Score ON Student.id = Score.studentID</p><p>全连接：返回左表和右表中的所有行，当某行在另一表中没有匹配行，则另一表中的补NULL</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> MyBatis-Plus </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MyBatis-Plus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linu命令总结</title>
      <link href="/2023/05/12/blog-open-source-linux/"/>
      <url>/2023/05/12/blog-open-source-linux/</url>
      
        <content type="html"><![CDATA[<h2 id="简易的命令行入门教程"><a href="#简易的命令行入门教程" class="headerlink" title="简易的命令行入门教程:"></a>简易的命令行入门教程:</h2><p>Git 全局设置:</p><pre><code>git config --global user.name "sky"git config --global user.email "807928930@qq.com"</code></pre><p>创建 git 仓库:</p><pre><code>mkdir luyuncd luyungit init touch README.mdgit add README.mdgit commit -m "first commit"git remote add origin https://gitee.com/log6j/luyun.gitgit push -u origin "master"</code></pre><p>已有仓库?</p><pre><code>cd existing_git_repogit remote add origin https://gitee.com/log6j/luyun.gitgit push -u origin "master"</code></pre><h2 id="Linux关机-重启"><a href="#Linux关机-重启" class="headerlink" title="Linux关机,重启"></a>Linux关机,重启</h2><pre class="line-numbers language-go"><code class="language-go"># 关机shutdown <span class="token operator">-</span>h now# 重启shutdown <span class="token operator">-</span>r now<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="查看系统-CPU信息"><a href="#查看系统-CPU信息" class="headerlink" title="查看系统,CPU信息"></a>查看系统,CPU信息</h2><pre class="line-numbers language-go"><code class="language-go"># 查看系统内核信息uname <span class="token operator">-</span>a# 查看系统内核版本cat <span class="token operator">/</span>proc<span class="token operator">/</span>version# 查看当前用户环境变量envcat <span class="token operator">/</span>proc<span class="token operator">/</span>cpuinfo# 查看有几个逻辑cpu<span class="token punctuation">,</span> 包括cpu型号cat <span class="token operator">/</span>proc<span class="token operator">/</span>cpuinfo <span class="token operator">|</span> grep name <span class="token operator">|</span> cut <span class="token operator">-</span>f2 <span class="token operator">-</span>d<span class="token punctuation">:</span> <span class="token operator">|</span> uniq <span class="token operator">-</span>c# 查看有几颗cpu<span class="token punctuation">,</span>每颗分别是几核cat <span class="token operator">/</span>proc<span class="token operator">/</span>cpuinfo <span class="token operator">|</span> grep physical <span class="token operator">|</span> uniq <span class="token operator">-</span>c# 查看当前CPU运行在32bit还是64bit模式下<span class="token punctuation">,</span> 如果是运行在32bit下也不代表CPU不支持64bitgetconf LONG_BIT# 结果大于<span class="token number">0</span><span class="token punctuation">,</span> 说明支持64bit计算<span class="token punctuation">.</span> lm指long mode<span class="token punctuation">,</span> 支持lm则是64bitcat <span class="token operator">/</span>proc<span class="token operator">/</span>cpuinfo <span class="token operator">|</span> grep flags <span class="token operator">|</span> grep <span class="token string">' lm '</span> <span class="token operator">|</span> wc <span class="token operator">-</span>l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="建立软连接"><a href="#建立软连接" class="headerlink" title="建立软连接"></a>建立软连接</h2><pre class="line-numbers language-go"><code class="language-go">ln <span class="token operator">-</span>s <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>jdk1<span class="token number">.8</span><span class="token operator">/</span> jdk<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="rpm相关"><a href="#rpm相关" class="headerlink" title="rpm相关"></a>rpm相关</h2><pre class="line-numbers language-go"><code class="language-go"># 查看是否通过rpm安装了该软件rpm <span class="token operator">-</span>qa <span class="token operator">|</span> grep 软件名<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="sshkey"><a href="#sshkey" class="headerlink" title="sshkey"></a>sshkey</h2><pre class="line-numbers language-go"><code class="language-go"># 创建sshkeyssh<span class="token operator">-</span>keygen <span class="token operator">-</span>t rsa <span class="token operator">-</span>C your_email@example<span class="token punctuation">.</span>com#id_rsa<span class="token punctuation">.</span>pub 的内容拷贝到要控制的服务器的 home<span class="token operator">/</span>username<span class="token operator">/</span><span class="token punctuation">.</span>ssh<span class="token operator">/</span>authorized_keys 中<span class="token punctuation">,</span>如果没有则新建<span class="token punctuation">(</span><span class="token punctuation">.</span>ssh权限为<span class="token number">700</span><span class="token punctuation">,</span> authorized_keys权限为<span class="token number">600</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="命令重命名"><a href="#命令重命名" class="headerlink" title="命令重命名"></a>命令重命名</h2><pre class="line-numbers language-go"><code class="language-go"># 在各个用户的<span class="token punctuation">.</span>bash_profile中添加重命名配置alias ll<span class="token operator">=</span><span class="token string">'ls -alF'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="同步服务器时间"><a href="#同步服务器时间" class="headerlink" title="同步服务器时间"></a>同步服务器时间</h2><pre class="line-numbers language-go"><code class="language-go">sudo ntpdate <span class="token operator">-</span>u ntp<span class="token punctuation">.</span>api<span class="token punctuation">.</span>bz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="后台运行命令"><a href="#后台运行命令" class="headerlink" title="后台运行命令"></a>后台运行命令</h2><pre class="line-numbers language-go"><code class="language-go"># 后台运行<span class="token punctuation">,</span>并且有nohup<span class="token punctuation">.</span>out输出nohup xxx <span class="token operator">&amp;</span># 后台运行<span class="token punctuation">,</span> 不输出任何日志nohup xxx <span class="token operator">></span> <span class="token operator">/</span>dev<span class="token operator">/</span>null <span class="token operator">&amp;</span># 后台运行<span class="token punctuation">,</span> 并将错误信息做标准输出到日志中 nohup xxx <span class="token operator">></span>out<span class="token punctuation">.</span>log <span class="token number">2</span><span class="token operator">></span><span class="token operator">&amp;</span><span class="token number">1</span> <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="强制活动用户退出"><a href="#强制活动用户退出" class="headerlink" title="强制活动用户退出"></a>强制活动用户退出</h2><pre class="line-numbers language-go"><code class="language-go"># 命令来完成强制活动用户退出<span class="token punctuation">.</span>其中TTY表示终端名称pkill <span class="token operator">-</span>kill <span class="token operator">-</span>t <span class="token punctuation">[</span>TTY<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="查看命令路径"><a href="#查看命令路径" class="headerlink" title="查看命令路径"></a>查看命令路径</h2><pre class="line-numbers language-go"><code class="language-go">which <span class="token operator">&lt;</span>命令<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="查看进程所有打开最大fd数"><a href="#查看进程所有打开最大fd数" class="headerlink" title="查看进程所有打开最大fd数"></a>查看进程所有打开最大fd数</h2><pre class="line-numbers language-go"><code class="language-go">ulimit <span class="token operator">-</span>n<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="配置dns"><a href="#配置dns" class="headerlink" title="配置dns"></a>配置dns</h2><pre class="line-numbers language-go"><code class="language-go">vim <span class="token operator">/</span>etc<span class="token operator">/</span>resolv<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="nslookup-查看域名路由表"><a href="#nslookup-查看域名路由表" class="headerlink" title="nslookup,查看域名路由表"></a>nslookup,查看域名路由表</h2><pre class="line-numbers language-go"><code class="language-go">nslookup google<span class="token punctuation">.</span>com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="last-最近登录信息列表"><a href="#last-最近登录信息列表" class="headerlink" title="last, 最近登录信息列表"></a>last, 最近登录信息列表</h2><pre class="line-numbers language-go"><code class="language-go"># 最近登录的<span class="token number">5</span>个账号last <span class="token operator">-</span>n <span class="token number">5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="设置固定ip"><a href="#设置固定ip" class="headerlink" title="设置固定ip"></a>设置固定ip</h2><p>搜索公纵号：<a href="https://blog.csdn.net/liliangpin/article/details/124938445" target="_blank" rel="noopener">MarkerHub</a>，关注回复[ <strong>vue</strong> ]获取前后端入门教程！</p><pre class="line-numbers language-go"><code class="language-go">ifconfig em1  <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">5.177</span> netmask <span class="token number">255.255</span><span class="token punctuation">.</span><span class="token number">255.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="查看进程内加载的环境变量"><a href="#查看进程内加载的环境变量" class="headerlink" title="查看进程内加载的环境变量"></a>查看进程内加载的环境变量</h2><pre class="line-numbers language-go"><code class="language-go"># 也可以去 cd <span class="token operator">/</span>proc 目录下<span class="token punctuation">,</span> 查看进程内存中加载的东西ps eww <span class="token operator">-</span>p  <span class="token function">XXXXX</span><span class="token punctuation">(</span>进程号<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="查看进程树找到服务器进程"><a href="#查看进程树找到服务器进程" class="headerlink" title="查看进程树找到服务器进程"></a>查看进程树找到服务器进程</h2><pre class="line-numbers language-go"><code class="language-go">ps auwxf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="查看进程启动路径"><a href="#查看进程启动路径" class="headerlink" title="查看进程启动路径"></a>查看进程启动路径</h2><pre class="line-numbers language-go"><code class="language-go">cd <span class="token operator">/</span>proc<span class="token operator">/</span><span class="token function">xxx</span><span class="token punctuation">(</span>进程号<span class="token punctuation">)</span>ls <span class="token operator">-</span>all# cwd对应的是启动路径<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="添加用户-配置sudo权限"><a href="#添加用户-配置sudo权限" class="headerlink" title="添加用户, 配置sudo权限"></a>添加用户, 配置sudo权限</h2><pre class="line-numbers language-go"><code class="language-go"># 新增用户useradd 用户名passwd 用户名#增加sudo权限vim <span class="token operator">/</span>etc<span class="token operator">/</span>sudoers# 修改文件里面的# root    ALL<span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span>       ALL# 用户名 ALL<span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span>       ALL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="强制关闭进程名包含xxx的所有进程"><a href="#强制关闭进程名包含xxx的所有进程" class="headerlink" title="强制关闭进程名包含xxx的所有进程"></a>强制关闭进程名包含xxx的所有进程</h2><pre class="line-numbers language-go"><code class="language-go">ps aux<span class="token operator">|</span>grep xxx <span class="token operator">|</span> grep <span class="token operator">-</span>v grep <span class="token operator">|</span> awk <span class="token string">'{print $2}'</span> <span class="token operator">|</span> xargs kill <span class="token operator">-</span><span class="token number">9</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="磁盘-文件-目录相关操作"><a href="#磁盘-文件-目录相关操作" class="headerlink" title="磁盘,文件,目录相关操作"></a>磁盘,文件,目录相关操作</h2><h2 id="vim操作"><a href="#vim操作" class="headerlink" title="vim操作"></a>vim操作</h2><pre class="line-numbers language-go"><code class="language-go">#normal模式下 g表示全局<span class="token punctuation">,</span> x表示查找的内容<span class="token punctuation">,</span> y表示替换后的内容<span class="token punctuation">:</span><span class="token operator">%</span>s<span class="token operator">/</span>x<span class="token operator">/</span>y<span class="token operator">/</span>g#normal模式下<span class="token number">0</span>  # 光标移到行首<span class="token punctuation">(</span>数字<span class="token number">0</span><span class="token punctuation">)</span>$  # 光标移至行尾shift <span class="token operator">+</span> g # 跳到文件最后gg # 跳到文件头# 显示行号<span class="token punctuation">:</span>set nu# 去除行号<span class="token punctuation">:</span>set nonu# 检索<span class="token operator">/</span><span class="token function">xxx</span><span class="token punctuation">(</span>检索内容<span class="token punctuation">)</span>  # 从头检索<span class="token punctuation">,</span> 按n查找下一个?<span class="token function">xxx</span><span class="token punctuation">(</span>检索内容<span class="token punctuation">)</span>  # 从尾部检索<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="打开只读文件-修改后需要保存时-不用切换用户即可保存的方式"><a href="#打开只读文件-修改后需要保存时-不用切换用户即可保存的方式" class="headerlink" title="打开只读文件,修改后需要保存时(不用切换用户即可保存的方式)"></a>打开只读文件,修改后需要保存时(不用切换用户即可保存的方式)</h2><pre class="line-numbers language-go"><code class="language-go"># 在normal模式下<span class="token punctuation">:</span>w <span class="token operator">!</span>sudo tee <span class="token operator">%</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="查看磁盘-文件目录基本信息"><a href="#查看磁盘-文件目录基本信息" class="headerlink" title="查看磁盘, 文件目录基本信息"></a>查看磁盘, 文件目录基本信息</h2><pre class="line-numbers language-go"><code class="language-go"># 查看磁盘挂载情况mount# 查看磁盘分区信息df# 查看目录及子目录大小du <span class="token operator">-</span>H <span class="token operator">-</span>h# 查看当前目录下各个文件<span class="token punctuation">,</span> 文件夹占了多少空间<span class="token punctuation">,</span> 不会递归du <span class="token operator">-</span>sh <span class="token operator">*</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="wc命令"><a href="#wc命令" class="headerlink" title="wc命令"></a>wc命令</h2><pre class="line-numbers language-go"><code class="language-go"># 查看文件里有多少行wc <span class="token operator">-</span>l filename# 看文件里有多少个wordwc <span class="token operator">-</span>w filename# 文件里最长的那一行是多少个字wc <span class="token operator">-</span>L filename# 统计字节数wc <span class="token operator">-</span>c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="常用压缩-解压缩命令"><a href="#常用压缩-解压缩命令" class="headerlink" title="常用压缩, 解压缩命令"></a>常用压缩, 解压缩命令</h2><h2 id="压缩命令"><a href="#压缩命令" class="headerlink" title="压缩命令"></a>压缩命令</h2><pre class="line-numbers language-go"><code class="language-go">tar czvf xxx<span class="token punctuation">.</span>tar 压缩目录zip <span class="token operator">-</span>r xxx<span class="token punctuation">.</span>zip 压缩目录<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="解压缩命令"><a href="#解压缩命令" class="headerlink" title="解压缩命令"></a>解压缩命令</h2><pre class="line-numbers language-go"><code class="language-go">tar zxvf xxx<span class="token punctuation">.</span>tar# 解压到指定文件夹tar zxvf xxx<span class="token punctuation">.</span>tar <span class="token operator">-</span>C <span class="token operator">/</span>xxx<span class="token operator">/</span>yyy<span class="token operator">/</span>unzip xxx<span class="token punctuation">.</span>zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="变更文件所属用户-用户组"><a href="#变更文件所属用户-用户组" class="headerlink" title="变更文件所属用户, 用户组"></a>变更文件所属用户, 用户组</h2><pre class="line-numbers language-go"><code class="language-go">chown eagleye<span class="token punctuation">.</span>eagleye xxx<span class="token punctuation">.</span>log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="cp-scp-mkdir"><a href="#cp-scp-mkdir" class="headerlink" title="cp, scp, mkdir"></a>cp, scp, mkdir</h2><pre class="line-numbers language-go"><code class="language-go">#复制cp xxx<span class="token punctuation">.</span>log# 复制并强制覆盖同名文件cp <span class="token operator">-</span>f xxx<span class="token punctuation">.</span>log# 复制文件夹cp <span class="token operator">-</span>r <span class="token function">xxx</span><span class="token punctuation">(</span>源文件夹<span class="token punctuation">)</span> <span class="token function">yyy</span><span class="token punctuation">(</span>目标文件夹<span class="token punctuation">)</span># 远程复制scp <span class="token operator">-</span>P ssh端口 username@<span class="token number">10.10</span><span class="token punctuation">.</span><span class="token number">10.101</span><span class="token punctuation">:</span><span class="token operator">/</span>home<span class="token operator">/</span>username<span class="token operator">/</span>xxx <span class="token operator">/</span>home<span class="token operator">/</span>xxx# 级联创建目录mkdir <span class="token operator">-</span>p <span class="token operator">/</span>xxx<span class="token operator">/</span>yyy<span class="token operator">/</span>zzz# 批量创建文件夹<span class="token punctuation">,</span> 会在test<span class="token punctuation">,</span>main下都创建java<span class="token punctuation">,</span> resources文件夹mkdir <span class="token operator">-</span>p src<span class="token operator">/</span><span class="token punctuation">{</span>test<span class="token punctuation">,</span>main<span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">{</span>java<span class="token punctuation">,</span>resources<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="比较两个文件"><a href="#比较两个文件" class="headerlink" title="比较两个文件"></a>比较两个文件</h2><pre class="line-numbers language-go"><code class="language-go">diff <span class="token operator">-</span>u <span class="token number">1.</span>txt <span class="token number">2.</span>txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="日志输出的字节数-可以用作性能测试"><a href="#日志输出的字节数-可以用作性能测试" class="headerlink" title="日志输出的字节数,可以用作性能测试"></a>日志输出的字节数,可以用作性能测试</h2><pre class="line-numbers language-go"><code class="language-go"># 如果做性能测试<span class="token punctuation">,</span> 可以每执行一次<span class="token punctuation">,</span> 往日志里面输出 “<span class="token punctuation">.</span>” <span class="token punctuation">,</span> 这样日志中的字节数就是实际的性能测试运行的次数<span class="token punctuation">,</span> 还可以看见实时速率<span class="token punctuation">.</span>tail <span class="token operator">-</span>f xxx<span class="token punctuation">.</span>log <span class="token operator">|</span> pv <span class="token operator">-</span>bt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="查看-去除特殊字符"><a href="#查看-去除特殊字符" class="headerlink" title="查看, 去除特殊字符"></a>查看, 去除特殊字符</h2><pre class="line-numbers language-go"><code class="language-go"># 查看特殊字符cat <span class="token operator">-</span>v xxx<span class="token punctuation">.</span>sh# 去除特殊字符sed <span class="token operator">-</span>i 's<span class="token operator">/</span><span class="token operator">^</span>M<span class="token comment" spellcheck="true">//g’ env.sh  去除文件的特殊字符, 比如^M:  需要这样输入: ctrl+v+enter</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="处理因系统原因引起的文件中特殊字符的问题"><a href="#处理因系统原因引起的文件中特殊字符的问题" class="headerlink" title="处理因系统原因引起的文件中特殊字符的问题"></a>处理因系统原因引起的文件中特殊字符的问题</h2><pre class="line-numbers language-go"><code class="language-go"># 可以转换为该系统下的文件格式cat file<span class="token punctuation">.</span>sh <span class="token operator">></span> file<span class="token punctuation">.</span>sh_bak# 先将file<span class="token punctuation">.</span>sh中文件内容复制下来然后运行<span class="token punctuation">,</span> 然后粘贴内容<span class="token punctuation">,</span> 最后ctrl <span class="token operator">+</span> d 保存退出cat <span class="token operator">></span> file1<span class="token punctuation">.</span>sh# 在vim中通过如下设置文件编码和文件格式<span class="token punctuation">:</span>set fileencodings<span class="token operator">=</span>utf<span class="token number">-8</span> ，然后 w （存盘）一下即可转化为 utf8 格式，<span class="token punctuation">:</span>set fileformat<span class="token operator">=</span>unix# 在mac下使用dos2unix进行文件格式化find <span class="token punctuation">.</span> <span class="token operator">-</span>name <span class="token string">"*.sh"</span> <span class="token operator">|</span> xargs dos2unix<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="tee-重定向的同时输出到屏幕"><a href="#tee-重定向的同时输出到屏幕" class="headerlink" title="tee, 重定向的同时输出到屏幕"></a>tee, 重定向的同时输出到屏幕</h2><pre class="line-numbers language-go"><code class="language-go">awk ‘<span class="token punctuation">{</span><span class="token builtin">print</span> $<span class="token number">0</span><span class="token punctuation">}</span>’ xxx<span class="token punctuation">.</span>log <span class="token operator">|</span> tee test<span class="token punctuation">.</span>log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="检索相关"><a href="#检索相关" class="headerlink" title="检索相关"></a>检索相关</h2><h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><pre class="line-numbers language-go"><code class="language-go"># 反向匹配<span class="token punctuation">,</span> 查找不包含xxx的内容grep <span class="token operator">-</span>v xxx# 排除所有空行grep <span class="token operator">-</span>v <span class="token string">'^$'</span># 返回结果 <span class="token number">2</span><span class="token punctuation">,</span>则说明第二行是空行grep <span class="token operator">-</span>n “<span class="token operator">^</span>$” <span class="token number">111.</span>txt    # 查询以abc开头的行grep <span class="token operator">-</span>n “<span class="token operator">^</span>abc” <span class="token number">111.</span>txt # 同时列出该词语出现在文章的第几行grep <span class="token string">'xxx'</span> <span class="token operator">-</span>n xxx<span class="token punctuation">.</span>log# 计算一下该字串出现的次数grep <span class="token string">'xxx'</span> <span class="token operator">-</span>c xxx<span class="token punctuation">.</span>log# 比对的时候，不计较大小写的不同grep <span class="token string">'xxx'</span> <span class="token operator">-</span>i xxx<span class="token punctuation">.</span>log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h2><pre class="line-numbers language-go"><code class="language-go"># 以<span class="token string">':'</span> 为分隔符<span class="token punctuation">,</span>如果第五域有user则输出该行awk <span class="token operator">-</span>F <span class="token string">':'</span> <span class="token string">'{if ($5 ~ /user/) print $0}'</span> <span class="token operator">/</span>etc<span class="token operator">/</span>passwd # 统计单个文件中某个字符（串）<span class="token punctuation">(</span>中文无效<span class="token punctuation">)</span>出现的次数awk <span class="token operator">-</span>v RS<span class="token operator">=</span><span class="token string">'character'</span> <span class="token string">'END {print --NR}'</span> xxx<span class="token punctuation">.</span>txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="find检索命令"><a href="#find检索命令" class="headerlink" title="find检索命令"></a>find检索命令</h2><pre class="line-numbers language-go"><code class="language-go"># 在目录下找后缀是<span class="token punctuation">.</span>mysql的文件find <span class="token operator">/</span>home<span class="token operator">/</span>eagleye <span class="token operator">-</span>name <span class="token string">'*.mysql'</span> <span class="token operator">-</span><span class="token builtin">print</span># 会从 <span class="token operator">/</span>usr 目录开始往下找，找最近<span class="token number">3</span>天之内存取过的文件。find <span class="token operator">/</span>usr <span class="token operator">-</span>atime <span class="token number">3</span> –<span class="token builtin">print</span># 会从 <span class="token operator">/</span>usr 目录开始往下找，找最近<span class="token number">5</span>天之内修改过的文件。find <span class="token operator">/</span>usr <span class="token operator">-</span>ctime <span class="token number">5</span> –<span class="token builtin">print</span># 会从 <span class="token operator">/</span>doc 目录开始往下找，找jacky 的、文件名开头是 j的文件。  find <span class="token operator">/</span>doc <span class="token operator">-</span>user jacky <span class="token operator">-</span>name <span class="token string">'j*'</span> –<span class="token builtin">print</span># 会从 <span class="token operator">/</span>doc 目录开始往下找，找寻文件名是 ja 开头或者 ma开头的文件。find <span class="token operator">/</span>doc \<span class="token punctuation">(</span> <span class="token operator">-</span>name <span class="token string">'ja*'</span> <span class="token operator">-</span>o<span class="token operator">-</span> <span class="token operator">-</span>name <span class="token string">'ma*'</span> \<span class="token punctuation">)</span> –<span class="token builtin">print</span>#  会从 <span class="token operator">/</span>doc 目录开始往下找，找到凡是文件名结尾为 bak的文件，把它删除掉。<span class="token operator">-</span>exec 选项是执行的意思，rm 是删除命令，<span class="token punctuation">{</span> <span class="token punctuation">}</span> 表示文件名，“\<span class="token punctuation">;</span>”是规定的命令结尾。 find <span class="token operator">/</span>doc <span class="token operator">-</span>name <span class="token string">'*bak'</span> <span class="token operator">-</span>exec rm <span class="token punctuation">{</span><span class="token punctuation">}</span> \<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="网络相关"><a href="#网络相关" class="headerlink" title="网络相关"></a>网络相关</h2><h2 id="查看什么进程使用了该端口"><a href="#查看什么进程使用了该端口" class="headerlink" title="查看什么进程使用了该端口"></a>查看什么进程使用了该端口</h2><pre class="line-numbers language-go"><code class="language-go">lsof <span class="token operator">-</span>i<span class="token punctuation">:</span>port<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="获取本机ip地址"><a href="#获取本机ip地址" class="headerlink" title="获取本机ip地址"></a>获取本机ip地址</h2><pre class="line-numbers language-go"><code class="language-go"><span class="token operator">/</span>sbin<span class="token operator">/</span>ifconfig <span class="token operator">-</span>a<span class="token operator">|</span>grep inet<span class="token operator">|</span>grep <span class="token operator">-</span>v <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">|</span>grep <span class="token operator">-</span>v inet6<span class="token operator">|</span>awk <span class="token string">'{print $2}'</span><span class="token operator">|</span>tr <span class="token operator">-</span>d <span class="token string">"addr:"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h2><pre class="line-numbers language-go"><code class="language-go"># 查看iptables状态service iptables status# 要封停一个ipiptables <span class="token operator">-</span>I INPUT <span class="token operator">-</span>s <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token operator">-</span>j DROP# 要解封一个IP，使用下面这条命令：iptables <span class="token operator">-</span>D INPUT <span class="token operator">-</span>s <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token operator">-</span>j DROP备注<span class="token punctuation">:</span> 参数<span class="token operator">-</span>I是表示Insert（添加），<span class="token operator">-</span>D表示Delete（删除）。后面跟的是规则，INPUT表示入站，<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>表示要封停的IP，DROP表示放弃连接。#开启<span class="token number">9090</span>端口的访问<span class="token operator">/</span>sbin<span class="token operator">/</span>iptables <span class="token operator">-</span>I INPUT <span class="token operator">-</span>p tcp <span class="token operator">--</span>dport <span class="token number">9090</span> <span class="token operator">-</span>j ACCEPT # 防火墙开启、关闭、重启<span class="token operator">/</span>etc<span class="token operator">/</span>init<span class="token punctuation">.</span>d<span class="token operator">/</span>iptables status<span class="token operator">/</span>etc<span class="token operator">/</span>init<span class="token punctuation">.</span>d<span class="token operator">/</span>iptables start<span class="token operator">/</span>etc<span class="token operator">/</span>init<span class="token punctuation">.</span>d<span class="token operator">/</span>iptables stop<span class="token operator">/</span>etc<span class="token operator">/</span>init<span class="token punctuation">.</span>d<span class="token operator">/</span>iptables restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="nc命令-tcp调试利器"><a href="#nc命令-tcp调试利器" class="headerlink" title="nc命令, tcp调试利器"></a>nc命令, tcp调试利器</h2><pre class="line-numbers language-go"><code class="language-go">#给某一个endpoint发送TCP请求<span class="token punctuation">,</span>就将data的内容发送到对端nc <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">0.11</span> <span class="token number">8000</span> <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>txt#nc可以当做服务器，监听某个端口号<span class="token punctuation">,</span>把某一次请求的内容存储到received_data里nc <span class="token operator">-</span>l <span class="token number">8000</span> <span class="token operator">></span> received_data#上边只监听一次，如果多次可以加上<span class="token operator">-</span>k参数nc <span class="token operator">-</span>lk <span class="token number">8000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="tcpdump"><a href="#tcpdump" class="headerlink" title="tcpdump"></a>tcpdump</h2><pre class="line-numbers language-go"><code class="language-go"># dump出本机<span class="token number">12301</span>端口的tcp包tcpdump <span class="token operator">-</span>i em1 tcp port <span class="token number">12301</span> <span class="token operator">-</span>s <span class="token number">1500</span> <span class="token operator">-</span>w abc<span class="token punctuation">.</span>pcap<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="跟踪网络路由路径"><a href="#跟踪网络路由路径" class="headerlink" title="跟踪网络路由路径"></a>跟踪网络路由路径</h2><pre class="line-numbers language-go"><code class="language-go"># traceroute默认使用udp方式<span class="token punctuation">,</span> 如果是<span class="token operator">-</span>I则改成icmp方式traceroute <span class="token operator">-</span>I www<span class="token number">.163</span><span class="token punctuation">.</span>com# 从ttl第<span class="token number">3</span>跳跟踪traceroute <span class="token operator">-</span>M <span class="token number">3</span> www<span class="token number">.163</span><span class="token punctuation">.</span>com  # 加上端口跟踪traceroute <span class="token operator">-</span>p <span class="token number">8080</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">10.11</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ss"><a href="#ss" class="headerlink" title="ss"></a>ss</h2><pre class="line-numbers language-go"><code class="language-go"># 显示本地打开的所有端口ss <span class="token operator">-</span>l # 显示每个进程具体打开的socketss <span class="token operator">-</span>pl # 显示所有tcp socketss <span class="token operator">-</span>t <span class="token operator">-</span>a # 显示所有的UDP Socektss <span class="token operator">-</span>u <span class="token operator">-</span>a # 显示所有已建立的SMTP连接ss <span class="token operator">-</span>o state established <span class="token string">'( dport = :smtp or sport = :smtp )'</span>  # 显示所有已建立的HTTP连接 ss <span class="token operator">-</span>o state established <span class="token string">'( dport = :http or sport = :http )'</span>  找出所有连接X服务器的进程ss <span class="token operator">-</span>x src <span class="token operator">/</span>tmp<span class="token operator">/</span><span class="token punctuation">.</span>X11<span class="token operator">-</span>unix<span class="token operator">/</span><span class="token operator">*</span>  列出当前socket统计信息ss <span class="token operator">-</span>s 解释：netstat是遍历<span class="token operator">/</span>proc下面每个PID目录，ss直接读<span class="token operator">/</span>proc<span class="token operator">/</span>net下面的统计信息。所以ss执行的时候消耗资源以及消耗的时间都比netstat少很多<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h2><pre class="line-numbers language-go"><code class="language-go"># 输出每个ip的连接数，以及总的各个状态的连接数netstat <span class="token operator">-</span>n <span class="token operator">|</span> awk <span class="token string">'/^tcp/ {n=split($(NF-1),array,":");if(n&lt;=2)++S[array[(1)]];else++S[array[(4)]];++s[$NF];++N} END {for(a in S){printf("%-20s %s\n", a, S[a]);++I}printf("%-20s %s\n","TOTAL_IP",I);for(a in s) printf("%-20s %s\n",a, s[a]);printf("%-20s %s\n","TOTAL_LINK",N);}'</span># 统计所有连接状态<span class="token punctuation">,</span> # CLOSED：无连接是活动的或正在进行# LISTEN：服务器在等待进入呼叫# SYN_RECV：一个连接请求已经到达，等待确认# SYN_SENT：应用已经开始，打开一个连接# ESTABLISHED：正常数据传输状态# FIN_WAIT1：应用说它已经完成# FIN_WAIT2：另一边已同意释放# ITMED_WAIT：等待所有分组死掉# CLOSING：两边同时尝试关闭# TIME_WAIT：主动关闭连接一端还没有等到另一端反馈期间的状态# LAST_ACK：等待所有分组死掉netstat <span class="token operator">-</span>n <span class="token operator">|</span> awk <span class="token string">'/^tcp/ {++state[$NF]} END {for(key in state) print key,"\t",state[key]}'</span># 查找较多time_wait连接netstat <span class="token operator">-</span>n<span class="token operator">|</span>grep TIME_WAIT<span class="token operator">|</span>awk <span class="token string">'{print $5}'</span><span class="token operator">|</span>sort<span class="token operator">|</span>uniq <span class="token operator">-</span>c<span class="token operator">|</span>sort <span class="token operator">-</span>rn<span class="token operator">|</span>head <span class="token operator">-</span>n20<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="监控linux性能命令"><a href="#监控linux性能命令" class="headerlink" title="监控linux性能命令"></a>监控linux性能命令</h2><h2 id="top"><a href="#top" class="headerlink" title="top"></a>top</h2><pre class="line-numbers language-go"><code class="language-go">按大写的 F 或 O 键，然后按 a<span class="token operator">-</span>z 可以将进程按照相应的列进行排序<span class="token punctuation">,</span> 然后回车。而大写的 R 键可以将当前的排序倒转<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><table><thead><tr><th align="left">列名</th><th align="left">含义</th></tr></thead><tbody><tr><td align="left">PID</td><td align="left">进程id</td></tr><tr><td align="left">PPID</td><td align="left">父进程id</td></tr><tr><td align="left">RUSER</td><td align="left">Real user name</td></tr><tr><td align="left">UID</td><td align="left">进程所有者的用户id</td></tr><tr><td align="left">USER</td><td align="left">进程所有者的用户名</td></tr><tr><td align="left">GROUP</td><td align="left">进程所有者的组名</td></tr><tr><td align="left">TTY</td><td align="left">启动进程的终端名。不是从终端启动的进程则显示为 ?</td></tr><tr><td align="left">PR</td><td align="left">优先级</td></tr><tr><td align="left">NI</td><td align="left">nice值。负值表示高优先级，正值表示低优先级</td></tr><tr><td align="left">P</td><td align="left">最后使用的CPU，仅在多CPU环境下有意义</td></tr><tr><td align="left">%CPU</td><td align="left">上次更新到现在的CPU时间占用百分比</td></tr><tr><td align="left">TIME</td><td align="left">进程使用的CPU时间总计，单位秒</td></tr><tr><td align="left">TIME+</td><td align="left">进程使用的CPU时间总计，单位1/100秒</td></tr><tr><td align="left">%MEM</td><td align="left">进程使用的物理内存百分比</td></tr><tr><td align="left">VIRT</td><td align="left">进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES</td></tr><tr><td align="left">SWAP</td><td align="left">进程使用的虚拟内存中，被换出的大小，单位kb。</td></tr><tr><td align="left">RES</td><td align="left">进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA</td></tr><tr><td align="left">CODE</td><td align="left">可执行代码占用的物理内存大小，单位kb</td></tr><tr><td align="left">DATA</td><td align="left">可执行代码以外的部分(数据段+栈)占用的物理内存大小，单位kb</td></tr><tr><td align="left">SHR</td><td align="left">共享内存大小，单位kb</td></tr><tr><td align="left">nFLT</td><td align="left">页面错误次数</td></tr><tr><td align="left">nDRT</td><td align="left">最后一次写入到现在，被修改过的页面数。</td></tr><tr><td align="left">S</td><td align="left">进程状态。D=不可中断的睡眠状态,R=运行,S=睡眠,T=跟踪/停止,Z=僵尸进程</td></tr><tr><td align="left">COMMAND</td><td align="left">命令名/命令行</td></tr><tr><td align="left">WCHAN</td><td align="left">若该进程在睡眠，则显示睡眠中的系统函数名</td></tr><tr><td align="left">Flags</td><td align="left">任务标志，参考 sched.h</td></tr></tbody></table><h2 id="dmesg-查看系统日志"><a href="#dmesg-查看系统日志" class="headerlink" title="dmesg,查看系统日志"></a>dmesg,查看系统日志</h2><pre class="line-numbers language-go"><code class="language-go">dmesg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="iostat-磁盘IO情况监控"><a href="#iostat-磁盘IO情况监控" class="headerlink" title="iostat,磁盘IO情况监控"></a>iostat,磁盘IO情况监控</h2><pre class="line-numbers language-go"><code class="language-go">iostat <span class="token operator">-</span>xz <span class="token number">1</span># r<span class="token operator">/</span>s<span class="token punctuation">,</span> w<span class="token operator">/</span>s<span class="token punctuation">,</span> rkB<span class="token operator">/</span>s<span class="token punctuation">,</span> wkB<span class="token operator">/</span>s：分别表示每秒读写次数和每秒读写数据量（千字节）。读写量过大，可能会引起性能问题。# await：IO操作的平均等待时间，单位是毫秒。这是应用程序在和磁盘交互时，需要消耗的时间，包括IO等待和实际操作的耗时。如果这个数值过大，可能是硬件设备遇到了瓶颈或者出现故障。# avgqu<span class="token operator">-</span>sz：向设备发出的请求平均数量。如果这个数值大于<span class="token number">1</span>，可能是硬件设备已经饱和（部分前端硬件设备支持并行写入）。# <span class="token operator">%</span>util：设备利用率。这个数值表示设备的繁忙程度，经验值是如果超过<span class="token number">60</span>，可能会影响IO性能（可以参照IO操作平均等待时间）。如果到达<span class="token number">100</span><span class="token operator">%</span>，说明硬件设备已经饱和。# 如果显示的是逻辑设备的数据，那么设备利用率不代表后端实际的硬件设备已经饱和。值得注意的是，即使IO性能不理想，也不一定意味这应用程序性能会不好，可以利用诸如预读取、写缓存等策略提升应用性能。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="free-内存使用情况"><a href="#free-内存使用情况" class="headerlink" title="free,内存使用情况"></a>free,内存使用情况</h2><pre class="line-numbers language-go"><code class="language-go">free <span class="token operator">-</span>meg<span class="token punctuation">:</span>     total       used       free     shared    buffers     cachedMem<span class="token punctuation">:</span>          <span class="token number">1002</span>        <span class="token number">769</span>        <span class="token number">232</span>          <span class="token number">0</span>         <span class="token number">62</span>        <span class="token number">421</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">+</span> buffers<span class="token operator">/</span>cache<span class="token punctuation">:</span>          <span class="token number">286</span>        <span class="token number">715</span>Swap<span class="token punctuation">:</span>          <span class="token number">1153</span>          <span class="token number">0</span>       <span class="token number">1153</span>第一部分Mem行<span class="token punctuation">:</span>total 内存总数<span class="token punctuation">:</span> 1002Mused 已经使用的内存数<span class="token punctuation">:</span> 769Mfree 空闲的内存数<span class="token punctuation">:</span> 232Mshared 当前已经废弃不用<span class="token punctuation">,</span>总是<span class="token number">0</span>buffers Buffer 缓存内存数<span class="token punctuation">:</span> 62Mcached Page 缓存内存数<span class="token punctuation">:</span>421M关系：<span class="token function">total</span><span class="token punctuation">(</span>1002M<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">used</span><span class="token punctuation">(</span>769M<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">free</span><span class="token punctuation">(</span>232M<span class="token punctuation">)</span>第二部分<span class="token punctuation">(</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">+</span> buffers<span class="token operator">/</span>cache<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token operator">-</span>buffers<span class="token operator">/</span>cache<span class="token punctuation">)</span> used内存数：<span class="token function">286M</span> <span class="token punctuation">(</span>指的第一部分Mem行中的used – buffers – cached<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">+</span>buffers<span class="token operator">/</span>cache<span class="token punctuation">)</span> free内存数<span class="token punctuation">:</span> <span class="token function">715M</span> <span class="token punctuation">(</span>指的第一部分Mem行中的free <span class="token operator">+</span> buffers <span class="token operator">+</span> cached<span class="token punctuation">)</span>可见<span class="token operator">-</span>buffers<span class="token operator">/</span>cache反映的是被程序实实在在吃掉的内存<span class="token punctuation">,</span>而<span class="token operator">+</span>buffers<span class="token operator">/</span>cache反映的是可以挪用的内存总数<span class="token punctuation">.</span>第三部分是指交换分区<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="sar-查看网络吞吐状态"><a href="#sar-查看网络吞吐状态" class="headerlink" title="sar,查看网络吞吐状态"></a>sar,查看网络吞吐状态</h2><pre class="line-numbers language-go"><code class="language-go"># sar命令在这里可以查看网络设备的吞吐率。在排查性能问题时，可以通过网络设备的吞吐量，判断网络设备是否已经饱和sar <span class="token operator">-</span>n DEV <span class="token number">1</span>## sar命令在这里用于查看TCP连接状态，其中包括：# active<span class="token operator">/</span>s：每秒本地发起的TCP连接数，既通过connect调用创建的TCP连接；# passive<span class="token operator">/</span>s：每秒远程发起的TCP连接数，即通过accept调用创建的TCP连接；# retrans<span class="token operator">/</span>s：每秒TCP重传数量；# TCP连接数可以用来判断性能问题是否由于建立了过多的连接，进一步可以判断是主动发起的连接，还是被动接受的连接。TCP重传可能是因为网络环境恶劣，或者服务器压力过大导致丢包sar <span class="token operator">-</span>n TCP<span class="token punctuation">,</span>ETCP <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="vmstat-给定时间监控CPU使用率-内存使用-虚拟内存交互-IO读写"><a href="#vmstat-给定时间监控CPU使用率-内存使用-虚拟内存交互-IO读写" class="headerlink" title="vmstat, 给定时间监控CPU使用率, 内存使用, 虚拟内存交互, IO读写"></a>vmstat, 给定时间监控CPU使用率, 内存使用, 虚拟内存交互, IO读写</h2><pre class="line-numbers language-go"><code class="language-go"># <span class="token number">2</span>表示每<span class="token number">2</span>秒采集一次状态信息<span class="token punctuation">,</span> <span class="token number">1</span>表示只采集一次<span class="token punctuation">(</span>忽略既是一直采集<span class="token punctuation">)</span>vmstat <span class="token number">2</span> <span class="token number">1</span>eg<span class="token punctuation">:</span>r b swpd free buff cache si so bi bo in cs us sy id wa<span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">3499840</span> <span class="token number">315836</span> <span class="token number">3819660</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">100</span> <span class="token number">0</span><span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">3499584</span> <span class="token number">315836</span> <span class="token number">3819660</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">88</span> <span class="token number">158</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">100</span> <span class="token number">0</span><span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">3499708</span> <span class="token number">315836</span> <span class="token number">3819660</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">2</span> <span class="token number">86</span> <span class="token number">162</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">100</span> <span class="token number">0</span><span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">3499708</span> <span class="token number">315836</span> <span class="token number">3819660</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">10</span> <span class="token number">81</span> <span class="token number">151</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">100</span> <span class="token number">0</span><span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">3499732</span> <span class="token number">315836</span> <span class="token number">3819660</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">2</span> <span class="token number">83</span> <span class="token number">154</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">100</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>r</strong> 表示运行队列(就是说多少个进程真的分配到CPU)，我测试的服务器目前CPU比较空闲，没什么程序在跑，当这个值超过了CPU数目，就会出现CPU瓶颈了。这个也和top的负载有关系，一般负载超过了3就比较高，超过了5就高，超过了10就不正常了，服务器的状态很危险。top的负载类似每秒的运行队列。如果运行队列过大，表示你的CPU很繁忙，一般会造成CPU使用率很高。</li><li><strong>b</strong> 表示阻塞的进程,这个不多说，进程阻塞，大家懂的。</li><li><strong>swpd</strong> 虚拟内存已使用的大小，如果大于0，表示你的机器物理内存不足了，如果不是程序内存泄露的原因，那么你该升级内存了或者把耗内存的任务迁移到其他机器。</li><li><strong>free</strong> 空闲的物理内存的大小，我的机器内存总共8G，剩余3415M。</li><li><strong>buff</strong> Linux/Unix系统是用来存储，目录里面有什么内容，权限等的缓存，我本机大概占用300多M</li><li><strong>cache</strong> cache直接用来记忆我们打开的文件,给文件做缓冲，我本机大概占用300多M(这里是Linux/Unix的聪明之处，把空闲的物理内存的一部分拿来做文件和目录的缓存，是为了提高 程序执行的性能，当程序使用内存时，buffer/cached会很快地被使用。)</li><li><strong>si</strong> 每秒从磁盘读入虚拟内存的大小，如果这个值大于0，表示物理内存不够用或者内存泄露了，要查找耗内存进程解决掉。我的机器内存充裕，一切正常。</li><li><strong>so</strong> 每秒虚拟内存写入磁盘的大小，如果这个值大于0，同上。</li><li><strong>bi</strong> 块设备每秒接收的块数量，这里的块设备是指系统上所有的磁盘和其他块设备，默认块大小是1024byte，我本机上没什么IO操作，所以一直是0，但是我曾在处理拷贝大量数据(2-3T)的机器上看过可以达到140000/s，磁盘写入速度差不多140M每秒</li><li><strong>bo</strong> 块设备每秒发送的块数量，例如我们读取文件，bo就要大于0。bi和bo一般都要接近0，不然就是IO过于频繁，需要调整。</li><li><strong>in</strong> 每秒CPU的中断次数，包括时间中断</li><li><strong>cs</strong> 每秒上下文切换次数，例如我们调用系统函数，就要进行上下文切换，线程的切换，也要进程上下文切换，这个值要越小越好，太大了，要考虑调低线程或者进程的数目,例如在apache和nginx这种web服务器中，我们一般做性能测试时会进行几千并发甚至几万并发的测试，选择web服务器的进程可以由进程或者线程的峰值一直下调，压测，直到cs到一个比较小的值，这个进程和线程数就是比较合适的值了。系统调用也是，每次调用系统函数，我们的代码就会进入内核空间，导致上下文切换，这个是很耗资源，也要尽量避免频繁调用系统函数。上下文切换次数过多表示你的CPU大部分浪费在上下文切换，导致CPU干正经事的时间少了，CPU没有充分利用，是不可取的。</li><li><strong>us</strong> 用户CPU时间，我曾经在一个做加密解密很频繁的服务器上，可以看到us接近100,r运行队列达到80(机器在做压力测试，性能表现不佳)。</li><li><strong>sy</strong> 系统CPU时间，如果太高，表示系统调用时间长，例如是IO操作频繁。</li><li><strong>id</strong> 空闲 CPU时间，一般来说，id + us + sy = 100,一般我认为id是空闲CPU使用率，us是用户CPU使用率，sy是系统CPU使用率。</li><li><strong>wt</strong> 等待IO CPU时间。</li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信小程序</title>
      <link href="/2023/05/12/blog-open-source-wechat-mini-program/"/>
      <url>/2023/05/12/blog-open-source-wechat-mini-program/</url>
      
        <content type="html"><![CDATA[<p>微信小程序篇</p><p> 打开微信小程序导入一个项目时，控制台弹出下面的错误：</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="C:%5CUsers%5C%E5%8D%81%E4%B8%80%E8%A5%BF%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20230510170251667.png" alt="image-20230510170251667"></p><p>HBuilder X—运行—运行到小程序模拟器 微信开发者工具</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="C:%5CUsers%5C%E5%8D%81%E4%B8%80%E8%A5%BF%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20230510170505647.png" alt="image-20230510170505647"></p><p>编译后生成</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="C:%5CUsers%5C%E5%8D%81%E4%B8%80%E8%A5%BF%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20230510171230686.png" alt="image-20230510171230686"></p><h2 id="一，注册微信小程序"><a href="#一，注册微信小程序" class="headerlink" title="一，注册微信小程序"></a>一，注册微信小程序</h2><h3 id="1-打开-微信公众平台"><a href="#1-打开-微信公众平台" class="headerlink" title="1.打开 微信公众平台"></a>1.打开 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fmp.weixin.qq.com%2Fcgi-bin%2Floginpage%3Furl%3D%2Fcgi-bin%2Fhome%3Ft%3Dhome%2Findex%26lang%3Dzh_CN%26token%3D1037169054" target="_blank" rel="noopener">微信公众平台</a></h3><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-7956026460f13977.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><hr><hr><h3 id="2-注册开发者账号"><a href="#2-注册开发者账号" class="headerlink" title="2.注册开发者账号"></a>2.注册开发者账号</h3><blockquote><p>可以选择注册服务号/小程序号，如果有公司资质可选择注册服务号，在服务号里快速复用公司资质直接注册小程序号，一个服务号可以关联注册10个同主体或关联主体的小程序,3个非同主体小程序。</p></blockquote><ul><li>服务号：企业资质，在服务号里可直接快速注册多个小程序号</li><li>小程序：企业资质、个人资质···</li></ul><p>注册需要用到的资料</p><ul><li>个人注册：身份证姓名、身份证号码、管理员手机、短信验证、管理员身份验证等等</li><li>企业注册：企业类型、营业执照注册号、管理员身份证姓名、管理员身份证号码、管理员手机号码、短信验证等</li></ul><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-e987bec1251f3cf1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/955/format/webp" alt="img"></p><p>​                                                </p><p><strong>小程序注册</strong></p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-67d340af5e5b9a60.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-da9054934f2a0490.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-f46d7917e0a10627.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-39d2a04191867704.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/944/format/webp" alt="img"></p><hr><hr><h3 id="3-微信公众平台"><a href="#3-微信公众平台" class="headerlink" title="3.微信公众平台"></a>3.微信公众平台</h3><p>注册完成后，既可登录微信公众平台，填写小程序信息、小程序类目，填写完整既可在设置中找到小程序AppId以及配置小程序秘钥。<br> 在里面版本管理、成员管理、添加开发域名、管理插件、查看核心数据等，</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-35ff7342fb1f58ad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><hr><hr><h2 id="二，微信开发者工具"><a href="#二，微信开发者工具" class="headerlink" title="二，微信开发者工具"></a>二，微信开发者工具</h2><p>下载<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fdevtools%2Fdownload.html" target="_blank" rel="noopener">微信web开发者工具</a>，根据自己的操作系统下载对应的安装包进行安装即可。</p><h3 id="2-1-创建工程"><a href="#2-1-创建工程" class="headerlink" title="2.1.创建工程"></a>2.1.创建工程</h3><ul><li>登录微信公众平台，填写好小程序信息后，去设置里面找到账号信息，找到小程序AppID</li></ul><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-23bb86d56dec6996.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><ul><li>打开微信开发者工具，点击加号创建工程</li></ul><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-e53a0d4a614b78ba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/800/format/webp" alt="img"></p><ul><li>填写好AppID等信息，选择工程模板，确定</li></ul><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-a875567f1f4afdf7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/806/format/webp" alt="img"></p><ul><li><p>进入工程</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-3e6138745c690f3e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p></li></ul><hr><hr><h3 id="2-2-界面介绍"><a href="#2-2-界面介绍" class="headerlink" title="2.2.界面介绍"></a>2.2.界面介绍</h3><ul><li><p>微信开发工具界面</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-3a0b160f31f592d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p></li></ul><ul><li><p>项目工程目录</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-30354182170daf8f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/814/format/webp" alt="img"></p></li></ul><hr><hr><h3 id="2-3-全局配置"><a href="#2-3-全局配置" class="headerlink" title="2.3 全局配置"></a>2.3 全局配置</h3><blockquote><p>小程序配置项  <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Freference%2Fconfiguration%2Fapp.html" target="_blank" rel="noopener">微信开发文档</a><br> 小程序根目录下的 app.json 文件用来对微信小程序进行全局配置。文件内容为一个 JSON 对象</p></blockquote><h5 id="配置项"><a href="#配置项" class="headerlink" title="配置项"></a>配置项</h5><table><thead><tr><th>属性</th><th>类型</th><th>必填</th><th>描述</th><th>最低版本</th></tr></thead><tbody><tr><td>entryPagePath</td><td>string</td><td>否</td><td>小程序默认启动首页</td><td></td></tr><tr><td>pages</td><td>string[]</td><td>是</td><td>页面路径列表</td><td></td></tr><tr><td>window</td><td>Object</td><td>否</td><td>全局的默认窗口表现</td><td></td></tr><tr><td>tabBar</td><td>Object</td><td>否</td><td>底部 <code>tab</code> 栏的表现</td><td></td></tr><tr><td>networkTimeout</td><td>Object</td><td>否</td><td>网络超时时间</td><td></td></tr><tr><td>debug</td><td>boolean</td><td>否</td><td>是否开启 debug 模式，默认关闭</td><td></td></tr><tr><td>functionalPages</td><td>boolean</td><td>否</td><td>是否启用插件功能页，默认关闭</td><td>2.1.0</td></tr><tr><td>subpackages</td><td>Object[]</td><td>否</td><td>分包结构配置</td><td>1.7.3</td></tr><tr><td>workers</td><td>string</td><td>否</td><td><code>Worker</code> 代码放置的目录</td><td>1.9.90</td></tr><tr><td>requiredBackgroundModes</td><td>string[]</td><td>否</td><td>需要在后台使用的能力，如「音乐播放」</td><td></td></tr><tr><td>plugins</td><td>Object</td><td>否</td><td>使用到的插件</td><td>1.9.6</td></tr><tr><td>preloadRule</td><td>Object</td><td>否</td><td>分包预下载规则</td><td>2.3.0</td></tr><tr><td>resizable</td><td>boolean</td><td>否</td><td>PC 小程序是否支持用户任意改变窗口大小（包括最大化窗口）；iPad 小程序是否支持屏幕旋转。默认关闭</td><td>2.3.0</td></tr><tr><td>usingComponents</td><td>Object</td><td>否</td><td>全局自定义组件配置</td><td>开发者工具 1.02.1810190</td></tr><tr><td>permission</td><td>Object</td><td>否</td><td>小程序接口权限相关设置</td><td>微信客户端 7.0.0</td></tr><tr><td>sitemapLocation</td><td>string</td><td>是</td><td>指明 sitemap.json 的位置</td><td></td></tr><tr><td>style</td><td>string</td><td>否</td><td>指定使用升级后的weui样式</td><td>2.8.0</td></tr><tr><td>useExtendedLib</td><td>Object</td><td>否</td><td>指定需要引用的扩展库</td><td>2.2.1</td></tr><tr><td>entranceDeclare</td><td>Object</td><td>否</td><td>微信消息用小程序打开</td><td>微信客户端7.0.9</td></tr><tr><td>darkmode</td><td>boolean</td><td>否</td><td>小程序支持 DarkMode</td><td>2.11.0</td></tr><tr><td>themeLocation</td><td>string</td><td>否</td><td>指明 theme.json 的位置，darkmode为true为必填</td><td>开发者工具 1.03.2004271</td></tr><tr><td>lazyCodeLoading</td><td>string</td><td>否</td><td>配置自定义组件代码按需注入</td><td>2.11.1</td></tr><tr><td>singlePage</td><td>Object</td><td>否</td><td>单页模式相关配置</td><td>2.12.0</td></tr></tbody></table><ul><li>pages配置</li></ul><blockquote><p>用于指定小程序由哪些页面组成，每一项都对应一个页面的 路径（含文件名） 信息。文件名不需要写文件后缀，框架会自动去寻找对应位置的 .json, .js, .wxml, .wxss 四个文件进行处理。</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token string">"pages"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>    <span class="token string">"pages/index/index"</span>,    <span class="token string">"pages/next-bus/next-bus"</span>,    <span class="token string">"pages/park-map/park-map"</span>,    <span class="token string">"pages/park/park"</span>,    <span class="token string">"pages/route-info/route-info"</span>,    <span class="token string">"pages/glory-futian/glory-futian"</span>,    <span class="token string">"pages/glory-futian/details/vehicle-road/vehicle-road"</span>,    <span class="token string">"pages/glory-futian/details/station/station"</span>,    <span class="token string">"pages/glory-futian/details/smart-road/smart-road"</span>,    <span class="token string">"pages/glory-futian/details/slow/slow"</span>,    <span class="token string">"pages/bind-car/bind-car"</span>,    <span class="token string">"pages/offiaccount-login/offiaccount-login"</span>,    <span class="token string">"pages/construction/construction"</span>  <span class="token punctuation">]</span>,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>window配置</li></ul><blockquote><p>用于设置小程序的状态栏、导航条、标题、窗口背景色等。</p></blockquote><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>navigationBarBackgroundColor</td><td>HexColor</td><td>#000000</td><td>导航栏背景颜色，如 <code>#000000</code></td></tr><tr><td>navigationBarTextStyle</td><td>string</td><td>white</td><td>导航栏标题颜色，仅支持 <code>black</code> / <code>white</code></td></tr><tr><td>navigationBarTitleText</td><td>string</td><td></td><td>导航栏标题文字内容</td></tr><tr><td>navigationStyle</td><td>string</td><td>default</td><td>导航栏样式，仅支持以下值：<code>default</code> 默认样式<code>custom</code> 自定义导航栏，只保留右上角胶囊按钮。参见注 2。</td></tr><tr><td>homeButton</td><td>boolean</td><td>default</td><td>在非首页、非页面栈最底层页面或非 tabbar 内页面中的导航栏展示 home 键</td></tr><tr><td>backgroundColor</td><td>HexColor</td><td>#ffffff</td><td>窗口的背景色</td></tr><tr><td>backgroundTextStyle</td><td>string</td><td>dark</td><td>下拉 loading 的样式，仅支持 <code>dark</code> / <code>light</code></td></tr><tr><td>backgroundColorTop</td><td>string</td><td>#ffffff</td><td>顶部窗口的背景色，仅 iOS 支持</td></tr><tr><td>backgroundColorBottom</td><td>string</td><td>#ffffff</td><td>底部窗口的背景色，仅 iOS 支持</td></tr><tr><td>enablePullDownRefresh</td><td>boolean</td><td>false</td><td>是否开启全局的下拉刷新。</td></tr><tr><td>onReachBottomDistance</td><td>number</td><td>50</td><td>页面上拉触底事件触发时距页面底部距离，单位为 px。</td></tr><tr><td>pageOrientation</td><td>string</td><td>portrait</td><td>屏幕旋转设置，支持 <code>auto</code> / <code>portrait</code> / <code>landscape</code></td></tr><tr><td>restartStrategy</td><td>string</td><td>homePage</td><td>重新启动策略配置</td></tr><tr><td>initialRenderingCache</td><td>string</td><td></td><td>页面初始渲染缓存配置，支持 <code>static</code> / <code>dynamic</code></td></tr><tr><td>visualEffectInBackground</td><td>string</td><td>none</td><td>切入系统后台时，隐藏页面内容，保护用户隐私。支持 <code>hidden</code> / <code>none</code></td></tr><tr><td>handleWebviewPreload</td><td>string</td><td>static</td><td>控制预加载下个页面的时机 支持 <code>static</code> / <code>manual</code> / <code>auto</code></td></tr></tbody></table><ul><li>tabBar配置</li></ul><blockquote><p>客户端窗口的底部或顶部有 tab 栏可以切换页面，可以通过 tabBar 配置项指定 tab 栏的表现，以及 tab 切换时显示的对应页面。</p></blockquote><table><thead><tr><th>属性</th><th>类型</th><th>必填</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>color</td><td>HexColor</td><td>是</td><td></td><td>tab 上的文字默认颜色，仅支持十六进制颜色</td></tr><tr><td>selectedColor</td><td>HexColor</td><td>是</td><td></td><td>tab 上的文字选中时的颜色，仅支持十六进制颜色</td></tr><tr><td>backgroundColor</td><td>HexColor</td><td>是</td><td></td><td>tab 的背景色，仅支持十六进制颜色</td></tr><tr><td>borderStyle</td><td>string</td><td>否</td><td>black</td><td>tabbar 上边框的颜色， 仅支持 <code>black</code> / <code>white</code></td></tr><tr><td>list</td><td>Array</td><td>是</td><td></td><td>tab 的列表，详见 <code>list</code> 属性说明，最少 2 个、最多 5 个 tab</td></tr><tr><td>position</td><td>string</td><td>否</td><td>bottom</td><td>tabBar 的位置，仅支持 <code>bottom</code> / <code>top</code></td></tr><tr><td>custom</td><td>boolean</td><td>否</td><td>false</td><td>自定义 tabBar</td></tr></tbody></table><p>其中 list 接受一个数组，<strong>只能配置最少 2 个、最多 5 个 tab</strong>。tab 按数组的顺序排序，每个项都是一个对象，其属性值如下：</p><table><thead><tr><th>属性</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>pagePath</td><td>string</td><td>是</td><td>页面路径，必须在 pages 中先定义</td></tr><tr><td>text</td><td>string</td><td>是</td><td>tab 上按钮文字</td></tr><tr><td>iconPath</td><td>string</td><td>否</td><td>图片路径，icon 大小限制为 40kb，建议尺寸为 81px * 81px，不支持网络图片。当 <code>position</code> 为 <code>top</code> 时，不显示 icon。</td></tr><tr><td>selectedIconPath</td><td>string</td><td>否</td><td>选中时的图片路径，icon 大小限制为 40kb，建议尺寸为 81px * 81px，不支持网络图片。当 <code>position</code> 为 <code>top</code> 时，不显示 icon。</td></tr></tbody></table><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-0bf952ddb998685f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><ul><li>networkTimeout 网络请求超时配置</li></ul><blockquote><p>各类网络请求的超时时间，单位均为毫秒。</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-f7ff9bd8d134109d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1011/format/webp" alt="img"></p></blockquote><ul><li>分包加载加载</li></ul><blockquote><p>某些情况下，开发者需要将小程序划分成不同的子包，在构建时打包成不同的分包，用户在使用时按需进行加载。<br> 在构建小程序分包项目时，构建会输出一个或多个分包。每个使用分包小程序必定含有一个主包。所谓的主包，即放置默认启动页面/TabBar 页面，以及一些所有分包都需用到公共资源/JS 脚本；而分包则是根据开发者的配置进行划分。<br> 在小程序启动时，默认会下载主包并启动主包内页面，当用户进入分包内某个页面时，客户端会把对应分包下载下来，下载完成后再进行展示。<br> <strong>目前小程序分包大小有以下限制：</strong><br> 整个小程序所有分包大小不超过 20M<br> 单个分包/主包大小不能超过 2M </p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-2b6d2efe80de63a0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/978/format/webp" alt="img"></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-f45ab636ac3d7dfe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><hr><hr><h3 id="2-4-小程序页面配置"><a href="#2-4-小程序页面配置" class="headerlink" title="2.4 小程序页面配置"></a>2.4 小程序页面配置</h3><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Freference%2Fconfiguration%2Fpage.html" target="_blank" rel="noopener">页面配置地址</a><br> 小程序中，可以在页面对应的 .json 文件来对本页面的表现进行配置。如：导航栏样式、自定义组件注入等。</p><p>注意：app.json 中的部分配置，可以再页面对应的.json进行重新配置，页面中配置项在当前页面会覆盖 app.json 中相同的配置项。</p><h2 id="配置项-1"><a href="#配置项-1" class="headerlink" title="配置项"></a>配置项</h2><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>navigationBarBackgroundColor</td><td>HexColor</td><td>#000000</td><td>导航栏背景颜色，如 <code>#000000</code></td></tr><tr><td>navigationBarTextStyle</td><td>string</td><td>white</td><td>导航栏标题颜色，仅支持 <code>black</code> / <code>white</code></td></tr><tr><td>navigationBarTitleText</td><td>string</td><td></td><td>导航栏标题文字内容</td></tr><tr><td>navigationStyle</td><td>string</td><td>default</td><td>导航栏样式，仅支持以下值：<code>default</code> 默认样式<code>custom</code> 自定义导航栏，只保留右上角胶囊按钮。</td></tr><tr><td>homeButton</td><td>boolean</td><td>false</td><td>在非首页、非页面栈最底层页面或非 tabbar 内页面中的导航栏展示 home 键</td></tr><tr><td>backgroundColor</td><td>HexColor</td><td>#ffffff</td><td>窗口的背景色</td></tr><tr><td>backgroundTextStyle</td><td>string</td><td>dark</td><td>下拉 loading 的样式，仅支持 <code>dark</code> / <code>light</code></td></tr><tr><td>backgroundColorTop</td><td>string</td><td>#ffffff</td><td>顶部窗口的背景色，仅 iOS 支持</td></tr><tr><td>backgroundColorBottom</td><td>string</td><td>#ffffff</td><td>底部窗口的背景色，仅 iOS 支持</td></tr><tr><td>enablePullDownRefresh</td><td>boolean</td><td>false</td><td>是否开启当前页面下拉刷新</td></tr><tr><td>onReachBottomDistance</td><td>number</td><td>50</td><td>页面上拉触底事件触发时距页面底部距离，单位为px</td></tr><tr><td>pageOrientation</td><td>string</td><td>portrait</td><td>屏幕旋转设置，支持 <code>auto</code> / <code>portrait</code> / <code>landscape</code></td></tr><tr><td>disableScroll</td><td>boolean</td><td>false</td><td>设置为 <code>true</code> 则页面整体不能上下滚动。只在页面配置中有效，无法在 <code>app.json</code> 中设置</td></tr><tr><td>usingComponents</td><td>Object</td><td>否</td><td>页面自定义组件配置</td></tr><tr><td>initialRenderingCache</td><td>string</td><td></td><td>页面初始渲染缓存配置，支持 <code>static</code> / <code>dynamic</code></td></tr><tr><td>style</td><td>string</td><td>default</td><td>启用新版的组件样式</td></tr><tr><td>singlePage</td><td>Object</td><td>否</td><td>单页模式相关配置</td></tr><tr><td>restartStrategy</td><td>string</td><td>homePage</td><td>重新启动策略配置</td></tr><tr><td>handleWebviewPreload</td><td>string</td><td>static</td><td>控制预加载下个页面的时机。支持 <code>static</code> / <code>manual</code> / <code>auto</code></td></tr><tr><td>visualEffectInBackground</td><td>string</td><td>否</td><td>切入系统后台时，隐藏页面内容，保护用户隐私。支持 <code>hidden</code> / <code>none</code>，若对页面单独设置则会覆盖全局的配置</td></tr><tr><td>enablePassiveEvent</td><td>Object或boolean</td><td>否</td><td>事件监听是否为 passive，若对页面单独设置则会覆盖全局的配置</td></tr><tr><td>renderer</td><td>string</td><td>否</td><td>渲染后端</td></tr></tbody></table><hr><hr><h2 id="三、小程序语法"><a href="#三、小程序语法" class="headerlink" title="三、小程序语法"></a>三、小程序语法</h2><p>网页编程采用的是 HTML + CSS + JS 这样的组合，小程序也是如此 WXML + WXSS+ JS 。</p><h3 id="3-1-wxml"><a href="#3-1-wxml" class="headerlink" title="3.1.wxml"></a>3.1.wxml</h3><p>和html没什么区别，只是标签名称不同。 多了一些表达式</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- 渲染 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">></span></span>{{parkType}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">data-text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{index}}<span class="token punctuation">"</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>clickParkMap<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item-poi<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{img_server_url}}/pos_icon.png<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">height</span><span class="token punctuation">:</span><span class="token number">50</span>rpx<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{msg.length}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- 条件渲染 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{selRegionIndex<span class="token punctuation">=</span><span class="token punctuation">=</span>1}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>select_result0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>数据加载中···请稍后!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>elif</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{selRegionIndex<span class="token punctuation">=</span><span class="token punctuation">=</span>2}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>select_result0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>数据加载中···请稍后!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>else</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>select_result0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>数据加载中···请稍后!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- 列表渲染 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{selSort}}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for-index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for-item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">data-text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{index}}<span class="token punctuation">"</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>selSort<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{selSortIndex<span class="token punctuation">=</span><span class="token punctuation">=</span>index?<span class="token punctuation">'</span>sel_text<span class="token punctuation">'</span>:<span class="token punctuation">'</span><span class="token punctuation">'</span>}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{item.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{selSortIndex<span class="token punctuation">=</span><span class="token punctuation">=</span>index}}<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{img_server_url}}/radio_icon_sel.png<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- 引入过滤器 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wxs</span> <span class="token attr-name">module</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>filters<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../../utils/filter.wxs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>wxs</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- 使用过滤器 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checkbox</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#fff<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>*this<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{fieldsInfo.live_reason}}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for-item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{item}}<span class="token punctuation">"</span></span> <span class="token attr-name">checked</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{ filters.setChecked(allData.live_reason,item) }}<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">></span></span>{{item}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>checkbox</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- 使用自定义组件 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav-bar</span> <span class="token attr-name">header</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>{{nvabarData}}<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav-bar</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">></span></span>{{"hello" + name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>objectCombine<span class="token punctuation">"</span></span> <span class="token attr-name">data</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{...obj1, ...obj2, a, c: 6}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>objectCombine<span class="token punctuation">"</span></span> <span class="token attr-name">data</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{...obj1, ...obj2, e: 5}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>wxml模板使用<br> 定义item.wxml</li></ul><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">></span></span>{{text}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>使用模板</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- 引入 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>import</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item.wxml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment" spellcheck="true">&lt;!-- 使用 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">data</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{text: <span class="token punctuation">'</span>forbar<span class="token punctuation">'</span>}}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>include<br> 可以将目标文件除了 <template> <wxs> 外的整个代码引入，相当于是拷贝到 include 位置，</wxs></template></li></ul><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- header.wxml --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">></span></span> header <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- footer.wxml --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">></span></span> footer <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- index.wxml --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>header.wxml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">></span></span> body <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>footer.wxml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">></span></span> header <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">></span></span> body <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">></span></span> footer <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>注意事项<br> 当 wx:for 的值为字符串时，会将字符串解析成字符串数组</li></ul><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>array<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  {{item}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{[<span class="token punctuation">'</span>a<span class="token punctuation">'</span>,<span class="token punctuation">'</span>r<span class="token punctuation">'</span>,<span class="token punctuation">'</span>r<span class="token punctuation">'</span>,<span class="token punctuation">'</span>a<span class="token punctuation">'</span>,<span class="token punctuation">'</span>y<span class="token punctuation">'</span>]}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  {{item}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-a1d24ed83d8b276f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/310/format/webp" alt="img"></p><p>当花括号和引号之间如果有空格，将最终被解析成为字符串</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{[1,2,3]}} <span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  {{item}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{[1,2,3] + <span class="token punctuation">'</span> <span class="token punctuation">'</span>}}<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>  {{item}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-2bdcc5f942ddad52.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/621/format/webp" alt="img"></p><hr><hr><h3 id="3-2-wxss"><a href="#3-2-wxss" class="headerlink" title="3.2.wxss"></a>3.2.wxss</h3><p>WXSS 具有 CSS 大部分的特性，小程序在 WXSS 也做了一些扩充和修改。<br> 新增了单位尺寸：rpx</p><pre class="line-numbers language-css"><code class="language-css"><span class="token selector"><span class="token class">.body</span></span><span class="token punctuation">{</span>  <span class="token property">width</span><span class="token punctuation">:</span><span class="token number">100%</span><span class="token punctuation">;</span>  <span class="token property">height</span><span class="token punctuation">:</span><span class="token number">100%</span><span class="token punctuation">;</span>  <span class="token property">background</span><span class="token punctuation">:</span><span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">243</span>,<span class="token number">247</span>,<span class="token number">249</span>,<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>  <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.top-panel</span></span><span class="token punctuation">{</span>  <span class="token property">height</span><span class="token punctuation">:</span><span class="token number">160</span>rpx<span class="token punctuation">;</span>  <span class="token property">padding</span><span class="token punctuation">:</span><span class="token number">20</span>rpx<span class="token punctuation">;</span>  <span class="token property">border-radius</span><span class="token punctuation">:</span><span class="token number">4</span>px<span class="token punctuation">;</span>  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/* 选项面板 */</span><span class="token selector"><span class="token class">.top-panel</span> <span class="token class">.sel-panel</span></span><span class="token punctuation">{</span>  <span class="token property">height</span><span class="token punctuation">:</span><span class="token function">calc</span><span class="token punctuation">(</span> <span class="token number">100%</span> - <span class="token number">40</span>rpx <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>  <span class="token property">padding</span><span class="token punctuation">:</span><span class="token number">20</span>rpx<span class="token punctuation">;</span>  <span class="token property">background</span><span class="token punctuation">:</span><span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">255</span>,<span class="token number">255</span>,<span class="token number">255</span>,<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/* 输入 */</span><span class="token selector"><span class="token class">.top-panel</span> <span class="token class">.sel-panel</span> <span class="token class">.input-c</span></span><span class="token punctuation">{</span>  <span class="token property">height</span><span class="token punctuation">:</span><span class="token number">65</span>rpx<span class="token punctuation">;</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>  <span class="token property">flex-direction</span><span class="token punctuation">:</span> row<span class="token punctuation">;</span>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><hr><h3 id="3-3-wxs"><a href="#3-3-wxs" class="headerlink" title="3.3.wxs"></a>3.3.wxs</h3><p>小程序的一套脚本语言，结合 WXML，可以构建出页面的结构。包含 wxs模块、变量、注释、运算符、语句、数据类型、基础类库</p><ul><li>wxs文件定义</li></ul><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// /pages/tools.wxs 定义</span><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">"'hello world' from tools.wxs"</span><span class="token punctuation">;</span><span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> d<span class="token punctuation">;</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>  FOO<span class="token punctuation">:</span> foo<span class="token punctuation">,</span>  bar<span class="token punctuation">:</span> bar<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">"some msg"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>wxs标签使用</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-3256041b4e8f3666.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/930/format/webp" alt="img"></p></li></ul><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// 使用</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wxs</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./../tools.wxs<span class="token punctuation">"</span></span> <span class="token attr-name">module</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tools<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span><span class="token punctuation">{</span>tools<span class="token punctuation">.</span>msg<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span><span class="token punctuation">{</span>tools<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span>tools<span class="token punctuation">.</span>FOO<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>示例：</li></ul><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token keyword">var</span> filters <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 设置复选框选中</span>  setChecked<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>selArr<span class="token punctuation">,</span>fields<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>selArr <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> selArr <span class="token operator">==</span> undefined <span class="token operator">||</span> selArr <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>selArr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>fields<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>     <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>  strToArr<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>strArr<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> strArr<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'，'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>  setChecked<span class="token punctuation">:</span> filters<span class="token punctuation">.</span>setChecked<span class="token punctuation">,</span>  strToArr<span class="token punctuation">:</span> filters<span class="token punctuation">.</span>strToArr<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- 引入过滤器 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wxs</span> <span class="token attr-name">module</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>filters<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../../utils/filter.wxs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>wxs</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>field-item<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checkbox-group</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radio-group-col<span class="token punctuation">"</span></span> <span class="token attr-name">bindchange</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radioChange<span class="token punctuation">"</span></span> <span class="token attr-name">data-field</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>live_reason<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checkbox</span> <span class="token attr-name"><span class="token namespace">wx:</span>key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>*this<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{fieldsInfo.live_reason}}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for-item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{item}}<span class="token punctuation">"</span></span> <span class="token attr-name">checked</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{ filters.setChecked(allData.live_reason,item) }}<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">></span></span>{{item}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>checkbox</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>checkbox-group</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-db1bad3b56deebd2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><hr><hr><h3 id="3-4-js"><a href="#3-4-js" class="headerlink" title="3.4. js"></a>3.4. js</h3><ul><li><h5 id="3-4-1-App-js"><a href="#3-4-1-App-js" class="headerlink" title="3.4.1 App.js"></a>3.4.1 App.js</h5></li></ul><p>使用App()注册小程序。接受一个 Object 参数，其指定小程序的生命周期回调、定义全局变量等。<br> 全局变量如何使用后面会说。</p><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">//app.js</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 小程序初始化完成时触发，全局只触发一次</span>  onLaunch<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//获取手机导航栏高度</span>    wx<span class="token punctuation">.</span><span class="token function">getSystemInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      success<span class="token punctuation">:</span> res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> isIos <span class="token operator">=</span> res<span class="token punctuation">.</span>system<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'iOS'</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>statusHeight <span class="token operator">=</span> res<span class="token punctuation">.</span>statusBarHeight<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>navHeight <span class="token operator">=</span> isIos <span class="token operator">?</span> <span class="token number">44</span> <span class="token punctuation">:</span> <span class="token number">48</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> res<span class="token punctuation">.</span>fontSizeSetting<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//设置低版本不显示自定义导航栏</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>SDKVersion <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>SDKVersion<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>SDKVersion<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>navHeightHidden<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token function">fail</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// 位置授权</span>    wx<span class="token punctuation">.</span><span class="token function">getSetting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>authSetting<span class="token punctuation">[</span><span class="token string">'scope.userLocation'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          wx<span class="token punctuation">.</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            scope<span class="token punctuation">:</span> <span class="token string">'scope.userLocation'</span><span class="token punctuation">,</span>            <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 监听小程序启动或切前台</span>  onShow <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// Do something when show.</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 监听小程序切后台</span>  onHide <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// Do something when hide.</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 错误监听函数。</span>  onError <span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 页面不存在监听函数</span>  <span class="token function">onPageNotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token comment" spellcheck="true">// 小程序要打开的页面不存在时触发</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 未处理的 Promise 拒绝事件监听函数。</span>  <span class="token function">onUnhandledRejection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 小程序有未处理的 Promise 拒绝时触发。</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 监听系统主题变化</span>  <span class="token function">onThemeChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 系统切换主题时触发。也可以使用 wx.onThemeChange 绑定监听</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  globalData<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//标题</span>    header<span class="token punctuation">:</span><span class="token string">'交通行为与意愿调查系统'</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">//自定义导航组件高度</span>    navHeightHidden<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>    statusHeight<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>    navHeight<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>    fontSize<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">/**发布版-请求数据地址 */</span>    request_server_url<span class="token punctuation">:</span> <span class="token string">'https://l***'</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">/**开发版-请求数据地址本地 */</span>    <span class="token comment" spellcheck="true">// request_server_url: 'http:</span><span class="token comment" spellcheck="true">/***',    /**发布版-图片地址 */</span>    img_server_url<span class="token punctuation">:</span> <span class="token string">'https://***'</span><span class="token punctuation">,</span>      <span class="token regex">/**开发版-图片地址 */</span>    <span class="token comment" spellcheck="true">// img_server_url: '../../images',</span>    <span class="token comment" spellcheck="true">//地图相关</span>    selMap<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>    mapKey<span class="token punctuation">:</span> <span class="token string">'YPNBZ-PMSCX-G664V-7XBWG-SYFB6-KRBUO'</span><span class="token punctuation">,</span>    referer<span class="token punctuation">:</span> <span class="token string">'深研居民调查'</span><span class="token punctuation">,</span>    category<span class="token punctuation">:</span> <span class="token string">'生活服务,娱乐休闲'</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">//用户信息</span>    openid<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>    userInfo<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>    surveyJob<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">//版本号</span>    version<span class="token punctuation">:</span> <span class="token string">'v1.4.7'</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><hr><ul><li><h5 id="3-4-2-页面page-js"><a href="#3-4-2-页面page-js" class="headerlink" title="3.4.2 页面page.js"></a>3.4.2 页面page.js</h5></li></ul><p>使用Page() 注册小程序中的一个页面。接受一个 Object 类型参数，其指定页面的初始数据、生命周期回调、事件处理函数等。</p><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// pages/ceshi/ceshi.js</span><span class="token comment" spellcheck="true">// 引入公用函数</span><span class="token keyword">const</span> Common <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"../../utils/common.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//获取应用实例</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">/**   * 页面的初始数据   */</span>  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 图片链接</span>    img_server_url<span class="token punctuation">:</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>img_server_url<span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">/**   * 生命周期函数--监听页面加载   */</span>  <span class="token function">onLoad</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">/**   * 生命周期函数--监听页面初次渲染完成   */</span>  <span class="token function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">/**   * 生命周期函数--监听页面显示   */</span>  <span class="token function">onShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">/**   * 生命周期函数--监听页面隐藏   */</span>  <span class="token function">onHide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">/**   * 生命周期函数--监听页面卸载   */</span>  <span class="token function">onUnload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">/**   * 页面相关事件处理函数--监听用户下拉动作   */</span>  <span class="token function">onPullDownRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">/**   * 页面上拉触底事件的处理函数   */</span>  <span class="token function">onReachBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">/**   * 用户点击右上角分享   */</span>  <span class="token function">onShareAppMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><hr><ul><li><h5 id="3-4-3-数据绑定使用"><a href="#3-4-3-数据绑定使用" class="headerlink" title="3.4.3 数据绑定使用"></a>3.4.3 数据绑定使用</h5></li></ul><pre class="line-numbers language-csharp"><code class="language-csharp"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> index<span class="token punctuation">.</span>wxml<span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span>text wx<span class="token punctuation">:</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"{{text}}"</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">></span><span class="token operator">&lt;</span>input model<span class="token punctuation">:</span><span class="token keyword">value</span><span class="token operator">=</span><span class="token string">"{{text}}"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span>view wx<span class="token punctuation">:</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"{{persons}}"</span> wx<span class="token punctuation">:</span>key<span class="token operator">=</span><span class="token string">"*this"</span> wx<span class="token punctuation">:</span><span class="token keyword">for</span><span class="token operator">-</span>index<span class="token operator">=</span><span class="token string">"index"</span> wx<span class="token punctuation">:</span><span class="token keyword">for</span><span class="token operator">-</span>item<span class="token operator">=</span><span class="token string">"item"</span><span class="token operator">></span>  <span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"item-person"</span> data<span class="token operator">-</span><span class="token keyword">value</span><span class="token operator">=</span><span class="token string">"{{item.value}}"</span> bindtap<span class="token operator">=</span><span class="token string">"setCheck"</span><span class="token operator">></span>    <span class="token operator">&lt;</span>text<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">></span>    <span class="token operator">&lt;</span>text<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">></span><span class="token comment" spellcheck="true">// index.js</span><span class="token comment" spellcheck="true">// 获取应用实例</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>    text<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>    active<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>    list<span class="token punctuation">:</span><span class="token punctuation">[</span>      <span class="token punctuation">{</span> name<span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token keyword">value</span><span class="token punctuation">:</span><span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span> name<span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token keyword">value</span><span class="token punctuation">:</span><span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span> name<span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token keyword">value</span><span class="token punctuation">:</span><span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  onShow<span class="token punctuation">:</span> <span class="token function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      text<span class="token punctuation">:</span><span class="token number">11</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 事件处理函数</span>  <span class="token function">setCheck</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> <span class="token keyword">value</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      active<span class="token punctuation">:</span><span class="token keyword">value</span><span class="token punctuation">,</span>      text<span class="token punctuation">:</span><span class="token string">'1111'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><hr><ul><li><h5 id="3-4-4-事件介绍"><a href="#3-4-4-事件介绍" class="headerlink" title="3.4.4 事件介绍"></a>3.4.4 事件介绍</h5></li><li><p><strong>事件列表</strong></p></li></ul><blockquote><ul><li>点击事件（单击）：tap</li><li>长按事件：longpress、longtap</li><li>键盘输入事件：input</li><li>回车事件：confirm</li><li>输入框聚焦：focus</li><li>输入框失焦：blur</li><li>value改变事件：change</li><li>触摸动作开始：touchstart</li><li>触摸动作结束：touchend</li><li>触摸过程移动：touchmove</li><li>触摸动作被打断：touchcancel</li><li>提交表单事件：submit</li><li>重置表单事件：reset</li></ul></blockquote><ul><li><strong>事件对象属性列表</strong></li><li>BaseEvent基础事件对象属性列表</li></ul><table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>type</td><td>String</td><td>事件类型</td></tr><tr><td><code>timeStamp</code></td><td>Integer</td><td>事件生成时的时间戳</td></tr><tr><td><code>target</code></td><td>Object</td><td>触发事件的源组件的一些属性值集合</td></tr><tr><td><code>currentTarget</code></td><td>Object</td><td>当前组件的一些属性值集合</td></tr></tbody></table><ul><li>CustomEvent 自定义事件对象属性列表（继承 BaseEvent）</li></ul><table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>detail</code></td><td>Object</td><td>额外的信息</td></tr></tbody></table><ul><li>TouchEvent 触摸事件对象属性列表（继承 BaseEvent）</li></ul><table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>touches</code></td><td>Array</td><td>触摸事件，当前停留在屏幕中的触摸点信息的数组</td></tr><tr><td><code>changedTouches</code></td><td>Array</td><td>触摸事件，当前变化的触摸点信息的数组</td></tr></tbody></table><ul><li><strong>事件对象属性说明</strong></li><li>type<br> 通用事件类型</li><li>timeStamp<br> 该页面打开到触发事件所经过的毫秒数。</li><li>target<br> 触发事件的源组件</li></ul><table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>id</code></td><td>String</td><td>事件源组件的id</td></tr><tr><td><code>tagName</code></td><td>String</td><td>当前组件的类型</td></tr><tr><td><code>dataset</code></td><td>Object</td><td>事件源组件上由<code>data-</code>开头的自定义属性组成的集合</td></tr></tbody></table><ul><li>currentTarget<br> 事件绑定的当前组件</li></ul><table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>id</code></td><td>String</td><td>当前组件的id</td></tr><tr><td><code>tagName</code></td><td>String</td><td>当前组件的类型</td></tr><tr><td><code>dataset</code></td><td>Object</td><td>当前组件上由<code>data-</code>开头的自定义属性组成的集合</td></tr></tbody></table><ul><li>dataset</li></ul><blockquote><p>在组件中可以定义数据，这些数据将会通过事件传递给 SERVICE。书写方式：以data-开头，多个单词由连字符-链接，不能有大写(大写会自动转成小写)<br> 如<code>data-element-type</code>，最终在 event.target.dataset 中会将连字符转成驼峰 <code>elementType</code>。<br> 如<code>data-elementType</code>，最终在 e.currentTarget.dataset.elementtype 大写会自动转成小写<code>elementtype</code>。</p></blockquote><ul><li><strong>事件绑定</strong></li></ul><blockquote><p>事件绑定的写法同组件的属性，以key、value的形式</p><ul><li>key以<code>bind</code>或<code>catch</code>开头，然后跟上事件的类型，如<code>bindtap</code>, <code>catchtouchstart</code></li><li>value是一个字符串，需要在对应的Page中定义同名的函数。不然当触发事件的时候会报错</li></ul></blockquote><pre class="line-numbers language-kotlin"><code class="language-kotlin"><span class="token operator">&lt;</span>view bindtap<span class="token operator">=</span><span class="token string">"bindViewTap"</span> <span class="token keyword">data</span><span class="token operator">-</span>field<span class="token operator">=</span><span class="token string">"name"</span> <span class="token keyword">data</span><span class="token operator">-</span>text<span class="token operator">=</span><span class="token string">"aa"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">></span><span class="token operator">&lt;</span>view bind<span class="token operator">:</span>tap<span class="token operator">=</span><span class="token string">"bindViewTap"</span> <span class="token keyword">data</span><span class="token operator">-</span>field<span class="token operator">=</span><span class="token string">"name"</span> <span class="token keyword">data</span><span class="token operator">-</span>text<span class="token operator">=</span><span class="token string">"aa"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">></span><span class="token operator">&lt;</span>view <span class="token keyword">catch</span><span class="token operator">:</span>tap<span class="token operator">=</span><span class="token string">"bindViewTap"</span> <span class="token keyword">data</span><span class="token operator">-</span>field<span class="token operator">=</span><span class="token string">"name"</span> <span class="token keyword">data</span><span class="token operator">-</span>text<span class="token operator">=</span><span class="token string">"aa"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">></span><span class="token operator">&lt;</span>view catchtap<span class="token operator">=</span><span class="token string">"bindViewTap"</span> <span class="token keyword">data</span><span class="token operator">-</span>field<span class="token operator">=</span><span class="token string">"name"</span> <span class="token keyword">data</span><span class="token operator">-</span>text<span class="token operator">=</span><span class="token string">"aa"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>bind与catch的区别</p><ul><li>bind事件绑定不会阻止冒泡事件往上冒泡，简单来说，bind所绑定的事件对应会向上传递，让自己的父组件响应对应的事件。</li><li>catch事件会把对应的事件阻拦在自己这里，只有自己能够响应对应事件。</li></ul></blockquote><ul><li><strong>事件的使用</strong></li></ul><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--index.wxml--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bindViewTap<span class="token punctuation">"</span></span> <span class="token attr-name">data-field</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">data-text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>aa<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>// index.jsPage({  // 事件处理函数  bindViewTap(e) {    var field= e.currentTarget.dataset.field;    var aa= e.currentTarget.dataset.text;  },})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>事件参数</strong></li></ul><blockquote><ul><li>使用：dataset</li><li>注意：事件携带参数 dataset使用的时候 ，数据名尽量用小写，不要使用驼峰</li></ul></blockquote><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--index.wxml--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bindViewTap<span class="token punctuation">"</span></span> <span class="token attr-name">data-element-type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">data-elementType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>aa<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>// index.jsPage({  // 事件处理函数  bindViewTap(e) {  // 获取时候  data-element-type  =  e.currentTarget.dataset.elementType   // 获取时候  data-elementType=  e.currentTarget.dataset.elementtype  },})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>使用wxs响应事件</strong></li></ul><blockquote><p>支持使用 WXS 函数绑定事件，WXS函数接受2个参数：</p><ul><li>event，在原有的 event 的基础上加了event.instance对象，</li><li>ownerInstance，和event.instance一样是一个ComponentDescriptor对象</li></ul></blockquote><p>在组件中绑定和注册事件处理的 WXS 函数</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- text.wxml --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wxs</span> <span class="token attr-name">module</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>test<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./test.wxs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>wxs</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- 绑定wxs中函数 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tapTest<span class="token punctuation">"</span></span> <span class="token attr-name">data-hi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Weixin<span class="token punctuation">"</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{test.tapName}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> Click me! <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- prop 属性改变的时候调用 propObserver --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">change:</span>prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{test.propObserver}}<span class="token punctuation">"</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{propValue}}<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>movable<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>test.wxs文件实现 tapName 函数</p><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// test.wxs</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    tapName<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> ownerInstance<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> hi<span class="token operator">=</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>hi<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 监听prop属性变化</span>    propObserver<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">,</span> ownerInstance<span class="token punctuation">,</span> instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'prop observer'</span><span class="token punctuation">,</span> newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><hr><ul><li><h5 id="3-4-5-App-js中全局变量使用"><a href="#3-4-5-App-js中全局变量使用" class="headerlink" title="3.4.5 App.js中全局变量使用"></a>3.4.5 App.js中全局变量使用</h5></li></ul><p>可在App.js中定义全局变量</p><ul><li>定义</li></ul><pre class="line-numbers language-csharp"><code class="language-csharp"><span class="token comment" spellcheck="true">// app.js</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>  globalData<span class="token punctuation">:</span> <span class="token punctuation">{</span>    userInfo<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>    dataList<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>使用</li></ul><pre class="line-numbers language-kotlin"><code class="language-kotlin"><span class="token comment" spellcheck="true">//获取应用实例</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">/**   * 页面的初始数据   */</span>  <span class="token keyword">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 图片链接</span>    img_server_url<span class="token operator">:</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>img_server_url<span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">/* 修改全局变量 */</span>  <span class="token function">updateRecord</span><span class="token punctuation">(</span><span class="token keyword">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//保存全局数据</span>    app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>dataList<span class="token operator">=</span> <span class="token keyword">data</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 注意，修改后，此页面如果又用到了，重新获取app，不然值不会变。</span>    <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><hr><ul><li><h5 id="3-4-6-模块化"><a href="#3-4-6-模块化" class="headerlink" title="3.4.6 模块化"></a>3.4.6 模块化</h5></li></ul><p>可以将一些公共的代码抽离成为一个单独的 js 文件，作为一个模块。模块只有通过<code>module.exports</code>或者 <code>exports</code> 才能对外暴露接口。</p><ul><li><strong>定义公用变量 base.js</strong></li></ul><pre class="line-numbers language-rust"><code class="language-rust"><span class="token keyword">const</span> accountInfo <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getAccountInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> webViewSrc <span class="token operator">=</span> <span class="token string">'http://cBus'</span><span class="token punctuation">;</span><span class="token keyword">let</span> pathWebViewSrc <span class="token operator">=</span> 'https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token comment" spellcheck="true">/***/</span>index'<span class="token punctuation">;</span><span class="token keyword">let</span> userSubscribeUrl <span class="token operator">=</span> <span class="token string">'https://i***e/app/user'</span><span class="token punctuation">;</span><span class="token keyword">let</span> SogoEnvVersion <span class="token operator">=</span> <span class="token string">'trial'</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//跳转到体验版</span><span class="token comment" spellcheck="true">// let SogoEnvVersion = "release"; //跳转到生产版本</span><span class="token keyword">if</span> <span class="token punctuation">(</span>accountInfo<span class="token punctuation">.</span>miniProgram<span class="token punctuation">.</span>envVersion <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'trial'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    webViewSrc <span class="token operator">=</span> 'https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token comment" spellcheck="true">/****tcBus';    pathWebViewSrc = 'https://****ndex';    userSubscribeUrl = 'https://****/</span>user'<span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>accountInfo<span class="token punctuation">.</span>miniProgram<span class="token punctuation">.</span>envVersion <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'release'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    webViewSrc <span class="token operator">=</span> 'https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token comment" spellcheck="true">/***/</span>ftcBus'<span class="token punctuation">;</span>    pathWebViewSrc <span class="token operator">=</span> 'https<span class="token punctuation">:</span><span class="token comment" spellcheck="true">/***/</span>#<span class="token operator">/</span>index'<span class="token punctuation">;</span>    maasBaseUrl <span class="token operator">=</span> 'https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token comment" spellcheck="true">/***/</span>entry'<span class="token punctuation">;</span>    userSubscribeUrl <span class="token operator">=</span> 'https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token comment" spellcheck="true">/***/</span>app<span class="token operator">/</span>user'<span class="token punctuation">;</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    webViewSrc<span class="token punctuation">,</span>    pathWebViewSrc<span class="token punctuation">,</span>    maasBaseUrl<span class="token punctuation">,</span>    SogoEnvVersion<span class="token punctuation">,</span>    userSubscribeUrl<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用</p><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> maasBaseUrl<span class="token punctuation">,</span> SogoEnvVersion <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"/utils/base.js"</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> ceshi <span class="token operator">=</span> maasBaseUrl    <span class="token operator">...</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>定义公用函数 methods.js</strong></li></ul><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">/*** * 转换距离 转换成相应的展示单位 *  */</span><span class="token keyword">function</span> <span class="token function">computedDistance</span><span class="token punctuation">(</span>distance<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>distance <span class="token operator">></span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>distance <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'km'</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> distance <span class="token operator">+</span> <span class="token string">'米'</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * 判断用户滑动 * 上滑还是下滑 */</span><span class="token keyword">function</span> <span class="token function">getTouchData</span><span class="token punctuation">(</span>endX<span class="token punctuation">,</span> endY<span class="token punctuation">,</span> startX<span class="token punctuation">,</span> startY<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> turn <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>endY <span class="token operator">-</span> startY <span class="token operator">></span> <span class="token number">50</span> <span class="token operator">&amp;&amp;</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>endX <span class="token operator">-</span> startX<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//下滑</span>        turn <span class="token operator">=</span> <span class="token string">"bottom"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>endY <span class="token operator">-</span> startY <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">50</span> <span class="token operator">&amp;&amp;</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>endX <span class="token operator">-</span> startX<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//上滑</span>        turn <span class="token operator">=</span> <span class="token string">"top"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> turn<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>    computedDistance<span class="token punctuation">,</span>    getTouchData<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用</p><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> computedDistance<span class="token punctuation">,</span> getTouchData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"/utils/methods.js"</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> ceshi <span class="token operator">=</span> <span class="token function">computedDistance</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><hr><ul><li><h5 id="3-4-7-封装-wx-request-js"><a href="#3-4-7-封装-wx-request-js" class="headerlink" title="3.4.7 封装 wx-request.js"></a>3.4.7 封装 wx-request.js</h5></li></ul><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">tansParams</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">var</span>  str <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> k <span class="token keyword">in</span> obj<span class="token punctuation">)</span><span class="token punctuation">{</span>    str<span class="token operator">+</span><span class="token operator">=</span>k<span class="token operator">+</span><span class="token string">"="</span><span class="token operator">+</span>obj<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"&amp;"</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">//移除最后一个&amp;</span>  <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">wxRequest</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">var</span> url <span class="token operator">=</span> option<span class="token punctuation">.</span>url<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 选项里面有params（get传入的参数）</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 如果有参数，把参数转换为url编码形式加入</span>    url<span class="token operator">+</span><span class="token operator">=</span><span class="token string">"?"</span><span class="token operator">+</span><span class="token function">tansParams</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// 02 可以添加请求头</span>  <span class="token keyword">var</span>  header <span class="token operator">=</span>  <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> contentType <span class="token operator">=</span> option<span class="token punctuation">.</span>contentType <span class="token operator">||</span> <span class="token string">'form'</span><span class="token punctuation">;</span>  header <span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>     form<span class="token punctuation">:</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">,</span>     json<span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">[</span>contentType<span class="token punctuation">]</span><span class="token punctuation">;</span>  header <span class="token operator">=</span> <span class="token punctuation">{</span>    header<span class="token punctuation">,</span>    <span class="token operator">...</span>option<span class="token punctuation">.</span>header  <span class="token punctuation">}</span>  header<span class="token punctuation">.</span>Authorization <span class="token operator">=</span><span class="token string">"Bearer "</span><span class="token operator">+</span>wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 添加加载提示</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">{</span>    wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      title<span class="token punctuation">:</span> option<span class="token punctuation">.</span>loading<span class="token punctuation">.</span>title<span class="token punctuation">,</span>      icon<span class="token punctuation">:</span>option<span class="token punctuation">.</span>loading<span class="token punctuation">.</span>icon<span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// 返回一个Promise</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>      wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 请求的地址如果一http开头直接用url不是http开头添加我们 baseUrL</span>        url<span class="token punctuation">:</span> url<span class="token punctuation">,</span>        method<span class="token punctuation">:</span>option<span class="token punctuation">.</span>method<span class="token operator">||</span><span class="token string">"GET"</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//请求的方法 默认get</span>        data<span class="token punctuation">:</span>option<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//post出入的参数</span>        header<span class="token punctuation">,</span>        <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token comment" spellcheck="true">// 请求成功</span>          <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token function">fail</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token comment" spellcheck="true">// 04 对错误进行处理</span>          wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>title<span class="token punctuation">:</span><span class="token string">"加载失败"</span><span class="token punctuation">,</span>icon<span class="token punctuation">:</span><span class="token string">"none"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>          <span class="token comment" spellcheck="true">// 请求失败</span>          <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token comment" spellcheck="true">// 关闭加载提示</span>          wx<span class="token punctuation">.</span><span class="token function">hideToast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// 定义get简易方法</span>wxRequest<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token operator">=</span> <span class="token punctuation">(</span>url<span class="token punctuation">,</span>config<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token punctuation">,</span>method<span class="token punctuation">:</span><span class="token string">"get"</span><span class="token punctuation">,</span><span class="token operator">...</span>config<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 定义post简易方法</span>wxRequest<span class="token punctuation">.</span>post<span class="token operator">=</span> <span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token punctuation">,</span>config<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token punctuation">,</span>method<span class="token punctuation">:</span><span class="token string">"post"</span><span class="token punctuation">,</span>data<span class="token punctuation">,</span><span class="token operator">...</span>config<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 导入request</span>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>  wxRequest <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用</p><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> wxRequest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"/utils/wx-request.js"</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">wxRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            method<span class="token punctuation">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>            url<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>maasBaseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/trp/api/v1/openResource/getRouteInfo`</span></span><span class="token punctuation">,</span>            data<span class="token punctuation">:</span> routeNo        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><hr><ul><li><h5 id="3-4-8-组件封装与使用-自定义组件"><a href="#3-4-8-组件封装与使用-自定义组件" class="headerlink" title="3.4.8 组件封装与使用  自定义组件"></a>3.4.8 组件封装与使用  <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fframework%2Fcustom-component%2F" target="_blank" rel="noopener">自定义组件</a></h5></li></ul><p>将页面内的功能模块抽象成自定义组件，以便在不同的页面中重复使用；在自定义组件的 js 文件中，需要使用 Component() 来注册组件，并提供组件的属性定义、内部数据和自定义方法。</p><p>组件的文件夹结构应和页面一样：.wxml .wxss .js .json</p><ul><li><strong>定义组件</strong></li></ul><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token punctuation">.</span>json<span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span> 中配置这是一个组件<span class="token punctuation">{</span>  <span class="token string">"component"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">.</span>wxml<span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>inner<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token punctuation">{</span><span class="token punctuation">{</span>innerText<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span><span class="token punctuation">.</span>wxss<span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token punctuation">.</span>inner <span class="token punctuation">{</span>  color<span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span>js<span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  properties<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 这里定义了 innerText 属性，属性值可以在组件使用时指定</span>    innerText<span class="token punctuation">:</span> <span class="token punctuation">{</span>      type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>      value<span class="token punctuation">:</span> <span class="token string">'default value'</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 这里是一些组件内部数据</span>    someData<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 这里是一个自定义方法</span>    customMethod<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>使用组件</strong></li></ul><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// index.json 中引入组件</span><span class="token punctuation">{</span>  <span class="token string">"usingComponents"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token string">"component-tag-name"</span><span class="token punctuation">:</span> <span class="token string">"path/to/the/custom/component"</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// index.wxml 中使用组件</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">></span></span>  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 以下是对一个自定义组件的引用 <span class="token operator">--</span><span class="token operator">></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component-tag-name</span> <span class="token attr-name">inner-text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Some</span> <span class="token attr-name">text"</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">></span></span><span class="token number">11111</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component-tag-name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>开启多插槽模式（自定义组件默认是单插槽）</strong></li></ul><pre class="line-numbers language-xml"><code class="language-xml">.js*********Component({  options: {    multipleSlots: true // 在组件定义时的选项中启用多 slot 支持  },  properties: { /* ... */ },  methods: { /* ... */ }}).wxml**********<span class="token comment" spellcheck="true">&lt;!-- 组件模板 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>before<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">></span></span>这里是组件的内部细节<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>after<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>index.wxml 使用*********<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component-tag-name</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 这部分内容将被放置在组件 &lt;slot name="before"> 的位置上 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>before<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>这里是插入到组件slot name="before"中的内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 这部分内容将被放置在组件 &lt;slot name="after"> 的位置上 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>after<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>这里是插入到组件slot name="after"中的内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component-tag-name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>组件样式</strong><br> 默认情况下，自定义组件的样式只受到自定义组件 wxss 的影响，但是，可以配置页面和组件之间样式是否互相影响。</li></ul><blockquote><p>Component({}) 对象配置 options中有个属性styleIsolation：</p><blockquote><ul><li>isolated 表示启用样式隔离，互不影响。</li><li>apply-shared 表示页面 wxss 样式将影响到自定义组件，但自定义组件 wxss 中指定的样式不会影响页面；</li><li>shared 表示页面wxss样式和组件wxss样式 相互影响。</li></ul></blockquote></blockquote><pre class="line-numbers language-css"><code class="language-css"><span class="token selector"><span class="token class">.js</span>*********Component(</span><span class="token punctuation">{</span>  <span class="token selector">options: </span><span class="token punctuation">{</span>    <span class="token property">styleIsolation</span><span class="token punctuation">:</span> <span class="token string">'isolated'</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>数据传输</strong><br> 可以再组件properties 定义接收参数</li></ul><pre class="line-numbers language-bash"><code class="language-bash">Component<span class="token punctuation">(</span><span class="token punctuation">{</span>  properties: <span class="token punctuation">{</span>    name: <span class="token punctuation">{</span>      type: <span class="token string">'String'</span>    <span class="token punctuation">}</span>,    type: <span class="token punctuation">{</span>      type: <span class="token string">'String'</span>    <span class="token punctuation">}</span>,    index:<span class="token punctuation">{</span>      type:<span class="token string">'Number'</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>component-nav index<span class="token operator">=</span><span class="token string">"{{index}}"</span> type<span class="token operator">=</span><span class="token string">"person"</span> name<span class="token operator">=</span><span class="token string">"点击编辑【个人特征】{{index+1}}"</span>/<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>事件沟通</strong></li></ul><blockquote><p>自定义组件触发事件时，需要使用 triggerEvent 方法，接收参数参数：指定事件名、detail对象、事件选项；</p></blockquote><p>触发事件的选项包括：</p><table><thead><tr><th>选项名</th><th>类型</th><th>是否必填</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>bubbles</td><td>Boolean</td><td>否</td><td>false</td><td>事件是否冒泡</td></tr><tr><td>composed</td><td>Boolean</td><td>否</td><td>false</td><td>事件是否可以穿越组件边界，为false时，事件将只能在引用组件的节点树上触发，不进入其他任何组件内部</td></tr><tr><td>capturePhase</td><td>Boolean</td><td>否</td><td>false</td><td>事件是否拥有捕获阶段</td></tr></tbody></table><p>代码示例：</p><pre class="line-numbers language-jsx"><code class="language-jsx">组件<span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">></span></span>  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 定义事件 <span class="token operator">--</span><span class="token operator">></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onTap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>点击这个按钮将触发“myevent”事件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    onTap<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// detail对象，提供给事件监听函数 传输数据</span>      <span class="token keyword">var</span> myEventDetail <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>       <span class="token comment" spellcheck="true">// 触发事件的选项</span>      <span class="token keyword">var</span> myEventOption <span class="token operator">=</span> <span class="token punctuation">{</span>      <span class="token punctuation">}</span>       <span class="token comment" spellcheck="true">// 组件通信</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">triggerEvent</span><span class="token punctuation">(</span><span class="token string">'myevent'</span><span class="token punctuation">,</span> myEventDetail<span class="token punctuation">,</span> myEventOption<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>使用<span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component-nav</span> <span class="token attr-name">bindmyevent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onMyEvent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component-nav</span><span class="token punctuation">></span></span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  onMyEvent<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>    e<span class="token punctuation">.</span>detail <span class="token comment" spellcheck="true">// 自定义组件触发事件时提供的 detail 对象</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>获取组件实例</strong></li></ul><blockquote><p>可在父组件里调用 this.selectComponent ，获取子组件的实例对象，调用时需要传入一个匹配选择器 selector。<br> 如：this.selectComponent(“.my-component”)，父组件将会获取 class 为 my-component 的子组件实例对象，即子组件的 this 。</p></blockquote><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// .wxml***********</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component-nav</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>component-nav<span class="token punctuation">"</span>/</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">// .js***********</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  data<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  getChildComponent<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">selectComponent</span><span class="token punctuation">(</span><span class="token string">'.my-component'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>示例创建自定义组件Nav</strong></li></ul><p>nav.json</p><pre class="line-numbers language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"component"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>nav.wxml</p><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>routeToFamily<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>{{img_server_url}}/ic_status_{{imgName}}.png<span class="token punctuation">'</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>aspectFit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 定义事件 <span class="token operator">--</span><span class="token operator">></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onTap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>点击这个按钮将触发“myevent”事件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>before<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>after<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>nav.wxss</p><pre class="line-numbers language-css"><code class="language-css"><span class="token selector"><span class="token class">.nav-item</span></span><span class="token punctuation">{</span>  <span class="token property">width</span><span class="token punctuation">:</span><span class="token number">100%</span><span class="token punctuation">;</span>  <span class="token property">height</span><span class="token punctuation">:</span><span class="token number">70</span>rpx<span class="token punctuation">;</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>  <span class="token property">flex-direction</span><span class="token punctuation">:</span> row<span class="token punctuation">;</span>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token number">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>nav.js</p><pre class="line-numbers language-tsx"><code class="language-tsx">//获取应用实例const app = getApp();Component({  options: {    // 在组件定义时的选项中启用多 slot 支持    multipleSlots: true,     // isolated 表示启用样式隔离    // apply-shared 表示页面 wxss 样式将影响到自定义组件，但自定义组件 wxss 中指定的样式不会影响页面；    // shared 表示页面 wxss 和 组件wxss 相互影响    styleIsolation: 'isolated'  },  // 接收参数  properties: {    name: {      type: 'String'    },    type: {      type: 'String'    },    index:{      type:'Number'    }  },   data: {    img_server_url: app.globalData.img_server_url,    imgName:0,    setIcon:false  },  pageLifetimes: {    // 页面被展示    show: function () {      this.setData({        setIcon:true      });      this.setIcon();    }  },  ready(){  },  methods: {    onTap: function(){      var myEventDetail = {} // detail对象，提供给事件监听函数      var myEventOption = {} // 触发事件的选项      // 组件通信      this.triggerEvent('myevent', myEventDetail, myEventOption)      // 出发事件时，可传入配置       // { bubbles：事件是否冒泡，composed： 事件是否可以穿越组件边界，为 false 时，事件将只能在引用组件的节点树上触发，不进入其他任何组件内部，capturePhase：事件是否拥有捕获阶段}      this.triggerEvent('myevent', {}, { bubbles: true, composed: true })     },    setIcon:function(){    }    ...  }})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>在index页面中使用自定义组件Nav</strong></li></ul><pre class="line-numbers language-xml"><code class="language-xml">// index.json{  "navigationBarTitleText": "样本",  "navigationStyle": "custom",  "usingComponents": {    "component-nav": "../../component/nav/nav",    "nav-bar": "../../component/navbar/index"  }}// index.wxml <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component-nav</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>component-nav<span class="token punctuation">"</span></span> <span class="token attr-name">bindmyevent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onMyEvent<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>family<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>点击编辑【户特征】<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 这部分内容将被放置在组件 &lt;slot name="before"> 的位置上 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>before<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>这里是插入到组件slot name="before"中的内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 这部分内容将被放置在组件 &lt;slot name="after"> 的位置上 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>after<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>这里是插入到组件slot name="after"中的内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component-nav</span><span class="token punctuation">></span></span>// index.jsPage({   // 这样可以获取到子组件  getChildComponent: function () {    // 调用组件时候，给起一个 id、class 都可以    const child = this.selectComponent('.component-nav'); // #    console.log(child)  }  onMyEvent: function(e){    // 自定义组件触发事件时提供的 detail 对象 数据    e.detail   }})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><hr><ul><li><h5 id="3-4-9-页面跳转"><a href="#3-4-9-页面跳转" class="headerlink" title="3.4.9 页面跳转"></a>3.4.9 页面跳转</h5></li><li><p><strong>使用API跳转</strong></p></li></ul><table><thead><tr><th>路由方式</th><th>功能描述</th><th>路由前页面</th><th>路由后页面</th></tr></thead><tbody><tr><td><code>navigateTo</code></td><td>打开新页面</td><td>onHide</td><td>onLoad, onShow</td></tr><tr><td><code>redirectTo</code></td><td>页面重定向</td><td>onUnload</td><td>onLoad, onShow</td></tr><tr><td><code>navigateBack</code></td><td>页面返回</td><td>onUnload</td><td>onShow</td></tr><tr><td><code>switchTab</code></td><td>Tab 切换</td><td>onHide onUnload..</td><td>onLoad  B.onShow..</td></tr><tr><td><code>reLaunch</code></td><td>重启动</td><td>onUnload</td><td>onLoad, onShow</td></tr></tbody></table><p>共有 <code>switchTab</code> <code>reLaunch</code> <code>redirectTo</code> <code>navigateTo</code> <code>navigateBack</code> 五个方法，可以通过 <code>this.pageRouter</code>、 <code>this.router</code>、<code>wx对象 wxNavAction</code> ， 获得当前页面或自定义组件的路由器对象，进行跳转，功能相同；但有区别。</p><blockquote><p>注意：</p><ul><li>navigateTo,redirectTo只能打开非 tabBar 页面。</li><li>switchTab 只能打开 tabBar 页面。</li><li>reLaunch 可以打开任意页面。</li><li>页面底部的 tabBar 由页面决定，即只要是定义为 tabBar 的页面，底部都有 tabBar。</li><li>调用页面路由带的参数可以在目标页面的onLoad中获取。</li></ul></blockquote><ul><li>非tabba页面跳转 navigateTo、redirectTo、navigateBack等</li></ul><pre class="line-numbers language-kotlin"><code class="language-kotlin"><span class="token comment" spellcheck="true">// 保留当前页面，跳转到应用内的某个页面。</span>wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token operator">:</span> <span class="token string">'/pages/calculator/calculator'</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>pageRouter<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token operator">:</span> <span class="token string">'/pages/calculator/calculator'</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token operator">:</span> <span class="token string">'/pages/calculator/calculator'</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 关闭当前页面，跳转到应用内的某个页面。</span>wx<span class="token punctuation">.</span><span class="token function">redirectTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token operator">:</span> <span class="token string">'/pages/calculator/calculatort?id=1'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>pageRouter<span class="token punctuation">.</span><span class="token function">redirectTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token operator">:</span> <span class="token string">'/pages/calculator/calculatort?id=1'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 关闭当前页面，返回上一页面或多级页面 参数是后退数</span>wx<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  delta<span class="token operator">:</span> <span class="token number">1</span> <span class="token comment" spellcheck="true">// 2 3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">..</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>tabbar页面跳转  wx.switchTab</li></ul><pre class="line-numbers language-css"><code class="language-css"><span class="token selector">wx<span class="token class">.switchTab</span>(</span><span class="token punctuation">{</span>  <span class="token property">url</span><span class="token punctuation">:</span> <span class="token string">'/pages/calculator/calculator'</span>,<span class="token punctuation">}</span><span class="token selector">)this<span class="token class">.pageRouter.switchTab</span>(</span><span class="token punctuation">{</span>  <span class="token property">url</span><span class="token punctuation">:</span> <span class="token string">'/pages/calculator/calculator'</span>,<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>唯一的区别是，页面路由器中的方法调用时，相对路径永远相对于 <code>this</code> 指代的页面或自定义组件，比wx.navigateTo等方法稳定。<br> 在使用相对路径跳转的时候</p><ul><li>页面 index/index 的 js 代码如下所示。如果此时已经跳转到了一个新页面 pack/index ，然后才调用到上面的 wxNavAction 方法，跳转的新页面路径将是 pack/new-page ；而如果调用的是 routerNavAction 方法，跳转的新页面路径仍然是 index/new-page。</li></ul><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// com/index.js</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  wxNavAction<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      url<span class="token punctuation">:</span> <span class="token string">'./new-page'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  routerNavAction<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// this.pageRouter </span>    <span class="token keyword">this</span><span class="token punctuation">.</span>pageRouter<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      url<span class="token punctuation">:</span> <span class="token string">'./new-page'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>this.pageRouter 和 this.router区别<br> this.pageRouter 和 this.router 在页面中将获得同样的页面路由器对象。<br> 但如果在自定义组件中调用， this.pageRouter 将相对于自定义组件所在的页面来进行路由跳转，而 this.router 相对于自定义组件自身的路径。</li></ul><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// components/ceshi/index.js</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * 组件的方法列表     */</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token function">goto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//路径：index/logs/logs</span>            <span class="token comment" spellcheck="true">// wx.navigateTo({</span>            <span class="token comment" spellcheck="true">//     url: './logs/logs'</span>            <span class="token comment" spellcheck="true">// })</span>            <span class="token comment" spellcheck="true">//路径：index/logs/logs</span>            <span class="token comment" spellcheck="true">// this.pageRouter.navigateTo({</span>            <span class="token comment" spellcheck="true">//     url: './logs/logs'</span>            <span class="token comment" spellcheck="true">// })</span>            <span class="token comment" spellcheck="true">//路径：ceshi/logs/logs</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                url<span class="token punctuation">:</span> <span class="token string">'./logs/logs'</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 使用组件</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>index<span class="token punctuation">.</span>wxml<span class="token operator">--</span><span class="token operator">></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ceshi</span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bindViewTap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token number">2222</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 引入 <span class="token operator">--</span><span class="token operator">></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>使用组件标签navigator 跳转</strong><br> navigator 页面链接</li></ul><table><thead><tr><th>属性名</th><th>类型</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>target</td><td>String</td><td>self</td><td>在哪个目标上发生跳转，默认当前小程序，可选值self/miniProgram</td></tr><tr><td>url</td><td>String</td><td></td><td>应用内的跳转链接</td></tr><tr><td>open-type</td><td>String</td><td>navigate</td><td>跳转方式</td></tr><tr><td>delta</td><td>Number</td><td></td><td>当 open-type 为 ‘navigateBack’ 时有效，表示回退的层数</td></tr><tr><td>app-id</td><td>String</td><td></td><td>当target=”miniProgram”时有效，要打开的小程序 appId</td></tr><tr><td>path</td><td>String</td><td></td><td>当target=”miniProgram”时有效，打开的页面路径，如果为空则打开首页</td></tr><tr><td>extra-data</td><td>Object</td><td></td><td>当target=”miniProgram”时有效，需要传递给目标小程序的数据，目标小程序可在 <code>App.onLaunch()</code> ，<code>App.onShow()</code>  中获取到这份数据。</td></tr><tr><td>version</td><td>version</td><td>release</td><td>当target=”miniProgram”时有效，要打开的小程序版本，有效值 develop（开发版），trial（体验版），release（正式版），仅在当前小程序为开发版或体验版时此参数有效；如果当前小程序是正式版，则打开的小程序必定是正式版。</td></tr><tr><td>hover-class</td><td>String</td><td>navigator-hover</td><td>指定点击时的样式类，当<code>hover-class="none"</code>时，没有点击态效果</td></tr><tr><td>hover-stop-propagation</td><td>Boolean</td><td>false</td><td>指定是否阻止本节点的祖先节点出现点击态</td></tr><tr><td>hover-start-time</td><td>Number</td><td>50</td><td>按住后多久出现点击态，单位毫秒</td></tr><tr><td>hover-stay-time</td><td>Number</td><td>600</td><td>手指松开后点击态保留时间，单位毫秒</td></tr><tr><td>bindsuccess</td><td>String</td><td></td><td>当target=”miniProgram”时有效，跳转小程序成功</td></tr><tr><td>bindfail</td><td>String</td><td></td><td>当target=”miniProgram”时有效，跳转小程序失败</td></tr><tr><td>bindcomplete</td><td>String</td><td></td><td>当target=”miniProgram”时有效，跳转小程序完成</td></tr></tbody></table><p><strong>open-type 有效值：</strong></p><table><thead><tr><th>值</th><th>说明</th><th>最低版本</th></tr></thead><tbody><tr><td>navigate</td><td>对应<code>wx.navigateTo</code>的功能</td><td></td></tr><tr><td>redirect</td><td>对应<code>wx.redirectTo</code>的功能</td><td></td></tr><tr><td>switchTab</td><td>对应<code>wx.switchTab</code>的功能</td><td></td></tr><tr><td>reLaunch</td><td>对应<code>wx.reLaunch</code>的功能</td><td>1.1.0</td></tr><tr><td>navigateBack</td><td>对应<code>wx.navigateBack</code>的功能</td><td>1.1.0</td></tr><tr><td>exit</td><td>退出小程序，target=”miniProgram”时生效</td><td>2.1.0</td></tr></tbody></table><p><strong>注：<code>navigator-hover</code>默认为<code>{background-color: rgba(0, 0, 0, 0.1); opacity: 0.7;}</code>, <code>&lt;navigator/&gt;</code>的子节点背景色应为透明色</strong></p><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn-area<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>navigator</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/page/navigate/navigate?title<span class="token punctuation">=</span>navigate<span class="token punctuation">"</span></span> <span class="token attr-name">hover-class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>navigator-hover<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>跳转到新页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>navigator</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>navigator</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../../redirect/redirect/redirect?title<span class="token punctuation">=</span>redirect<span class="token punctuation">"</span></span> <span class="token attr-name">open-type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>redirect<span class="token punctuation">"</span></span> <span class="token attr-name">hover-class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>other-navigator-hover<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>在当前页打开<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>navigator</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>navigator</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/page/index/index<span class="token punctuation">"</span></span> <span class="token attr-name">open-type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>switchTab<span class="token punctuation">"</span></span> <span class="token attr-name">hover-class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>other-navigator-hover<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>切换 Tab<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>navigator</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>navigator</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>miniProgram<span class="token punctuation">"</span></span> <span class="token attr-name">open-type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>navigate<span class="token punctuation">"</span></span> <span class="token attr-name">app-id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span> path<span class="token punctuation">=</span><span class="token punctuation">"</span></span><span class="token attr-name">"</span> <span class="token attr-name">extra-data</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span> version<span class="token punctuation">=</span><span class="token punctuation">"</span></span><span class="token attr-name">release"</span><span class="token punctuation">></span></span>打开绑定的小程序<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>navigator</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>页面跳转传参</strong><br> <strong>传输</strong><br> 直接放到页面路径后既可。示例：</li></ul><pre class="line-numbers language-kotlin"><code class="language-kotlin">  <span class="token comment" spellcheck="true">// 查看地图分布</span>  <span class="token function">clickAllParkMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> parkId<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>parkData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>parkId<span class="token punctuation">;</span>    wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      url<span class="token operator">:</span> <span class="token string">"../park-map/park-map?inputValue="</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>inputValue<span class="token operator">+</span><span class="token string">'&amp;parkId='</span><span class="token operator">+</span>parkId    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 点击单个</span>  <span class="token function">clickParkMap</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> index <span class="token operator">=</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>text<span class="token punctuation">;</span>    <span class="token keyword">var</span> parkId<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>parkData<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>parkId<span class="token punctuation">;</span>    <span class="token keyword">var</span> parkName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>parkData<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>parkName<span class="token punctuation">;</span>    wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      url<span class="token operator">:</span> <span class="token string">"../park-map/park-map?inputValue="</span><span class="token operator">+</span>parkName<span class="token operator">+</span><span class="token string">'&amp;parkId='</span><span class="token operator">+</span>parkId    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>获取</strong><br> 在页面的onLoad函数，接收参数 options 中获取，</p><pre class="line-numbers language-jsx"><code class="language-jsx">  <span class="token comment" spellcheck="true">/**   * 生命周期函数--监听页面加载   */</span>  onLoad<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> parkId<span class="token operator">=</span>options<span class="token punctuation">.</span>parkId <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> parkName<span class="token operator">=</span>options<span class="token punctuation">.</span>parkId <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><hr><ul><li><h5 id="3-4-10-提示、加载"><a href="#3-4-10-提示、加载" class="headerlink" title="3.4.10 提示、加载"></a>3.4.10 提示、加载</h5></li></ul><blockquote><ul><li>wx.showToast 显示消息提示框</li><li>wx.hideToast 隐藏消息提示框</li><li>wx.showModal 显示模态对话框</li><li>wx.showLoading 显示 loading 提示框</li><li>wx.hideLoading 关闭 loading 提示框</li><li>wx.showActionSheet 显示操作菜单</li></ul></blockquote><ul><li><strong>wx.showToast(option) 显示消息提示框</strong></li></ul><table><thead><tr><th>参数</th><th>类型</th><th>必填</th><th>说明</th><th></th></tr></thead><tbody><tr><td><code>title</code></td><td>String</td><td>是</td><td>提示的内容</td><td></td></tr><tr><td><code>icon</code></td><td>String</td><td>否</td><td>图标，有效值”success”、”error” 、”loading” 、”none”</td><td></td></tr><tr><td><code>image</code></td><td>String</td><td>否</td><td>自定义图标的本地路径，image 的优先级高于 icon</td><td></td></tr><tr><td><code>duration</code></td><td>Number</td><td>否</td><td>提示的延迟时间，单位毫秒，默认：1500</td><td></td></tr><tr><td><code>mask</code></td><td>Boolean</td><td>否</td><td>是否显示透明蒙层，防止触摸穿透，默认：false</td><td></td></tr><tr><td><code>success</code></td><td>Function</td><td>否</td><td>接口调用成功的回调函数</td><td></td></tr><tr><td><code>fail</code></td><td>Function</td><td>否</td><td>接口调用失败的回调函数</td><td></td></tr><tr><td><code>complete</code></td><td>Function</td><td>否</td><td>接口调用结束的回调函数（调用成功、失败都会执行）</td><td></td></tr></tbody></table><pre class="line-numbers language-css"><code class="language-css"><span class="token selector">wx<span class="token class">.showToast</span>(</span><span class="token punctuation">{</span>  <span class="token property">title</span><span class="token punctuation">:</span> <span class="token string">'成功'</span>,  <span class="token property">icon</span><span class="token punctuation">:</span> <span class="token string">'success'</span>,   <span class="token property">duration</span><span class="token punctuation">:</span> <span class="token number">2000</span><span class="token punctuation">}</span><span class="token punctuation">)</span>wx<span class="token number">.</span><span class="token function">hideToast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-4a1e6e3163fba9ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/296/format/webp" alt="img"></p><p>显示消息提示框.png</p><ul><li><strong>wx.showModal(option) 显示模态对话框</strong></li></ul><table><thead><tr><th>参数</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td><code>title</code></td><td>String</td><td>是</td><td>提示的标题</td></tr><tr><td><code>content</code></td><td>String</td><td>是</td><td>提示的内容</td></tr><tr><td><code>showCancel</code></td><td>Boolean</td><td>否</td><td>是否显示取消按钮，默认为 true</td></tr><tr><td><code>cancelText</code></td><td>String</td><td>否</td><td>取消按钮的文字，默认为”取消”，最多 4 个字符</td></tr><tr><td><code>cancelColor</code></td><td>HexColor</td><td>否</td><td>取消按钮的文字颜色，默认为”#000000”</td></tr><tr><td><code>confirmText</code></td><td>String</td><td>否</td><td>确定按钮的文字，默认为”确定”，最多 4 个字符</td></tr><tr><td><code>confirmColor</code></td><td>HexColor</td><td>否</td><td>确定按钮的文字颜色，默认为”#3CC51F”</td></tr><tr><td><code>success</code></td><td>Function</td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td><code>fail</code></td><td>Function</td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td><code>complete</code></td><td>Function</td><td>否</td><td>接口调用结束的回调函数（调用成功、失败都会执行）</td></tr></tbody></table><p>succes返回参数说明：</p><table><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>confirm</td><td>Boolean</td><td>为 true 时，表示用户点击了确定按钮</td></tr><tr><td>cancel</td><td>Boolean</td><td>为 true 时，表示用户点击了取消（用于 Android 系统区分点击蒙层关闭还是点击取消按钮关闭）</td></tr></tbody></table><pre class="line-numbers language-jsx"><code class="language-jsx">wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  title<span class="token punctuation">:</span> <span class="token string">'提示'</span><span class="token punctuation">,</span>  content<span class="token punctuation">:</span> <span class="token string">'这是一个模态弹窗'</span><span class="token punctuation">,</span>  success <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>confirm<span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'用户点击确定'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>cancel<span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'用户点击取消'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="<img src="" alt="img"></p><p>显示模态对话框.png</p><ul><li><strong>wx.showActionSheet(option)  显示操作菜单</strong></li></ul><table><thead><tr><th>参数</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>itemList</td><td>String Array</td><td>是</td><td>按钮的文字数组，数组长度最大为6个</td></tr><tr><td>itemColor</td><td>HexColor    否</td><td>按钮的文字颜色，默认为”#000000”</td><td></td></tr><tr><td>success</td><td>Function</td><td>否</td><td>接口调用成功的回调函数，详见返回参数说明</td></tr><tr><td>fail</td><td>Function</td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>Function</td><td>否</td><td>接口调用结束的回调函数（调用成功、失败都会执行）</td></tr></tbody></table><p>success返回参数说明：</p><table><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>tapIndex</td><td>Number</td><td>用户点击的按钮，从上到下的顺序，从0开始</td></tr></tbody></table><pre class="line-numbers language-cpp"><code class="language-cpp">wx<span class="token punctuation">.</span><span class="token function">showActionSheet</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  itemList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token function">success</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tapIndex<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">fail</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>errMsg<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="<img src="" alt="img"></p><p>显示操作菜单.png</p><p><strong>注意</strong></p><ul><li><code>wx.showLoading</code>和 <code>wx.showToast</code>同时只能显示一个</li><li><code>wx.showToast</code> 应与 <code>wx.hideToast</code>配对使用</li></ul><hr><hr><ul><li><h5 id="3-4-11-自定义导航栏"><a href="#3-4-11-自定义导航栏" class="headerlink" title="3.4.11 自定义导航栏"></a>3.4.11 自定义导航栏</h5><p>使用page.json中配置：navigationStyle 。  详情可以看我另外一片文章 </p><p>自定义页面导航栏</p></li></ul><table><thead><tr><th>属性</th><th>类型  默认值</th><th>描述</th></tr></thead><tbody><tr><td><code>navigationStyle</code></td><td>string default</td><td>导航栏样式，配置值：<code>default</code>默认、<code>custom</code>自定义，只保留右上角胶囊按钮</td></tr><tr><td><code>usingComponents</code></td><td>Object 无</td><td>页面自定义组件配置</td></tr></tbody></table><ul><li>在对应页面的json中开启自定义顶部状态栏，且引入自定义的状态栏组件。</li></ul><pre class="line-numbers language-bash"><code class="language-bash">  <span class="token string">"navigationStyle"</span><span class="token keyword">:</span> <span class="token string">"custom"</span>,  <span class="token string">"usingComponents"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>    <span class="token string">"nav-bar"</span><span class="token keyword">:</span> <span class="token string">"../../component/navbar/index"</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>自定义组件navbar</strong></li><li>在 app.js中获取 手机的状态栏高度以及字体大小。wx.getSystemInfo（）</li></ul><pre class="line-numbers language-jsx"><code class="language-jsx">onLaunch<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//获取手机导航栏高度</span>    wx<span class="token punctuation">.</span><span class="token function">getSystemInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      success<span class="token punctuation">:</span> res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> isIos <span class="token operator">=</span> res<span class="token punctuation">.</span>system<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'iOS'</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>statusHeight <span class="token operator">=</span> res<span class="token punctuation">.</span>statusBarHeight<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>navHeight <span class="token operator">=</span> isIos <span class="token operator">?</span> <span class="token number">44</span> <span class="token punctuation">:</span> <span class="token number">48</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> res<span class="token punctuation">.</span>fontSizeSetting<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//设置低版本不显示自定义导航栏</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>SDKVersion <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>SDKVersion<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>SDKVersion<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>navHeightHidden<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token function">fail</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>globalData<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//自定义导航组件高度</span>    navHeightHidden<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>    statusHeight<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>    navHeight<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>    fontSize<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>navbar.wxml</li></ul><pre class="line-numbers language-xml"><code class="language-xml">  <span class="token comment" spellcheck="true">&lt;!-- 如果版本低于2.5后，不显示自定义状态栏 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{navHeightHidden}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>else</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token selector">height:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>statusHeight+navHeight<span class="token punctuation">}</span><span class="token punctuation">}</span>px</span><span class="token punctuation">"</span></span> <span class="token attr-name">hidden</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>{{header.hiddenBlock}}<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>topbar<span class="token punctuation">'</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token selector">background:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>header<span class="token number">.</span>headerbg<span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>status<span class="token punctuation">'</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token selector">height:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>statusHeight<span class="token punctuation">}</span><span class="token punctuation">}</span>px</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>navbar<span class="token punctuation">'</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token selector">height:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>navHeight<span class="token punctuation">}</span><span class="token punctuation">}</span>px</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{header.slot}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>else</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>navbar_home<span class="token punctuation">'</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{header.homeCapsule}}<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token selector">background:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>header<span class="token number">.</span>capsulebg<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token selector">;border:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>header<span class="token number">.</span>capsuleborder<span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>../../images/black_back.png<span class="token punctuation">'</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>backClick<span class="token punctuation">'</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token selector">border-right:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>header<span class="token number">.</span>capsulesep<span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>../../images/home_black.png<span class="token punctuation">'</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>homeClick<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>navbar_back<span class="token punctuation">'</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>backClick<span class="token punctuation">'</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>else</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>../../images/black_back.png<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>navbar_title<span class="token punctuation">'</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token selector">height:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>navHeight<span class="token punctuation">}</span><span class="token punctuation">}</span>px</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token selector">color:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>header<span class="token number">.</span>fontColor<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token selector">;font-size:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>fontSize<span class="token punctuation">}</span><span class="token punctuation">}</span>px</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{header.title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>navbar.wxss</li></ul><pre class="line-numbers language-css"><code class="language-css"><span class="token selector"><span class="token class">.topbar</span> </span><span class="token punctuation">{</span>  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>  <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token property">top</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span>  <span class="token property">z-index</span><span class="token punctuation">:</span> <span class="token number">9999</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.status</span> </span><span class="token punctuation">{</span>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token number">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>navbar.js<br> 编写业务员逻辑，我的是点击左上角返回按钮的事件，弹窗提示要不要返回</li></ul><pre class="line-numbers language-kotlin"><code class="language-kotlin"><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  properties<span class="token operator">:</span> <span class="token punctuation">{</span>    header<span class="token operator">:</span> <span class="token punctuation">{</span>      type<span class="token operator">:</span> Object<span class="token punctuation">,</span>      value<span class="token operator">:</span> <span class="token punctuation">{</span>        homeCapsule<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        headerbg<span class="token operator">:</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>        title<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        fontColor<span class="token operator">:</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>        fontSize<span class="token operator">:</span> <span class="token string">'16'</span><span class="token punctuation">,</span>        hiddenBlock<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        capsulebg<span class="token operator">:</span> <span class="token string">'rgba(0,0,0,0.2)'</span><span class="token punctuation">,</span>        capsuleborder<span class="token operator">:</span> <span class="token string">'1px solid rgba(0, 0, 0, 0.1)'</span><span class="token punctuation">,</span>        capsulesep<span class="token operator">:</span> <span class="token string">'1px solid rgba(255,255,255,0.2)'</span><span class="token punctuation">,</span>        slot<span class="token operator">:</span> <span class="token boolean">false</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    customBackReturn<span class="token operator">:</span> <span class="token punctuation">{</span>      type<span class="token operator">:</span> Boolean<span class="token punctuation">,</span>      value<span class="token operator">:</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token keyword">data</span><span class="token operator">:</span><span class="token punctuation">{</span>    statusHeight<span class="token operator">:</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>statusHeight<span class="token punctuation">,</span>    navHeight<span class="token operator">:</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>navHeight<span class="token punctuation">,</span>    fontSize<span class="token operator">:</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>fontSize<span class="token punctuation">,</span>    navHeightHidden<span class="token operator">:</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>navHeightHidden  <span class="token punctuation">}</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 定义点击左上角返回按钮的函数 </span>    <span class="token function">backClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> me<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">;</span>      wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        title<span class="token operator">:</span> <span class="token string">'提示'</span><span class="token punctuation">,</span>        content<span class="token operator">:</span> <span class="token string">'如有改动，请确认是否已点击【保存】'</span><span class="token punctuation">,</span>        <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>confirm<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>me<span class="token punctuation">.</span>data<span class="token punctuation">.</span>customBackReturn<span class="token punctuation">)</span> <span class="token punctuation">{</span>              me<span class="token punctuation">.</span><span class="token function">triggerEvent</span><span class="token punctuation">(</span><span class="token string">"customBackReturn"</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getCurrentPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                wx<span class="token punctuation">.</span><span class="token function">switchTab</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                  url<span class="token operator">:</span> <span class="token string">'/pages/index/index'</span><span class="token punctuation">,</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                wx<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                  delta<span class="token operator">:</span> <span class="token number">1</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>              <span class="token punctuation">}</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>cancel<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">homeClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      wx<span class="token punctuation">.</span><span class="token function">switchTab</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        url<span class="token operator">:</span> <span class="token string">'/pages/index/index'</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>组件的json index.json</li></ul><pre class="line-numbers language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"component"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li><strong>使用组件</strong></li><li>在对应页面的json中开启自定义顶部状态栏，且引入自定义的状态栏组件。</li></ul><pre class="line-numbers language-bash"><code class="language-bash">  <span class="token string">"navigationStyle"</span><span class="token keyword">:</span> <span class="token string">"custom"</span>,  <span class="token string">"usingComponents"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>    <span class="token string">"nav-bar"</span><span class="token keyword">:</span> <span class="token string">"../../component/navbar/index"</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在对应页面的js中写好定义的组件状态和标题名</li></ul><pre class="line-numbers language-csharp"><code class="language-csharp"><span class="token comment" spellcheck="true">//自定义顶部  参数直接能看懂</span>    nvabarData<span class="token punctuation">:</span> <span class="token punctuation">{</span>      homeCapsule<span class="token punctuation">:</span> <span class="token keyword">false</span><span class="token punctuation">,</span>       title<span class="token punctuation">:</span> <span class="token string">'户特征'</span><span class="token punctuation">,</span>      fontColor<span class="token punctuation">:</span> <span class="token string">"white"</span><span class="token punctuation">,</span>      fontSize<span class="token punctuation">:</span> <span class="token string">'26rpx'</span><span class="token punctuation">,</span>      headerbg<span class="token punctuation">:</span> <span class="token string">'#04aceb'</span><span class="token punctuation">,</span>      hiddenBlock<span class="token punctuation">:</span> <span class="token keyword">false</span><span class="token punctuation">,</span>      slot<span class="token punctuation">:</span> <span class="token keyword">false</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 整个导航栏高度</span>    navHeight<span class="token punctuation">:</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>navHeight <span class="token operator">+</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>statusHeight<span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 是否显示自定义导航栏（为低版本）</span>    navHeightHidden<span class="token punctuation">:</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>navHeightHidden<span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在index 中使用自定义组件</li></ul><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- 自定义顶部 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav-bar</span> <span class="token attr-name">header</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>{{nvabarData}}<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav-bar</span><span class="token punctuation">></span></span>// 我的页面用的是100% 高度的布局， 所有要减去这个状态栏的高度<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token selector">height: calc( 100% - </span><span class="token punctuation">{</span><span class="token punctuation">{</span>navHeightHidden?<span class="token property">0</span><span class="token punctuation">:</span>navHeight<span class="token punctuation">}</span><span class="token punctuation">}</span>px <span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-18d921acc28f3d93.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/395/format/webp" alt="img"></p><hr><hr><h2 id="四、常用功能"><a href="#四、常用功能" class="headerlink" title="四、常用功能"></a>四、常用功能</h2><h3 id="4-1-常用小程序api"><a href="#4-1-常用小程序api" class="headerlink" title="4.1 常用小程序api"></a>4.1 常用小程序api</h3><ul><li><h5 id="4-1-1-数据缓存-官方API地址"><a href="#4-1-1-数据缓存-官方API地址" class="headerlink" title="4.1.1 数据缓存 官方API地址"></a>4.1.1 数据缓存 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fapi%2Fstorage%2Fwx.setStorageSync.html" target="_blank" rel="noopener">官方API地址</a></h5></li><li><p><strong>wx.setStorage(option)</strong><br> 将数据存储在本地缓存中指定的key中，会覆盖掉原来该key对应的内容，这是一个异步接口。<br> 设置setStorage、获取getStorage、删除removeStorage<br> OBJECT参数说明</p></li></ul><table><thead><tr><th>参数</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>String</td><td>是</td><td>本地缓存中的指定的 key</td></tr><tr><td>data</td><td>Object/String</td><td>是</td><td>需要存储的内容</td></tr><tr><td>success</td><td>Function</td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>Function</td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>Function</td><td>否</td><td>接口调用结束的回调函数（调用成功、失败都会执行）</td></tr></tbody></table><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>    logs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 设置</span>   wx<span class="token punctuation">.</span><span class="token function">setStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        key<span class="token punctuation">:</span><span class="token string">"key11"</span><span class="token punctuation">,</span>        data<span class="token punctuation">:</span><span class="token string">"value"</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// 获取</span>    wx<span class="token punctuation">.</span><span class="token function">getStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        key<span class="token punctuation">:</span> <span class="token string">'key11'</span><span class="token punctuation">,</span>        success <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 直接就是对象</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">// 批量读取 数组</span>    wx<span class="token punctuation">.</span><span class="token function">batchGetStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      keyList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'key11'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      success <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>       <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// 删除</span>     wx<span class="token punctuation">.</span><span class="token function">removeStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>          key<span class="token punctuation">:</span> <span class="token string">'key'</span><span class="token punctuation">,</span>          success <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>          <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>wx.setStorageSync(option)</strong><br> 将data存储在本地缓存中指定的key中，会覆盖掉原来该key对应的内容，这是一个同步接口。<br> 设置setStorageSync、获取getStorageSync、删除removeStorageSync<br> OBJECT参数说明</li></ul><table><thead><tr><th>参数</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>String</td><td>是</td><td>本地缓存中的指定的key</td></tr><tr><td>data</td><td>Object/String</td><td>是</td><td>需要存储的内容</td></tr></tbody></table><pre class="line-numbers language-kotlin"><code class="language-kotlin"><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token keyword">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>        regionData<span class="token operator">:</span><span class="token keyword">null</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 设置</span>        wx<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'regionData'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>b<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 获取 直接就是对象</span>        <span class="token keyword">var</span> regionData <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'regionData'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 删除</span>        wx<span class="token punctuation">.</span><span class="token function">removeStorageSync</span><span class="token punctuation">(</span><span class="token string">'regionData'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>wx.batchSetStorageSync(option) 批量存储</strong><br> Array.<object> kvList，将数据批量存储在本地缓存中指定的 key 中，单个 key 允许存储的最大数据长度为 1MB，所有数据存储上限为 10MB。这是一个同步接口。<br> 等同于多个setStorageSync ，但是对于多个 key 的读取, 批量读取在性能上优于多次 getStorageSync 读取<br> OBJECT参数说明 Array.<object> kvList</object></object></li></ul><table><thead><tr><th>参数</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>key</td><td>String</td><td>是</td><td>本地缓存中的指定的key</td></tr><tr><td>data</td><td>Object/String</td><td>是</td><td>需要存储的内容</td></tr></tbody></table><pre class="line-numbers language-csharp"><code class="language-csharp"><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>        regionData<span class="token punctuation">:</span><span class="token keyword">null</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 设置</span>        wx<span class="token punctuation">.</span><span class="token function">batchSetStorageSync</span><span class="token punctuation">(</span><span class="token punctuation">[</span>            <span class="token punctuation">{</span>key<span class="token punctuation">:</span> <span class="token string">'key1'</span><span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token punctuation">{</span>key<span class="token punctuation">:</span> <span class="token string">'key2'</span><span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>b<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// 获取</span>        <span class="token keyword">var</span> valueList <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">batchGetStorageSync</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'key1'</span><span class="token punctuation">,</span><span class="token string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// ["1", "2"]</span>        <span class="token comment" spellcheck="true">// 删除</span>        <span class="token comment" spellcheck="true">// 使用removeStorageSync 单个删除;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>以上三类存储API，注意事项：<br> 1：存储同样的key，会覆盖掉原来该 key 对应的内容。<br> 2：除非用户主动删除或因存储空间原因被系统清理，否则数据都一直可用。</p></blockquote><hr><hr><ul><li><h5 id="4-1-2-微信小程序画布-canvas"><a href="#4-1-2-微信小程序画布-canvas" class="headerlink" title="4.1.2 微信小程序画布 canvas"></a>4.1.2 微信小程序画布 canvas</h5></li></ul><p>微信小程序标签组件：canvas</p><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>必填</th><th>说明</th><th>最低版本</th></tr></thead><tbody><tr><td>type</td><td>string</td><td></td><td>否</td><td>指定 canvas 类型，支持 2d (2.9.0) 和 webgl (2.7.0)</td><td>2.7.0</td></tr><tr><td>canvas-id</td><td>string</td><td></td><td>否</td><td>canvas 组件的唯一标识符，若指定了 type 则无需再指定该属性</td><td>1.0.0</td></tr><tr><td>disable-scroll</td><td>boolean</td><td>false</td><td>否</td><td>当在 canvas 中移动时且有绑定手势事件时，禁止屏幕滚动以及下拉刷新</td><td>1.0.0</td></tr><tr><td>bindtouchstart</td><td>eventhandle</td><td></td><td>否</td><td>手指触摸动作开始</td><td>1.0.0</td></tr><tr><td>bindtouchmove</td><td>eventhandle</td><td></td><td>否</td><td>手指触摸后移动</td><td>1.0.0</td></tr><tr><td>bindtouchend</td><td>eventhandle</td><td></td><td>否</td><td>手指触摸动作结束</td><td>1.0.0</td></tr><tr><td>bindtouchcancel</td><td>eventhandle</td><td></td><td>否</td><td>手指触摸动作被打断，如来电提醒，弹窗</td><td>1.0.0</td></tr><tr><td>bindlongtap</td><td>eventhandle</td><td></td><td>否</td><td>手指长按 500ms 之后触发，触发了长按事件后进行移动不会触发屏幕的滚动</td><td>1.0.0</td></tr><tr><td>binderror</td><td>eventhandle</td><td></td><td>否</td><td>当发生错误时触发 error 事件，detail = {errMsg}</td><td>1.0.0</td></tr></tbody></table><blockquote><p>注意事项：</p><ol><li>canvas 标签默认宽度300px、高度150px</li><li>同一页面中的 canvas-id 不可重复，如果使用一个已经出现过的 canvas-id，该 canvas 标签对应的画布将被隐藏并不再正常工作</li><li>请注意<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fcomponent%2Fnative-component.html%23%E5%8E%9F%E7%94%9F%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8%E9%99%90%E5%88%B6" target="_blank" rel="noopener">原生组件使用限制</a></li><li>开发者工具中默认关闭了 GPU 硬件加速，可在开发者工具的设置中开启“硬件加速”提高 WebGL 的渲染性能</li><li>WebGL 支持通过 getContext(‘webgl’, { alpha: true }) 获取透明背景的画布</li><li>Canvas 2D（新接口）需要显式设置画布宽高 (默认为 300x150)</li><li>避免设置过大的宽高，在安卓下会有crash的问题</li></ol></blockquote><ul><li><strong>Canvas 2D 示例代码</strong></li></ul><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> canvas<span class="token punctuation">.</span>wxml <span class="token operator">--</span><span class="token operator">></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2d<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>myCanvas<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">// canvas.js</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> query <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createSelectorQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#myCanvas'</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">fields</span><span class="token punctuation">(</span><span class="token punctuation">{</span> node<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> canvas <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>node        <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> dpr <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pixelRatio        canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">*</span> dpr        canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>height <span class="token operator">*</span> dpr        ctx<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>dpr<span class="token punctuation">,</span> dpr<span class="token punctuation">)</span>        ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>WebGL 示例代码</strong></li></ul><pre class="line-numbers language-xml"><code class="language-xml"> <span class="token comment" spellcheck="true">&lt;!-- canvas.wxml --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>webgl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>myCanvas<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>// canvas.jsPage({  onReady() {    const query = wx.createSelectorQuery()    query.select('#myCanvas').node().exec((res) => {      const canvas = res[0].node      const gl = canvas.getContext('webgl')      gl.clearColor(1, 0, 1, 1)      gl.clear(gl.COLOR_BUFFER_BIT)    })  }})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>示例</strong></li></ul><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 画背景</span>  drawProgressbg<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 使用 旧api绘制 + 新api 自动适配圆圈大小</span>    <span class="token keyword">const</span> query <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createSelectorQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#canvasProgressbg'</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">fields</span><span class="token punctuation">(</span><span class="token punctuation">{</span> node<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 获取 px -> rpx 比例</span>        <span class="token comment" spellcheck="true">// const dpr = wx.getSystemInfoSync().pixelRatio;</span>        <span class="token keyword">var</span> width <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width<span class="token punctuation">;</span>        <span class="token keyword">var</span> height <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>height<span class="token punctuation">;</span>        <span class="token keyword">var</span> ctx <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createCanvasContext</span><span class="token punctuation">(</span><span class="token string">'canvasProgressbg'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>        ctx<span class="token punctuation">.</span><span class="token function">setLineWidth</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 设置圆环的宽度</span>        ctx<span class="token punctuation">.</span><span class="token function">setStrokeStyle</span><span class="token punctuation">(</span><span class="token string">'#e2e0e0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 设置圆环的颜色</span>        ctx<span class="token punctuation">.</span><span class="token function">setLineCap</span><span class="token punctuation">(</span><span class="token string">'round'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 设置圆环端点的形状</span>        ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//开始一个新的路径</span>        <span class="token keyword">var</span> radius <span class="token operator">=</span> <span class="token punctuation">(</span>height <span class="token operator">-</span> <span class="token number">26</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//设置圆的路径到当前路径</span>        ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> radius<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//对当前路径进行描边</span>        ctx<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">// 画公交线路倒计时 参数： step=( 到站秒数 / (900/2) )    最大900s</span>  drawCircle<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>step<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 使用 旧api绘制 + 新api 自动适配圆圈大小</span>    <span class="token keyword">const</span> query <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createSelectorQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#canvasProgress'</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">fields</span><span class="token punctuation">(</span><span class="token punctuation">{</span> node<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 获取 px -> rpx 比例</span>        <span class="token comment" spellcheck="true">// const dpr = wx.getSystemInfoSync().pixelRatio;</span>        <span class="token keyword">var</span> width <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width<span class="token punctuation">;</span>        <span class="token keyword">var</span> height <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>height<span class="token punctuation">;</span>        <span class="token keyword">var</span> ctx <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createCanvasContext</span><span class="token punctuation">(</span><span class="token string">'canvasProgress'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 设置渐变</span>        <span class="token keyword">var</span> gradient <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">createLinearGradient</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">,</span> <span class="token string">"#77d0dc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token string">"0.5"</span><span class="token punctuation">,</span> <span class="token string">"#1db1c6"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">,</span> <span class="token string">"#09b1c7"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">setLineWidth</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">setStrokeStyle</span><span class="token punctuation">(</span>gradient<span class="token punctuation">)</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">setLineCap</span><span class="token punctuation">(</span><span class="token string">'round'</span><span class="token punctuation">)</span>        ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> radius <span class="token operator">=</span> <span class="token punctuation">(</span>height <span class="token operator">-</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 参数step 为绘制的圆环周长，从0到2为一周 。 -Math.PI / 2 将起始角设在12点钟位置 ，结束角 通过改变 step 的值确定</span>        ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> radius<span class="token punctuation">,</span> <span class="token operator">-</span>Math<span class="token punctuation">.</span>PI <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> step <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI <span class="token operator">-</span> Math<span class="token punctuation">.</span>PI <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 画跟随的圆圈 内圆</span>        <span class="token keyword">var</span> e <span class="token operator">=</span> step <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI <span class="token operator">-</span> Math<span class="token punctuation">.</span>PI <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">let</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> r1 <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 通过三角函数计算x y 坐标</span>        x <span class="token operator">=</span> radius <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">+</span> width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>                y <span class="token operator">=</span> radius <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">+</span> width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> r1<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI<span class="token punctuation">)</span>        ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'rgba(29,177,198,1)'</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// 外圆</span>        ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token number">15</span>        ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> r2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI<span class="token punctuation">)</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'rgba(29,177,198,0.5)'</span>        ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="<img src="" alt="img"></p><p>image.png</p><hr><hr><ul><li><h5 id="4-1-3-相机-wx-chooseImage"><a href="#4-1-3-相机-wx-chooseImage" class="headerlink" title="4.1.3 相机 wx.chooseImage"></a>4.1.3 相机 wx.chooseImage</h5></li></ul><p>使用接口：wx.chooseImage(Object object)从本地相册选择图片或使用相机拍照。具体可看我另外一篇文章 <a href="https://www.jianshu.com/p/705d1c1aa07c" target="_blank" rel="noopener">微信小程序调用相机</a><br> <strong>参数</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>width</td><td>number</td><td>图像数据矩形的宽度</td></tr><tr><td>height</td><td>number</td><td>图像数据矩形的高度</td></tr><tr><td>data</td><td>ArrayBuffer</td><td>图像像素点数据，一维数组，每四项表示一个像素点的 rgba</td></tr></tbody></table><p><strong>返回值参数</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>必填</th></tr></thead><tbody><tr><td>success</td><td>function</td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>function</td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>function</td><td>否</td><td>接口调用结束的回调函数（调用成功、失败都会执行）</td></tr></tbody></table><p><strong>success 返回值 res</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>tempThumbPath</td><td>string</td><td>封面图片文件的临时路径 (本地路径)</td></tr><tr><td>tempVideoPath</td><td>string</td><td>视频的文件的临时路径 (本地路径)</td></tr></tbody></table><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>    carWin_img_hidden<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//展示照片的view是否隐藏</span>    carWin_img<span class="token punctuation">:</span><span class="token string">''</span> <span class="token comment" spellcheck="true">//存放照片路径的</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//页面加载设置初始值 可以不要</span>  <span class="token function">onReady</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      carWin_img_hidden<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      carWin_img<span class="token punctuation">:</span> <span class="token string">''</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//点击事件</span>  <span class="token function">clickCarWin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    wx<span class="token punctuation">.</span><span class="token function">chooseImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      success<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 无论用户是从相册选择还是直接用相机拍摄，路径都是在这里面</span>        <span class="token keyword">var</span> filePath <span class="token operator">=</span> res<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//将刚才选的照片/拍的 放到下面view视图中</span>        that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>          carWin_img<span class="token punctuation">:</span> filePath<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//把照片路径存到变量中，</span>          carWin_img_hidden<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token comment" spellcheck="true">//让展示照片的view显示</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 这个是使用微信接口保存文件到数据库</span>        <span class="token comment" spellcheck="true">// wx.uploadFile({</span>        <span class="token comment" spellcheck="true">//   url: "",</span>        <span class="token comment" spellcheck="true">//   filePath: filePath,</span>        <span class="token comment" spellcheck="true">//   name: 'file',</span>        <span class="token comment" spellcheck="true">//   success: function (res) {</span>        <span class="token comment" spellcheck="true">//   }</span>        <span class="token comment" spellcheck="true">// })</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      fail<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"调用本地相册文件时出错"</span><span class="token punctuation">)</span>        console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      complete<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-4245d7d49c747686.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/344/format/webp" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-c38e8a1b1f813ae4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/341/format/webp" alt="img"></p><hr><hr><ul><li><h5 id="4-1-4-获取位置"><a href="#4-1-4-获取位置" class="headerlink" title="4.1.4 获取位置"></a>4.1.4 获取位置</h5></li></ul><blockquote><p>获取用户位置信息，共需要使用以下三个api：</p><ul><li>wx.getSetting 获取用户授权信息列表</li><li>wx.authorize 向用户发起授权请求</li><li>wx.getLocation 获取用户位置信息</li></ul></blockquote><ul><li><strong>wx.getSetting(option)</strong><br> 获取用户的当前设置。*返回值中只会出现小程序已经向用户请求过的权限。</li></ul><p>option 参数说明</p><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>withSubscriptions</td><td>Boolean</td><td>false</td><td>是否同时获取用户订阅消息的订阅状态，默认不获取。</td></tr><tr><td>success</td><td>function</td><td></td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>function</td><td></td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>function</td><td></td><td>接口调用结束的回调函数（调用成功、失败都会执行）</td></tr></tbody></table><p>success 回调函数</p><table><thead><tr><th>属性</th><th>类型</th><th>说明</th><th></th></tr></thead><tbody><tr><td>authSetting</td><td>AuthSetting</td><td>用户授权结果</td><td></td></tr><tr><td>subscriptionsSetting</td><td>SubscriptionsSetting</td><td>用户订阅消息设置，接口参数<code>withSubscriptions</code>值为<code>true</code>时才会返回。</td><td></td></tr><tr><td>miniprogramAuthSetting</td><td>AuthSetting</td><td>在插件中调用时，当前宿主小程序的用户授权结果</td><td></td></tr></tbody></table><pre class="line-numbers language-cpp"><code class="language-cpp">wx<span class="token punctuation">.</span><span class="token function">getSetting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token function">success</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>authSetting<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// res.authSetting = {</span>    <span class="token comment" spellcheck="true">//   "scope.userInfo": true,</span>    <span class="token comment" spellcheck="true">//   "scope.userLocation": true</span>    <span class="token comment" spellcheck="true">// }</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>wx.authorize (option)</strong><br> 用户授权名称列表 可查看 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fframework%2Fopen-ability%2Fauthorize.html" target="_blank" rel="noopener">授权scope 列表</a></li></ul><p>option参数说明</p><table><thead><tr><th>属性</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>scope</td><td>string</td><td>是</td><td>需要获取权限的 scope</td></tr><tr><td>success</td><td>function</td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>function</td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>function</td><td>否</td><td>接口调用结束的回调函数（调用成功、失败都会执行）</td></tr></tbody></table><pre class="line-numbers language-csharp"><code class="language-csharp"><span class="token comment" spellcheck="true">// 可以通过 wx.getSetting 先查询一下用户是否授权了 "scope.record" 这个 scope</span>wx<span class="token punctuation">.</span><span class="token function">getSetting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment" spellcheck="true">// 查询用户是否授权位置信息</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>authSetting<span class="token punctuation">[</span><span class="token string">'scope.userLocation'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 调用位置授权</span>      wx<span class="token punctuation">.</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        scope<span class="token punctuation">:</span> <span class="token string">'scope.userLocation'</span><span class="token punctuation">,</span>        <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>wx.getLocation(option)</strong><br> 获取当前的地理位置、速度。当用户离开小程序后，此接口无法调用；当用户点击“显示在聊天顶部”时，此接口可继续调用。</li></ul><p>option参数说明</p><table><thead><tr><th>参数</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>type</td><td>String</td><td>否</td><td>默认为”wgs84”返回gps坐标，”gcj02”返回可用于wx.openLocation的坐标</td></tr><tr><td>success</td><td>Function</td><td>是</td><td>接口调用成功的回调函数，返回内容详见返回参数说明。</td></tr><tr><td>fail</td><td>Function</td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>Function</td><td>否</td><td>接口调用结束的回调函数（调用成功、失败都会执行）</td></tr></tbody></table><p>success返回参数说明</p><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>latitude</td><td>纬度，浮点数，范围为-90~90，负数表示南纬</td></tr><tr><td>longitude</td><td>经度，浮点数，范围为-180~180，负数表示西经</td></tr><tr><td>speed</td><td>速度，浮点数，单位m/s</td></tr><tr><td>accuracy</td><td>位置的精确度</td></tr><tr><td>altitude</td><td>高度，单位 m</td></tr><tr><td>verticalAccuracy</td><td>垂直精度，单位 m（Android 无法获取，返回 0）</td></tr><tr><td>horizontalAccuracy</td><td>水平精度，单位 m</td></tr></tbody></table><pre class="line-numbers language-css"><code class="language-css"><span class="token selector">wx<span class="token class">.getLocation</span>(</span><span class="token punctuation">{</span> <span class="token selector">type: 'wgs84', success (res) </span><span class="token punctuation">{</span>   const latitude = res<span class="token number">.</span>latitude   const longitude = res<span class="token number">.</span>longitude   const speed = res<span class="token number">.</span>speed   const accuracy = res<span class="token number">.</span>accuracy <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>获取用户位置信息示例</strong></li><li>第一步：在app.json中申明</li></ul><pre class="line-numbers language-json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"pages"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token string">"pages/index/index"</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"window"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"backgroundTextStyle"</span><span class="token operator">:</span> <span class="token string">"light"</span><span class="token punctuation">,</span>        <span class="token property">"navigationBarBackgroundColor"</span><span class="token operator">:</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>        <span class="token property">"navigationBarTitleText"</span><span class="token operator">:</span> <span class="token string">"Weixin"</span><span class="token punctuation">,</span>        <span class="token property">"navigationBarTextStyle"</span><span class="token operator">:</span> <span class="token string">"black"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"permission"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"scope.userLocation"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"你的位置信息将用于小程序首页获取附近公交站点"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"style"</span><span class="token operator">:</span> <span class="token string">"v2"</span><span class="token punctuation">,</span>    <span class="token property">"sitemapLocation"</span><span class="token operator">:</span> <span class="token string">"sitemap.json"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>第二步：提前让用户授权，示例在app.js中调用wx.getSetting、wx.authorize 弹窗让用户授权</li></ul><pre class="line-numbers language-csharp"><code class="language-csharp"><span class="token comment" spellcheck="true">// app.js</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 位置授权</span>    wx<span class="token punctuation">.</span><span class="token function">getSetting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>authSetting<span class="token punctuation">[</span><span class="token string">'scope.userLocation'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            wx<span class="token punctuation">.</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">{</span>              scope<span class="token punctuation">:</span> <span class="token string">'scope.userLocation'</span><span class="token punctuation">,</span>              <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  globalData<span class="token punctuation">:</span> <span class="token punctuation">{</span>    userInfo<span class="token punctuation">:</span> <span class="token keyword">null</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>第三步：在需要获取位置的地方，调用获取</li></ul><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--index.wxml--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>myMap<span class="token punctuation">"</span></span> <span class="token attr-name">show-location</span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>getCenterLocation<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>获取位置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>moveToLocation<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>移动位置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>translateMarker<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>移动标注<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>includePoints<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>缩放视野展示所有经纬度<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token comment" spellcheck="true">// map.js</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    onReady<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 使用 wx.createMapContext 获取 map 上下文</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>mapCtx <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createMapContext</span><span class="token punctuation">(</span><span class="token string">'myMap'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    getCenterLocation<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>mapCtx<span class="token punctuation">.</span><span class="token function">getCenterLocation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        success<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">{</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>latitude<span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    moveToLocation<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>mapCtx<span class="token punctuation">.</span><span class="token function">moveToLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    translateMarker<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>mapCtx<span class="token punctuation">.</span><span class="token function">translateMarker</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        markerId<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        autoRotate<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        duration<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>        destination<span class="token punctuation">:</span> <span class="token punctuation">{</span>          latitude<span class="token punctuation">:</span><span class="token number">23.10229</span><span class="token punctuation">,</span>          longitude<span class="token punctuation">:</span><span class="token number">113.3345211</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token function">animationEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'animation end'</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    includePoints<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>mapCtx<span class="token punctuation">.</span><span class="token function">includePoints</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        padding<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        points<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>          latitude<span class="token punctuation">:</span><span class="token number">23.10229</span><span class="token punctuation">,</span>          longitude<span class="token punctuation">:</span><span class="token number">113.3345211</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>          latitude<span class="token punctuation">:</span><span class="token number">23.00229</span><span class="token punctuation">,</span>          longitude<span class="token punctuation">:</span><span class="token number">113.3345211</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">]</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-1e962c74e9d35785.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/365/format/webp" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-7bd8c7613dc248f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/357/format/webp" alt="img"></p><hr><hr><ul><li><h5 id="4-1-5-屏幕操作"><a href="#4-1-5-屏幕操作" class="headerlink" title="4.1.5 屏幕操作"></a>4.1.5 屏幕操作</h5></li><li><p><strong>设置屏幕亮度：wx.setScreenBrightness（）</strong><br> 参数值：value   0-1，越大越亮</p></li></ul><pre class="line-numbers language-csharp"><code class="language-csharp"><span class="token keyword">if</span> <span class="token punctuation">(</span>wx<span class="token punctuation">.</span>setScreenBrightness<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//设置屏幕亮度  参数值：0-1，越大越亮</span>      wx<span class="token punctuation">.</span><span class="token function">setScreenBrightness</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token keyword">value</span><span class="token punctuation">:</span> <span class="token number">0.6</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 如果希望用户在最新版本的客户端上体验您的小程序，可以这样子提示</span>      wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        title<span class="token punctuation">:</span> <span class="token string">'提示'</span><span class="token punctuation">,</span>        content<span class="token punctuation">:</span> <span class="token string">'当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。'</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>获取屏幕亮度 wx.getScreenBrightness()</strong></li></ul><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token keyword">if</span> <span class="token punctuation">(</span>wx<span class="token punctuation">.</span>getScreenBrightness<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//获取屏幕亮度 值：0-1，越大越亮</span>      success<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// res.value</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      fail<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//请求失败 </span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 如果希望用户在最新版本的客户端上体验您的小程序，可以这样子提示</span>      wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        title<span class="token punctuation">:</span> <span class="token string">'提示'</span><span class="token punctuation">,</span>        content<span class="token punctuation">:</span> <span class="token string">'当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。'</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上两个方法可以配合使用，设置前记得先获取一下屏幕亮度，存起来，设置好亮度等不需要这么亮或用户退出程序时候，在给设置回去，这样用户体验好一些。<br> 注：记得别忘记用户退出程序或者是某个界面时，恢复一下了亮度。</p><ul><li><strong>设置屏幕常亮 wx.setKeepScreenOn</strong><br> 参数值： true / false</li></ul><pre class="line-numbers language-ruby"><code class="language-ruby"><span class="token keyword">if</span> <span class="token punctuation">(</span>wx<span class="token punctuation">.</span>setScreenBrightness<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token operator">/</span><span class="token operator">/</span> 保持屏幕常亮 <span class="token keyword">true</span> <span class="token operator">/</span> <span class="token keyword">false</span>      wx<span class="token punctuation">.</span><span class="token function">setKeepScreenOn</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        keepScreenOn<span class="token punctuation">:</span> <span class="token keyword">false</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token operator">/</span><span class="token operator">/</span> 如果希望用户在最新版本的客户端上体验您的小程序，可以这样子提示      wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        title<span class="token punctuation">:</span> <span class="token string">'提示'</span><span class="token punctuation">,</span>        content<span class="token punctuation">:</span> <span class="token string">'当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。'</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注：记得别忘记用户退出程序或者是某个界面时，重新设置一下不常亮。</p><hr><hr><ul><li><h5 id="4-1-6-扫码-wx-scanCode"><a href="#4-1-6-扫码-wx-scanCode" class="headerlink" title="4.1.6 扫码 wx.scanCode"></a>4.1.6 扫码 wx.scanCode</h5></li></ul><p>调起客户端扫码界面进行扫码</p><p><strong>option参数说明</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>onlyFromCamera</td><td>boolean</td><td>false</td><td>是否只能从相机扫码，不允许从相册选择图片</td></tr><tr><td>scanType</td><td>Array.<string></string></td><td>[‘barCode’, ‘qrCode’]</td><td>扫码类型</td></tr><tr><td>success</td><td>function</td><td></td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>function</td><td></td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>function</td><td></td><td>接口调用结束的回调函数（调用成功、失败都会执行）</td></tr></tbody></table><p>object.scanType 的合法值</p><table><thead><tr><th>值</th><th>说明</th></tr></thead><tbody><tr><td>barCode</td><td>一维码</td></tr><tr><td>qrCode</td><td>二维码</td></tr><tr><td>datamatrix</td><td>Data Matrix 码</td></tr><tr><td>pdf417</td><td>PDF417 条码</td></tr></tbody></table><p><strong>success res</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>result</td><td>string</td><td>所扫码的内容</td></tr><tr><td>scanType</td><td>string</td><td>所扫码的类型</td></tr><tr><td>charSet</td><td>string</td><td>所扫码的字符集</td></tr><tr><td>path</td><td>string</td><td>当所扫的码为当前小程序二维码时，会返回此字段，内容为二维码携带的 path</td></tr><tr><td>rawData</td><td>string</td><td>原始数据，base64编码</td></tr></tbody></table><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">// 允许从相机和相册扫码</span>wx<span class="token punctuation">.</span><span class="token function">scanCode</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token function">success</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 只允许从相机扫码</span>wx<span class="token punctuation">.</span><span class="token function">scanCode</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  onlyFromCamera<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token function">success</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><hr><h3 id="4-2-第三方插件使用"><a href="#4-2-第三方插件使用" class="headerlink" title="4.2 第三方插件使用"></a>4.2 第三方插件使用</h3><p>微信官方及第三方等提供了很多优秀的小程序页面插件，如：腾讯位置服务地图选点、腾讯位置导航等，使用方式相同，均是无缝跳转到插件小程序页面</p><ul><li><strong>在微信公众平台中配置插件</strong><br> “微信小程序官方后台-设置-第三方服务-插件管理” 里点击 “添加插件”，如：搜索 “腾讯位置服务地图选点” 申请，审核通过后，小程序开发者可在小程序内使用该插件。</li></ul><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-3820ee3b0d91474e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><ul><li><strong>引入插件包</strong><br> 点击插件详情，既可看到插件APPid</li></ul><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-76db462164bd6d75.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><ul><li><strong>在app.json中配置使用插件</strong></li></ul><pre class="line-numbers language-json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"pages"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token string">"pages/index/index"</span><span class="token punctuation">,</span>        <span class="token string">"pages/logs/logs"</span><span class="token punctuation">,</span>        <span class="token string">"components/ceshi"</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"window"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"backgroundTextStyle"</span><span class="token operator">:</span> <span class="token string">"light"</span><span class="token punctuation">,</span>        <span class="token property">"navigationBarBackgroundColor"</span><span class="token operator">:</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>        <span class="token property">"navigationBarTitleText"</span><span class="token operator">:</span> <span class="token string">"Weixin"</span><span class="token punctuation">,</span>        <span class="token property">"navigationBarTextStyle"</span><span class="token operator">:</span> <span class="token string">"black"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"permission"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"scope.userLocation"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"你的位置信息将用于小程序首页获取附近公交站点"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"routePlan"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.5"</span><span class="token punctuation">,</span>            <span class="token property">"provider"</span><span class="token operator">:</span> <span class="token string">"wx76a9a06e5b4e693e"</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"style"</span><span class="token operator">:</span> <span class="token string">"v2"</span><span class="token punctuation">,</span>    <span class="token property">"sitemapLocation"</span><span class="token operator">:</span> <span class="token string">"sitemap.json"</span><span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>设置定位授权</strong><br> 地图选点插件需要小程序提供定位授权才能够正常使用定位功能：</li></ul><pre class="line-numbers language-json"><code class="language-json">// app.json    <span class="token punctuation">{</span>    <span class="token property">"permission"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"scope.userLocation"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"你的位置信息将用于小程序定位"</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>使用插件</strong><br> 插件页面调用示例：</li></ul><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//使用在腾讯位置服务申请的key</span><span class="token keyword">const</span> referer <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//调用插件的app的名称</span><span class="token comment" spellcheck="true">// 初始位置的经纬度，如果不传 默认当前位置</span><span class="token keyword">const</span> location <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  latitude<span class="token punctuation">:</span> <span class="token number">39.89631551</span><span class="token punctuation">,</span>  longitude<span class="token punctuation">:</span> <span class="token number">116.323459711</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> category <span class="token operator">=</span> <span class="token string">'生活服务,娱乐休闲'</span><span class="token punctuation">;</span>wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  url<span class="token punctuation">:</span> <span class="token string">'plugin://chooseLocation/index?key='</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">'&amp;referer='</span> <span class="token operator">+</span> referer <span class="token operator">+</span> <span class="token string">'&amp;location='</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">'&amp;category'</span> <span class="token operator">+</span> category<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>插件返回数据</strong></li></ul><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//地图返回 在页面的 onShow中 获取数据返回。</span>        <span class="token keyword">const</span> location <span class="token operator">=</span> chooseLocation<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 返回的数据放在这个对象里面</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>location<span class="token punctuation">)</span> <span class="token punctuation">{</span>          allData<span class="token punctuation">.</span>address_name <span class="token operator">=</span> location<span class="token punctuation">.</span>name<span class="token punctuation">;</span>          allData<span class="token punctuation">.</span>address <span class="token operator">=</span> location<span class="token punctuation">.</span>address<span class="token punctuation">;</span>          allData<span class="token punctuation">.</span>address_poi <span class="token operator">=</span> location<span class="token punctuation">.</span>latitude <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> location<span class="token punctuation">.</span>longitude<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>效果如下</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-8f479970c9af2895.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/414/format/webp" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-156ff7957e2950fe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/385/format/webp" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-84511da243f8c0f7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/388/format/webp" alt="img"></p><hr><hr><h3 id="4-3-微信扫码快捷打开小程序页面"><a href="#4-3-微信扫码快捷打开小程序页面" class="headerlink" title="4.3 微信扫码快捷打开小程序页面"></a>4.3 微信扫码快捷打开小程序页面</h3><p>微信公众平台开放扫描普通链接二维码跳转小程序能力。</p><blockquote><p>普通链接二维码，是指开发者使用工具对网页链接进行编码后生成的二维码。<br> 线下商户可不需更换线下二维码，在小程序后台完成配置后，即可在用户扫描普通链接二维码时打开小程序，使用小程序的功能。<br> 对于普通链接二维码，目前支持使用微信“扫一扫”或微信内长按识别二维码跳转小程序。</p></blockquote><ul><li><strong>登录小程序后台</strong><br> 进入“设置-开发设置-扫普通链接二维码打开小程序”，开启功能后即可配置二维码规则。</li></ul><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-c46e3a1912e691bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><ul><li><strong>配置规则</strong></li></ul><blockquote><ul><li>二维码规则<br> 二维码规则的域名须通过ICP备案的验证。<br> 支持http、https、ftp开头的链接，一个小程序帐号可配置不多于10个二维码前缀规则。</li></ul></blockquote><blockquote><ul><li>前缀占用规则<br> 可选择是否占用符合二维码匹配规则的所有子规则。如选择占用，则其他帐号不可申请使用满足该前缀匹配规则的其他子规则。<br> 如：若开发者A配置二维码规则：<a href="https://links.jianshu.com/go?to=http%3A%2F%2Faaa%2Fmp%3Fid%3D123" target="_blank" rel="noopener">http://aaa/mp?id=123</a>，并选择“占用所有子规则“，其他开发者将不可以配置满足前缀匹配的子规则</li></ul></blockquote><p>下载随机校验文件，并将文件上传至服务器指定位置的目录下（你填写的这个链接，加上这个校验文件名称，必须能访问到，如：<a href="https://links.jianshu.com/go?to=http%3A%2F%2Faaa%2Fmp%2FrOO4daUTUI.txt" target="_blank" rel="noopener">http://aaa/mp/rOO4daUTUI.txt</a>），方可通过所属权校验。<br> 根据要求填写好下列选项</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-2663059c0ed5bfd6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><p>如：</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-ad1aebbe39deac4a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><ul><li><strong>制作二维码</strong><br> 使用二维码工具制作二维码：如 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fcli.im%2F" target="_blank" rel="noopener">草料二维码</a><br> 将域名放入，可传参，小程序对应页面可接收参数，方法同路由跳转接收参数一样。生成二维码， 然后就可以使用微信扫描这个二维码进入小程序对应页面。</li></ul><p>如：its.***.com/ft-xcx?a=1&amp;b=2</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-cee59415cec6f828.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1078/format/webp" alt="img"></p><hr><hr><h3 id="4-4-地图"><a href="#4-4-地图" class="headerlink" title="4.4 地图"></a>4.4 地图</h3><p>map组件提供了地图展示、交互、叠加点线面及文字等功能，同时支持个性化地图样式，可结合地图服务 API 实现更丰富功能，这里简单说一下， 不过多讲解，内容很多，详情去文档看既可。。 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fcomponent%2Fmap.html" target="_blank" rel="noopener">微信文档-map</a></p><p><strong>个性化地图</strong><br> 个性化地图能力可在小程序后台“开发-开发者工具-腾讯位置服务”申请开通。 小程序内地图组件应使用同一 subkey，可通过 layer-style（地图官网设置的样式 style 编号）属性选择不同的底图风格。 组件属性的长度单位默认为px，2.4.0起支持传入单位(rpx/px)。。</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-0b297123cb5ed5b6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><p>示例</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- line-map --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>station_map<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span>     <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>map<span class="token punctuation">'</span></span>     <span class="token attr-name">subkey</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3A4BZ-TMKEP-OPEDL-VCRQ7-HUJZ5-TJBYJ<span class="token punctuation">"</span></span>    <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>station_map<span class="token punctuation">"</span></span>     <span class="token attr-name">longitude</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{longitude}}<span class="token punctuation">"</span></span>     <span class="token attr-name">latitude</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{latitude}}<span class="token punctuation">"</span></span>     <span class="token attr-name">scale</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>14<span class="token punctuation">"</span></span>      <span class="token attr-name">markers</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{markers}}<span class="token punctuation">"</span></span>    <span class="token attr-name">polyline</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{polyline}}<span class="token punctuation">"</span></span>    <span class="token attr-name">show-location</span>  <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-kotlin"><code class="language-kotlin"><span class="token comment" spellcheck="true">// pages/line/line.js</span><span class="token keyword">const</span> Common <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"../../../utils/common.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//获取应用实例</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  properties<span class="token operator">:</span><span class="token punctuation">{</span>    stations<span class="token operator">:</span> <span class="token punctuation">{</span>      type<span class="token operator">:</span> <span class="token string">'Object'</span><span class="token punctuation">,</span>      value<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    lineId<span class="token operator">:</span> <span class="token punctuation">{</span>      type<span class="token operator">:</span> <span class="token string">'String'</span><span class="token punctuation">,</span>      value<span class="token operator">:</span><span class="token string">''</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token keyword">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 图片链接</span>    img_server_url<span class="token operator">:</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>img_server_url<span class="token punctuation">,</span>    latitude<span class="token operator">:</span> <span class="token number">22.533773</span><span class="token punctuation">,</span>    longitude<span class="token operator">:</span> <span class="token number">114.057678</span><span class="token punctuation">,</span>    markers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    polyline<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    controls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> markers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>stations<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> station <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>stations<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token keyword">var</span> poi <span class="token operator">=</span> Common<span class="token punctuation">.</span><span class="token function">wgs84togcj02</span><span class="token punctuation">(</span>station<span class="token punctuation">.</span>lng<span class="token punctuation">,</span> station<span class="token punctuation">.</span>lat<span class="token punctuation">)</span><span class="token punctuation">;</span>      markers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        id<span class="token operator">:</span> i<span class="token punctuation">,</span>        iconPath<span class="token operator">:</span><span class="token string">"./images/station_icon1.png"</span><span class="token punctuation">,</span>        latitude<span class="token operator">:</span> poi<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        longitude<span class="token operator">:</span> poi<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        width<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>        height<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>        callout<span class="token operator">:</span> <span class="token punctuation">{</span>          content<span class="token operator">:</span> <span class="token string">'站名：'</span> <span class="token operator">+</span> station<span class="token punctuation">.</span>station_name<span class="token punctuation">,</span>          color<span class="token operator">:</span> <span class="token string">'#000'</span><span class="token punctuation">,</span>          fontSize<span class="token operator">:</span> <span class="token string">'24rpx'</span><span class="token punctuation">,</span>          padding<span class="token operator">:</span> <span class="token string">'10rpx'</span><span class="token punctuation">,</span>          bgColor<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>          borderRadius<span class="token operator">:</span> <span class="token string">'10rpx'</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">var</span> poi <span class="token operator">=</span> Common<span class="token punctuation">.</span><span class="token function">wgs84togcj02</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>stations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lng<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>stations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lat<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      markers<span class="token operator">:</span> markers<span class="token punctuation">,</span>      latitude<span class="token operator">:</span> poi<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      longitude<span class="token operator">:</span> poi<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    wx<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      title<span class="token operator">:</span> <span class="token string">'加载中···'</span><span class="token punctuation">,</span>      mask<span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> me <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    let param <span class="token operator">=</span> <span class="token punctuation">{</span>      lineId<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>lineId    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> url <span class="token operator">=</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>request_server_url <span class="token operator">+</span> <span class="token string">"/wechat/getLineGeom"</span><span class="token punctuation">;</span>    Common<span class="token punctuation">.</span><span class="token function">fetchGet</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> param<span class="token punctuation">,</span> <span class="token function">function</span> <span class="token punctuation">(</span>records<span class="token punctuation">)</span> <span class="token punctuation">{</span>      wx<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      let lineGeo <span class="token operator">=</span> records<span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>\w<span class="token operator">+</span><span class="token operator">/</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      lineGeo <span class="token operator">=</span> lineGeo<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>\<span class="token punctuation">(</span>|\<span class="token punctuation">)</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      lineGeo<span class="token operator">=</span>lineGeo<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">var</span> points <span class="token operator">=</span> lineGeo<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>        item <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>^\s<span class="token operator">+</span><span class="token operator">/</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        item<span class="token operator">=</span>item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> poi <span class="token operator">=</span> Common<span class="token punctuation">.</span><span class="token function">wgs84togcj02</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">{</span>          longitude<span class="token operator">:</span> poi<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          latitude<span class="token operator">:</span> poi<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">var</span> polyline<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{</span>        points<span class="token operator">:</span> points<span class="token punctuation">,</span>        color<span class="token operator">:</span> <span class="token string">'#09b1c7'</span><span class="token punctuation">,</span>        borderColor<span class="token operator">:</span><span class="token string">'#2f7f39'</span><span class="token punctuation">,</span>        borderWidth<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>        width<span class="token operator">:</span> <span class="token number">5</span>      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      me<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        polyline<span class="token operator">:</span> polyline      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  method<span class="token operator">:</span><span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><hr><h3 id="4-5-echarts使用"><a href="#4-5-echarts使用" class="headerlink" title="4.5 echarts使用"></a>4.5 echarts使用</h3><ul><li><strong>下载echarts</strong></li></ul><p>下载echarts微信版 地址：<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fecomfe%2Fecharts-for-weixin" target="_blank" rel="noopener">https://github.com/ecomfe/echarts-for-weixin</a><br> 下载后打开，如图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-6ca201bbf5d2bc34.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/305/format/webp" alt="img"></p><p>将下载好的文件中 ec-canvas目录 放在小程序项目目录中即可。如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-08b0eb5c6250f09d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/306/format/webp" alt="img"></p><p>然后在需要的地方引入即可。<br> 效果</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-4d65d5bdf62f69b8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/735/format/webp" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-c505f1fdfaf3e0fc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/367/format/webp" alt="img"></p><ul><li><strong>示例</strong></li><li>在页面开启使用echarts<br> 如：在 page目录的ceshi页面中使用echarts的话，需要在ceshi.json中添加以下配置。</li></ul><pre class="line-numbers language-bash"><code class="language-bash"><span class="token string">"usingComponents"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>    <span class="token string">"ec-canvas"</span><span class="token keyword">:</span> <span class="token string">"../../ec-canvas/ec-canvas"</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>引入<br> 在 ceshi.js 中引入echarts.js</li></ul><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> echarts <span class="token keyword">from</span> <span class="token string">'../../ec-canvas/echarts'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>wxml元素<br> 在ceshi.wxml中建立一个元素，外层用view包一下是方便设置echarts元素的宽高。</li></ul><pre class="line-numbers language-jsx"><code class="language-jsx">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>echart_panel<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ec-canvas</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ec-canvas</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>开始编写图表 折线图<br> 我是在ceshi.js中直接写了一个函数，传一些参数，返回一个option，至于echarts的option写法，可以参考echats官网api文档。</li></ul><pre class="line-numbers language-tsx"><code class="language-tsx">function getOption(xData, data_cur, data_his) {  var option = {    backgroundColor: "#f5f4f3",    color: ["#37A2DA", "#f2960d", "#67E0E3", "#9FE6B8"],    title: {      text: '实时运行速度',      textStyle: {        fontWeight: '500',        fontSize: 15,        color: '#000'      },      x:'center',      y:'0'    },    legend: {      data: ['今日', '昨日'],      right: 10    },    grid: {      top: '15%',      left: '1%',      right: '3%',      bottom: '60rpx',      containLabel: true    },    tooltip: {      show: true,      trigger: 'axis'    },    xAxis: {      type: 'category',      boundaryGap: false,      data: xData||[],      axisLabel: {        interval: 11,        formatter: function (value, index) {          return value.substring(0, 2) * 1;        },        textStyle: {          fontsize: '10px'        }      }    },    yAxis: {      x: 'center',      name: 'km/h',      type: 'value',      min: 0,      max: 120    },    series: [{      name: '今日',      zIndex:2,      type: 'line',      smooth: true,      symbolSize: 0,      data: data_cur||[]    },{        name: '昨日',        zIndex: 1,        type: 'line',        smooth: true,        symbolSize: 0,        data: data_his||[]    }]  };  return option;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后就可以在 页面page中的data中配置初始化，如何初始化？<br> 首先 建立一个全局变量（注意，放在page外面，要全局变量，不然你在页面加载之后，在动态修改图表数据的话，没法修改，这样方便点），<br> 然后在data中初始化echats对象 ecLine，名字随便起，按照官方写法即可，onInit函数中参数有三个，canvas, width, height，这些都不需要管，直接初始化echats元素。复制粘贴即可。</p><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token keyword">let</span> chartLine<span class="token punctuation">;</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>        ecLine<span class="token punctuation">:</span> <span class="token punctuation">{</span>            onInit<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//初始化echarts元素，绑定到全局变量，方便更改数据</span>                chartLine <span class="token operator">=</span> echarts<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>                    width<span class="token punctuation">:</span> width<span class="token punctuation">,</span>                    height<span class="token punctuation">:</span> height                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                canvas<span class="token punctuation">.</span><span class="token function">setChart</span><span class="token punctuation">(</span>chartLine<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">//可以先不setOption，等数据加载好后赋值，</span>                <span class="token comment" spellcheck="true">//不过那样没setOption前，echats元素是一片空白，体验不好，所有我先set。</span>                <span class="token keyword">var</span> xData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// x轴数据 自己写</span>                <span class="token keyword">var</span> option <span class="token operator">=</span> <span class="token function">getOption</span><span class="token punctuation">(</span>xData<span class="token punctuation">)</span><span class="token punctuation">;</span>                chartLine<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后将建立的echats对象绑定到echarts元素中，如下：</p><pre class="line-numbers language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>echart_panel<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ec-canvas</span> <span class="token attr-name">ec</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{</span> <span class="token attr-name">ecLine</span> <span class="token attr-name">}}"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ec-canvas</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-d4490a962b9a745d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/376/format/webp" alt="img"></p><p>然后就可以在数据加载后，给图表赋值option了，或者是重新setOption的数据。</p><pre class="line-numbers language-kotlin"><code class="language-kotlin"><span class="token comment" spellcheck="true">//ajax请求好数据后，调用获取option函数，传一些数据，</span><span class="token comment" spellcheck="true">//然后用全局变量echarts元素chartLine 来 setOption即可。</span><span class="token comment" spellcheck="true">// 三个参数： x轴数据，第一条线数据，第二条数据。 随意，echarts就跟正常用随便写就行</span><span class="token comment" spellcheck="true">// 随便写几个假数据</span><span class="token keyword">var</span> xData<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> data_cur<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">78</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">78</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">78</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">78</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">78</span><span class="token punctuation">,</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token number">54</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> data_his<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">67</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">78</span><span class="token punctuation">,</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token number">54</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">78</span><span class="token punctuation">,</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token number">54</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">78</span><span class="token punctuation">,</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token number">54</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">78</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 方法一：</span><span class="token keyword">var</span> option <span class="token operator">=</span> <span class="token function">getOption</span><span class="token punctuation">(</span>xData<span class="token punctuation">,</span> data_cur<span class="token punctuation">,</span> data_his<span class="token punctuation">)</span><span class="token punctuation">;</span>chartLine<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 方法二：</span><span class="token comment" spellcheck="true">//如果上面初始化时候，已经chartLine已经setOption了，</span><span class="token comment" spellcheck="true">//那么建议不要重新setOption，官方推荐写法，重新赋数据即可。</span>chartLine<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    xAxis<span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token keyword">data</span><span class="token operator">:</span> xData    <span class="token punctuation">}</span><span class="token punctuation">,</span>     series<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>        <span class="token keyword">data</span><span class="token operator">:</span> data_cur    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>        <span class="token keyword">data</span><span class="token operator">:</span> data_his    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-9ddac7a4b4b81cf6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/387/format/webp" alt="img"></p><p>示例写的折线图，其他类型图表，可以参考echarts官网文档即可。</p><p>因为从github下载的echarts.js包含类型比较多，如果上传代码进行发布时，提示echarts文件过大，可以忽略。</p><p>或者是自己重新下载echarts定制需要的组件，如我就需要折线图，我就定制带折线图的即可。然后直接替换文件夹中的echarts.js即可。</p><p>下载定制echarts官网链接：<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fecharts.baidu.com%2Fbuilder.html" target="_blank" rel="noopener">http://echarts.baidu.com/builder.html</a></p><hr><hr><h2 id="五、上传、发布"><a href="#五、上传、发布" class="headerlink" title="五、上传、发布"></a>五、上传、发布</h2><blockquote><p>小程序打包发布等都很简单,流程：</p><ul><li>从微信开发工具上面上传代码到微信公众平台</li><li>使用小程序账号登录，进入管理-版本管理，选择发布 正式版、体验版 既可。</li></ul></blockquote><ul><li><p><strong>配置域名</strong><br> 登录微信公众平台-点击开发管理-开发设置，往下拉进去配置合法域名</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-e960a05f5d330df4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p></li></ul><ul><li><strong>上传</strong></li></ul><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-6907fba36e307028.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-df504be2182d01c4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><ul><li><strong>发布</strong><br> 进入管理-版本管理，选择刚才提交的版本，点击提交审核发布既可，或者点击小三角，选择选为体验版。</li></ul><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-4c588f0e07eeb170.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/490/format/webp" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-393c8cd6698de766.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https:////upload-images.jianshu.io/upload_images/4321660-e2d13e218cf5a87b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><hr><hr><h2 id="六、小程序开发技术选型（不限于微信小程序）"><a href="#六、小程序开发技术选型（不限于微信小程序）" class="headerlink" title="六、小程序开发技术选型（不限于微信小程序）"></a>六、小程序开发技术选型（不限于微信小程序）</h2><ul><li><strong>原生开发</strong><br> 使用小程序原生开发，很方便，官方提供了非常详细的组件、API等，文档也很丰富，开发者社区等。</li></ul><blockquote><p><strong>优点</strong></p><ul><li>官方文档清晰明了，更接近手机服务的底层逻辑，开发者可以更有针对性的对小程序进行深度开发</li><li>小程序原生平台社区更加活跃</li><li>使用原生开发可以紧随官方的版本，更新响应速度快，让项目达到最优状态</li><li>完美适配，不会出现适配问题</li><li>原生开发的功能更加完善，可以优秀的调用小程序API使用手机各种功能</li></ul></blockquote><blockquote><p><strong>缺点</strong></p><ul><li>仅适用于单个平台的小程序</li><li>开发成本高，开发不同平台下的小程序，需要不同的开发工具及语法</li><li>维护成本高，同样的项目需要写多套代码，后期维护起来工作量大成本高，</li><li>原生组件样式不太美观，需要专门写css美化</li></ul></blockquote><ul><li><strong>uni-app</strong><br> uniapp是跨端的快速开发工具，当前支持微信小程序、百度小程序、头条小程序、qq小程序等14个平台，一套代码适应多个平台。   支持原生代码混写和原生sdk集成，通过条件编译+平台特有API调用，可以优雅的为某平台写个性化代码，调用专有能力而不影响其他平台。</li></ul><blockquote><p><strong>优点</strong></p><ul><li>多端开发，一套代码可打包超多个不同平台，生成各种小程序H5及APP应用，不需来回切换各种开发工具</li><li>学习成本低，uni-app基于通用的前端技术栈，采用vue语法+微信小程序api，无额外学习成本</li><li>插件市场， uni-app拥有上千款的插件，支持NPM、支持平台小程序组件和SDK</li><li>组件丰富，样式漂亮</li><li>微信小程序依赖于微信的一键登录非常方便，uniapp不但能使用微信登录，而且还有一套自己的用户管理系统</li></ul></blockquote><blockquote><p><strong>缺点</strong></p><ul><li>完善性差，uni-app问世的时间还比较短，坑多，不过官方版本更新活跃，相信这些问题逐渐都会得到解决</li><li>兼容问题，uni-app打包出来的小程序可能会存在平台兼容问题，同样的代码会在不同平台下存在差异，如微信小程序、支付宝小程序。</li><li>如更新不及时，就不能紧随平台小程序，使用不了小程序平台发布的新功能</li><li>文档比较松散，社区质量不如小程序平台</li></ul></blockquote><ul><li><strong>其他类似uni-app的框架</strong><br> taro、yonbuilder</li><li><strong>总结</strong><br> 项目只做单平台的小程序，原生是最优的选择<br> 项目同时开发多平台小程序，使用uni-app最优选择</li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> 微信小程序 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 微信小程序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx安装和配置文件讲解</title>
      <link href="/2023/03/23/blog-open-source-nginx-environment/"/>
      <url>/2023/03/23/blog-open-source-nginx-environment/</url>
      
        <content type="html"><![CDATA[<h1 id="Nginx安装和配置文件讲解"><a href="#Nginx安装和配置文件讲解" class="headerlink" title="Nginx安装和配置文件讲解"></a>Nginx安装和配置文件讲解</h1><h3 id="第一步：下载nginx压缩包"><a href="#第一步：下载nginx压缩包" class="headerlink" title="第一步：下载nginx压缩包"></a><strong>第一步：下载nginx压缩包</strong></h3><pre><code>可以到官方网站下载安装包也可以通过wget命令下载。wget -c http://nginx.org/download/nginx-1.17.5.tar.gz</code></pre><blockquote><p><em>备注：一般会把压缩包放在/usr/local 下</em></p></blockquote><h3 id="第二步：配置nginx安装所需的环境"><a href="#第二步：配置nginx安装所需的环境" class="headerlink" title="第二步：配置nginx安装所需的环境"></a><strong>第二步：配置nginx安装所需的环境</strong></h3><h4 id="1-安装gcc"><a href="#1-安装gcc" class="headerlink" title="1.安装gcc"></a><strong>1.安装gcc</strong></h4><pre><code>安装nginx需要先将源码进行编译，编译需要依赖gcc环境yum install gcc-c++</code></pre><h4 id="2-安装PCRE-pcre-devel"><a href="#2-安装PCRE-pcre-devel" class="headerlink" title="2.安装PCRE pcre-devel"></a><strong>2.安装PCRE pcre-devel</strong></h4><pre><code>Nginx的Rewrite模块和HTTP核心模块会使用到PCRE正则表达式语法。这里需要安装两个安装包pcre和pcre-devel。第一个安装包提供编译版本的库，而第二个提供开发阶段的头文件和编译项目的源代码。yum install -y pcre pcre-devel</code></pre><h4 id="3-安装zlib"><a href="#3-安装zlib" class="headerlink" title="3.安装zlib"></a><strong>3.安装zlib</strong></h4><pre><code>zlib库提供了开发人员的压缩算法，在Nginx的各种模块中需要使用gzip压缩。yum install -y zlib zlib-devel</code></pre><h4 id="4-安装Open-SSL"><a href="#4-安装Open-SSL" class="headerlink" title="4.安装Open SSL"></a><strong>4.安装Open SSL</strong></h4><pre><code>nginx不仅支持 http协议，还支持 https（即在 ssl 协议上传输 http），如果使用了 https，需要安装 OpenSSL 库。yum install -y openssl openssl-devel</code></pre><h3 id="第三步：解压nginx压缩包并安装"><a href="#第三步：解压nginx压缩包并安装" class="headerlink" title="第三步：解压nginx压缩包并安装"></a><strong>第三步：解压nginx压缩包并安装</strong></h3><pre><code>解压 nginx-1.17.5.tar.gztar -zxvf nginx-1.17.5.tar.gz</code></pre><pre><code>解压之后，进入加压文件``然后进行配置，推荐使用默认配置。 命令如下cd nginx-1.17.5./configure （指定目录）</code></pre><h3 id="第四步：编译安装nginx"><a href="#第四步：编译安装nginx" class="headerlink" title="第四步：编译安装nginx"></a><strong>第四步：编译安装nginx</strong></h3><pre><code>进入目录 /usr/local/nginx-1.17.5 进行编译make</code></pre><pre><code>如果编译出错，请检查是否前面的4个安装都没有问题。``编译成功之后，就可以安装了make install</code></pre><h3 id="第五步：启动nginx"><a href="#第五步：启动nginx" class="headerlink" title="第五步：启动nginx"></a>第五步：启动nginx</h3><pre><code>启动nginx/usr/local/nginx/sbin/nginx 或者 ./nginx停止nginx/usr/local/nginx/sbin/nginx -s stop 或者 ./nginx -s stop重新加载/usr/local/nginx/sbin/nginx -s reload 或者 ./nginx -s reload测试检查配置文件/usr/local/nginx/sbin/nginx -t 或者 ./nginx -t</code></pre><h3 id="nginx配置文件详解"><a href="#nginx配置文件详解" class="headerlink" title="nginx配置文件详解"></a><strong>nginx配置文件详解</strong></h3><h4 id="1-nginx文件结构"><a href="#1-nginx文件结构" class="headerlink" title="1.nginx文件结构"></a><strong>1.nginx文件结构</strong></h4><pre><code>...              #全局块events {         #events块   ...}http      #http块{    ...   #http全局块    server        #server块    {         ...       #server全局块        location [PATTERN]   #location块        {            ...        }        location [PATTERN]         {            ...        }    }    server    {      ...    }    ...     #http全局块}</code></pre><p>1、全局块：配置影响nginx全局的指令。一般有运行nginx服务器的用户组，nginx进程pid存放路径，日志存放路径，配置文件引入，允许生成worker process数等。<br>2、events块：配置影响nginx服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。<br>3、http块：可以嵌套多个server，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，mime-type定义，日志自定义，是否使用sendfile传输文件，连接超时时间，单连接请求数等。<br>4、server块：配置虚拟主机的相关参数，一个http中可以有多个server。<br>5、location块：配置请求的路由，以及各种页面的处理情况。</p><h4 id="2-nginx配置详解"><a href="#2-nginx配置详解" class="headerlink" title="2.nginx配置详解"></a>2.<strong>nginx配置详解</strong></h4><pre><code>#定义Nginx运行的用户和用户组user www www;##nginx进程数,建议设置为等于CPU总核心数.worker_processes 8;##全局错误日志定义类型,[ debug | info | notice | warn | error | crit ]error_log /var/log/nginx/error.log info;##进程文件pid /var/run/nginx.pid;##一个nginx进程打开的最多文件描述符数目,理论值应该是最多打开文件数（系统的值ulimit -n）与nginx进程数相除,但是nginx分配请求并不均匀,所以建议与ulimit -n的值保持一致.worker_rlimit_nofile 65535;##工作模式与连接数上限events{    #参考事件模型,use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epoll模型是Linux 2.6以上版本内核中的高性能网络I/O模型,如果跑在FreeBSD上面,就用kqueue模型.    use epoll;    #单个进程最大连接数（最大连接数=连接数*进程数）    worker_connections 1024;    #最大连接数，默认为512}##设定http服务器http{    include mime.types; #文件扩展名与文件类型映射表    default_type application/octet-stream; #默认文件类型    #charset utf-8; #默认编码    server_names_hash_bucket_size 128; #服务器名字的hash表大小    client_header_buffer_size 32k; #上传文件大小限制    large_client_header_buffers 4 64k; #设定请求缓    client_max_body_size 8m; #设定请求缓      keepalive_timeout 65;  #连接超时时间，默认为75s，可以在http，server，location块。    # 开启目录列表访问,合适下载服务器,默认关闭.    autoindex on; # 显示目录    autoindex_exact_size on; # 显示文件大小 默认为on,显示出文件的确切大小,单位是bytes 改为off后,显示出文件的大概大小,单位是kB或者MB或者GB    autoindex_localtime on; # 显示文件时间 默认为off,显示的文件时间为GMT时间 改为on后,显示的文件时间为文件的服务器时间    sendfile on; # 开启高效文件传输模式,sendfile指令指定nginx是否调用sendfile函数来输出文件,对于普通应用设为 on,如果用来进行下载等应用磁盘IO重负载应用,可设置为off,以平衡磁盘与网络I/O处理速度,降低系统的负载.注意：如果图片显示不正常把这个改成off.    tcp_nopush on; # 防止网络阻塞    tcp_nodelay on; # 防止网络阻塞    # FastCGI相关参数是为了改善网站的性能：减少资源占用,提高访问速度.下面参数看字面意思都能理解.    fastcgi_connect_timeout 300; ## 链接    fastcgi_send_timeout 300;  ##读取 是指nginx进程向fastcgi进程发送request的整个过程的超时时间    fastcgi_read_timeout 300;  ##发请求 是指fastcgi进程向nginx进程发送response的整个过程的超时时间    fastcgi_buffer_size 64k;    fastcgi_buffers 4 64k;    fastcgi_busy_buffers_size 128k;    fastcgi_temp_file_write_size 128k;    # gzip模块设置    gzip on; #开启gzip压缩输出    gzip_min_length 1k; #允许压缩的页面的最小字节数,页面字节数从header偷得content-length中获取.默认是0,不管页面多大都进行压缩.建议设置成大于1k的字节数,小于1k可能会越压越大    gzip_buffers 4 16k; #表示申请4个单位为16k的内存作为压缩结果流缓存,默认值是申请与原始数据大小相同的内存空间来存储gzip压缩结果    gzip_http_version 1.1; #压缩版本（默认1.1,目前大部分浏览器已经支持gzip解压.前端如果是squid2.5请使用1.0）    gzip_comp_level 2; #压缩等级.1压缩比最小,处理速度快.9压缩比最大,比较消耗cpu资源,处理速度最慢,但是因为压缩比最大,所以包最小,传输速度快    gzip_types text/plain application/x-javascript text/css application/xml;    #压缩类型,默认就已经包含text/html,所以下面就不用再写了,写上去也不会有问题,但是会有一个warn.    gzip_vary on;#选项可以让前端的缓存服务器缓存经过gzip压缩的页面.例如:用squid缓存经过nginx压缩的数据    #开启限制IP连接数的时候需要使用    #limit_zone crawler $binary_remote_addr 10m;    ##upstream的负载均衡,四种调度算法(下例主讲)##    #虚拟主机的配置    server    {        # 监听端口        listen 80;        # 域名可以有多个,用空格隔开        server_name 127.0.0.1;        # HTTP 自动跳转 HTTPS        rewrite ^(.*) https://www.baidu.com;        deny 127.0.0.1;  #拒绝的ip        allow 172.18.5.54; #允许的ip     }    upstream myserver {         server 127.0.0.1:8080;      server 192.168.24.189:8080 backup;  #热备    }    server    {        # 监听端口 HTTPS        listen 443 ssl;        server_name https://www.baidu.com;        root /data/www/;        # 配置域名证书        ssl_certificate      C:\WebServer\Certs\certificate.crt;        ssl_certificate_key  C:\WebServer\Certs\private.key;        ssl_session_cache    shared:SSL:1m;        ssl_session_timeout  5m;        ssl_protocols SSLv2 SSLv3 TLSv1;        ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;        ssl_prefer_server_ciphers  on;        index index.html index.htm index.php;        location ~ .*\.(php|php5)?$        {            fastcgi_pass 127.0.0.1:9000;            fastcgi_index index.php;            include fastcgi.conf;        }        # 配置地址拦截转发，解决跨域验证问题        location /oauth/{            proxy_pass https://localhost:13580/oauth/;            proxy_set_header HOST $host;            proxy_set_header X-Real-IP $remote_addr;            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;        }        # 图片缓存时间设置        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$ {            expires 10d;        }        # JS和CSS缓存时间设置        location ~ .*\.(js|css)?$ {            expires 1h;        }        # 日志格式设定        log_format access '$server_name $remote_addr -$remote_user [$time_local] "$request"'                  '$status $uptream_status $body_bytes_sent "$http_referer"'                  '"$http_user_agent" "$http_x_forwarded_for" '                  '$ssl_protocol $ssl_cipher $upstream_addr $request_time $upstream_response_time';       # 定义本虚拟主机的访问日志        access_log /var/log/nginx/access.log access;        # 设定查看Nginx状态的地址.StubStatus模块能够获取Nginx自上次启动以来的工作状态，此模块非核心模块，需要在Nginx编译安装时手工指定才能使用        location /NginxStatus {            stub_status on;            access_log on;            auth_basic "NginxStatus";            auth_basic_user_file conf/htpasswd;            #htpasswd文件的内容可以用apache提供的htpasswd工具来产生.        }    }}</code></pre><p>1.与remoteaddr与http_x_forwarded_for 用以记录客户端的ip地址；<br>2.$remote_user ：用来记录客户端用户名称；<br>3.$time_local ： 用来记录访问时间与时区；<br>4.$request ： 用来记录请求的url与http协议；<br>5.$status ： 用来记录请求状态；成功是200，<br>6.$body_bytes_s ent ：记录发送给客户端文件主体内容大小；<br>7.$http_referer ：用来记录从那个页面链接访问过来的；<br>8.$http_user_agent ：记录客户端浏览器的相关信息；<br>9.惊群现象：一个网路连接到来，多个睡眠的进程被同事叫醒，但只有一个进程能获得链接，这样会影响系统性能。<br>10.每个指令必须有分号结束。</p><h3 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h3><p>nginx是一个功能非常强大的web服务器加反向代理服务器，同时又是邮件服务器等等</p><p>在项目使用中，使用最多的三个核心功能是反向代理、负载均衡和静态服务器</p><p>这三个不同的功能的使用，都跟nginx的配置密切相关，nginx服务器的配置信息主要集中在nginx.conf这个配置文件中，并且所有的可配置选项大致分为以下几个部分</p><pre><code>main                                # 全局配置events {                            # nginx工作模式配置}http {                                # http设置    ....    server {                        # 服务器主机配置        ....        location {                    # 路由配置            ....        }        location path {            ....        }        location otherpath {            ....        }    }    server {        ....        location {            ....        }    }    upstream name {                    # 负载均衡配置        ....    }}</code></pre><p>如上述配置文件所示，主要由6个部分组成：</p><ol><li>main：用于进行nginx全局信息的配置</li><li>events：用于nginx工作模式的配置</li><li>http：用于进行http协议信息的一些配置</li><li>server：用于进行服务器访问信息的配置</li><li>location：用于进行访问路由的配置</li><li>upstream：用于进行负载均衡的配置</li></ol><h4 id="main模块"><a href="#main模块" class="headerlink" title="main模块"></a>main模块</h4><p>观察下面的配置代码</p><pre><code># user nobody nobody;worker_processes 2;# error_log logs/error.log# error_log logs/error.log notice# error_log logs/error.log info# pid logs/nginx.pidworker_rlimit_nofile 1024;</code></pre><p>上述配置都是存放在main全局配置模块中的配置项</p><ul><li>user用来指定nginx worker进程运行用户以及用户组，默认nobody账号运行</li><li>worker_processes指定nginx要开启的子进程数量，运行过程中监控每个进程消耗内存(一般几M~几十M不等)根据实际情况进行调整，通常数量是CPU内核数量的整数倍</li><li>error_log定义错误日志文件的位置及输出级别【debug / info / notice / warn / error / crit】</li><li>pid用来指定进程id的存储文件的位置</li><li>worker_rlimit_nofile用于指定一个进程可以打开最多文件数量的描述</li></ul><h4 id="event-模块"><a href="#event-模块" class="headerlink" title="event 模块"></a>event 模块</h4><p>上干货</p><pre><code>event {    worker_connections 1024;    multi_accept on;    use epoll;}</code></pre><p>上述配置是针对nginx服务器的工作模式的一些操作配置</p><ul><li>worker_connections 指定最大可以同时接收的连接数量，这里一定要注意，最大连接数量是和worker processes共同决定的。</li><li>multi_accept 配置指定nginx在收到一个新连接通知后尽可能多的接受更多的连接</li><li>use epoll 配置指定了线程轮询的方法，如果是linux2.6+，使用epoll，如果是BSD如Mac请使用Kqueue</li></ul><h4 id="server模块"><a href="#server模块" class="headerlink" title="server模块"></a>server模块</h4><p>srever模块配置是http模块中的一个子模块，用来定义一个虚拟访问主机，也就是一个虚拟服务器的配置信息</p><pre><code>server {    listen        80;    server_name localhost    192.168.1.100;    root        /nginx/www;    index        index.php index.html index.html;    charset        utf-8;    access_log    logs/access.log;    error_log    logs/error.log;    ......}</code></pre><p>核心配置信息如下：</p><ul><li>server：一个虚拟主机的配置，一个http中可以配置多个server</li><li>server_name：用力啊指定ip地址或者域名，多个配置之间用空格分隔</li><li>root：表示整个server虚拟主机内的根目录，所有当前主机中web项目的根目录</li><li>index：用户访问web网站时的全局首页</li><li>charset：用于设置www/路径中配置的网页的默认编码格式</li><li>access_log：用于指定该虚拟主机服务器中的访问记录日志存放路径</li><li>error_log：用于指定该虚拟主机服务器中访问错误日志的存放路径</li></ul><h4 id="location模块"><a href="#location模块" class="headerlink" title="location模块"></a>location模块</h4><p>location模块是nginx配置中出现最多的一个配置，主要用于配置路由访问信息</p><p>在路由访问信息配置中关联到反向代理、负载均衡等等各项功能，所以location模块也是一个非常重要的配置模块</p><p>基本配置</p><pre><code>location / {    root    /nginx/www;    index    index.php index.html index.htm;}</code></pre><p>location /：表示匹配访问根目录</p><p>root：用于指定访问根目录时，访问虚拟主机的web目录</p><p>index：在不指定访问具体资源时，默认展示的资源文件列表</p><p>反向代理配置方式</p><p>通过反向代理代理服务器访问模式，通过proxy_set配置让客户端访问透明化</p><pre><code>location / {    proxy_pass http://localhost:8888;    proxy_set_header X-real-ip $remote_addr;    proxy_set_header Host $http_host;}</code></pre><p>uwsgi配置</p><p>wsgi模式下的服务器配置访问方式</p><pre><code>location / {    include uwsgi_params;    uwsgi_pass localhost:8888}</code></pre><h4 id="upstream模块"><a href="#upstream模块" class="headerlink" title="upstream模块"></a>upstream模块</h4><p>upstream模块主要负责负载均衡的配置，通过默认的轮询调度方式来分发请求到后端服务器</p><p>简单的配置方式如下</p><pre><code>upstream name {    ip_hash;    server 192.168.1.100:8000;    server 192.168.1.100:8001 down;    server 192.168.1.100:8002 max_fails=3;    server 192.168.1.100:8003 fail_timeout=20s;    server 192.168.1.100:8004 max_fails=3 fail_timeout=20s;}</code></pre><p>核心配置信息如下</p><ul><li>ip_hash：指定请求调度算法，默认是weight权重轮询调度，可以指定</li><li>server host:port：分发服务器的列表配置</li><li>– down：表示该主机暂停服务</li><li>– max_fails：表示失败最大次数，超过失败最大次数暂停服务</li><li>– fail_timeout：表示如果请求受理失败，暂停指定的时间之后重新发起请求</li></ul><p>​       </p><hr><p><strong>持续更新中…，如果遇到问题欢迎联系我，在文章最后评论区【留言和讨论】笑～</strong></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java学习之Java环境配置</title>
      <link href="/2023/03/22/blog-open-source-java-environment/"/>
      <url>/2023/03/22/blog-open-source-java-environment/</url>
      
        <content type="html"><![CDATA[<h1 id="Java学习笔记之Java环境配置"><a href="#Java学习笔记之Java环境配置" class="headerlink" title="Java学习笔记之Java环境配置"></a>Java学习笔记之Java环境配置</h1><h2 id="1-配置Path环境变量"><a href="#1-配置Path环境变量" class="headerlink" title="1. 配置Path环境变量"></a>1. 配置Path环境变量</h2><p>计算机右键属性—高级系统设置—环境变量;</p><h4 id="新建，添加变量名-JAVA-HOME-，"><a href="#新建，添加变量名-JAVA-HOME-，" class="headerlink" title="新建，添加变量名 JAVA_HOME ，"></a>新建，添加变量名 <strong>JAVA_HOME</strong> ，</h4><p>变量值为之前自己jdk的安装路径，如下：</p><pre class="line-numbers language-bash"><code class="language-bash">C:\Program Files\Java\jdk1.8.0_181<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p> <img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="C:%5CUsers%5C%E5%8D%81%E4%B8%80%E8%A5%BF%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20230509102743454.png" alt="image-20230509102743454"></p><h4 id="系统环境变量新建CLASSPATH环境变量"><a href="#系统环境变量新建CLASSPATH环境变量" class="headerlink" title="系统环境变量新建CLASSPATH环境变量"></a>系统环境变量新建CLASSPATH环境变量</h4><p>新建，添加变量名 <strong>CLASSPATH</strong> ，变量值为：</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">.</span><span class="token punctuation">;</span>%JAVA_HOME%\lib<span class="token punctuation">;</span>%JAVA_HOME%\lib\tools.jar 或者 <span class="token keyword">.</span><span class="token punctuation">;</span>%JAVA_HOME%\lib<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>我试过两个都可以，所以二选一，注意不要忘记前面的点和中间的分号。点击“确定“，如图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://pic4.zhimg.com/80/v2-68a315e024f85f3d475c767d3c842a8b_1440w.webp" alt="img"></p><h4 id="编辑Path变量"><a href="#编辑Path变量" class="headerlink" title="编辑Path变量"></a>编辑Path变量</h4><p>找到系统变量里变量为<strong>Path</strong>的行，选中，并点击编辑，追加如下：</p><pre class="line-numbers language-bash"><code class="language-bash">%JAVA_HOME%\bin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="C:%5CUsers%5C%E5%8D%81%E4%B8%80%E8%A5%BF%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20230509103136966.png" alt="image-20230509103136966"></p><h4 id="检测JDK环境变量是否配置成功"><a href="#检测JDK环境变量是否配置成功" class="headerlink" title="检测JDK环境变量是否配置成功"></a>检测JDK环境变量是否配置成功</h4><p>使用快捷键win+R，在弹出的运行命令窗口输入CMD回车运行，光标后输入java，然后回车，看到如下图所示，表示环境变量安装成功。</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="C:%5CUsers%5C%E5%8D%81%E4%B8%80%E8%A5%BF%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20230509095747386.png" alt="image-20230509095747386"></p><h2 id="2-Java程序开发运行流程"><a href="#2-Java程序开发运行流程" class="headerlink" title="2. Java程序开发运行流程"></a>2. Java程序开发运行流程</h2><p>开发Java程序，需要三个步骤：编写程序，编译程序，运行程序。</p><p><img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img2020.cnblogs.com/blog/1354564/202111/1354564-20211101181437857-89659389.png" alt="img"></p><p> <img src="https://cdn.jsdelivr.net/gh/liaoxingwang/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img2020.cnblogs.com/blog/1354564/202111/1354564-20211101181459748-1480791867.png" alt="img"></p><h2 id="3-HelloWorld"><a href="#3-HelloWorld" class="headerlink" title="3. HelloWorld"></a>3. HelloWorld</h2><pre><code>public class HelloWorld {    public static void main(String[] args) {        System.out.println("HelloWorld");    }}</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>专业团队高效接单</title>
      <link href="/2020/11/21/blog-open-source/"/>
      <url>/2020/11/21/blog-open-source/</url>
      
        <content type="html"><![CDATA[<h1 id="团队介绍"><a href="#团队介绍" class="headerlink" title="团队介绍"></a>团队介绍</h1><p>滴滴滴，接单啦接单啦欢迎各位老板咨询18124777246 服务包括管理系统，小程序，APP，优质课程讲解等都可以找我哦，质量保证，服务态度超好，售后服务一级棒</p><p>我们的优势： 6年Java开发经验，有带领团队经验，良好的售后服务，有团队可整包开发，对待项目认真负责能按时交付，在项目开发过程中积极与用户对接，质量保证，时间效率高，解决问题能力强。经验丰富、认真细致、责任心强！</p><h2 id="服务前需客户提供的信息："><a href="#服务前需客户提供的信息：" class="headerlink" title="服务前需客户提供的信息："></a>服务前需客户提供的信息：</h2><p>• 需求文档，需求功能的确定<br>• 双方确定开发周期，合理安排时间<br>• 项目git地址，以及权限开通，若无我们可提供</p><h2 id="我们能做的事情"><a href="#我们能做的事情" class="headerlink" title="我们能做的事情"></a>我们能做的事情</h2><p>•    整包服务(只需沟通需求，或文档若无我们可以代写文档)<br>•    前后端(Java，vue，React，Angular)课程辅导，面试辅导<br>•    后台管理系统开发<br>•    物联网平台开发<br>•    数据API开发<br>•    毕业设计整套开发<br>•    微信公众号开发<br>•    微信小程序开发<br>•    PC网站官网开发<br>•    H5移动端开发<br>•    大学算法课程<br>•    面试代做答疑助攻<br>•   前端官网整套服务<br>•   商单<br>•   毕设<br>•   面试辅助答疑<br>•   算法课程讲解<br>•    其他业务正扩展中敬请期待  </p><h2 id="团队人员"><a href="#团队人员" class="headerlink" title="团队人员"></a>团队人员</h2><table><thead><tr><th>角色</th><th>开发职位</th></tr></thead><tbody><tr><td>负责人</td><td>高级Java开发</td></tr><tr><td>队员</td><td>前端工程师(5人)</td></tr><tr><td>队员</td><td>后端工程师(5人)</td></tr><tr><td>队员</td><td>测试工程师(2人)</td></tr><tr><td>队员</td><td>Android工程师(2人)</td></tr><tr><td>队员</td><td>iOS工程师(2人)</td></tr></tbody></table><h3 id="后端包含的工作："><a href="#后端包含的工作：" class="headerlink" title="后端包含的工作："></a>后端包含的工作：</h3><p>1、需求分析讨论或腾讯会议沟通<br>2、技术选型，框架搭建接口实现<br>3、数据库表设计，设计文档<br>4、接口文档产出<br>5、接口对接，问题记录修复<br>6、项目部署上线</p><h3 id="前端包含的工作："><a href="#前端包含的工作：" class="headerlink" title="前端包含的工作："></a>前端包含的工作：</h3><p>1、开需求评审会，讨论相关需求，并提出自己的相关看法<br>2、前端技术选型，搭建基本架构<br>3、前端静态页面实现<br>4、模拟接口进行交互调整<br>5、对接后台接口，完成功能<br>6、项目自测并分析项目可优化点<br>7、接口文档产出<br>8、操作手册编写</p><hr><h1 id="前端技术能力"><a href="#前端技术能力" class="headerlink" title="前端技术能力"></a>前端技术能力</h1><pre><code>* 框架    1. vue2    2. vue2+nuxt.js    3. vue3    4. react      5. jquery* 多端框架    1. uni-app    2. Taro    3. ui库    4. element-ui      5. element-plus        6. Ant Design    7. vant      8. layui * 第三方库    1. axios    2. echarts    3. qrcodejs2    4. html2canvas      5. bootstrap* 其他    1. es6    2. webpack    3. vite       </code></pre><ul><li>持续更新…</li></ul><h1 id="后端技术能力"><a href="#后端技术能力" class="headerlink" title="后端技术能力"></a>后端技术能力</h1><p>1、熟悉 Java 语法，多线程、集合等基础框架,熟练掌握Spring,SpringMVC，Mybatis,SpringBoot等开源技术，以及 Gradle、Maven 等项目,并能熟练搭建整合SSM框架，进行 Junit，Debug测试以及热部署。<br>2、熟练掌握常见的开发工具Eclipse，IDEA，并能熟练使用常见的项目构建工具maven构建项目, 熟悉分布式 的Git协同开发工具。<br>3、熟练掌握Mysql数据库。熟悉常见的Sql优化，熟悉Mysql 的读写分离，Mycat分库分表和Linux系统下 的环境搭建。<br>4、熟悉Redis非关系型数据库，熟悉Redis的高可用架构，了解缓存雪崩和穿透等解决方案，知道如何保证缓 存数据库双写时的数据一致性。<br>5、熟悉Shiro，Spring Security，Sa-Token认证授权框架，Quartz定时工具以及利用Echarts实现数据可视化。<br>6、熟悉Solr的全文搜索引擎，FastDFS分布式文件等。<br>7、熟悉Linux操作系统的常用命令以及Nginx，ZooKeeper，Redis的集群环境搭建，熟悉应用服务器软件 Tomcat 等容器配置和部署。<br>8、熟练掌握基于RPC的Dubbo，WebService技术，熟悉网络编程，mqtt，Websocket，modbus，tcp协议开发，熟悉物联网项目开发，终端设备接入，LoRa，Bluetooth数据对接。<br>9、熟练使用ZooKeeper分布式协调工具，了解其集群管理，配置管理以及分布式锁的应用。<br>10、熟悉kafak，RabbitMQ，RocketMQ等消息中间件，了解如何保证消息中间件的高可用以及消息的可靠传输和顺序 性问题。利用 MQ 做异步处理，削峰填谷。<br>11、熟悉JVM体系结构与GC优化对,JVM 原理深刻理解，包括内存模型、垃圾回收机制等。<br>12、熟练运用springBoot，springClood、dubbo 以及springcloud alibaba等主流框架。<br>13、熟练使用构建容器有jenkins、docker、k8s、rancher 经验部署。</p><h1 id="项目经验"><a href="#项目经验" class="headerlink" title="项目经验"></a>项目经验</h1><p>以下项目都为真实项目，可体验<br>1.DC农业官网 <a href="https://www.idianchou.com/" target="_blank" rel="noopener">https://www.idianchou.com/</a><br>前端技术栈：vue2+nuxt.js+element-ui+echarts+axios+postcss-px2rem</p><p>2.供应商发票系统 <a href="http://zsc.dianchoutest.com:10086/login" target="_blank" rel="noopener">http://zsc.dianchoutest.com:10086/login</a><br>前端技术栈：react+redux+antd+axios<br>后端技术栈：SpingCloud+SpringSecurity +Kafka +MySQL +Redis</p><p>3.供应商小程序 #小程序://DC供应商端/lL8Wtd3ldbuRhgH<br>前端技术栈：微信原生小程序+flyio.js</p><p>4.dch5 <a href="http://zsc.dianchoutest.com" target="_blank" rel="noopener">http://zsc.dianchoutest.com</a><br>前端技术栈:vue2+vant+qrcodejs2+html2canvas+axios+echarts </p><p>5.蔬东坡DC后台管理<a href="http://zsc.dianchoutest.com:9050/#/login" target="_blank" rel="noopener">http://zsc.dianchoutest.com:9050/#/login</a><br>前端技术栈:vue3+vuex+postcss-pxtorem+element-plus+axios+ts<br>后端技术栈：SpingCloud+SpringSecurity +MySQL+ Kafka +Redis</p><p>6.智农宁津管理后台 <a href="http://zsc.dianchoutest.com:9060/#/login" target="_blank" rel="noopener">http://zsc.dianchoutest.com:9060/#/login</a><br>前端技术栈：vite+vue3+ts+element-plus+pinia+axios+eslint+husky+lint-staged<br>后端技术栈：SpingCloud+SpringSecurity +MySQL +Redis</p><p>7.智农宁津 小程序://智农宁津/dabZgAIqbqA5XUk</p><p>8.DC严选批发 #小程序://DC严选批发/wiGGRkzduyc1tro</p><p>9.DC云菜篮 #小程序://DC云菜篮/BhPr6pG95sY562y</p><p>10.DC餐单 #小程序://DC餐单/AFTxFWDy1EHza7u</p><p>11.DC生鲜 #小程序://DC生鲜/OgfRQeruyHHs1OI</p><p>12.DC精品水果批发 #小程序://DC精品水果批发/NorNX8c4IjfsPiH</p><p>13.DC小掌柜</p><p>14.读行网<br>15.山海秀<br>16.读行网后台管理系统</p><p>17.鑫宝体育<br>前端技术栈：vite+vue3+ts+element-plus+pinia+axios+eslint+husky+lint-staged+ Nuxt<br>后端技术栈：Spring、SpringMVC +SpingCloud+阿里云PolarDB +Redis+ Nginx<br>18.鑫宝体育ssr<br>19.鑫宝体育后台管理系统<br>20.鑫宝体育H5<br>21.鑫宝体育小程序  </p><p>22.南山课后服务<br>23.中启教育后台管理系统<br>24.四点半小程序</p><p>25.找礼品网 PC（SSR）、找礼品网  PC、集团商城 PC<br>前端技术栈：vue2 + Nuxt.js + echarts+rerender-spa-plugin+vue-meta-info+vue-cropper+QRCode.js<br>后端技术栈：SpingCloud+ SpringSecurity oauth2+MySQL +Redis+ Nginx</p><p>26.找礼品网移动端、集团商城 移动端<br>前端技术栈：vue2 + vuex + axios + echart<br>后端技术栈：SpingCloud+ SpringSecurity oauth2+MySQL+ RabbitMQ +Redis+ Nginx</p><p>27.艾象商城微信小程序、艾象商城百度小程序、艾象集采微信小程序<br>前端技术栈：uni-app+vant<br>后端技术栈：SpingCloud+ SpringSecurity oauth2+MySQL+ RabbitMQ +Redis+ Nginx</p><p>28.云通讯BOSS平台、云通讯EMS平台、中行企业短信平台、聚信通讯信息平台、<br>川航短信平台、东莞证券短信平台<br>前端技术栈：vue2+Element-ui+vuedraggable+mavonEditor+Export2Excel+echarts<br>后端技术栈：SpingCloud+ SpringSecurity oauth2+MySQL + RabbitMQ +Redis+ Nginx</p><p>29.EMS信息监控大屏<br>前端技术栈：websocket+Echarts+i18n+webpack+vue2+Element-ui<br>后端技术栈：SpingCloud+ SpringSecurity oauth2+MySQL +Redis+ Nginx</p><p>30.易顺云企业管理系统<br>前端技术栈：vue2 + element ui + echarts<br>后端技术栈：SpingCloud+ SpringSecurity oauth2+MySQL +Redis+ Nginx</p><p>31.深圳市城市轨道交通CLC二期系统<br>前端技术栈：vue3 + typeScript + antdVue ui + echart<br>后端技术栈：SpingCloud+MySQL +Redis+ Nginx</p><p>32.天津四号线运营管理系统<br>前端技术栈：react + antd<br>后端技术栈：SpingCloud+MySQL +Redis+ RabbitMQ+ Maven + Nginx</p><p>33.九彩育儿(微信小程序)</p><hr><p><strong>持续更新中…，如果遇到问题欢迎联系我，在文章最后评论区【留言和讨论】笑～</strong></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> 高效接单 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 高效接单 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
